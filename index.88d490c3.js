!function(){function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},i={},a=n.parcelRequire94c2;null==a&&((a=function(e){if(e in r)return r[e].exports;if(e in i){var t=i[e];delete i[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},n.parcelRequire94c2=a),a.register("2evKT",(function(t,n){var r,i;e(t.exports,"register",(function(){return r}),(function(e){return r=e})),e(t.exports,"resolve",(function(){return i}),(function(e){return i=e}));var a={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)a[t[n]]=e[t[n]]},i=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a.register("4gaLD",(function(t,n){e(t.exports,"applyDecoratedDescriptor",(function(){return a("1VoUi").default})),e(t.exports,"arrayWithHoles",(function(){return a("9QPBY").default})),e(t.exports,"arrayWithoutHoles",(function(){return a("93uWT").default})),e(t.exports,"assertThisInitialized",(function(){return a("dtpWT").default})),e(t.exports,"asyncGenerator",(function(){return a("k2zz2").default})),e(t.exports,"asyncGeneratorDelegate",(function(){return a("im0iK").default})),e(t.exports,"asyncIterator",(function(){return a("bZaaJ").default})),e(t.exports,"asyncToGenerator",(function(){return a("1ELdT").default})),e(t.exports,"awaitAsyncGenerator",(function(){return a("ioDir").default})),e(t.exports,"awaitValue",(function(){return a("dEdf1").default})),e(t.exports,"classCallCheck",(function(){return a("5nGP2").default})),e(t.exports,"classNameTDZError",(function(){return a("2n2Eu").default})),e(t.exports,"classPrivateFieldGet",(function(){return a("7CIl9").default})),e(t.exports,"classPrivateFieldLooseBase",(function(){return a("hju27").default})),e(t.exports,"classPrivateFieldSet",(function(){return a("dounu").default})),e(t.exports,"classPrivateMethodGet",(function(){return a("11ovY").default})),e(t.exports,"classPrivateMethodSet",(function(){return a("3lm3s").default})),e(t.exports,"classStaticPrivateFieldSpecGet",(function(){return a("fUuGy").default})),e(t.exports,"classStaticPrivateFieldSpecSet",(function(){return a("4RzKu").default})),e(t.exports,"construct",(function(){return a("32sR3").default})),e(t.exports,"createClass",(function(){return a("8TCpN").default})),e(t.exports,"decorate",(function(){return a("gTPvi").default})),e(t.exports,"defaults",(function(){return a("5Fbir").default})),e(t.exports,"defineEnumerableProperties",(function(){return a("jkn5s").default})),e(t.exports,"defineProperty",(function(){return a("iXkAt").default})),e(t.exports,"extends",(function(){return a("6B2k9").default})),e(t.exports,"get",(function(){return a("9BvPR").default})),e(t.exports,"getPrototypeOf",(function(){return a("kksNc").default})),e(t.exports,"inherits",(function(){return a("5Vcrn").default})),e(t.exports,"inheritsLoose",(function(){return a("lFHjz").default})),e(t.exports,"initializerDefineProperty",(function(){return a("8EHSx").default})),e(t.exports,"initializerWarningHelper",(function(){return a("ahTIG").default})),e(t.exports,"_instanceof",(function(){return a("jnOWE").default})),e(t.exports,"interopRequireDefault",(function(){return a("7Te0B").default})),e(t.exports,"interopRequireWildcard",(function(){return a("jWuj6").default})),e(t.exports,"isNativeFunction",(function(){return a("laEC7").default})),e(t.exports,"iterableToArray",(function(){return a("9TcPW").default})),e(t.exports,"iterableToArrayLimit",(function(){return a("69XTi").default})),e(t.exports,"iterableToArrayLimitLoose",(function(){return a("2tM2P").default})),e(t.exports,"jsx",(function(){return a("bOiDs").default})),e(t.exports,"newArrowCheck",(function(){return a("iPsIo").default})),e(t.exports,"nonIterableRest",(function(){return a("emdgA").default})),e(t.exports,"nonIterableSpread",(function(){return a("ngiRg").default})),e(t.exports,"objectSpread",(function(){return a("aoONY").default})),e(t.exports,"objectWithoutProperties",(function(){return a("56zPf").default})),e(t.exports,"objectWithoutPropertiesLoose",(function(){return a("gsjeZ").default})),e(t.exports,"possibleConstructorReturn",(function(){return a("g3BpA").default})),e(t.exports,"readOnlyError",(function(){return a("aNIse").default})),e(t.exports,"set",(function(){return a("dsYLu").default})),e(t.exports,"setPrototypeOf",(function(){return a("kJxmx").default})),e(t.exports,"skipFirstGeneratorNext",(function(){return a("64eYx").default})),e(t.exports,"slicedToArray",(function(){return a("69ldn").default})),e(t.exports,"slicedToArrayLoose",(function(){return a("byMw4").default})),e(t.exports,"superPropBase",(function(){return a("aBJPM").default})),e(t.exports,"taggedTemplateLiteral",(function(){return a("iQZ9N").default})),e(t.exports,"taggedTemplateLiteralLoose",(function(){return a("jo3tj").default})),e(t.exports,"_throw",(function(){return a("8mCvL").default})),e(t.exports,"toArray",(function(){return a("6EAw4").default})),e(t.exports,"toConsumableArray",(function(){return a("k53V6").default})),e(t.exports,"toPrimitive",(function(){return a("fk4ZW").default})),e(t.exports,"toPropertyKey",(function(){return a("hcP60").default})),e(t.exports,"typeOf",(function(){return a("gdFSe").default})),e(t.exports,"wrapAsyncGenerator",(function(){return a("61v0m").default})),e(t.exports,"wrapNativeSuper",(function(){return a("lWQ0P").default})),e(t.exports,"createSuper",(function(){return a("l5X8n").default})),e(t.exports,"isNativeReflectConstruct",(function(){return a("bkLps").default}));a("1VoUi"),a("9QPBY"),a("93uWT"),a("dtpWT"),a("k2zz2"),a("im0iK"),a("bZaaJ"),a("1ELdT"),a("ioDir"),a("dEdf1"),a("5nGP2"),a("2n2Eu"),a("7CIl9"),a("hju27"),a("dounu"),a("11ovY"),a("3lm3s"),a("fUuGy"),a("4RzKu"),a("32sR3"),a("8TCpN"),a("gTPvi"),a("5Fbir"),a("jkn5s"),a("iXkAt"),a("6B2k9"),a("9BvPR"),a("kksNc"),a("5Vcrn"),a("lFHjz"),a("8EHSx"),a("ahTIG"),a("jnOWE"),a("7Te0B"),a("jWuj6"),a("laEC7"),a("9TcPW"),a("69XTi"),a("2tM2P"),a("bOiDs"),a("iPsIo"),a("emdgA"),a("ngiRg"),a("aoONY"),a("56zPf"),a("gsjeZ"),a("g3BpA"),a("aNIse"),a("dsYLu"),a("kJxmx"),a("64eYx"),a("69ldn"),a("byMw4"),a("aBJPM"),a("iQZ9N"),a("jo3tj"),a("8mCvL"),a("6EAw4"),a("k53V6"),a("fk4ZW"),a("hcP60"),a("gdFSe"),a("61v0m"),a("lWQ0P"),a("l5X8n"),a("bkLps")})),a.register("1VoUi",(function(t,n){function r(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r&&r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}e(t.exports,"default",(function(){return r}))})),a.register("9QPBY",(function(t,n){function r(e){if(Array.isArray(e))return e}e(t.exports,"default",(function(){return r}))})),a.register("93uWT",(function(t,n){function r(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}e(t.exports,"default",(function(){return r}))})),a.register("dtpWT",(function(t,n){function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e(t.exports,"default",(function(){return r}))})),a.register("k2zz2",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("dEdf1");function i(e){var t,n;function i(t,n){try{var o=e[t](n),s=o.value,l=s instanceof r.default;Promise.resolve(l?s.wrapped:s).then((function(e){l?i("next",e):a(o.done?"return":"normal",e)}),(function(e){i("throw",e)}))}catch(e){a("throw",e)}}function a(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise((function(a,o){var s={key:e,arg:r,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,i(e,r))}))},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)}})),a.register("dEdf1",(function(t,n){function r(e){this.wrapped=e}e(t.exports,"default",(function(){return r}))})),a.register("im0iK",(function(t,n){function r(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new Promise((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return i("return",e)}),n}e(t.exports,"default",(function(){return r}))})),a.register("bZaaJ",(function(t,n){function r(e){var t;if("function"==typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}e(t.exports,"default",(function(){return r}))})),a.register("1ELdT",(function(t,n){function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)}))}}e(t.exports,"default",(function(){return i}))})),a.register("ioDir",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("dEdf1");function i(e){return new r.default(e)}})),a.register("5nGP2",(function(t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(t.exports,"default",(function(){return r}))})),a.register("2n2Eu",(function(t,n){function r(e){throw new Error('Class "'+e+'" cannot be referenced in computed property keys.')}e(t.exports,"default",(function(){return r}))})),a.register("7CIl9",(function(t,n){function r(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e).value}e(t.exports,"default",(function(){return r}))})),a.register("hju27",(function(t,n){function r(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}e(t.exports,"default",(function(){return r}))})),a.register("dounu",(function(t,n){function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}e(t.exports,"default",(function(){return r}))})),a.register("11ovY",(function(t,n){function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}e(t.exports,"default",(function(){return r}))})),a.register("3lm3s",(function(t,n){function r(){throw new TypeError("attempted to reassign private method")}e(t.exports,"default",(function(){return r}))})),a.register("fUuGy",(function(t,n){function r(e,t,n){if(e!==t)throw new TypeError("Private static access of wrong provenance");return n.value}e(t.exports,"default",(function(){return r}))})),a.register("4RzKu",(function(t,n){function r(e,t,n,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");if(!n.writable)throw new TypeError("attempted to set read only private field");return n.value=r,r}e(t.exports,"default",(function(){return r}))})),a.register("32sR3",(function(t,n){function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function i(e,t,n){return(i=r()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function a(e,t,n){return i.apply(null,arguments)}e(t.exports,"default",(function(){return a}))})),a.register("8TCpN",(function(t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}e(t.exports,"default",(function(){return i}))})),a.register("gTPvi",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("6EAw4"),i=a("hcP60");function o(e,t,n){var r,i,a,o=t((function(e){!function(e,t){["method","field"].forEach((function(n){t.forEach((function(t){t.kind===n&&"own"===t.placement&&h(e,t)}))}))}(e,f.elements)}),n),f=function(e,t){var n=[],r=[],i={static:[],prototype:[],own:[]};if(e.forEach((function(e){d(e,i)})),e.forEach((function(e){if(!c(e))return n.push(e);var t=function(e,t){for(var n=[],r=[],i=e.decorators,a=i.length-1;a>=0;a--){var o=t[e.placement];o.splice(o.indexOf(e.key),1);var s=p(e),l=v((0,i[a])(s)||s);d(e=l.element,t),l.finisher&&r.push(l.finisher);var c=l.extras;if(c){for(var u=0;u<c.length;u++)d(c[u],t);n.push.apply(n,c)}}return{element:e,finishers:r,extras:n}}(e,i);n.push(t.element),n.push.apply(n,t.extras),r.push.apply(r,t.finishers)})),!t)return{elements:n,finishers:r};var a=function(e,t){for(var n=[],r=t.length-1;r>=0;r--){var i=m(e),a=y((0,t[r])(i)||i);if(void 0!==a.finisher&&n.push(a.finisher),void 0!==a.elements){e=a.elements;for(var o=0;o<e.length-1;o++)for(var s=o+1;s<e.length;s++)if(e[o].key===e[s].key&&e[o].placement===e[s].placement)throw new TypeError("Duplicated element ("+e[o].key+")")}}return{elements:e,finishers:n}}(n,t);return r.push.apply(r,a.finishers),a.finishers=r,a}(function(e){for(var t=[],n=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=t.find(n)))if(u(a.descriptor)||u(i.descriptor)){if(c(a)||c(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(c(a)){if(c(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}l(a,i)}else t.push(a)}return t}(o.d.map(s)),e);return r=o.F,i=f.elements,a=r.prototype,["method","field"].forEach((function(e){i.forEach((function(t){var n=t.placement;t.kind!==e||"static"!==n&&"prototype"!==n||h("static"===n?r:a,t)}))})),function(e,t){for(var n=0;n<t.length;n++){var r=(0,t[n])(e);if(void 0!==r){if("function"!=typeof r)throw new TypeError("Finishers must return a constructor.");e=r}}return e}(o.F,f.finishers)}function s(e){var t,n=i.default(e.key);"method"===e.kind?(t={value:e.value,writable:!0,configurable:!0,enumerable:!1},Object.defineProperty(e.value,"name",{value:"symbol"===_typeof(n)?"":n,configurable:!0})):"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var r={kind:"field"===e.kind?"field":"method",key:n,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(r.decorators=e.decorators),"field"===e.kind&&(r.initializer=e.value),r}function l(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function c(e){return e.decorators&&e.decorators.length}function u(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function h(e,t){var n=t.descriptor;if("field"===t.kind){var r=t.initializer;n={enumerable:n.enumerable,writable:n.writable,configurable:n.configurable,value:void 0===r?void 0:r.call(e)}}Object.defineProperty(e,t.key,n)}function d(e,t,n){var r=t[e.placement];if(!n&&-1!==r.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");r.push(e.key)}function p(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t}function f(e){if(void 0!==e)return r.default(e).map((function(e){var t=g(e);return x(e,"finisher","An element descriptor"),x(e,"extras","An element descriptor"),t}))}function g(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var n=i.default(e.key),r=String(e.placement);if("static"!==r&&"prototype"!==r&&"own"!==r)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+r+'"');var a=e.descriptor;x(e,"elements","An element descriptor");var o={kind:t,key:n,placement:r,descriptor:Object.assign({},a)};return"field"!==t?x(e,"initializer","A method descriptor"):(x(a,"get","The property descriptor of a field descriptor"),x(a,"set","The property descriptor of a field descriptor"),x(a,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o}function v(e){return{element:g(e),finisher:b(e,"finisher"),extras:f(e.extras)}}function m(e){var t={kind:"class",elements:e.map(p)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t}function y(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');x(e,"key","A class descriptor"),x(e,"placement","A class descriptor"),x(e,"descriptor","A class descriptor"),x(e,"initializer","A class descriptor"),x(e,"extras","A class descriptor");var n=b(e,"finisher");return{elements:f(e.elements),finisher:n}}function x(e,t,n){if(void 0!==e[t])throw new TypeError(n+" can't have a ."+t+" property.")}function b(e,t){var n=e[t];if(void 0!==n&&"function"!=typeof n)throw new TypeError("Expected '"+t+"' to be a function");return n}})),a.register("6EAw4",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("9QPBY"),i=a("9TcPW"),o=a("emdgA");function s(e){return r.default(e)||i.default(e)||o.default()}})),a.register("9TcPW",(function(t,n){function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}e(t.exports,"default",(function(){return r}))})),a.register("emdgA",(function(t,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}e(t.exports,"default",(function(){return r}))})),a.register("hcP60",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("gdFSe"),i=a("fk4ZW");function o(e){var t=i.default(e,"string");return"symbol"===r.default(t)?t:String(t)}})),a.register("gdFSe",(function(t,n){function r(e){return e&&e.constructor===Symbol?"symbol":typeof e}e(t.exports,"default",(function(){return r}))})),a.register("fk4ZW",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("gdFSe");function i(e,t){if("object"!==r.default(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r.default(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}})),a.register("5Fbir",(function(t,n){function r(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var i=n[r],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}return e}e(t.exports,"default",(function(){return r}))})),a.register("jkn5s",(function(t,n){function r(e,t){for(var n in t){(a=t[n]).configurable=a.enumerable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n,a)}if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(t),i=0;i<r.length;i++){var a,o=r[i];(a=t[o]).configurable=a.enumerable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,o,a)}return e}e(t.exports,"default",(function(){return r}))})),a.register("iXkAt",(function(t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e(t.exports,"default",(function(){return r}))})),a.register("6B2k9",(function(t,n){function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}function i(){return r.apply(this,arguments)}e(t.exports,"default",(function(){return i}))})),a.register("9BvPR",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("aBJPM");function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=r.default(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n||e):a.value}})(e,t,n)}function o(e,t,n){return i(e,t,n)}})),a.register("aBJPM",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("kksNc");function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r.default(e)););return e}})),a.register("kksNc",(function(t,n){function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){return r(e)}e(t.exports,"default",(function(){return i}))})),a.register("5Vcrn",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("kJxmx");function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r.default(e,t)}})),a.register("kJxmx",(function(t,n){function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){return r(e,t)}e(t.exports,"default",(function(){return i}))})),a.register("lFHjz",(function(t,n){function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}e(t.exports,"default",(function(){return r}))})),a.register("8EHSx",(function(t,n){function r(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}e(t.exports,"default",(function(){return r}))})),a.register("ahTIG",(function(t,n){function r(e,t){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and set to use loose mode. To use proposal-class-properties in spec mode with decorators, wait for the next major version of decorators in stage 2.")}e(t.exports,"default",(function(){return r}))})),a.register("jnOWE",(function(t,n){function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}e(t.exports,"default",(function(){return r}))})),a.register("7Te0B",(function(t,n){function r(e){return e&&e.__esModule?e:{default:e}}e(t.exports,"default",(function(){return r}))})),a.register("jWuj6",(function(t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}e(t.exports,"default",(function(){return r}))})),a.register("laEC7",(function(t,n){function r(e){return-1!==Function.toString.call(e).indexOf("[native code]")}e(t.exports,"default",(function(){return r}))})),a.register("69XTi",(function(t,n){function r(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}e(t.exports,"default",(function(){return r}))})),a.register("2tM2P",(function(t,n){function r(e,t){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}e(t.exports,"default",(function(){return r}))})),a.register("bOiDs",(function(t,n){var r;function i(e,t,n,i){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&a)for(var s in a)void 0===t[s]&&(t[s]=a[s]);else t||(t=a||{});if(1===o)t.children=i;else if(o>1){for(var l=new Array(o),c=0;c<o;c++)l[c]=arguments[c+3];t.children=l}return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}e(t.exports,"default",(function(){return i}))})),a.register("iPsIo",(function(t,n){function r(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}e(t.exports,"default",(function(){return r}))})),a.register("ngiRg",(function(t,n){function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}e(t.exports,"default",(function(){return r}))})),a.register("aoONY",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("iXkAt");function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){r.default(e,t,n[t])}))}return e}})),a.register("56zPf",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("gsjeZ");function i(e,t){if(null==e)return{};var n,i,a=r.default(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}})),a.register("gsjeZ",(function(t,n){function r(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}e(t.exports,"default",(function(){return r}))})),a.register("g3BpA",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("dtpWT"),i=a("gdFSe");function o(e,t){return!t||"object"!==i.default(t)&&"function"!=typeof t?r.default(e):t}})),a.register("aNIse",(function(t,n){function r(e){throw new Error('"'+e+'" is read-only')}e(t.exports,"default",(function(){return r}))})),a.register("dsYLu",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("iXkAt"),i=a("aBJPM");function o(e,t,n,a){return(o="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var o,s=i.default(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(a,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(a,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(a,t,o)}else r.default(a,t,n);return!0})(e,t,n,a)}function s(e,t,n,r,i){if(!o(e,t,n,r||e)&&i)throw new Error("failed to set property");return n}})),a.register("64eYx",(function(t,n){function r(e){return function(){var t=e.apply(this,arguments);return t.next(),t}}e(t.exports,"default",(function(){return r}))})),a.register("69ldn",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("9QPBY"),i=a("9TcPW"),o=a("emdgA");function s(e,t){return r.default(e)||i.default(e,t)||o.default()}})),a.register("byMw4",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("9QPBY"),i=a("2tM2P"),o=a("emdgA");function s(e,t){return r.default(e)||i.default(e,t)||o.default()}})),a.register("iQZ9N",(function(t,n){function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}e(t.exports,"default",(function(){return r}))})),a.register("jo3tj",(function(t,n){function r(e,t){return t||(t=e.slice(0)),e.raw=t,e}e(t.exports,"default",(function(){return r}))})),a.register("8mCvL",(function(t,n){function r(e){throw e}e(t.exports,"default",(function(){return r}))})),a.register("k53V6",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("93uWT"),i=a("9TcPW"),o=a("ngiRg");function s(e){return r.default(e)||i.default(e)||o.default()}})),a.register("61v0m",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("k2zz2");function i(e){return function(){return new r.default(e.apply(this,arguments))}}})),a.register("lWQ0P",(function(t,n){e(t.exports,"default",(function(){return c}));var r=a("32sR3"),i=a("laEC7"),o=a("kksNc"),s=a("kJxmx");function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||!i.default(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return r.default(e,arguments,o.default(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s.default(n,e)},l(e)}function c(e){return l(e)}})),a.register("l5X8n",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("bkLps"),i=a("kksNc"),o=a("g3BpA");function s(e){var t=r.default();return function(){var n,r=i.default(e);if(t){var a=i.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o.default(this,n)}}})),a.register("bkLps",(function(t,n){function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}e(t.exports,"default",(function(){return r}))})),a.register("f6OTe",(function(t,n){var r;e(t.exports,"getBundleURL",(function(){return r}),(function(e){return r=e}));var i={};function a(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}r=function(e){var t=i[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return a(e[2])}return"/"}(),i[e]=t),t}})),a.register("iPIW6",(function(e,t){e.exports=a("ih7W4")(a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("5RGAp")).then((function(){return a("fz5vW")}))})),a.register("ih7W4",(function(e,t){"use strict";var n=a("5Y6Bl");e.exports=n((function(e){return new Promise((function(t,n){var r=document.getElementsByTagName("script");if([].concat(r).some((function(t){return t.src===e})))t();else{var i=document.createElement("script");i.async=!0,i.type="text/javascript",i.charset="utf-8",i.src=e,i.onerror=function(t){var r=new TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));i.onerror=i.onload=null,i.remove(),n(r)},i.onload=function(){i.onerror=i.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(i)}}))}))})),a.register("5Y6Bl",(function(e,t){"use strict";var n={},r={},i={};function a(e){switch(e){case"preload":return r;case"prefetch":return i;default:return n}}e.exports=function(e,t){return function(n){var r=a(t);return r[n]?r[n]:r[n]=e.apply(null,arguments).catch((function(e){throw delete r[n],e}))}}})),a.register("hb3Ll",(function(e,t){e.exports=a("ih7W4")(a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("y5edP")).then((function(){return a("7ZPTi")}))})),a.register("fW7LR",(function(e,t){e.exports=a("ih7W4")(a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("dsJ3g")).then((function(){return a("blNy6")}))})),a.register("j1Ae5",(function(e,t){e.exports=a("ih7W4")(a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("kNYzr")).then((function(){return a("2m2jt")}))})),a.register("aG74V",(function(e,t){e.exports=a("ih7W4")(a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("79hnx")).then((function(){return a("jNQF2")}))})),a("2evKT").register(JSON.parse('{"lYbF2":"index.88d490c3.js","l7FYj":"check.8d706b11.svg","kbyFQ":"cancel.17aa34ea.svg","5RGAp":"de.1d07f28c.js","y5edP":"ja.22be4cfe.js","dsJ3g":"zh-CN.dc42080c.js","5H9IS":"brush-pressure.f4437531.svg","la7yv":"copy.4adadd0c.svg","cTtMO":"tool-picker.d0e69c3a.svg","iQ1f0":"angle.f0b557ac.svg","1mb1v":"add-layer.ce1078bb.svg","11KJK":"duplicate-layer.3314e3c7.svg","floUo":"merge-layers.19da79a6.svg","kino6":"remove-layer.4e9b2b7d.svg","hhQeq":"rename-layer.13b70bac.svg","1dLwT":"cursor-picker.db2f5b39.png","9wZxU":"cursor-zoom-ew.fbb85406.png","hQSEH":"cursor-fill.8027a243.png","916ZI":"cursor-text.dcaa5de5.png","045N6":"cursor-rotate.5b164044.png","eHdqz":"klecks-logo.802fb0cc.png","3x5dR":"new-image.09cdcd80.svg","hbDTd":"import.7a68c844.svg","16iGk":"export.bc31616f.svg","2ME3z":"share.454898d1.svg","hZnSk":"help.208e9032.svg","6mHrC":"tool-paint.6cdb3344.svg","hS5Hj":"tool-fill.3358320a.svg","doX4v":"tool-text.1cbd0325.svg","7NqHO":"tool-shape.3de78c3f.svg","dz3mY":"caret-down.68d4cd16.svg","2gZH2":"tool-hand.e7fc81b9.svg","04ZZm":"tool-zoom-in.d413f042.svg","j9xio":"tool-zoom-out.299f4d1f.svg","AnO0a":"tool-undo.540bf765.svg","nTvP2":"inverted-border.3353c7f3.svg","6toXQ":"edit-rotate.fd0e572a.svg","b1UMP":"ui-collapse.2b5dfc6a.svg","lvwQ5":"align-left.4876a845.svg","imAvm":"align-center.6f56d4bd.svg","dC0sF":"align-right.1521d61c.svg","h3hPo":"typo-italic.39f02a8d.svg","1pAeY":"typo-bold.8156fef3.svg","5tPq3":"edit-brightness-contrast.8430cb26.svg","cazOx":"edit-crop.16c534dd.svg","245NA":"edit-curves.bbdb97b2.svg","1hkCG":"edit-flip.00fd2c6b.svg","k2eFf":"edit-hue-saturation.c9c1c847.svg","krKGd":"edit-invert.fa435c66.png","ehfxY":"edit-perspective.e23100db.svg","beOjS":"edit-resize.56391e2b.svg","Gk9bV":"edit-tilt-shift.dd20efff.png","csed7":"edit-to-alpha.f7a2065a.svg","equSE":"edit-transform.c8795430.svg","h1dN3":"edit-triangle-blur.9df2dbef.png","LfAXI":"edit-unsharp-mask.c58e988c.png","iiCd6":"brush-pen.49a7b91e.svg","6fRlX":"brush-blend.2b9837fa.svg","hC7PC":"brush-sketchy.9e5d0120.png","eZgVv":"brush-pixel.673f3e4c.svg","fPZin":"brush-eraser.a9e10dce.svg","fp7H1":"brush-smudge.45852bcd.svg","eX098":"brush-chemy.a5a188f6.svg","iGeXe":"loading.7ff8a2ac.gif","kNYzr":"dist.abd92f9b.js","kSWIa":"bitbof-logo.bc5e3ed5.svg","4FMUg":"ui-swap-lr.7f474f51.svg","79hnx":"licenses.85c0196d.js","eFiVD":"checkmark.5cb0764b.svg","2BZYe":"constrain.62f04e45.svg","k9Nks":"tab-settings.1f52740e.svg","bBxqy":"tab-layers.c8a104e7.svg"}')),a("4gaLD");var o=a("1ELdT"),s={},l=function(e){var t,n=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]},r=function(e,t,n,r){var i=t&&t.prototype instanceof a?t:a,o=Object.create(i.prototype),s=new p(r||[]);return o._invoke=u(e,n,s),o},i=function(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}},a=function(){},o=function(){},s=function(){},l=function(e){["next","throw","return"].forEach((function(t){n(e,t,(function(e){return this._invoke(t,e)}))}))},c=function(e,t){function n(r,a,o,s){var l=i(e[r],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&m.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;this._invoke=function(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}},u=function(e,t,n){var r=C;return function(a,o){if(r===k)throw new Error("Generator is already running");if(r===E){if("throw"===a)throw o;return g()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var l=L(s,n);if(l){if(l===T)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===C)throw r=E,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=k;var c=i(e,t,n);if("normal"===c.type){if(r=n.done?E:S,c.arg===T)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=E,n.method="throw",n.arg=c.arg)}}},h=function(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)},d=function(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t},p=function(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)},f=function(e){if(e){var n=e[x];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(m.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:g}},g=function(){return{value:t,done:!0}},v=Object.prototype,m=v.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},x=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",w=y.toStringTag||"@@toStringTag";try{n({},"")}catch(e){n=function(e,t,n){return e[t]=n}}e.wrap=r;var C="suspendedStart",S="suspendedYield",k="executing",E="completed",T={},M={};n(M,x,(function(){return this}));var I=Object.getPrototypeOf,R=I&&I(I(f([])));R&&R!==v&&m.call(R,x)&&(M=R);var A=s.prototype=a.prototype=Object.create(M);function L(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method))return T;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var a=i(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,T;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,T):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,T)}return o.prototype=s,n(A,"constructor",s),n(s,"constructor",o),o.displayName=n(s,w,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,n(e,w,"GeneratorFunction")),e.prototype=Object.create(A),e},e.awrap=function(e){return{__await:e}},l(c.prototype),n(c.prototype,b,(function(){return this})),e.AsyncIterator=c,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new c(r(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},l(A),n(A,w,"Generator"),n(A,x,(function(){return this})),n(A,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=f,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(d),!e)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){var n=function(n,i){return o.type="throw",o.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i};if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=m.call(a,"catchLoc"),l=m.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,T):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),T},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),T}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;d(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:f(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),T}},e}(s);try{regeneratorRuntime=l}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=l:Function("r","regeneratorRuntime = r")(l)}var c;a("4gaLD");var u,h=a("gdFSe"),d={},p=function(e){return e&&e.Math==Math&&e};d=p("object"==typeof globalThis&&globalThis)||p("object"==typeof window&&window)||p("object"==typeof self&&self)||p("object"==typeof n&&n)||function(){return this}()||Function("return this")();var f,g;f=!(g=function(e){try{return!!e()}catch(e){return!0}})((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}));var v,m={};v=!g((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}));var y,x=Function.prototype.call;m=v?x.bind(x):function(){return x.apply(x,arguments)};var b={}.propertyIsEnumerable,w=Object.getOwnPropertyDescriptor,C=w&&!b.call({1:2},1);y=C?function(e){var t=w(this,e);return!!t&&t.enumerable}:b;var S;S=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}};var k,E={},T={},M=Function.prototype,I=M.bind,R=M.call,A=v&&I.bind(R,R);T=v?function(e){return e&&A(e)}:function(e){return e&&function(){return R.apply(e,arguments)}};var L,P=T({}.toString),O=T("".slice);L=function(e){return O(P(e),8,-1)};var D=d.Object,B=T("".split);E=g((function(){return!D("z").propertyIsEnumerable(0)}))?function(e){return"String"==L(e)?B(e,""):D(e)}:D;var z,j=d.TypeError;z=function(e){if(null==e)throw j("Can't call method on "+e);return e},k=function(e){return E(z(e))};var F,N,_,H;H=function(e){return"function"==typeof e},_=function(e){return"object"==typeof e?null!==e:H(e)};var U={};a("4gaLD");h=a("gdFSe");var Y,X=function(e){return H(e)?e:void 0};Y=function(e,t){return arguments.length<2?X(d[e]):d[e]&&d[e][t]};var V={};V=T({}.isPrototypeOf);var W;a("4gaLD");h=a("gdFSe");var G,K,q={};q=Y("navigator","userAgent")||"";var J,Z,Q=d.process,$=d.Deno,ee=Q&&Q.versions||$&&$.version,te=ee&&ee.v8;te&&(Z=(J=te.split("."))[0]>0&&J[0]<4?1:+(J[0]+J[1])),!Z&&q&&(!(J=q.match(/Edge\/(\d+)/))||J[1]>=74)&&(J=q.match(/Chrome\/(\d+)/))&&(Z=+J[1]),K=Z,G=!!Object.getOwnPropertySymbols&&!g((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&K&&K<41})),W=G&&!Symbol.sham&&"symbol"==h.default(Symbol.iterator);var ne=d.Object;U=W?function(e){return"symbol"==(void 0===e?"undefined":h.default(e))}:function(e){var t=Y("Symbol");return H(t)&&V(t.prototype,ne(e))};var re,ie,ae,oe=d.String;ae=function(e){try{return oe(e)}catch(e){return"Object"}};var se=d.TypeError;ie=function(e){if(H(e))return e;throw se(ae(e)+" is not a function")},re=function(e,t){var n=e[t];return null==n?void 0:ie(n)};var le,ce=d.TypeError;le=function(e,t){var n,r;if("string"===t&&H(n=e.toString)&&!_(r=m(n,e)))return r;if(H(n=e.valueOf)&&!_(r=m(n,e)))return r;if("string"!==t&&H(n=e.toString)&&!_(r=m(n,e)))return r;throw ce("Can't convert object to primitive value")};var ue,he,de;de=!1;var pe,fe={},ge=Object.defineProperty;pe=function(e,t){try{ge(d,e,{value:t,configurable:!0,writable:!0})}catch(n){d[e]=t}return t};var ve="__core-js_shared__",me=d["__core-js_shared__"]||pe(ve,{});fe=me,(he=function(e,t){return fe[e]||(fe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.3",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var ye,xe={},be=d.Object;ye=function(e){return be(z(e))};var we=T({}.hasOwnProperty);xe=Object.hasOwn||function(e,t){return we(ye(e),t)};var Ce,Se=0,ke=Math.random(),Ee=T(1..toString);Ce=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ee(++Se+ke,36)};var Te=he("wks"),Me=d.Symbol,Ie=Me&&Me.for,Re=W?Me:Me&&Me.withoutSetter||Ce;ue=function(e){if(!xe(Te,e)||!G&&"string"!=typeof Te[e]){var t="Symbol."+e;G&&xe(Me,e)?Te[e]=Me[e]:Te[e]=W&&Ie?Ie(t):Re(t)}return Te[e]};var Ae=d.TypeError,Le=ue("toPrimitive");N=function(e,t){if(!_(e)||U(e))return e;var n,r=re(e,Le);if(r){if(void 0===t&&(t="default"),n=m(r,e,t),!_(n)||U(n))return n;throw Ae("Can't convert object to primitive value")}return void 0===t&&(t="number"),le(e,t)},F=function(e){var t=N(e,"string");return U(t)?t:t+""};var Pe,Oe,De=d.document,Be=_(De)&&_(De.createElement);Oe=function(e){return Be?De.createElement(e):{}},Pe=!f&&!g((function(){return 7!=Object.defineProperty(Oe("div"),"a",{get:function(){return 7}}).a}));var ze,je,Fe=Object.getOwnPropertyDescriptor,Ne=u=f?Fe:function(e,t){if(e=k(e),t=F(t),Pe)try{return Fe(e,t)}catch(e){}if(xe(e,t))return S(!m(y,e,t),e[t])},_e={};je=f&&g((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}));var He,Ue=d.String,Ye=d.TypeError;He=function(e){if(_(e))return e;throw Ye(Ue(e)+" is not an object")};var Xe=d.TypeError,Ve=Object.defineProperty,We=Object.getOwnPropertyDescriptor,Ge="enumerable",Ke="configurable",qe="writable";ze=f?je?function(e,t,n){if(He(e),t=F(t),He(n),"function"==typeof e&&"prototype"===t&&"value"in n&&qe in n&&!n.writable){var r=We(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:Ke in n?n.configurable:r.configurable,enumerable:Ge in n?n.enumerable:r.enumerable,writable:!1})}return Ve(e,t,n)}:Ve:function(e,t,n){if(He(e),t=F(t),He(n),Pe)try{return Ve(e,t,n)}catch(e){}if("get"in n||"set"in n)throw Xe("Accessors not supported");return"value"in n&&(e[t]=n.value),e},_e=f?function(e,t,n){return ze(e,t,S(1,n))}:function(e,t,n){return e[t]=n,e};var Je,Ze={},Qe=T(Function.toString);H(fe.inspectSource)||(fe.inspectSource=function(e){return Qe(e)}),Ze=fe.inspectSource;var $e,et,tt=d.WeakMap;et=H(tt)&&/native code/.test(Ze(tt));var nt,rt=he("keys");nt=function(e){return rt[e]||(rt[e]=Ce(e))};var it={};it={};var at,ot,st,lt="Object already initialized",ct=d.TypeError,ut=d.WeakMap;if(et||fe.state){var ht=fe.state||(fe.state=new ut),dt=T(ht.get),pt=T(ht.has),ft=T(ht.set);at=function(e,t){if(pt(ht,e))throw new ct(lt);return t.facade=e,ft(ht,e,t),t},ot=function(e){return dt(ht,e)||{}},st=function(e){return pt(ht,e)}}else{var gt=nt("state");it[gt]=!0,at=function(e,t){if(xe(e,gt))throw new ct(lt);return t.facade=e,_e(e,gt,t),t},ot=function(e){return xe(e,gt)?e[gt]:{}},st=function(e){return xe(e,gt)}}$e={set:at,get:ot,has:st,enforce:function(e){return st(e)?ot(e):at(e,{})},getterFor:function(e){return function(t){var n;if(!_(t)||(n=ot(t)).type!==e)throw ct("Incompatible receiver, "+e+" required");return n}}};var vt,mt=Function.prototype,yt=f&&Object.getOwnPropertyDescriptor,xt=xe(mt,"name"),bt=(vt={EXISTS:xt,PROPER:xt&&"something"===function(){}.name,CONFIGURABLE:xt&&(!f||f&&yt(mt,"name").configurable)}).CONFIGURABLE,wt=$e.get,Ct=$e.enforce,St=String(String).split("String");(Je=function(e,t,n,r){var i,a=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet,l=r&&void 0!==r.name?r.name:t;H(n)&&("Symbol("===String(l).slice(0,7)&&(l="["+String(l).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!xe(n,"name")||bt&&n.name!==l)&&_e(n,"name",l),(i=Ct(n)).source||(i.source=St.join("string"==typeof l?l:""))),e!==d?(a?!s&&e[t]&&(o=!0):delete e[t],o?e[t]=n:_e(e,t,n)):o?e[t]=n:pe(t,n)})(Function.prototype,"toString",(function(){return H(this)&&wt(this).source||Ze(this)}));var kt,Et,Tt,Mt,It,Rt,At={},Lt=Math.ceil,Pt=Math.floor;Rt=function(e){var t=+e;return t!=t||0===t?0:(t>0?Pt:Lt)(t)};var Ot=Math.max,Dt=Math.min;It=function(e,t){var n=Rt(e);return n<0?Ot(n+t,0):Dt(n,t)};var Bt,zt,jt=Math.min;zt=function(e){return e>0?jt(Rt(e),9007199254740991):0},Bt=function(e){return zt(e.length)};var Ft=function(e){return function(t,n,r){var i,a=k(t),o=Bt(a),s=It(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},Nt=(Mt={includes:Ft(!0),indexOf:Ft(!1)}).indexOf,_t=T([].push);Tt=function(e,t){var n,r=k(e),i=0,a=[];for(n in r)!xe(it,n)&&xe(r,n)&&_t(a,n);for(;t.length>i;)xe(r,n=t[i++])&&(~Nt(a,n)||_t(a,n));return a};var Ht,Ut={},Yt=(Ut=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]).concat("length","prototype");Et=Object.getOwnPropertyNames||function(e){return Tt(e,Yt)},Ht=Object.getOwnPropertySymbols;var Xt=T([].concat);At=Y("Reflect","ownKeys")||function(e){var t=Et(He(e));return Ht?Xt(t,Ht(e)):t},kt=function(e,t,n){for(var r=At(t),i=ze,a=u,o=0;o<r.length;o++){var s=r[o];xe(e,s)||n&&xe(n,s)||i(e,s,a(t,s))}};var Vt={},Wt=/#|\.prototype\./,Gt=function(e,t){var n=qt[Kt(e)];return n==Zt||n!=Jt&&(H(t)?g(t):!!t)},Kt=Gt.normalize=function(e){return String(e).replace(Wt,".").toLowerCase()},qt=Gt.data={},Jt=Gt.NATIVE="N",Zt=Gt.POLYFILL="P";Vt=Gt,c=function(e,t){var n,r,i,a,o,s=e.target,l=e.global,c=e.stat;if(n=l?d:c?d[s]||pe(s,{}):(d[s]||{}).prototype)for(r in t){if(a=t[r],i=e.noTargetGet?(o=Ne(n,r))&&o.value:n[r],!Vt(l?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if((void 0===a?"undefined":h.default(a))==(void 0===i?"undefined":h.default(i)))continue;kt(a,i)}(e.sham||i&&i.sham)&&_e(a,"sham",!0),Je(n,r,a,e)}};var Qt={},$t=Function.prototype,en=$t.apply,tn=$t.call;Qt="object"==typeof Reflect&&Reflect.apply||(v?tn.bind(en):function(){return tn.apply(en,arguments)});var nn={};nn=Array.isArray||function(e){return"Array"==L(e)};var rn,an,on={},sn={};sn[ue("toStringTag")]="z",an="[object z]"===String(sn);var ln=ue("toStringTag"),cn=d.Object,un="Arguments"==L(function(){return arguments}());on=an?L:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=cn(e),ln))?n:un?L(t):"Object"==(r=L(t))&&H(t.callee)?"Arguments":r};var hn=d.String;rn=function(e){if("Symbol"===on(e))throw TypeError("Cannot convert a Symbol value to a string");return hn(e)};var dn,pn={},fn={};fn=Object.keys||function(e){return Tt(e,Ut)},dn=f&&!je?Object.defineProperties:function(e,t){He(e);for(var n,r=k(t),i=fn(t),a=i.length,o=0;a>o;)ze(e,n=i[o++],r[n]);return e};var gn={};gn=Y("document","documentElement");var vn,mn,yn=nt("IE_PROTO"),xn=function(){},bn=function(e){return"<script>"+e+"</"+"script>"},wn=function(e){e.write(bn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Cn=function(){try{vn=new ActiveXObject("htmlfile")}catch(e){}var e,t;Cn="undefined"!=typeof document?document.domain&&vn?wn(vn):((t=Oe("iframe")).style.display="none",gn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(bn("document.F=Object")),e.close(),e.F):wn(vn);for(var n=Ut.length;n--;)delete Cn.prototype[Ut[n]];return Cn()};it[yn]=!0,pn=Object.create||function(e,t){var n;return null!==e?(xn.prototype=He(e),n=new xn,xn.prototype=null,n[yn]=e):n=Cn(),void 0===t?n:dn(n,t)};var Sn,kn,En=Et;kn=function(e,t,n){var r=F(t);r in e?ze(e,r,S(0,n)):e[r]=n};var Tn=d.Array,Mn=Math.max;Sn=function(e,t,n){for(var r=Bt(e),i=It(t,r),a=It(void 0===n?r:n,r),o=Tn(Mn(a-i,0)),s=0;i<a;i++,s++)kn(o,s,e[i]);return o.length=s,o};var In="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];mn=function(e){return In&&"Window"==L(e)?function(e){try{return En(e)}catch(e){return Sn(In)}}(e):En(k(e))};var Rn,An={};An=T([].slice),Rn=ue;var Ln,Pn={};Pn=d;var On=ze;Ln=function(e){var t=Pn.Symbol||(Pn.Symbol={});xe(t,e)||On(t,e,{value:Rn(e)})};var Dn,Bn=ze,zn=ue("toStringTag");Dn=function(e,t,n){e&&!n&&(e=e.prototype),e&&!xe(e,zn)&&Bn(e,zn,{configurable:!0,value:t})};var jn,Fn,Nn=T(T.bind);Fn=function(e,t){return ie(e),void 0===t?e:v?Nn(e,t):function(){return e.apply(t,arguments)}};var _n,Hn,Un={},Yn=function(){},Xn=[],Vn=Y("Reflect","construct"),Wn=/^\s*(?:class|function)\b/,Gn=T(Wn.exec),Kn=!Wn.exec(Yn),qn=function(e){if(!H(e))return!1;try{return Vn(Yn,Xn,e),!0}catch(e){return!1}},Jn=function(e){if(!H(e))return!1;switch(on(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Kn||!!Gn(Wn,Ze(e))}catch(e){return!0}};Jn.sham=!0,Un=!Vn||g((function(){var e;return qn(qn.call)||!qn(Object)||!qn((function(){e=!0}))||e}))?Jn:qn;var Zn=ue("species"),Qn=d.Array;Hn=function(e){var t;return nn(e)&&(t=e.constructor,(Un(t)&&(t===Qn||nn(t.prototype))||_(t)&&null===(t=t[Zn]))&&(t=void 0)),void 0===t?Qn:t},_n=function(e,t){return new(Hn(e))(0===t?0:t)};var $n=T([].push),er=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(l,c,u,h){for(var d,p,f=ye(l),g=E(f),v=Fn(c,u),m=Bt(g),y=0,x=h||_n,b=t?x(l,m):n||o?x(l,0):void 0;m>y;y++)if((s||y in g)&&(p=v(d=g[y],y,f),e))if(t)b[y]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return y;case 2:$n(b,d)}else switch(e){case 4:return!1;case 7:$n(b,d)}return a?-1:r||i?i:b}},tr=(jn={forEach:er(0),map:er(1),filter:er(2),some:er(3),every:er(4),find:er(5),findIndex:er(6),filterReject:er(7)}).forEach,nr=nt("hidden"),rr="Symbol",ir=ue("toPrimitive"),ar=$e.set,or=$e.getterFor(rr),sr=Object.prototype,lr=d.Symbol,cr=lr&&lr.prototype,ur=d.TypeError,hr=d.QObject,dr=Y("JSON","stringify"),pr=u,fr=ze,gr=mn,vr=y,mr=T([].push),yr=he("symbols"),xr=he("op-symbols"),br=he("string-to-symbol-registry"),wr=he("symbol-to-string-registry"),Cr=he("wks"),Sr=!hr||!hr.prototype||!hr.prototype.findChild,kr=f&&g((function(){return 7!=pn(fr({},"a",{get:function(){return fr(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=pr(sr,t);r&&delete sr[t],fr(e,t,n),r&&e!==sr&&fr(sr,t,r)}:fr,Er=function(e,t){var n=yr[e]=pn(cr);return ar(n,{type:rr,tag:e,description:t}),f||(n.description=t),n},Tr=function(e,t,n){e===sr&&Tr(xr,t,n),He(e);var r=F(t);return He(n),xe(yr,r)?(n.enumerable?(xe(e,nr)&&e[nr][r]&&(e[nr][r]=!1),n=pn(n,{enumerable:S(0,!1)})):(xe(e,nr)||fr(e,nr,S(1,{})),e[nr][r]=!0),kr(e,r,n)):fr(e,r,n)},Mr=function(e,t){He(e);var n=k(t),r=fn(n).concat(Lr(n));return tr(r,(function(t){f&&!m(Ir,n,t)||Tr(e,t,n[t])})),e},Ir=function(e){var t=F(e),n=m(vr,this,t);return!(this===sr&&xe(yr,t)&&!xe(xr,t))&&(!(n||!xe(this,t)||!xe(yr,t)||xe(this,nr)&&this[nr][t])||n)},Rr=function(e,t){var n=k(e),r=F(t);if(n!==sr||!xe(yr,r)||xe(xr,r)){var i=pr(n,r);return!i||!xe(yr,r)||xe(n,nr)&&n[nr][r]||(i.enumerable=!0),i}},Ar=function(e){var t=gr(k(e)),n=[];return tr(t,(function(e){xe(yr,e)||xe(it,e)||mr(n,e)})),n},Lr=function(e){var t=e===sr,n=gr(t?xr:k(e)),r=[];return tr(n,(function(e){!xe(yr,e)||t&&!xe(sr,e)||mr(r,yr[e])})),r};if(G||(lr=function(){if(V(cr,this))throw ur("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?rn(arguments[0]):void 0,t=Ce(e),n=function(e){this===sr&&m(n,xr,e),xe(this,nr)&&xe(this[nr],t)&&(this[nr][t]=!1),kr(this,t,S(1,e))};return f&&Sr&&kr(sr,t,{configurable:!0,set:n}),Er(t,e)},cr=lr.prototype,Je(cr,"toString",(function(){return or(this).tag})),Je(lr,"withoutSetter",(function(e){return Er(Ce(e),e)})),y=Ir,ze=Tr,dn=Mr,u=Rr,Et=mn=Ar,Ht=Lr,Rn=function(e){return Er(ue(e),e)},f&&(fr(cr,"description",{configurable:!0,get:function(){return or(this).description}}),Je(sr,"propertyIsEnumerable",Ir,{unsafe:!0}))),c({global:!0,wrap:!0,forced:!G,sham:!G},{Symbol:lr}),tr(fn(Cr),(function(e){Ln(e)})),c({target:rr,stat:!0,forced:!G},{for:function(e){var t=rn(e);if(xe(br,t))return br[t];var n=lr(t);return br[t]=n,wr[n]=t,n},keyFor:function(e){if(!U(e))throw ur(e+" is not a symbol");if(xe(wr,e))return wr[e]},useSetter:function(){Sr=!0},useSimple:function(){Sr=!1}}),c({target:"Object",stat:!0,forced:!G,sham:!f},{create:function(e,t){return void 0===t?pn(e):Mr(pn(e),t)},defineProperty:Tr,defineProperties:Mr,getOwnPropertyDescriptor:Rr}),c({target:"Object",stat:!0,forced:!G},{getOwnPropertyNames:Ar,getOwnPropertySymbols:Lr}),c({target:"Object",stat:!0,forced:g((function(){Ht(1)}))},{getOwnPropertySymbols:function(e){return Ht(ye(e))}}),dr){var Pr=!G||g((function(){var e=lr();return"[null]"!=dr([e])||"{}"!=dr({a:e})||"{}"!=dr(Object(e))}));c({target:"JSON",stat:!0,forced:Pr},{stringify:function(e,t,n){var r=An(arguments),i=t;if((_(t)||void 0!==e)&&!U(e))return nn(t)||(t=function(e,t){if(H(i)&&(t=m(i,this,e,t)),!U(t))return t}),r[1]=t,Qt(dr,null,r)}})}if(!cr[ir]){var Or=cr.valueOf;Je(cr,ir,(function(e){return m(Or,this)}))}Dn(lr,rr),it[nr]=!0;var Dr=ze,Br=d.Symbol,zr=Br&&Br.prototype;if(f&&H(Br)&&(!("description"in zr)||void 0!==Br().description)){var jr={},Fr=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:rn(arguments[0]),t=V(zr,this)?new Br(e):void 0===e?Br():Br(e);return""===e&&(jr[t]=!0),t};kt(Fr,Br),Fr.prototype=zr,zr.constructor=Fr;var Nr="Symbol(test)"==String(Br("test")),_r=T(zr.toString),Hr=T(zr.valueOf),Ur=/^Symbol\((.*)\)[^)]+$/,Yr=T("".replace),Xr=T("".slice);Dr(zr,"description",{configurable:!0,get:function(){var e=Hr(this),t=_r(e);if(xe(jr,e))return"";var n=Nr?Xr(t,7,-1):Yr(t,Ur,"$1");return""===n?void 0:n}}),c({global:!0,forced:!0},{Symbol:Fr})}Ln("asyncIterator"),Ln("hasInstance"),Ln("isConcatSpreadable"),Ln("iterator"),Ln("match"),Ln("replace"),Ln("search"),Ln("species"),Ln("split"),Ln("toPrimitive"),Ln("toStringTag"),Ln("unscopables");var Vr,Wr=ue("species");Vr=function(e){return K>=51||!g((function(){var t=[];return(t.constructor={})[Wr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))};var Gr=ue("isConcatSpreadable"),Kr=9007199254740991,qr="Maximum allowed index exceeded",Jr=d.TypeError,Zr=K>=51||!g((function(){var e=[];return e[Gr]=!1,e.concat()[0]!==e})),Qr=Vr("concat"),$r=function(e){if(!_(e))return!1;var t=e[Gr];return void 0!==t?!!t:nn(e)};c({target:"Array",proto:!0,forced:!Zr||!Qr},{concat:function(e){var t,n,r,i,a,o=ye(this),s=_n(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if($r(a=-1===t?o:arguments[t])){if(l+(i=Bt(a))>Kr)throw Jr(qr);for(n=0;n<i;n++,l++)n in a&&kn(s,l,a[n])}else{if(l>=Kr)throw Jr(qr);kn(s,l++,a)}return s.length=l,s}});var ei,ti=Math.min;ei=[].copyWithin||function(e,t){var n=ye(this),r=Bt(n),i=It(e,r),a=It(t,r),o=arguments.length>2?arguments[2]:void 0,s=ti((void 0===o?r:It(o,r))-a,r-i),l=1;for(a<i&&i<a+s&&(l=-1,a+=s-1,i+=s-1);s-- >0;)a in n?n[i]=n[a]:delete n[i],i+=l,a+=l;return n};var ni,ri=ue("unscopables"),ii=Array.prototype;null==ii[ri]&&ze(ii,ri,{configurable:!0,value:pn(null)}),ni=function(e){ii[ri][e]=!0},c({target:"Array",proto:!0},{copyWithin:ei}),ni("copyWithin");var ai;ai=function(e){for(var t=ye(this),n=Bt(t),r=arguments.length,i=It(r>1?arguments[1]:void 0,n),a=r>2?arguments[2]:void 0,o=void 0===a?n:It(a,n);o>i;)t[i++]=e;return t},c({target:"Array",proto:!0},{fill:ai}),ni("fill");var oi=jn.filter,si=Vr("filter");c({target:"Array",proto:!0,forced:!si},{filter:function(e){return oi(this,e,arguments.length>1?arguments[1]:void 0)}});var li=jn.find,ci="find",ui=!0;ci in[]&&Array(1).find((function(){ui=!1})),c({target:"Array",proto:!0,forced:ui},{find:function(e){return li(this,e,arguments.length>1?arguments[1]:void 0)}}),ni(ci);var hi=jn.findIndex,di="findIndex",pi=!0;di in[]&&Array(1).findIndex((function(){pi=!1})),c({target:"Array",proto:!0,forced:pi},{findIndex:function(e){return hi(this,e,arguments.length>1?arguments[1]:void 0)}}),ni(di);var fi={},gi=d.TypeError,vi=function(e,t,n,r,i,a,o,s){for(var l,c,u=i,h=0,d=!!o&&Fn(o,s);h<r;){if(h in n){if(l=d?d(n[h],h,t):n[h],a>0&&nn(l))c=Bt(l),u=vi(e,t,l,c,u,a-1)-1;else{if(u>=9007199254740991)throw gi("Exceed the acceptable array length");e[u]=l}u++}h++}return u};fi=vi,c({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=ye(this),n=Bt(t),r=_n(t,0);return r.length=fi(r,t,t,n,0,void 0===e?1:Rt(e)),r}}),c({target:"Array",proto:!0},{flatMap:function(e){var t,n=ye(this),r=Bt(n);return ie(e),(t=_n(n,0)).length=fi(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}});var mi,yi,xi;xi=function(e,t,n){var r,i;He(e);try{if(!(r=re(e,"return"))){if("throw"===t)throw n;return n}r=m(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return He(r),n},yi=function(e,t,n,r){try{return r?t(He(n)[0],n[1]):t(n)}catch(t){xi(e,"throw",t)}};var bi,wi={};wi={};var Ci=ue("iterator"),Si=Array.prototype;bi=function(e){return void 0!==e&&(wi.Array===e||Si[Ci]===e)};var ki,Ei,Ti=ue("iterator");Ei=function(e){if(null!=e)return re(e,Ti)||re(e,"@@iterator")||wi[on(e)]};var Mi=d.TypeError;ki=function(e,t){var n=arguments.length<2?Ei(e):t;if(ie(n))return He(m(n,e));throw Mi(ae(e)+" is not iterable")};var Ii=d.Array;mi=function(e){var t=ye(e),n=Un(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=Fn(i,r>2?arguments[2]:void 0));var o,s,l,c,u,h,d=Ei(t),p=0;if(!d||this==Ii&&bi(d))for(o=Bt(t),s=n?new this(o):Ii(o);o>p;p++)h=a?i(t[p],p):t[p],kn(s,p,h);else for(u=(c=ki(t,d)).next,s=n?new this:[];!(l=m(u,c)).done;p++)h=a?yi(c,i,[l.value,p],!0):l.value,kn(s,p,h);return s.length=p,s};var Ri,Ai=ue("iterator"),Li=!1;try{var Pi=0,Oi={next:function(){return{done:!!Pi++}},return:function(){Li=!0}};Oi[Ai]=function(){return this},Array.from(Oi,(function(){throw 2}))}catch(e){}var Di=!(Ri=function(e,t){if(!t&&!Li)return!1;var n=!1;try{var r={};r[Ai]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n})((function(e){Array.from(e)}));c({target:"Array",stat:!0,forced:Di},{from:mi});var Bi=Mt.includes;c({target:"Array",proto:!0},{includes:function(e){return Bi(this,e,arguments.length>1?arguments[1]:void 0)}}),ni("includes");var zi,ji=Mt.indexOf;zi=function(e,t){var n=[][e];return!!n&&g((function(){n.call(null,t||function(){throw 1},1)}))};var Fi=T([].indexOf),Ni=!!Fi&&1/Fi([1],1,-0)<0,_i=zi("indexOf");c({target:"Array",proto:!0,forced:Ni||!_i},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Ni?Fi(this,e,t)||0:ji(this,e,t)}});var Hi,Ui,Yi,Xi,Vi,Wi=ze,Gi={};Vi=!g((function(){var e=function(){};return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}));var Ki=nt("IE_PROTO"),qi=d.Object,Ji=qi.prototype;Gi=Vi?qi.getPrototypeOf:function(e){var t=ye(e);if(xe(t,Ki))return t[Ki];var n=t.constructor;return H(n)&&t instanceof n?n.prototype:t instanceof qi?Ji:null};var Zi,Qi,$i,ea=ue("iterator"),ta=!1;[].keys&&("next"in($i=[].keys())?(Qi=Gi(Gi($i)))!==Object.prototype&&(Zi=Qi):ta=!0);var na=null==Zi||g((function(){var e={};return Zi[ea].call(e)!==e}));na&&(Zi={}),H(Zi[ea])||Je(Zi,ea,(function(){return this}));var ra=(Xi={IteratorPrototype:Zi,BUGGY_SAFARI_ITERATORS:ta}).IteratorPrototype,ia=function(){return this};Yi=function(e,t,n,r){var i=t+" Iterator";return e.prototype=pn(ra,{next:S(+!r,n)}),Dn(e,i,!1),wi[i]=ia,e};var aa,oa={},sa=d.String,la=d.TypeError;aa=function(e){if("object"==typeof e||H(e))return e;throw la("Can't set "+sa(e)+" as a prototype")},oa=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=T(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return He(n),aa(r),t?e(n,r):n.__proto__=r,n}}():void 0);var ca=vt.PROPER,ua=vt.CONFIGURABLE,ha=Xi.IteratorPrototype,da=Xi.BUGGY_SAFARI_ITERATORS,pa=ue("iterator"),fa="keys",ga="values",va="entries",ma=function(){return this};Ui=function(e,t,n,r,i,a,o){Yi(n,t,r);var s,l,u,h=function(e){if(e===i&&v)return v;if(!da&&e in f)return f[e];switch(e){case fa:case ga:case va:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",p=!1,f=e.prototype,g=f[pa]||f["@@iterator"]||i&&f[i],v=!da&&g||h(i),y="Array"==t&&f.entries||g;if(y&&(s=Gi(y.call(new e)))!==Object.prototype&&s.next&&(Gi(s)!==ha&&(oa?oa(s,ha):H(s[pa])||Je(s,pa,ma)),Dn(s,d,!0)),ca&&i==ga&&g&&g.name!==ga&&(ua?_e(f,"name",ga):(p=!0,v=function(){return m(g,this)})),i)if(l={values:h(ga),keys:a?v:h(fa),entries:h(va)},o)for(u in l)(da||p||!(u in f))&&Je(f,u,l[u]);else c({target:t,proto:!0,forced:da||p},l);return f[pa]!==v&&Je(f,pa,v,{name:i}),wi[t]=v,l};var ya="Array Iterator",xa=$e.set,ba=$e.getterFor(ya);Hi=Ui(Array,"Array",(function(e,t){xa(this,{type:ya,target:k(e),index:0,kind:t})}),(function(){var e=ba(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");var wa=wi.Arguments=wi.Array;if(ni("keys"),ni("values"),ni("entries"),f&&"values"!==wa.name)try{Wi(wa,"name",{value:"values"})}catch(e){}var Ca=T([].join),Sa=E!=Object,ka=zi("join",",");c({target:"Array",proto:!0,forced:Sa||!ka},{join:function(e){return Ca(k(this),void 0===e?",":e)}});var Ea,Ta=Math.min,Ma=[].lastIndexOf,Ia=!!Ma&&1/[1].lastIndexOf(1,-0)<0,Ra=zi("lastIndexOf");Ea=Ia||!Ra?function(e){if(Ia)return Qt(Ma,this,arguments)||0;var t=k(this),n=Bt(t),r=n-1;for(arguments.length>1&&(r=Ta(r,Rt(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Ma,c({target:"Array",proto:!0,forced:Ea!==[].lastIndexOf},{lastIndexOf:Ea});var Aa=jn.map,La=Vr("map");c({target:"Array",proto:!0,forced:!La},{map:function(e){return Aa(this,e,arguments.length>1?arguments[1]:void 0)}});var Pa=d.Array,Oa=g((function(){var e=function(){};return!(Pa.of.call(e)instanceof e)}));c({target:"Array",stat:!0,forced:Oa},{of:function(){for(var e=0,t=arguments.length,n=new(Un(this)?this:Pa)(t);t>e;)kn(n,e,arguments[e++]);return n.length=t,n}});var Da,Ba,za=d.TypeError,ja=function(e){return function(t,n,r,i){ie(n);var a=ye(t),o=E(a),s=Bt(a),l=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(l in o){i=o[l],l+=c;break}if(l+=c,e?l<0:s<=l)throw za("Reduce of empty array with no initial value")}for(;e?l>=0:s>l;l+=c)l in o&&(i=n(i,o[l],l,a));return i}},Fa=(Da={left:ja(!1),right:ja(!0)}).left;Ba="process"==L(d.process);var Na=zi("reduce");c({target:"Array",proto:!0,forced:!Na||!Ba&&K>79&&K<83},{reduce:function(e){var t=arguments.length;return Fa(this,e,t,t>1?arguments[1]:void 0)}});var _a=Da.right,Ha=zi("reduceRight");c({target:"Array",proto:!0,forced:!Ha||!Ba&&K>79&&K<83},{reduceRight:function(e){return _a(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Ua=T([].reverse),Ya=[1,2];c({target:"Array",proto:!0,forced:String(Ya)===String(Ya.reverse())},{reverse:function(){return nn(this)&&(this.length=this.length),Ua(this)}});var Xa=Vr("slice"),Va=ue("species"),Wa=d.Array,Ga=Math.max;c({target:"Array",proto:!0,forced:!Xa},{slice:function(e,t){var n,r,i,a=k(this),o=Bt(a),s=It(e,o),l=It(void 0===t?o:t,o);if(nn(a)&&(n=a.constructor,(Un(n)&&(n===Wa||nn(n.prototype))||_(n)&&null===(n=n[Va]))&&(n=void 0),n===Wa||void 0===n))return An(a,s,l);for(r=new(void 0===n?Wa:n)(Ga(l-s,0)),i=0;s<l;s++,i++)s in a&&kn(r,i,a[s]);return r.length=i,r}});var Ka={},qa=Math.floor,Ja=function(e,t){var n=e.length,r=qa(n/2);return n<8?Za(e,t):Qa(e,Ja(Sn(e,0,r),t),Ja(Sn(e,r),t),t)},Za=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},Qa=function(e,t,n,r){for(var i=t.length,a=n.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?r(t[o],n[s])<=0?t[o++]:n[s++]:o<i?t[o++]:n[s++];return e};Ka=Ja;var $a,eo=q.match(/firefox\/(\d+)/i);$a=!!eo&&+eo[1];var to;to=/MSIE|Trident/.test(q);var no,ro=q.match(/AppleWebKit\/(\d+)\./);no=!!ro&&+ro[1];var io=[],ao=T(io.sort),oo=T(io.push),so=g((function(){io.sort(void 0)})),lo=g((function(){io.sort(null)})),co=zi("sort"),uo=!g((function(){if(K)return K<70;if(!($a&&$a>3)){if(to)return!0;if(no)return no<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)io.push({k:t+r,v:n})}for(io.sort((function(e,t){return t.v-e.v})),r=0;r<io.length;r++)t=io[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));c({target:"Array",proto:!0,forced:so||!lo||!co||!uo},{sort:function(e){void 0!==e&&ie(e);var t=ye(this);if(uo)return void 0===e?ao(t):ao(t,e);var n,r,i=[],a=Bt(t);for(r=0;r<a;r++)r in t&&oo(i,t[r]);for(Ka(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:rn(t)>rn(n)?1:-1}}(e)),n=i.length,r=0;r<n;)t[r]=i[r++];for(;r<a;)delete t[r++];return t}});var ho,po=ue("species");(ho=function(e){var t=Y(e),n=ze;f&&t&&!t[po]&&n(t,po,{configurable:!0,get:function(){return this}})})("Array");var fo=Vr("splice"),go=d.TypeError,vo=Math.max,mo=Math.min,yo=9007199254740991,xo="Maximum allowed length exceeded";c({target:"Array",proto:!0,forced:!fo},{splice:function(e,t){var n,r,i,a,o,s,l=ye(this),c=Bt(l),u=It(e,c),h=arguments.length;if(0===h?n=r=0:1===h?(n=0,r=c-u):(n=h-2,r=mo(vo(Rt(t),0),c-u)),c+n-r>yo)throw go(xo);for(i=_n(l,r),a=0;a<r;a++)(o=u+a)in l&&kn(i,a,l[o]);if(i.length=r,n<r){for(a=u;a<c-r;a++)s=a+n,(o=a+r)in l?l[s]=l[o]:delete l[s];for(a=c;a>c-r+n;a--)delete l[a-1]}else if(n>r)for(a=c-r;a>u;a--)s=a+n-1,(o=a+r-1)in l?l[s]=l[o]:delete l[s];for(a=0;a<n;a++)l[a+u]=arguments[a+2];return l.length=c-r+n,i}}),ni("flat"),ni("flatMap");var bo,wo;wo="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView;var Co;Co=function(e,t,n){for(var r in t)Je(e,r,t[r],n);return e};var So,ko=d.TypeError;So=function(e,t){if(V(t,e))return e;throw ko("Incorrect invocation")};var Eo,To=d.RangeError;Eo=function(e){if(void 0===e)return 0;var t=Rt(e),n=zt(t);if(t!==n)throw To("Wrong length or index");return n};var Mo,Io=d.Array,Ro=Math.abs,Ao=Math.pow,Lo=Math.floor,Po=Math.log,Oo=Math.LN2;Mo={pack:function(e,t,n){var r,i,a,o=Io(n),s=8*n-t-1,l=(1<<s)-1,c=l>>1,u=23===t?Ao(2,-24)-Ao(2,-77):0,h=e<0||0===e&&1/e<0?1:0,d=0;for((e=Ro(e))!=e||e===1/0?(i=e!=e?1:0,r=l):(r=Lo(Po(e)/Oo),e*(a=Ao(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?u/a:u*Ao(2,1-c))*a>=2&&(r++,a/=2),r+c>=l?(i=0,r=l):r+c>=1?(i=(e*a-1)*Ao(2,t),r+=c):(i=e*Ao(2,c-1)*Ao(2,t),r=0));t>=8;)o[d++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)o[d++]=255&r,r/=256,s-=8;return o[--d]|=128*h,o},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,a=(1<<i)-1,o=a>>1,s=i-7,l=r-1,c=e[l--],u=127&c;for(c>>=7;s>0;)u=256*u+e[l--],s-=8;for(n=u&(1<<-s)-1,u>>=-s,s+=t;s>0;)n=256*n+e[l--],s-=8;if(0===u)u=1-o;else{if(u===a)return n?NaN:c?-1/0:1/0;n+=Ao(2,t),u-=o}return(c?-1:1)*n*Ao(2,u-t)}};var Do=Et,Bo=ze,zo=vt.PROPER,jo=vt.CONFIGURABLE,Fo=$e.get,No=$e.set,_o="ArrayBuffer",Ho="DataView",Uo="Wrong index",Yo=d.ArrayBuffer,Xo=Yo,Vo=Xo&&Xo.prototype,Wo=d.DataView,Go=Wo&&Wo.prototype,Ko=Object.prototype,qo=d.Array,Jo=d.RangeError,Zo=T(ai),Qo=T([].reverse),$o=Mo.pack,es=Mo.unpack,ts=function(e){return[255&e]},ns=function(e){return[255&e,e>>8&255]},rs=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},is=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},as=function(e){return $o(e,23,4)},os=function(e){return $o(e,52,8)},ss=function(e,t){Bo(e.prototype,t,{get:function(){return Fo(this)[t]}})},ls=function(e,t,n,r){var i=Eo(n),a=Fo(e);if(i+t>a.byteLength)throw Jo(Uo);var o=Fo(a.buffer).bytes,s=i+a.byteOffset,l=Sn(o,s,s+t);return r?l:Qo(l)},cs=function(e,t,n,r,i,a){var o=Eo(n),s=Fo(e);if(o+t>s.byteLength)throw Jo(Uo);for(var l=Fo(s.buffer).bytes,c=o+s.byteOffset,u=r(+i),h=0;h<t;h++)l[c+h]=u[a?h:t-h-1]};if(wo){var us=zo&&Yo.name!==_o;if(g((function(){Yo(1)}))&&g((function(){new Yo(-1)}))&&!g((function(){return new Yo,new Yo(1.5),new Yo(NaN),us&&!jo})))us&&jo&&_e(Yo,"name",_o);else{(Xo=function(e){return So(this,Vo),new Yo(Eo(e))}).prototype=Vo;for(var hs,ds=Do(Yo),ps=0;ds.length>ps;)(hs=ds[ps++])in Xo||_e(Xo,hs,Yo[hs]);Vo.constructor=Xo}oa&&Gi(Go)!==Ko&&oa(Go,Ko);var fs=new Wo(new Xo(2)),gs=T(Go.setInt8);fs.setInt8(0,2147483648),fs.setInt8(1,2147483649),!fs.getInt8(0)&&fs.getInt8(1)||Co(Go,{setInt8:function(e,t){gs(this,e,t<<24>>24)},setUint8:function(e,t){gs(this,e,t<<24>>24)}},{unsafe:!0})}else Vo=(Xo=function(e){So(this,Vo);var t=Eo(e);No(this,{bytes:Zo(qo(t),0),byteLength:t}),f||(this.byteLength=t)}).prototype,Go=(Wo=function(e,t,n){So(this,Go),So(e,Vo);var r=Fo(e).byteLength,i=Rt(t);if(i<0||i>r)throw Jo("Wrong offset");if(i+(n=void 0===n?r-i:zt(n))>r)throw Jo("Wrong length");No(this,{buffer:e,byteLength:n,byteOffset:i}),f||(this.buffer=e,this.byteLength=n,this.byteOffset=i)}).prototype,f&&(ss(Xo,"byteLength"),ss(Wo,"buffer"),ss(Wo,"byteLength"),ss(Wo,"byteOffset")),Co(Go,{getInt8:function(e){return ls(this,1,e)[0]<<24>>24},getUint8:function(e){return ls(this,1,e)[0]},getInt16:function(e){var t=ls(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=ls(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return is(ls(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return is(ls(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return es(ls(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return es(ls(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){cs(this,1,e,ts,t)},setUint8:function(e,t){cs(this,1,e,ts,t)},setInt16:function(e,t){cs(this,2,e,ns,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){cs(this,2,e,ns,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){cs(this,4,e,rs,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){cs(this,4,e,rs,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){cs(this,4,e,as,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){cs(this,8,e,os,t,arguments.length>2?arguments[2]:void 0)}});Dn(Xo,_o),Dn(Wo,Ho);var vs="ArrayBuffer",ms=(bo={ArrayBuffer:Xo,DataView:Wo}).ArrayBuffer,ys=d.ArrayBuffer;c({global:!0,forced:ys!==ms},{ArrayBuffer:ms}),ho(vs);var xs,bs,ws=d.TypeError;bs=function(e){if(Un(e))return e;throw ws(ae(e)+" is not a constructor")};var Cs=ue("species");xs=function(e,t){var n,r=He(e).constructor;return void 0===r||null==(n=He(r)[Cs])?t:bs(n)};var Ss=bo.ArrayBuffer,ks=bo.DataView,Es=ks.prototype,Ts=T(Ss.prototype.slice),Ms=T(Es.getUint8),Is=T(Es.setUint8),Rs=g((function(){return!new Ss(2).slice(1,void 0).byteLength}));c({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Rs},{slice:function(e,t){if(Ts&&void 0===t)return Ts(He(this),e);for(var n=He(this).byteLength,r=It(e,n),i=It(void 0===t?n:t,n),a=new(xs(this,Ss))(zt(i-r)),o=new ks(this),s=new ks(a),l=0;r<i;)Is(s,l++,Ms(o,r++));return a}});var As=g((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));c({target:"Date",proto:!0,forced:As},{toJSON:function(e){var t=ye(this),n=N(t,"number");return"number"!=typeof n||isFinite(n)?t.toISOString():null}});var Ls,Ps=d.TypeError;Ls=function(e){if(He(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw Ps("Incorrect hint");return le(this,e)};var Os=ue("toPrimitive"),Ds=Date.prototype;xe(Ds,Os)||Je(Ds,Os,Ls);var Bs=ue("hasInstance"),zs=Function.prototype;Bs in zs||ze(zs,Bs,{value:function(e){if(!H(this)||!_(e))return!1;var t=this.prototype;if(!_(t))return e instanceof this;for(;e=Gi(e);)if(t===e)return!0;return!1}});var js=vt.EXISTS,Fs=ze,Ns=Function.prototype,_s=T(Ns.toString),Hs=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Us=T(Hs.exec);f&&!js&&Fs(Ns,"name",{configurable:!0,get:function(){try{return Us(Hs,_s(this))[1]}catch(e){return""}}}),Dn(d.JSON,"JSON",!0);var Ys,Xs;a("4gaLD");h=a("gdFSe");var Vs,Ws=ze,Gs={};Vs=g((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}));var Ks=Object.isExtensible,qs=g((function(){Ks(1)}));Gs=qs||Vs?function(e){return!!_(e)&&((!Vs||"ArrayBuffer"!=L(e))&&(!Ks||Ks(e)))}:Ks;var Js;Js=!g((function(){return Object.isExtensible(Object.preventExtensions({}))}));var Zs=!1,Qs=Ce("meta"),$s=0,el=function(e){Ws(e,Qs,{value:{objectID:"O"+$s++,weakData:{}}})},tl=Xs={enable:function(){tl.enable=function(){},Zs=!0;var e=Et,t=T([].splice),n={};n[Qs]=1,e(n).length&&(Et=function(n){for(var r=e(n),i=0,a=r.length;i<a;i++)if(r[i]===Qs){t(r,i,1);break}return r},c({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:mn}))},fastKey:function(e,t){if(!_(e))return"symbol"==(void 0===e?"undefined":h.default(e))?e:("string"==typeof e?"S":"P")+e;if(!xe(e,Qs)){if(!Gs(e))return"F";if(!t)return"E";el(e)}return e[Qs].objectID},getWeakData:function(e,t){if(!xe(e,Qs)){if(!Gs(e))return!0;if(!t)return!1;el(e)}return e[Qs].weakData},onFreeze:function(e){return Js&&Zs&&Gs(e)&&!xe(e,Qs)&&el(e),e}};it[Qs]=!0;var nl,rl=d.TypeError,il=function(e,t){this.stopped=e,this.result=t},al=il.prototype;nl=function(e,t,n){var r,i,a,o,s,l,c,u=n&&n.that,h=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),f=Fn(t,u),g=function(e){return r&&xi(r,"normal",e),new il(!0,e)},v=function(e){return h?(He(e),p?f(e[0],e[1],g):f(e[0],e[1])):p?f(e,g):f(e)};if(d)r=e;else{if(!(i=Ei(e)))throw rl(ae(e)+" is not iterable");if(bi(i)){for(a=0,o=Bt(e);o>a;a++)if((s=v(e[a]))&&V(al,s))return s;return new il(!1)}r=ki(e,i)}for(l=r.next;!(c=m(l,r)).done;){try{s=v(c.value)}catch(e){xi(r,"throw",e)}if("object"==typeof s&&s&&V(al,s))return s}return new il(!1)};var ol;ol=function(e,t,n){var r,i;return oa&&H(r=t.constructor)&&r!==n&&_(i=r.prototype)&&i!==n.prototype&&oa(e,i),e},Ys=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=r?"set":"add",o=d[e],s=o&&o.prototype,l=o,u={},h=function(e){var t=T(s[e]);Je(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!_(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!_(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!_(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(Vt(e,!H(o)||!(i||s.forEach&&!g((function(){(new o).entries().next()})))))l=n.getConstructor(t,e,r,a),Xs.enable();else if(Vt(e,!0)){var p=new l,f=p[a](i?{}:-0,1)!=p,v=g((function(){p.has(1)})),m=Ri((function(e){new o(e)})),y=!i&&g((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));m||((l=t((function(e,t){So(e,s);var n=ol(new o,e,l);return null!=t&&nl(t,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=l),(v||y)&&(h("delete"),h("has"),r&&h("get")),(y||f)&&h(a),i&&s.clear&&delete s.clear}return u[e]=l,c({global:!0,forced:l!=o},u),Dn(l,e),i||n.setStrong(l,e,r),l};var sl,ll=ze,cl=Xs.fastKey,ul=$e.set,hl=$e.getterFor;sl={getConstructor:function(e,t,n,r){var i=e((function(e,i){So(e,a),ul(e,{type:t,index:pn(null),first:void 0,last:void 0,size:0}),f||(e.size=0),null!=i&&nl(i,e[r],{that:e,AS_ENTRIES:n})})),a=i.prototype,o=hl(t),s=function(e,t,n){var r,i,a=o(e),s=l(e,t);return s?s.value=n:(a.last=s={index:i=cl(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),f?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},l=function(e,t){var n,r=o(e),i=cl(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Co(a,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,f?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=l(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),f?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=Fn(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!l(this,e)}}),Co(a,n?{get:function(e){var t=l(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),f&&ll(a,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=hl(t),a=hl(r);Ui(e,t,(function(e,t){ul(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),ho(t)}},Ys("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),sl);var dl={},pl=Math.log;dl=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:pl(1+e)};var fl=Math.acosh,gl=Math.log,vl=Math.sqrt,ml=Math.LN2,yl=!fl||710!=Math.floor(fl(Number.MAX_VALUE))||fl(1/0)!=1/0;c({target:"Math",stat:!0,forced:yl},{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?gl(e)+ml:dl(e-1+vl(e-1)*vl(e+1))}});var xl=Math.asinh,bl=Math.log,wl=Math.sqrt;c({target:"Math",stat:!0,forced:!(xl&&1/xl(0)>0)},{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):bl(t+wl(t*t+1)):t}});var Cl=Math.atanh,Sl=Math.log;c({target:"Math",stat:!0,forced:!(Cl&&1/Cl(-0)<0)},{atanh:function(e){return 0==(e=+e)?e:Sl((1+e)/(1-e))/2}});var kl={};kl=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};var El=Math.abs,Tl=Math.pow;c({target:"Math",stat:!0},{cbrt:function(e){return kl(e=+e)*Tl(El(e),1/3)}});var Ml=Math.floor,Il=Math.log,Rl=Math.LOG2E;c({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Ml(Il(e+.5)*Rl):32}});var Al={},Ll=Math.expm1,Pl=Math.exp;Al=!Ll||Ll(10)>22025.465794806718||Ll(10)<22025.465794806718||-2e-17!=Ll(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Pl(e)-1}:Ll;var Ol=Math.cosh,Dl=Math.abs,Bl=Math.E;c({target:"Math",stat:!0,forced:!Ol||Ol(710)===1/0},{cosh:function(e){var t=Al(Dl(e)-1)+1;return(t+1/(t*Bl*Bl))*(Bl/2)}}),c({target:"Math",stat:!0,forced:Al!=Math.expm1},{expm1:Al});var zl={},jl=Math.abs,Fl=Math.pow,Nl=Fl(2,-52),_l=Fl(2,-23),Hl=Fl(2,127)*(2-_l),Ul=Fl(2,-126);zl=Math.fround||function(e){var t,n,r=jl(e),i=kl(e);return r<Ul?i*(r/Ul/_l+1/Nl-1/Nl)*Ul*_l:(n=(t=(1+_l/Nl)*r)-(t-r))>Hl||n!=n?i*(1/0):i*n},c({target:"Math",stat:!0},{fround:zl});var Yl=Math.hypot,Xl=Math.abs,Vl=Math.sqrt,Wl=!!Yl&&Yl(1/0,NaN)!==1/0;c({target:"Math",stat:!0,forced:Wl},{hypot:function(e,t){for(var n,r,i=0,a=0,o=arguments.length,s=0;a<o;)s<(n=Xl(arguments[a++]))?(i=i*(r=s/n)*r+1,s=n):i+=n>0?(r=n/s)*r:n;return s===1/0?1/0:s*Vl(i)}});var Gl=Math.imul,Kl=g((function(){return-5!=Gl(4294967295,5)||2!=Gl.length}));c({target:"Math",stat:!0,forced:Kl},{imul:function(e,t){var n=65535,r=+e,i=+t,a=n&r,o=n&i;return 0|a*o+((n&r>>>16)*o+a*(n&i>>>16)<<16>>>0)}});var ql,Jl=Math.log,Zl=Math.LOG10E;ql=Math.log10||function(e){return Jl(e)*Zl},c({target:"Math",stat:!0},{log10:ql}),c({target:"Math",stat:!0},{log1p:dl});var Ql=Math.log,$l=Math.LN2;c({target:"Math",stat:!0},{log2:function(e){return Ql(e)/$l}}),c({target:"Math",stat:!0},{sign:kl});var ec=Math.abs,tc=Math.exp,nc=Math.E,rc=g((function(){return-2e-17!=Math.sinh(-2e-17)}));c({target:"Math",stat:!0,forced:rc},{sinh:function(e){return ec(e=+e)<1?(Al(e)-Al(-e))/2:(tc(e-1)-tc(-e-1))*(nc/2)}});var ic=Math.exp;c({target:"Math",stat:!0},{tanh:function(e){var t=Al(e=+e),n=Al(-e);return t==1/0?1:n==1/0?-1:(t-n)/(ic(e)+ic(-e))}}),Dn(Math,"Math",!0);var ac=Math.ceil,oc=Math.floor;c({target:"Math",stat:!0},{trunc:function(e){return(e>0?oc:ac)(e)}}),a("4gaLD");h=a("gdFSe");var sc=Et,lc=u,cc=ze,uc={};uc=T(1..valueOf);var hc,dc;dc="\t\n\v\f\r                　\u2028\u2029\ufeff";var pc=T("".replace),fc=RegExp("^[\t\n\v\f\r                　\u2028\u2029\ufeff][\t\n\v\f\r                　\u2028\u2029\ufeff]*"),gc=RegExp("[\t\n\v\f\r                　\u2028\u2029\ufeff][\t\n\v\f\r                　\u2028\u2029\ufeff]*$"),vc=function(e){return function(t){var n=rn(z(t));return 1&e&&(n=pc(n,fc,"")),2&e&&(n=pc(n,gc,"")),n}},mc=(hc={start:vc(1),end:vc(2),trim:vc(3)}).trim,yc="Number",xc=d.Number,bc=xc.prototype,wc=d.TypeError,Cc=T("".slice),Sc=T("".charCodeAt),kc=function(e){var t=N(e,"number");return"bigint"==(void 0===t?"undefined":h.default(t))?t:Ec(t)},Ec=function(e){var t,n,r,i,a,o,s,l,c=N(e,"number");if(U(c))throw wc("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=mc(c),43===(t=Sc(c,0))||45===t){if(88===(n=Sc(c,2))||120===n)return NaN}else if(48===t){switch(Sc(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(a=Cc(c,2)).length,s=0;s<o;s++)if((l=Sc(a,s))<48||l>i)return NaN;return parseInt(a,r)}return+c};if(Vt(yc,!xc(" 0o1")||!xc("0b1")||xc("+0x1"))){for(var Tc,Mc=function(e){var t=arguments.length<1?0:xc(kc(e)),n=this;return V(bc,n)&&g((function(){uc(n)}))?ol(Object(t),n,Mc):t},Ic=f?sc(xc):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Rc=0;Ic.length>Rc;Rc++)xe(xc,Tc=Ic[Rc])&&!xe(Mc,Tc)&&cc(Mc,Tc,lc(xc,Tc));Mc.prototype=bc,bc.constructor=Mc,Je(d,yc,Mc)}c({target:"Number",stat:!0},{EPSILON:Math.pow(2,-52)});var Ac={},Lc=d.isFinite;Ac=Number.isFinite||function(e){return"number"==typeof e&&Lc(e)},c({target:"Number",stat:!0},{isFinite:Ac});var Pc={},Oc=Math.floor;Pc=Number.isInteger||function(e){return!_(e)&&isFinite(e)&&Oc(e)===e},c({target:"Number",stat:!0},{isInteger:Pc}),c({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var Dc=Math.abs;c({target:"Number",stat:!0},{isSafeInteger:function(e){return Pc(e)&&Dc(e)<=9007199254740991}}),c({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),c({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var Bc,zc=hc.trim,jc=T("".charAt),Fc=d.parseFloat,Nc=d.Symbol,_c=Nc&&Nc.iterator;Bc=1/Fc("\t\n\v\f\r                　\u2028\u2029\ufeff-0")!=-1/0||_c&&!g((function(){Fc(Object(_c))}))?function(e){var t=zc(rn(e)),n=Fc(t);return 0===n&&"-"==jc(t,0)?-0:n}:Fc,c({target:"Number",stat:!0,forced:Number.parseFloat!=Bc},{parseFloat:Bc});var Hc={},Uc=hc.trim,Yc=d.parseInt,Xc=d.Symbol,Vc=Xc&&Xc.iterator,Wc=/^[+-]?0x/i,Gc=T(Wc.exec),Kc=8!==Yc("\t\n\v\f\r                　\u2028\u2029\ufeff08")||22!==Yc("\t\n\v\f\r                　\u2028\u2029\ufeff0x16")||Vc&&!g((function(){Yc(Object(Vc))}));Hc=Kc?function(e,t){var n=Uc(rn(e));return Yc(n,t>>>0||(Gc(Wc,n)?16:10))}:Yc,c({target:"Number",stat:!0,forced:Number.parseInt!=Hc},{parseInt:Hc});var qc,Jc=d.RangeError;qc=function(e){var t=rn(z(this)),n="",r=Rt(e);if(r<0||r==1/0)throw Jc("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n};var Zc=d.RangeError,Qc=d.String,$c=Math.floor,eu=T(qc),tu=T("".slice),nu=T(1..toFixed),ru=function(e,t,n){return 0===t?n:t%2==1?ru(e,t-1,n*e):ru(e*e,t/2,n)},iu=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=$c(i/1e7)},au=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=$c(r/t),r=r%t*1e7},ou=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=Qc(e[t]);n=""===n?r:n+eu("0",7-r.length)+r}return n},su=g((function(){return"0.000"!==nu(8e-5,3)||"1"!==nu(.9,0)||"1.25"!==nu(1.255,2)||"1000000000000000128"!==nu(0xde0b6b3a7640080,0)}))||!g((function(){nu({})}));c({target:"Number",proto:!0,forced:su},{toFixed:function(e){var t,n,r,i,a=uc(this),o=Rt(e),s=[0,0,0,0,0,0],l="",c="0";if(o<0||o>20)throw Zc("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return Qc(a);if(a<0&&(l="-",a=-a),a>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(a*ru(2,69,1))-69)<0?a*ru(2,-t,1):a/ru(2,t,1),n*=4503599627370496,(t=52-t)>0){for(iu(s,0,n),r=o;r>=7;)iu(s,1e7,0),r-=7;for(iu(s,ru(10,r,1),0),r=t-1;r>=23;)au(s,8388608),r-=23;au(s,1<<r),iu(s,1,1),au(s,2),c=ou(s)}else iu(s,0,n),iu(s,1<<-t,0),c=ou(s)+eu("0",o);return c=o>0?l+((i=c.length)<=o?"0."+eu("0",o-i)+c:tu(c,0,i-o)+"."+tu(c,i-o)):l+c}});var lu={},cu=Object.assign,uu=Object.defineProperty,hu=T([].concat);lu=!cu||g((function(){if(f&&1!==cu({b:1},cu(uu({},"a",{enumerable:!0,get:function(){uu(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=cu({},e)[n]||fn(cu({},t)).join("")!=r}))?function(e,t){for(var n=ye(e),r=arguments.length,i=1,a=Ht,o=y;r>i;)for(var s,l=E(arguments[i++]),c=a?hu(fn(l),a(l)):fn(l),u=c.length,h=0;u>h;)s=c[h++],f&&!m(o,l,s)||(n[s]=l[s]);return n}:cu,c({target:"Object",stat:!0,forced:Object.assign!==lu},{assign:lu});var du;du=!g((function(){if(!(no&&no<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete d[e]}})),f&&c({target:"Object",proto:!0,forced:du},{__defineGetter__:function(e,t){ze(ye(this),e,{get:ie(t),enumerable:!0,configurable:!0})}}),f&&c({target:"Object",proto:!0,forced:du},{__defineSetter__:function(e,t){ze(ye(this),e,{set:ie(t),enumerable:!0,configurable:!0})}});var pu,fu=T(y),gu=T([].push),vu=function(e){return function(t){for(var n,r=k(t),i=fn(r),a=i.length,o=0,s=[];a>o;)n=i[o++],f&&!fu(r,n)||gu(s,e?[n,r[n]]:r[n]);return s}},mu=(pu={entries:vu(!0),values:vu(!1)}).entries;c({target:"Object",stat:!0},{entries:function(e){return mu(e)}});var yu=Xs.onFreeze,xu=Object.freeze,bu=g((function(){xu(1)}));c({target:"Object",stat:!0,forced:bu,sham:!Js},{freeze:function(e){return xu&&_(e)?xu(yu(e)):e}}),c({target:"Object",stat:!0},{fromEntries:function(e){var t={};return nl(e,(function(e,n){kn(t,e,n)}),{AS_ENTRIES:!0}),t}});var wu=u,Cu=g((function(){wu(1)}));c({target:"Object",stat:!0,forced:!f||Cu,sham:!f},{getOwnPropertyDescriptor:function(e,t){return wu(k(e),t)}}),c({target:"Object",stat:!0,sham:!f},{getOwnPropertyDescriptors:function(e){for(var t,n,r=k(e),i=u,a=At(r),o={},s=0;a.length>s;)void 0!==(n=i(r,t=a[s++]))&&kn(o,t,n);return o}});var Su=mn,ku=g((function(){return!Object.getOwnPropertyNames(1)}));c({target:"Object",stat:!0,forced:ku},{getOwnPropertyNames:Su});var Eu=g((function(){Gi(1)}));c({target:"Object",stat:!0,forced:Eu,sham:!Vi},{getPrototypeOf:function(e){return Gi(ye(e))}});var Tu={};Tu=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},c({target:"Object",stat:!0},{is:Tu}),c({target:"Object",stat:!0,forced:Object.isExtensible!==Gs},{isExtensible:Gs});var Mu=Object.isFrozen,Iu=g((function(){Mu(1)}));c({target:"Object",stat:!0,forced:Iu||Vs},{isFrozen:function(e){return!_(e)||(!(!Vs||"ArrayBuffer"!=L(e))||!!Mu&&Mu(e))}});var Ru=Object.isSealed,Au=g((function(){Ru(1)}));c({target:"Object",stat:!0,forced:Au||Vs},{isSealed:function(e){return!_(e)||(!(!Vs||"ArrayBuffer"!=L(e))||!!Ru&&Ru(e))}});var Lu=g((function(){fn(1)}));c({target:"Object",stat:!0,forced:Lu},{keys:function(e){return fn(ye(e))}});var Pu=u;f&&c({target:"Object",proto:!0,forced:du},{__lookupGetter__:function(e){var t,n=ye(this),r=F(e);do{if(t=Pu(n,r))return t.get}while(n=Gi(n))}});var Ou=u;f&&c({target:"Object",proto:!0,forced:du},{__lookupSetter__:function(e){var t,n=ye(this),r=F(e);do{if(t=Ou(n,r))return t.set}while(n=Gi(n))}});var Du=Xs.onFreeze,Bu=Object.preventExtensions,zu=g((function(){Bu(1)}));c({target:"Object",stat:!0,forced:zu,sham:!Js},{preventExtensions:function(e){return Bu&&_(e)?Bu(Du(e)):e}});var ju=Xs.onFreeze,Fu=Object.seal,Nu=g((function(){Fu(1)}));c({target:"Object",stat:!0,forced:Nu,sham:!Js},{seal:function(e){return Fu&&_(e)?Fu(ju(e)):e}}),c({target:"Object",stat:!0},{setPrototypeOf:oa});var _u;_u=an?{}.toString:function(){return"[object "+on(this)+"]"},an||Je(Object.prototype,"toString",_u,{unsafe:!0});var Hu=pu.values;c({target:"Object",stat:!0},{values:function(e){return Hu(e)}}),c({global:!0,forced:parseFloat!=Bc},{parseFloat:Bc}),c({global:!0,forced:parseInt!=Hc},{parseInt:Hc});var Uu={};Uu=d.Promise;var Yu,Xu;Xu=/(?:ipad|iphone|ipod).*applewebkit/i.test(q);var Vu,Wu,Gu,Ku,qu=d.setImmediate,Ju=d.clearImmediate,Zu=d.process,Qu=d.Dispatch,$u=d.Function,eh=d.MessageChannel,th=d.String,nh=0,rh={},ih="onreadystatechange";try{Vu=d.location}catch(e){}var ah=function(e){if(xe(rh,e)){var t=rh[e];delete rh[e],t()}},oh=function(e){return function(){ah(e)}},sh=function(e){ah(e.data)},lh=function(e){d.postMessage(th(e),Vu.protocol+"//"+Vu.host)};qu&&Ju||(qu=function(e){var t=An(arguments,1);return rh[++nh]=function(){Qt(H(e)?e:$u(e),void 0,t)},Wu(nh),nh},Ju=function(e){delete rh[e]},Ba?Wu=function(e){Zu.nextTick(oh(e))}:Qu&&Qu.now?Wu=function(e){Qu.now(oh(e))}:eh&&!Xu?(Ku=(Gu=new eh).port2,Gu.port1.onmessage=sh,Wu=Fn(Ku.postMessage,Ku)):d.addEventListener&&H(d.postMessage)&&!d.importScripts&&Vu&&"file:"!==Vu.protocol&&!g(lh)?(Wu=lh,d.addEventListener("message",sh,!1)):Wu=ih in Oe("script")?function(e){gn.appendChild(Oe("script")).onreadystatechange=function(){gn.removeChild(this),ah(e)}}:function(e){setTimeout(oh(e),0)});var ch,uh=(Yu={set:qu,clear:Ju}).set,hh={},dh=u,ph=Yu.set;ch=/ipad|iphone|ipod/i.test(q)&&void 0!==d.Pebble;var fh;fh=/web0s(?!.*chrome)/i.test(q);var gh,vh,mh,yh,xh,bh,wh,Ch,Sh=d.MutationObserver||d.WebKitMutationObserver,kh=d.document,Eh=d.process,Th=d.Promise,Mh=dh(d,"queueMicrotask"),Ih=Mh&&Mh.value;Ih||(gh=function(){var e,t;for(Ba&&(e=Eh.domain)&&e.exit();vh;){t=vh.fn,vh=vh.next;try{t()}catch(e){throw vh?yh():mh=void 0,e}}mh=void 0,e&&e.enter()},Xu||Ba||fh||!Sh||!kh?!ch&&Th&&Th.resolve?((wh=Th.resolve(void 0)).constructor=Th,Ch=Fn(wh.then,wh),yh=function(){Ch(gh)}):Ba?yh=function(){Eh.nextTick(gh)}:(ph=Fn(ph,d),yh=function(){ph(gh)}):(xh=!0,bh=kh.createTextNode(""),new Sh(gh).observe(bh,{characterData:!0}),yh=function(){bh.data=xh=!xh})),hh=Ih||function(e){var t={fn:e,next:void 0};mh&&(mh.next=t),vh||(vh=t,yh()),mh=t};var Rh,Ah,Lh=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=ie(t),this.reject=ie(n)};Ah=function(e){return new Lh(e)},Rh=function(e,t){if(He(e),_(t)&&t.constructor===e)return t;var n=Ah(e);return(0,n.resolve)(t),n.promise};var Ph;Ph=function(e,t){var n=d.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))};var Oh;Oh=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}};var Dh={},Bh=function(){this.head=null,this.tail=null};Bh.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},Dh=Bh;var zh;zh="object"==typeof window;var jh,Fh,Nh,_h,Hh=ue("species"),Uh="Promise",Yh=$e.getterFor(Uh),Xh=$e.set,Vh=$e.getterFor(Uh),Wh=Uu&&Uu.prototype,Gh=Uu,Kh=Wh,qh=d.TypeError,Jh=d.document,Zh=d.process,Qh=Ah,$h=Qh,ed=!!(Jh&&Jh.createEvent&&d.dispatchEvent),td=H(d.PromiseRejectionEvent),nd="unhandledrejection",rd=!1,id=Vt(Uh,(function(){var e=Ze(Gh),t=e!==String(Gh);if(!t&&66===K)return!0;if(K>=51&&/native code/.test(e))return!1;var n=new Gh((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Hh]=r,!(rd=n.then((function(){}))instanceof r)||!t&&zh&&!td})),ad=id||!Ri((function(e){Gh.all(e).catch((function(){}))})),od=function(e){var t;return!(!_(e)||!H(t=e.then))&&t},sd=function(e,t){var n,r,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{s?(o||(2===t.rejection&&dd(t),t.rejection=1),!0===s?n=a:(u&&u.enter(),n=s(a),u&&(u.exit(),i=!0)),n===e.promise?c(qh("Promise-chain cycle")):(r=od(n))?m(r,n,l,c):l(n)):c(a)}catch(e){u&&!i&&u.exit(),c(e)}},ld=function(e,t){e.notified||(e.notified=!0,hh((function(){for(var n,r=e.reactions;n=r.get();)sd(n,e);e.notified=!1,t&&!e.rejection&&ud(e)})))},cd=function(e,t,n){var r,i;ed?((r=Jh.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),d.dispatchEvent(r)):r={promise:t,reason:n},!td&&(i=d["on"+e])?i(r):e===nd&&Ph("Unhandled promise rejection",n)},ud=function(e){m(uh,d,(function(){var t,n=e.facade,r=e.value;if(hd(e)&&(t=Oh((function(){Ba?Zh.emit("unhandledRejection",r,n):cd(nd,n,r)})),e.rejection=Ba||hd(e)?2:1,t.error))throw t.value}))},hd=function(e){return 1!==e.rejection&&!e.parent},dd=function(e){m(uh,d,(function(){var t=e.facade;Ba?Zh.emit("rejectionHandled",t):cd("rejectionhandled",t,e.value)}))},pd=function(e,t,n){return function(r){e(t,r,n)}},fd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,ld(e,!0))},gd=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw qh("Promise can't be resolved itself");var r=od(t);r?hh((function(){var n={done:!1};try{m(r,t,pd(gd,n,e),pd(fd,n,e))}catch(t){fd(n,t,e)}})):(e.value=t,e.state=1,ld(e,!1))}catch(t){fd({done:!1},t,e)}}};if(id&&(Kh=(Gh=function(e){So(this,Kh),ie(e),m(jh,this);var t=Yh(this);try{e(pd(gd,t),pd(fd,t))}catch(e){fd(t,e)}}).prototype,(jh=function(e){Xh(this,{type:Uh,done:!1,notified:!1,parent:!1,reactions:new Dh,rejection:!1,state:0,value:void 0})}).prototype=Co(Kh,{then:function(e,t){var n=Vh(this),r=Qh(xs(this,Gh));return n.parent=!0,r.ok=!H(e)||e,r.fail=H(t)&&t,r.domain=Ba?Zh.domain:void 0,0==n.state?n.reactions.add(r):hh((function(){sd(r,n)})),r.promise},catch:function(e){return this.then(void 0,e)}}),Fh=function(){var e=new jh,t=Yh(e);this.promise=e,this.resolve=pd(gd,t),this.reject=pd(fd,t)},Ah=Qh=function(e){return e===Gh||e===Nh?new Fh(e):$h(e)},H(Uu)&&Wh!==Object.prototype)){_h=Wh.then,rd||(Je(Wh,"then",(function(e,t){var n=this;return new Gh((function(e,t){m(_h,n,e,t)})).then(e,t)}),{unsafe:!0}),Je(Wh,"catch",Kh.catch,{unsafe:!0}));try{delete Wh.constructor}catch(e){}oa&&oa(Wh,Kh)}c({global:!0,wrap:!0,forced:id},{Promise:Gh}),Dn(Gh,Uh,!1),ho(Uh),Nh=Y(Uh),c({target:Uh,stat:!0,forced:id},{reject:function(e){var t=Qh(this);return m(t.reject,void 0,e),t.promise}}),c({target:Uh,stat:!0,forced:id},{resolve:function(e){return Rh(this,e)}}),c({target:Uh,stat:!0,forced:ad},{all:function(e){var t=this,n=Qh(t),r=n.resolve,i=n.reject,a=Oh((function(){var n=ie(t.resolve),a=[],o=0,s=1;nl(e,(function(e){var l=o++,c=!1;s++,m(n,t,e).then((function(e){c||(c=!0,a[l]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=Qh(t),r=n.reject,i=Oh((function(){var i=ie(t.resolve);nl(e,(function(e){m(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var vd=!!Uu&&g((function(){Uu.prototype.finally.call({then:function(){}},(function(){}))}));if(c({target:"Promise",proto:!0,real:!0,forced:vd},{finally:function(e){var t=xs(this,Y("Promise")),n=H(e);return this.then(n?function(n){return Rh(t,e()).then((function(){return n}))}:e,n?function(n){return Rh(t,e()).then((function(){throw n}))}:e)}}),H(Uu)){var md=Y("Promise").prototype.finally;Uu.prototype.finally!==md&&Je(Uu.prototype,"finally",md,{unsafe:!0})}var yd=!g((function(){Reflect.apply((function(){}))}));c({target:"Reflect",stat:!0,forced:yd},{apply:function(e,t,n){return Qt(ie(e),t,He(n))}});var xd,bd=d.Function,wd=T([].concat),Cd=T([].join),Sd={},kd=function(e,t,n){if(!xe(Sd,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Sd[t]=bd("C,a","return new C("+Cd(r,",")+")")}return Sd[t](e,n)};xd=v?bd.bind:function(e){var t=ie(this),n=t.prototype,r=An(arguments,1),i=function(){var n=wd(r,An(arguments));return this instanceof i?kd(t,n.length,n):t.apply(e,n)};return _(n)&&(i.prototype=n),i};var Ed=Y("Reflect","construct"),Td=Object.prototype,Md=[].push,Id=g((function(){var e=function(){};return!(Ed((function(){}),[],e)instanceof e)})),Rd=!g((function(){Ed((function(){}))})),Ad=Id||Rd;c({target:"Reflect",stat:!0,forced:Ad,sham:Ad},{construct:function(e,t){bs(e),He(t);var n=arguments.length<3?e:bs(arguments[2]);if(Rd&&!Id)return Ed(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return Qt(Md,r,t),new(Qt(xd,e,r))}var i=n.prototype,a=pn(_(i)?i:Td),o=Qt(e,a,t);return _(o)?o:a}});var Ld=g((function(){Reflect.defineProperty(ze({},1,{value:1}),1,{value:2})}));c({target:"Reflect",stat:!0,forced:Ld,sham:!f},{defineProperty:function(e,t,n){He(e);var r=F(t);He(n);try{return ze(e,r,n),!0}catch(e){return!1}}});var Pd=u;c({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var n=Pd(He(e),t);return!(n&&!n.configurable)&&delete e[t]}});var Od;Od=function(e){return void 0!==e&&(xe(e,"value")||xe(e,"writable"))},c({target:"Reflect",stat:!0},{get:function e(t,n){var r,i,a=arguments.length<3?t:arguments[2];return He(t)===a?t[n]:(r=u(t,n))?Od(r)?r.value:void 0===r.get?void 0:m(r.get,a):_(i=Gi(t))?e(i,n,a):void 0}}),c({target:"Reflect",stat:!0,sham:!f},{getOwnPropertyDescriptor:function(e,t){return u(He(e),t)}}),c({target:"Reflect",stat:!0,sham:!Vi},{getPrototypeOf:function(e){return Gi(He(e))}}),c({target:"Reflect",stat:!0},{has:function(e,t){return t in e}}),c({target:"Reflect",stat:!0},{isExtensible:function(e){return He(e),Gs(e)}}),c({target:"Reflect",stat:!0},{ownKeys:At}),c({target:"Reflect",stat:!0,sham:!Js},{preventExtensions:function(e){He(e);try{var t=Y("Object","preventExtensions");return t&&t(e),!0}catch(e){return!1}}});var Dd=g((function(){var e=function(){},t=ze(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}));c({target:"Reflect",stat:!0,forced:Dd},{set:function e(t,n,r){var i,a,o,s=arguments.length<4?t:arguments[3],l=u(He(t),n);if(!l){if(_(a=Gi(t)))return e(a,n,r,s);l=S(0)}if(Od(l)){if(!1===l.writable||!_(s))return!1;if(i=u(s,n)){if(i.get||i.set||!1===i.writable)return!1;i.value=r,ze(s,n,i)}else ze(s,n,S(0,r))}else{if(void 0===(o=l.set))return!1;m(o,s,r)}return!0}}),oa&&c({target:"Reflect",stat:!0},{setPrototypeOf:function(e,t){He(e),aa(t);try{return oa(e,t),!0}catch(e){return!1}}});var Bd,zd=ze,jd=Et,Fd=ue("match");Bd=function(e){var t;return _(e)&&(void 0!==(t=e[Fd])?!!t:"RegExp"==L(e))};var Nd;Nd=function(){var e=He(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};var _d,Hd=d.RegExp,Ud=g((function(){var e=Hd("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Yd=Ud||g((function(){return!Hd("a","y").sticky}));_d={BROKEN_CARET:Ud||g((function(){var e=Hd("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:Yd,UNSUPPORTED_Y:Ud};var Xd,Vd=$e.enforce,Wd=d.RegExp;Xd=g((function(){var e=Wd(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}));var Gd,Kd=d.RegExp;Gd=g((function(){var e=Kd("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}));var qd=ue("match"),Jd=d.RegExp,Zd=Jd.prototype,Qd=d.SyntaxError,$d=T(Nd),ep=T(Zd.exec),tp=T("".charAt),np=T("".replace),rp=T("".indexOf),ip=T("".slice),ap=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,op=/a/g,sp=/a/g,lp=new Jd(op)!==op,cp=_d.MISSED_STICKY,up=_d.UNSUPPORTED_Y,hp=f&&(!lp||cp||Xd||Gd||g((function(){return sp[qd]=!1,Jd(op)!=op||Jd(sp)==sp||"/a/i"!=Jd(op,"i")})));if(Vt("RegExp",hp)){for(var dp=function(e,t){var n,r,i,a,o,s,l=V(Zd,this),c=Bd(e),u=void 0===t,h=[],d=e;if(!l&&c&&u&&e.constructor===dp)return e;if((c||V(Zd,e))&&(e=e.source,u&&(t="flags"in d?d.flags:$d(d))),e=void 0===e?"":rn(e),t=void 0===t?"":rn(t),d=e,Xd&&"dotAll"in op&&(r=!!t&&rp(t,"s")>-1)&&(t=np(t,/s/g,"")),n=t,cp&&"sticky"in op&&(i=!!t&&rp(t,"y")>-1)&&up&&(t=np(t,/y/g,"")),Gd&&(a=function(e){for(var t,n=e.length,r=0,i="",a=[],o={},s=!1,l=!1,c=0,u="";r<=n;r++){if("\\"===(t=tp(e,r)))t+=tp(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:ep(ap,ip(e,r+1))&&(r+=2,l=!0),i+=t,c++;continue;case">"===t&&l:if(""===u||xe(o,u))throw new Qd("Invalid capture group name");o[u]=!0,a[a.length]=[u,c],l=!1,u="";continue}l?u+=t:i+=t}return[i,a]}(e),e=a[0],h=a[1]),o=ol(Jd(e,t),l?this:Zd,dp),(r||i||h.length)&&(s=Vd(o),r&&(s.dotAll=!0,s.raw=dp(function(e){for(var t,n=e.length,r=0,i="",a=!1;r<=n;r++)"\\"!==(t=tp(e,r))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+tp(e,++r);return i}(e),n)),i&&(s.sticky=!0),h.length&&(s.groups=h)),e!==d)try{_e(o,"source",""===d?"(?:)":d)}catch(e){}return o},pp=function(e){e in dp||zd(dp,e,{configurable:!0,get:function(){return Jd[e]},set:function(t){Jd[e]=t}})},fp=jd(Jd),gp=0;fp.length>gp;)pp(fp[gp++]);Zd.constructor=dp,dp.prototype=Zd,Je(d,"RegExp",dp)}ho("RegExp");var vp,mp,yp,xp=$e.get,bp=he("native-string-replace",String.prototype.replace),wp=RegExp.prototype.exec,Cp=wp,Sp=T("".charAt),kp=T("".indexOf),Ep=T("".replace),Tp=T("".slice),Mp=(yp=/b*/g,m(wp,mp=/a/,"a"),m(wp,yp,"a"),0!==mp.lastIndex||0!==yp.lastIndex),Ip=_d.BROKEN_CARET,Rp=void 0!==/()??/.exec("")[1];(Mp||Rp||Ip||Xd||Gd)&&(Cp=function(e){var t,n,r,i,a,o,s,l=this,c=xp(l),u=rn(e),h=c.raw;if(h)return h.lastIndex=l.lastIndex,t=m(Cp,h,u),l.lastIndex=h.lastIndex,t;var d=c.groups,p=Ip&&l.sticky,f=m(Nd,l),g=l.source,v=0,y=u;if(p&&(f=Ep(f,"y",""),-1===kp(f,"g")&&(f+="g"),y=Tp(u,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==Sp(u,l.lastIndex-1))&&(g="(?: "+g+")",y=" "+y,v++),n=new RegExp("^(?:"+g+")",f)),Rp&&(n=new RegExp("^"+g+"$(?!\\s)",f)),Mp&&(r=l.lastIndex),i=m(wp,p?n:l,y),p?i?(i.input=Tp(i.input,v),i[0]=Tp(i[0],v),i.index=l.lastIndex,l.lastIndex+=i[0].length):l.lastIndex=0:Mp&&i&&(l.lastIndex=l.global?i.index+i[0].length:r),Rp&&i&&i.length>1&&m(bp,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&d)for(i.groups=o=pn(null),a=0;a<d.length;a++)o[(s=d[a])[0]]=i[s[1]];return i}),c({target:"RegExp",proto:!0,forced:/./.exec!==(vp=Cp)},{exec:vp});var Ap=RegExp.prototype;f&&g((function(){return"sy"!==Object.getOwnPropertyDescriptor(Ap,"flags").get.call({dotAll:!0,sticky:!0})}))&&ze(Ap,"flags",{configurable:!0,get:Nd});var Lp=vt.PROPER,Pp="toString",Op=RegExp.prototype,Dp=Op.toString,Bp=T(Nd),zp=g((function(){return"/a/b"!=Dp.call({source:"a",flags:"b"})})),jp=Lp&&Dp.name!=Pp;(zp||jp)&&Je(RegExp.prototype,Pp,(function(){var e=He(this),t=rn(e.source),n=e.flags;return"/"+t+"/"+rn(void 0===n&&V(Op,e)&&!("flags"in Op)?Bp(e):n)}),{unsafe:!0}),Ys("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),sl);var Fp,Np=T("".charAt),_p=T("".charCodeAt),Hp=T("".slice),Up=function(e){return function(t,n){var r,i,a=rn(z(t)),o=Rt(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=_p(a,o))<55296||r>56319||o+1===s||(i=_p(a,o+1))<56320||i>57343?e?Np(a,o):r:e?Hp(a,o,o+2):i-56320+(r-55296<<10)+65536}},Yp=(Fp={codeAt:Up(!1),charAt:Up(!0)}).codeAt;c({target:"String",proto:!0},{codePointAt:function(e){return Yp(this,e)}});var Xp,Vp=u,Wp=d.TypeError;Xp=function(e){if(Bd(e))throw Wp("The method doesn't accept regular expressions");return e};var Gp,Kp=ue("match");Gp=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Kp]=!1,"/./"[e](t)}catch(e){}}return!1};var qp,Jp=T("".endsWith),Zp=T("".slice),Qp=Math.min,$p=Gp("endsWith"),ef=!($p||(qp=Vp(String.prototype,"endsWith"),!qp||qp.writable));c({target:"String",proto:!0,forced:!ef&&!$p},{endsWith:function(e){var t=rn(z(this));Xp(e);var n=arguments.length>1?arguments[1]:void 0,r=t.length,i=void 0===n?r:Qp(zt(n),r),a=rn(e);return Jp?Jp(t,a,i):Zp(t,i-a.length,i)===a}});var tf=d.RangeError,nf=String.fromCharCode,rf=String.fromCodePoint,af=T([].join),of=!!rf&&1!=rf.length;c({target:"String",stat:!0,forced:of},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],It(t,1114111)!==t)throw tf(t+" is not a valid code point");n[i]=t<65536?nf(t):nf(55296+((t-=65536)>>10),t%1024+56320)}return af(n,"")}});var sf=T("".indexOf);c({target:"String",proto:!0,forced:!Gp("includes")},{includes:function(e){return!!~sf(rn(z(this)),rn(Xp(e)),arguments.length>1?arguments[1]:void 0)}});var lf=Fp.charAt,cf="String Iterator",uf=$e.set,hf=$e.getterFor(cf);Ui(String,"String",(function(e){uf(this,{type:cf,string:rn(e),index:0})}),(function(){var e,t=hf(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=lf(n,r),t.index+=e.length,{value:e,done:!1})}));var df,pf=ue("species"),ff=RegExp.prototype;df=function(e,t,n,r){var i=ue(e),a=!g((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!g((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[pf]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!a||!o||n){var s=T(/./[i]),l=t(i,""[e],(function(e,t,n,r,i){var o=T(e),l=t.exec;return l===vp||l===ff.exec?a&&!i?{done:!0,value:s(t,n,r)}:{done:!0,value:o(n,t,r)}:{done:!1}}));Je(String.prototype,e,l[0]),Je(ff,i,l[1])}r&&_e(ff[i],"sham",!0)};var gf,vf=Fp.charAt;gf=function(e,t,n){return t+(n?vf(e,t).length:1)};var mf,yf=d.TypeError;mf=function(e,t){var n=e.exec;if(H(n)){var r=m(n,e,t);return null!==r&&He(r),r}if("RegExp"===L(e))return m(vp,e,t);throw yf("RegExp#exec called on incompatible receiver")},df("match",(function(e,t,n){return[function(t){var n=z(this),r=null==t?void 0:re(t,e);return r?m(r,t,n):new RegExp(t)[e](rn(n))},function(e){var r=He(this),i=rn(e),a=n(t,r,i);if(a.done)return a.value;if(!r.global)return mf(r,i);var o=r.unicode;r.lastIndex=0;for(var s,l=[],c=0;null!==(s=mf(r,i));){var u=rn(s[0]);l[c]=u,""===u&&(r.lastIndex=gf(i,zt(r.lastIndex),o)),c++}return 0===c?null:l}]}));var xf,bf,wf=T(qc),Cf=T("".slice),Sf=Math.ceil,kf=function(e){return function(t,n,r){var i,a,o=rn(z(t)),s=zt(n),l=o.length,c=void 0===r?" ":rn(r);return s<=l||""==c?o:((a=wf(c,Sf((i=s-l)/c.length))).length>i&&(a=Cf(a,0,i)),e?o+a:a+o)}},Ef=(xf={start:kf(!1),end:kf(!0)}).end;bf=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(q),c({target:"String",proto:!0,forced:bf},{padEnd:function(e){return Ef(this,e,arguments.length>1?arguments[1]:void 0)}});var Tf=xf.start;c({target:"String",proto:!0,forced:bf},{padStart:function(e){return Tf(this,e,arguments.length>1?arguments[1]:void 0)}});var Mf=T([].push),If=T([].join);c({target:"String",stat:!0},{raw:function(e){for(var t=k(ye(e).raw),n=Bt(t),r=arguments.length,i=[],a=0;n>a;){if(Mf(i,rn(t[a++])),a===n)return If(i,"");a<r&&Mf(i,rn(arguments[a]))}}}),c({target:"String",proto:!0},{repeat:qc});var Rf,Af=Math.floor,Lf=T("".charAt),Pf=T("".replace),Of=T("".slice),Df=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Bf=/\$([$&'`]|\d{1,2})/g;Rf=function(e,t,n,r,i,a){var o=n+e.length,s=r.length,l=Bf;return void 0!==i&&(i=ye(i),l=Df),Pf(a,l,(function(a,l){var c;switch(Lf(l,0)){case"$":return"$";case"&":return e;case"`":return Of(t,0,n);case"'":return Of(t,o);case"<":c=i[Of(l,1,-1)];break;default:var u=+l;if(0===u)return a;if(u>s){var h=Af(u/10);return 0===h?a:h<=s?void 0===r[h-1]?Lf(l,1):r[h-1]+Lf(l,1):a}c=r[u-1]}return void 0===c?"":c}))};var zf=ue("replace"),jf=Math.max,Ff=Math.min,Nf=T([].concat),_f=T([].push),Hf=T("".indexOf),Uf=T("".slice),Yf="$0"==="a".replace(/./,"$0"),Xf=!!/./[zf]&&""===/./[zf]("a","$0"),Vf=!g((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));df("replace",(function(e,t,n){var r=Xf?"$":"$0";return[function(e,n){var r=z(this),i=null==e?void 0:re(e,zf);return i?m(i,e,r,n):m(t,rn(r),e,n)},function(e,i){var a=He(this),o=rn(e);if("string"==typeof i&&-1===Hf(i,r)&&-1===Hf(i,"$<")){var s=n(t,a,o,i);if(s.done)return s.value}var l=H(i);l||(i=rn(i));var c=a.global;if(c){var u=a.unicode;a.lastIndex=0}for(var h=[];;){var d=mf(a,o);if(null===d)break;if(_f(h,d),!c)break;""===rn(d[0])&&(a.lastIndex=gf(o,zt(a.lastIndex),u))}for(var p,f="",g=0,v=0;v<h.length;v++){for(var m=rn((d=h[v])[0]),y=jf(Ff(Rt(d.index),o.length),0),x=[],b=1;b<d.length;b++)_f(x,void 0===(p=d[b])?p:String(p));var w=d.groups;if(l){var C=Nf([m],x,y,o);void 0!==w&&_f(C,w);var S=rn(Qt(i,void 0,C))}else S=Rf(m,o,y,x,w,i);y>=g&&(f+=Uf(o,g,y)+S,g=y+m.length)}return f+Uf(o,g)}]}),!Vf||!Yf||Xf),df("search",(function(e,t,n){return[function(t){var n=z(this),r=null==t?void 0:re(t,e);return r?m(r,t,n):new RegExp(t)[e](rn(n))},function(e){var r=He(this),i=rn(e),a=n(t,r,i);if(a.done)return a.value;var o=r.lastIndex;Tu(o,0)||(r.lastIndex=0);var s=mf(r,i);return Tu(r.lastIndex,o)||(r.lastIndex=o),null===s?-1:s.index}]}));var Wf=_d.UNSUPPORTED_Y,Gf=4294967295,Kf=Math.min,qf=[].push,Jf=T(/./.exec),Zf=T(qf),Qf=T("".slice),$f=!g((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));df("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=rn(z(this)),i=void 0===n?Gf:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Bd(e))return m(t,r,e,i);for(var a,o,s,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,h=new RegExp(e.source,c+"g");(a=m(vp,h,r))&&!((o=h.lastIndex)>u&&(Zf(l,Qf(r,u,a.index)),a.length>1&&a.index<r.length&&Qt(qf,l,Sn(a,1)),s=a[0].length,u=o,l.length>=i));)h.lastIndex===a.index&&h.lastIndex++;return u===r.length?!s&&Jf(h,"")||Zf(l,""):Zf(l,Qf(r,u)),l.length>i?Sn(l,0,i):l}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:m(t,this,e,n)}:t,[function(t,n){var i=z(this),a=null==t?void 0:re(t,e);return a?m(a,t,i,n):m(r,rn(i),t,n)},function(e,i){var a=He(this),o=rn(e),s=n(r,a,o,i,r!==t);if(s.done)return s.value;var l=xs(a,RegExp),c=a.unicode,u=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Wf?"g":"y"),h=new l(Wf?"^(?:"+a.source+")":a,u),d=void 0===i?Gf:i>>>0;if(0===d)return[];if(0===o.length)return null===mf(h,o)?[o]:[];for(var p=0,f=0,g=[];f<o.length;){h.lastIndex=Wf?0:f;var v,m=mf(h,Wf?Qf(o,f):o);if(null===m||(v=Kf(zt(h.lastIndex+(Wf?f:0)),o.length))===p)f=gf(o,f,c);else{if(Zf(g,Qf(o,p,f)),g.length===d)return g;for(var y=1;y<=m.length-1;y++)if(Zf(g,m[y]),g.length===d)return g;f=p=v}}return Zf(g,Qf(o,p)),g}]}),!$f,Wf);var eg=u,tg=T("".startsWith),ng=T("".slice),rg=Math.min,ig=Gp("startsWith"),ag=!ig&&!!function(){var e=eg(String.prototype,"startsWith");return e&&!e.writable}();c({target:"String",proto:!0,forced:!ag&&!ig},{startsWith:function(e){var t=rn(z(this));Xp(e);var n=zt(rg(arguments.length>1?arguments[1]:void 0,t.length)),r=rn(e);return tg?tg(t,r,n):ng(t,n,n+r.length)===r}});var og,sg=hc.trim,lg=vt.PROPER;c({target:"String",proto:!0,forced:(og=function(e){return g((function(){return!!dc[e]()||"​᠎"!=="​᠎"[e]()||lg&&dc[e].name!==e}))})("trim")},{trim:function(){return sg(this)}});var cg=hc.end,ug=og("trimEnd"),hg=ug?function(){return cg(this)}:"".trimEnd;c({target:"String",proto:!0,name:"trimEnd",forced:ug},{trimEnd:hg,trimRight:hg});var dg=hc.start,pg=og("trimStart"),fg=pg?function(){return dg(this)}:"".trimStart;c({target:"String",proto:!0,name:"trimStart",forced:pg},{trimStart:fg,trimLeft:fg});var gg,vg=/"/g,mg=T("".replace);gg=function(e,t,n,r){var i=rn(z(e)),a="<"+t;return""!==n&&(a+=" "+n+'="'+mg(rn(r),vg,"&quot;")+'"'),a+">"+i+"</"+t+">"};var yg;yg=function(e){return g((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},c({target:"String",proto:!0,forced:yg("anchor")},{anchor:function(e){return gg(this,"a","name",e)}}),c({target:"String",proto:!0,forced:yg("big")},{big:function(){return gg(this,"big","","")}}),c({target:"String",proto:!0,forced:yg("blink")},{blink:function(){return gg(this,"blink","","")}}),c({target:"String",proto:!0,forced:yg("bold")},{bold:function(){return gg(this,"b","","")}}),c({target:"String",proto:!0,forced:yg("fixed")},{fixed:function(){return gg(this,"tt","","")}}),c({target:"String",proto:!0,forced:yg("fontcolor")},{fontcolor:function(e){return gg(this,"font","color",e)}}),c({target:"String",proto:!0,forced:yg("fontsize")},{fontsize:function(e){return gg(this,"font","size",e)}}),c({target:"String",proto:!0,forced:yg("italics")},{italics:function(){return gg(this,"i","","")}}),c({target:"String",proto:!0,forced:yg("link")},{link:function(e){return gg(this,"a","href",e)}}),c({target:"String",proto:!0,forced:yg("small")},{small:function(){return gg(this,"small","","")}}),c({target:"String",proto:!0,forced:yg("strike")},{strike:function(){return gg(this,"strike","","")}}),c({target:"String",proto:!0,forced:yg("sub")},{sub:function(){return gg(this,"sub","","")}}),c({target:"String",proto:!0,forced:yg("sup")},{sup:function(){return gg(this,"sup","","")}});var xg,bg,wg,Cg,Sg,kg={},Eg=ze,Tg=d.Int8Array,Mg=Tg&&Tg.prototype,Ig=d.Uint8ClampedArray,Rg=Ig&&Ig.prototype,Ag=Tg&&Gi(Tg),Lg=Mg&&Gi(Mg),Pg=Object.prototype,Og=d.TypeError,Dg=ue("toStringTag"),Bg=Ce("TYPED_ARRAY_TAG"),zg=Ce("TYPED_ARRAY_CONSTRUCTOR"),jg=wo&&!!oa&&"Opera"!==on(d.opera),Fg=!1,Ng={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},_g={BigInt64Array:8,BigUint64Array:8},Hg=function(e){if(!_(e))return!1;var t=on(e);return xe(Ng,t)||xe(_g,t)};for(wg in Ng)(Sg=(Cg=d[wg])&&Cg.prototype)?_e(Sg,zg,Cg):jg=!1;for(wg in _g)(Sg=(Cg=d[wg])&&Cg.prototype)&&_e(Sg,zg,Cg);if((!jg||!H(Ag)||Ag===Function.prototype)&&(Ag=function(){throw Og("Incorrect invocation")},jg))for(wg in Ng)d[wg]&&oa(d[wg],Ag);if((!jg||!Lg||Lg===Pg)&&(Lg=Ag.prototype,jg))for(wg in Ng)d[wg]&&oa(d[wg].prototype,Lg);if(jg&&Gi(Rg)!==Lg&&oa(Rg,Lg),f&&!xe(Lg,Dg))for(wg in Fg=!0,Eg(Lg,Dg,{get:function(){return _(this)?this[Bg]:void 0}}),Ng)d[wg]&&_e(d[wg],Bg,wg);var Ug=(bg={NATIVE_ARRAY_BUFFER_VIEWS:jg,TYPED_ARRAY_CONSTRUCTOR:zg,TYPED_ARRAY_TAG:Fg&&Bg,aTypedArray:function(e){if(Hg(e))return e;throw Og("Target is not a typed array")},aTypedArrayConstructor:function(e){if(H(e)&&(!oa||V(Ag,e)))return e;throw Og(ae(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(f){if(n)for(var i in Ng){var a=d[i];if(a&&xe(a.prototype,e))try{delete a.prototype[e]}catch(n){try{a.prototype[e]=t}catch(e){}}}Lg[e]&&!n||Je(Lg,e,n?t:jg&&Mg[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(f){if(oa){if(n)for(r in Ng)if((i=d[r])&&xe(i,e))try{delete i[e]}catch(e){}if(Ag[e]&&!n)return;try{return Je(Ag,e,n?t:jg&&Ag[e]||t)}catch(e){}}for(r in Ng)!(i=d[r])||i[e]&&!n||Je(i,e,t)}},isView:function(e){if(!_(e))return!1;var t=on(e);return"DataView"===t||xe(Ng,t)||xe(_g,t)},isTypedArray:Hg,TypedArray:Ag,TypedArrayPrototype:Lg}).NATIVE_ARRAY_BUFFER_VIEWS,Yg=d.ArrayBuffer,Xg=d.Int8Array;xg=!Ug||!g((function(){Xg(1)}))||!g((function(){new Xg(-1)}))||!Ri((function(e){new Xg,new Xg(null),new Xg(1.5),new Xg(e)}),!0)||g((function(){return 1!==new Xg(new Yg(2),1,void 0).length}));var Vg,Wg,Gg=d.RangeError;Wg=function(e){var t=Rt(e);if(t<0)throw Gg("The argument can't be less than 0");return t};var Kg=d.RangeError;Vg=function(e,t){var n=Wg(e);if(n%t)throw Kg("Wrong offset");return n};var qg,Jg=Et,Zg=bg.aTypedArrayConstructor;qg=function(e){var t,n,r,i,a,o,s=bs(this),l=ye(e),c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,d=Ei(l);if(d&&!bi(d))for(o=(a=ki(l,d)).next,l=[];!(i=m(o,a)).done;)l.push(i.value);for(h&&c>2&&(u=Fn(u,arguments[2])),n=Bt(l),r=new(Zg(s))(n),t=0;n>t;t++)r[t]=h?u(l[t],t):l[t];return r};var Qg=jn.forEach,$g=$e.get,ev=$e.set,tv=ze,nv=u,rv=Math.round,iv=d.RangeError,av=bo.ArrayBuffer,ov=av.prototype,sv=bo.DataView,lv=bg.NATIVE_ARRAY_BUFFER_VIEWS,cv=bg.TYPED_ARRAY_CONSTRUCTOR,uv=bg.TYPED_ARRAY_TAG,hv=bg.TypedArray,dv=bg.TypedArrayPrototype,pv=bg.aTypedArrayConstructor,fv=bg.isTypedArray,gv="BYTES_PER_ELEMENT",vv="Wrong length",mv=function(e,t){pv(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},yv=function(e,t){tv(e,t,{get:function(){return $g(this)[t]}})},xv=function(e){var t;return V(ov,e)||"ArrayBuffer"==(t=on(e))||"SharedArrayBuffer"==t},bv=function(e,t){return fv(e)&&!U(t)&&t in e&&Pc(+t)&&t>=0},wv=function(e,t){return t=F(t),bv(e,t)?S(2,e[t]):nv(e,t)},Cv=function(e,t,n){return t=F(t),!(bv(e,t)&&_(n)&&xe(n,"value"))||xe(n,"get")||xe(n,"set")||n.configurable||xe(n,"writable")&&!n.writable||xe(n,"enumerable")&&!n.enumerable?tv(e,t,n):(e[t]=n.value,e)};f?(lv||(u=wv,ze=Cv,yv(dv,"buffer"),yv(dv,"byteOffset"),yv(dv,"byteLength"),yv(dv,"length")),c({target:"Object",stat:!0,forced:!lv},{getOwnPropertyDescriptor:wv,defineProperty:Cv}),kg=function(e,t,n){var r=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=d[i],l=s,u=l&&l.prototype,h={},p=function(e,t){tv(e,t,{get:function(){return function(e,t){var n=$g(e);return n.view[a](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=$g(e);n&&(i=(i=rv(i))<0?0:i>255?255:255&i),a.view[o](t*r+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};lv?xg&&(l=t((function(e,t,n,i){return So(e,u),ol(_(t)?xv(t)?void 0!==i?new s(t,Vg(n,r),i):void 0!==n?new s(t,Vg(n,r)):new s(t):fv(t)?mv(l,t):m(qg,l,t):new s(Eo(t)),e,l)})),oa&&oa(l,hv),Qg(Jg(s),(function(e){e in l||_e(l,e,s[e])})),l.prototype=u):(l=t((function(e,t,n,i){So(e,u);var a,o,s,c=0,h=0;if(_(t)){if(!xv(t))return fv(t)?mv(l,t):m(qg,l,t);a=t,h=Vg(n,r);var d=t.byteLength;if(void 0===i){if(d%r)throw iv(vv);if((o=d-h)<0)throw iv(vv)}else if((o=zt(i)*r)+h>d)throw iv(vv);s=o/r}else s=Eo(t),a=new av(o=s*r);for(ev(e,{buffer:a,byteOffset:h,byteLength:o,length:s,view:new sv(a)});c<s;)p(e,c++)})),oa&&oa(l,hv),u=l.prototype=pn(dv)),u.constructor!==l&&_e(u,"constructor",l),_e(u,cv,l),uv&&_e(u,uv,i),h[i]=l,c({global:!0,forced:l!=s,sham:!lv},h),gv in l||_e(l,gv,r),gv in u||_e(u,gv,r),ho(i)}):kg=function(){},kg("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0),kg("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}})),kg("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Sv=T(ei),kv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("copyWithin",(function(e,t){return Sv(kv(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Ev=jn.every,Tv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("every",(function(e){return Ev(Tv(this),e,arguments.length>1?arguments[1]:void 0)}));var Mv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("fill",(function(e){var t=arguments.length;return m(ai,Mv(this),e,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}));var Iv,Rv,Av=jn.filter;Rv=function(e,t){for(var n=0,r=Bt(t),i=new e(r);r>n;)i[n]=t[n++];return i};var Lv,Pv=bg.TYPED_ARRAY_CONSTRUCTOR,Ov=bg.aTypedArrayConstructor;Lv=function(e){return Ov(xs(e,e[Pv]))},Iv=function(e,t){return Rv(Lv(e),t)};var Dv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("filter",(function(e){var t=Av(Dv(this),e,arguments.length>1?arguments[1]:void 0);return Iv(this,t)}));var Bv=jn.find,zv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("find",(function(e){return Bv(zv(this),e,arguments.length>1?arguments[1]:void 0)}));var jv=jn.findIndex,Fv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("findIndex",(function(e){return jv(Fv(this),e,arguments.length>1?arguments[1]:void 0)}));var Nv=jn.forEach,_v=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("forEach",(function(e){Nv(_v(this),e,arguments.length>1?arguments[1]:void 0)})),(0,bg.exportTypedArrayStaticMethod)("from",qg,xg);var Hv=Mt.includes,Uv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("includes",(function(e){return Hv(Uv(this),e,arguments.length>1?arguments[1]:void 0)}));var Yv=Mt.indexOf,Xv=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("indexOf",(function(e){return Yv(Xv(this),e,arguments.length>1?arguments[1]:void 0)}));var Vv=ue("iterator"),Wv=d.Uint8Array,Gv=T(Hi.values),Kv=T(Hi.keys),qv=T(Hi.entries),Jv=bg.aTypedArray,Zv=bg.exportTypedArrayMethod,Qv=Wv&&Wv.prototype,$v=!g((function(){Qv[Vv].call([1])})),em=!!Qv&&Qv.values&&Qv[Vv]===Qv.values&&"values"===Qv.values.name,tm=function(){return Gv(Jv(this))};Zv("entries",(function(){return qv(Jv(this))}),$v),Zv("keys",(function(){return Kv(Jv(this))}),$v),Zv("values",tm,$v||!em,{name:"values"}),Zv(Vv,tm,$v||!em,{name:"values"});var nm=bg.aTypedArray,rm=bg.exportTypedArrayMethod,im=T([].join);rm("join",(function(e){return im(nm(this),e)}));var am=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return Qt(Ea,am(this),t>1?[e,arguments[1]]:[e])}));var om=jn.map,sm=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("map",(function(e){return om(sm(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Lv(e))(t)}))}));var lm=bg.aTypedArrayConstructor;(0,bg.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,n=new(lm(this))(t);t>e;)n[e]=arguments[e++];return n}),xg);var cm=Da.left,um=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return cm(um(this),e,t,t>1?arguments[1]:void 0)}));var hm=Da.right,dm=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return hm(dm(this),e,t,t>1?arguments[1]:void 0)}));var pm=bg.aTypedArray,fm=bg.exportTypedArrayMethod,gm=Math.floor;fm("reverse",(function(){for(var e,t=this,n=pm(t).length,r=gm(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var vm=d.RangeError,mm=d.Int8Array,ym=mm&&mm.prototype,xm=ym&&ym.set,bm=bg.aTypedArray,wm=bg.exportTypedArrayMethod,Cm=!g((function(){var e=new Uint8ClampedArray(2);return m(xm,e,{length:1,0:3},1),3!==e[1]})),Sm=Cm&&bg.NATIVE_ARRAY_BUFFER_VIEWS&&g((function(){var e=new mm(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));wm("set",(function(e){bm(this);var t=Vg(arguments.length>1?arguments[1]:void 0,1),n=ye(e);if(Cm)return m(xm,this,n,t);var r=this.length,i=Bt(n),a=0;if(i+t>r)throw vm("Wrong length");for(;a<i;)this[t+a]=n[a++]}),!Cm||Sm);var km=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("slice",(function(e,t){for(var n=An(km(this),e,t),r=Lv(this),i=0,a=n.length,o=new r(a);a>i;)o[i]=n[i++];return o}),g((function(){new Int8Array(1).slice()})));var Em=jn.some,Tm=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("some",(function(e){return Em(Tm(this),e,arguments.length>1?arguments[1]:void 0)}));var Mm=d.Array,Im=bg.aTypedArray,Rm=bg.exportTypedArrayMethod,Am=d.Uint16Array,Lm=Am&&T(Am.prototype.sort),Pm=!(!Lm||g((function(){Lm(new Am(2),null)}))&&g((function(){Lm(new Am(2),{})}))),Om=!!Lm&&!g((function(){if(K)return K<74;if($a)return $a<67;if(to)return!0;if(no)return no<602;var e,t,n=new Am(516),r=Mm(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(Lm(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));Rm("sort",(function(e){return void 0!==e&&ie(e),Om?Lm(this,e):Ka(Im(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!Om||Pm);var Dm=bg.aTypedArray;(0,bg.exportTypedArrayMethod)("subarray",(function(e,t){var n=Dm(this),r=n.length,i=It(e,r);return new(Lv(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,zt((void 0===t?r:It(t,r))-i))}));var Bm=d.Int8Array,zm=bg.aTypedArray,jm=bg.exportTypedArrayMethod,Fm=[].toLocaleString,Nm=!!Bm&&g((function(){Fm.call(new Bm(1))}));jm("toLocaleString",(function(){return Qt(Fm,Nm?An(zm(this)):zm(this),An(arguments))}),g((function(){return[1,2].toLocaleString()!=new Bm([1,2]).toLocaleString()}))||!g((function(){Bm.prototype.toLocaleString.call([1,2])})));var _m=bg.exportTypedArrayMethod,Hm=d.Uint8Array,Um=Hm&&Hm.prototype||{},Ym=[].toString,Xm=T([].join);g((function(){Ym.call({})}))&&(Ym=function(){return Xm(this)});var Vm=Um.toString!=Ym;_m("toString",Ym,Vm);var Wm,Gm=Xs.getWeakData,Km=$e.set,qm=$e.getterFor,Jm=jn.find,Zm=jn.findIndex,Qm=T([].splice),$m=0,ey=function(e){return e.frozen||(e.frozen=new ty)},ty=function(){this.entries=[]},ny=function(e,t){return Jm(e.entries,(function(e){return e[0]===t}))};ty.prototype={get:function(e){var t=ny(this,e);if(t)return t[1]},has:function(e){return!!ny(this,e)},set:function(e,t){var n=ny(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Zm(this.entries,(function(t){return t[0]===e}));return~t&&Qm(this.entries,t,1),!!~t}},Wm={getConstructor:function(e,t,n,r){var i=e((function(e,i){So(e,a),Km(e,{type:t,id:$m++,frozen:void 0}),null!=i&&nl(i,e[r],{that:e,AS_ENTRIES:n})})),a=i.prototype,o=qm(t),s=function(e,t,n){var r=o(e),i=Gm(He(t),!0);return!0===i?ey(r).set(t,n):i[r.id]=n,e};return Co(a,{delete:function(e){var t=o(this);if(!_(e))return!1;var n=Gm(e);return!0===n?ey(t).delete(e):n&&xe(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!_(e))return!1;var n=Gm(e);return!0===n?ey(t).has(e):n&&xe(n,t.id)}}),Co(a,n?{get:function(e){var t=o(this);if(_(e)){var n=Gm(e);return!0===n?ey(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}};var ry,iy=$e.enforce,ay=!d.ActiveXObject&&"ActiveXObject"in d,oy=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},sy=Ys("WeakMap",oy,Wm);if(et&&ay){ry=Wm.getConstructor(oy,"WeakMap",!0),Xs.enable();var ly=sy.prototype,cy=T(ly.delete),uy=T(ly.has),hy=T(ly.get),dy=T(ly.set);Co(ly,{delete:function(e){if(_(e)&&!Gs(e)){var t=iy(this);return t.frozen||(t.frozen=new ry),cy(this,e)||t.frozen.delete(e)}return cy(this,e)},has:function(e){if(_(e)&&!Gs(e)){var t=iy(this);return t.frozen||(t.frozen=new ry),uy(this,e)||t.frozen.has(e)}return uy(this,e)},get:function(e){if(_(e)&&!Gs(e)){var t=iy(this);return t.frozen||(t.frozen=new ry),uy(this,e)?hy(this,e):t.frozen.get(e)}return hy(this,e)},set:function(e,t){if(_(e)&&!Gs(e)){var n=iy(this);n.frozen||(n.frozen=new ry),uy(this,e)?dy(this,e,t):n.frozen.set(e,t)}else dy(this,e,t);return this}})}Ys("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Wm);var py,fy=T("".replace),gy=String(Error("zxcasd").stack),vy=/\n\s*at [^:]*:[^\n]*/,my=vy.test(gy);py=function(e,t){if(my&&"string"==typeof e)for(;t--;)e=fy(e,vy,"");return e};var yy;yy=function(e,t){_(t)&&"cause"in t&&_e(e,"cause",t.cause)};var xy;xy=function(e,t){return void 0===e?arguments.length<2?"":t:rn(e)};var by;by=!g((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",S(1,7)),7!==e.stack)}));var wy=ue("toStringTag"),Cy=d.Error,Sy=[].push,ky=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,i=V(Ey,this);oa?n=oa(new Cy,i?Gi(this):Ey):(n=i?this:pn(Ey),_e(n,wy,"Error")),void 0!==t&&_e(n,"message",xy(t)),by&&_e(n,"stack",py(n.stack,1)),yy(n,r);var a=[];return nl(e,Sy,{that:a}),_e(n,"errors",a),n};oa?oa(ky,Cy):kt(ky,Cy,{name:!0});var Ey=ky.prototype=pn(Cy.prototype,{constructor:S(1,ky),message:S(1,""),name:S(1,"AggregateError")});c({global:!0},{AggregateError:ky}),f&&!("lastIndex"in[])&&(ze(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=ye(this),t=Bt(e);return 0==t?0:t-1}}),ni("lastIndex")),f&&!("lastItem"in[])&&(ze(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=ye(this),t=Bt(e);return 0==t?void 0:e[t-1]},set:function(e){var t=ye(this),n=Bt(t);return t[0==n?0:n-1]=e}}),ni("lastItem"));var Ty,My=d.Object,Iy=d.TypeError,Ry=Y("Map"),Ay=Y("WeakMap"),Ly=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=pn(null)};Ly.prototype.get=function(e,t){return this[e]||(this[e]=t())},Ly.prototype.next=function(e,t,n){var r=n?this.objectsByIndex[e]||(this.objectsByIndex[e]=new Ay):this.primitives||(this.primitives=new Ry),i=r.get(t);return i||r.set(t,i=new Ly),i};var Py=new Ly;Ty=function(){var e,t,n=Py,r=arguments.length;for(e=0;e<r;e++)_(t=arguments[e])&&(n=n.next(e,t,!0));if(this===My&&n===Py)throw Iy("Composite keys must contain a non-primitive component");for(e=0;e<r;e++)_(t=arguments[e])||(n=n.next(e,t,!1));return n};var Oy=d.Object,Dy=function(){var e=Y("Object","freeze");return e?e(pn(null)):pn(null)};c({global:!0},{compositeKey:function(){return Qt(Ty,Oy,arguments).get("object",Dy)}}),c({global:!0},{compositeSymbol:function(){return 1==arguments.length&&"string"==typeof arguments[0]?Y("Symbol").for(arguments[0]):Qt(Ty,null,arguments).get("symbol",Y("Symbol"))}}),c({global:!0},{globalThis:d});var By;By=function(){for(var e,t=He(this),n=ie(t.delete),r=!0,i=0,a=arguments.length;i<a;i++)e=m(n,t,arguments[i]),r=r&&e;return!!r},c({target:"Map",proto:!0,real:!0,forced:de},{deleteAll:By});var zy;zy=function(e){return m(Map.prototype.entries,e)},c({target:"Map",proto:!0,real:!0,forced:de},{every:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return!nl(n,(function(e,n,i){if(!r(n,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),c({target:"Map",proto:!0,real:!0,forced:de},{filter:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0),i=new(xs(t,Y("Map"))),a=ie(i.set);return nl(n,(function(e,n){r(n,e,t)&&m(a,i,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),c({target:"Map",proto:!0,real:!0,forced:de},{find:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return nl(n,(function(e,n,i){if(r(n,e,t))return i(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),c({target:"Map",proto:!0,real:!0,forced:de},{findKey:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return nl(n,(function(e,n,i){if(r(n,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var jy,Fy=[].push;jy=function(e){var t,n,r,i,a=arguments.length,o=a>1?arguments[1]:void 0;return bs(this),(t=void 0!==o)&&ie(o),null==e?new this:(n=[],t?(r=0,i=Fn(o,a>2?arguments[2]:void 0),nl(e,(function(e){m(Fy,n,i(e,r++))}))):nl(e,Fy,{that:n}),new this(n))},c({target:"Map",stat:!0},{from:jy});var Ny=T([].push);c({target:"Map",stat:!0},{groupBy:function(e,t){ie(t);var n=ki(e),r=new this,i=ie(r.has),a=ie(r.get),o=ie(r.set);return nl(n,(function(e){var n=t(e);m(i,r,n)?Ny(m(a,r,n),e):m(o,r,n,[e])}),{IS_ITERATOR:!0}),r}});var _y;_y=function(e,t){return e===t||e!=e&&t!=t},c({target:"Map",proto:!0,real:!0,forced:de},{includes:function(e){return nl(zy(He(this)),(function(t,n,r){if(_y(n,e))return r()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),c({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;ie(t);var r=ie(n.set);return nl(e,(function(e){m(r,n,t(e),e)})),n}}),c({target:"Map",proto:!0,real:!0,forced:de},{keyOf:function(e){return nl(zy(He(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),c({target:"Map",proto:!0,real:!0,forced:de},{mapKeys:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0),i=new(xs(t,Y("Map"))),a=ie(i.set);return nl(n,(function(e,n){m(a,i,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),c({target:"Map",proto:!0,real:!0,forced:de},{mapValues:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0),i=new(xs(t,Y("Map"))),a=ie(i.set);return nl(n,(function(e,n){m(a,i,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),c({target:"Map",proto:!0,real:!0,forced:de},{merge:function(e){for(var t=He(this),n=ie(t.set),r=arguments.length,i=0;i<r;)nl(arguments[i++],n,{that:t,AS_ENTRIES:!0});return t}});var Hy;Hy=function(){return new this(An(arguments))},c({target:"Map",stat:!0},{of:Hy});var Uy=d.TypeError;c({target:"Map",proto:!0,real:!0,forced:de},{reduce:function(e){var t=He(this),n=zy(t),r=arguments.length<2,i=r?void 0:arguments[1];if(ie(e),nl(n,(function(n,a){r?(r=!1,i=a):i=e(i,a,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw Uy("Reduce of empty map with no initial value");return i}}),c({target:"Map",proto:!0,real:!0,forced:de},{some:function(e){var t=He(this),n=zy(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return nl(n,(function(e,n,i){if(r(n,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Yy=d.TypeError;c({target:"Map",proto:!0,real:!0,forced:de},{update:function(e,t){var n=He(this),r=ie(n.get),i=ie(n.has),a=ie(n.set),o=arguments.length;ie(t);var s=m(i,n,e);if(!s&&o<3)throw Yy("Updating absent value");var l=s?m(r,n,e):ie(o>2?arguments[2]:void 0)(e,n);return m(a,n,e,t(l,e,n)),n}});var Xy=Math.min,Vy=Math.max;c({target:"Math",stat:!0},{clamp:function(e,t,n){return Xy(n,Vy(t,e))}}),c({target:"Math",stat:!0},{DEG_PER_RAD:Math.PI/180});var Wy=180/Math.PI;c({target:"Math",stat:!0},{degrees:function(e){return e*Wy}});var Gy={};Gy=Math.scale||function(e,t,n,r,i){var a=+e,o=+t,s=+n,l=+r,c=+i;return a!=a||o!=o||s!=s||l!=l||c!=c?NaN:a===1/0||a===-1/0?a:(a-o)*(c-l)/(s-o)+l},c({target:"Math",stat:!0},{fscale:function(e,t,n,r,i){return zl(Gy(e,t,n,r,i))}}),c({target:"Math",stat:!0},{iaddh:function(e,t,n,r){var i=e>>>0,a=n>>>0;return(t>>>0)+(r>>>0)+((i&a|(i|a)&~(i+a>>>0))>>>31)|0}}),c({target:"Math",stat:!0},{imulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,o=i&n,s=r>>16,l=i>>16,c=(s*o>>>0)+(a*o>>>16);return s*l+(c>>16)+((a*l>>>0)+(c&n)>>16)}}),c({target:"Math",stat:!0},{isubh:function(e,t,n,r){var i=e>>>0,a=n>>>0;return(t>>>0)-(r>>>0)-((~i&a|~(i^a)&i-a>>>0)>>>31)|0}}),c({target:"Math",stat:!0},{RAD_PER_DEG:180/Math.PI});var Ky=Math.PI/180;c({target:"Math",stat:!0},{radians:function(e){return e*Ky}}),c({target:"Math",stat:!0},{scale:Gy});var qy="Seeded Random",Jy="Seeded Random Generator",Zy=$e.set,Qy=$e.getterFor(Jy),$y=d.TypeError,ex=Yi((function(e){Zy(this,{type:Jy,seed:e%2147483647})}),qy,(function(){var e=Qy(this);return{value:(1073741823&(e.seed=(1103515245*e.seed+12345)%2147483647))/1073741823,done:!1}}));c({target:"Math",stat:!0,forced:!0},{seededPRNG:function(e){var t=He(e).seed;if(!Ac(t))throw $y('Math.seededPRNG() argument should have a "seed" field with a finite value.');return new ex(t)}}),c({target:"Math",stat:!0},{signbit:function(e){return(e=+e)==e&&0==e?1/e==-1/0:e<0}}),c({target:"Math",stat:!0},{umulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,o=i&n,s=r>>>16,l=i>>>16,c=(s*o>>>0)+(a*o>>>16);return s*l+(c>>>16)+((a*l>>>0)+(c&n)>>>16)}});var tx="Invalid number representation",nx=d.RangeError,rx=d.SyntaxError,ix=d.TypeError,ax=/^[\da-z]+$/,ox=T("".charAt),sx=T(ax.exec),lx=T(1..toString),cx=T("".slice);c({target:"Number",stat:!0},{fromString:function(e,t){var n,r,i=1;if("string"!=typeof e)throw ix(tx);if(!e.length)throw rx(tx);if("-"==ox(e,0)&&(i=-1,!(e=cx(e,1)).length))throw rx(tx);if((n=void 0===t?10:Rt(t))<2||n>36)throw nx("Invalid radix");if(!sx(ax,e)||lx(r=Hc(e,n),n)!==e)throw rx(tx);return i*r}});var ux=ze,hx=ue("observable"),dx="Observable",px="Subscription",fx="SubscriptionObserver",gx=$e.getterFor,vx=$e.set,mx=gx(dx),yx=gx(px),xx=gx(fx),bx=d.Array,wx=function(e){this.observer=He(e),this.cleanup=void 0,this.subscriptionObserver=void 0};wx.prototype={type:px,clean:function(){var e=this.cleanup;if(e){this.cleanup=void 0;try{e()}catch(e){Ph(e)}}},close:function(){if(!f){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=void 0},isClosed:function(){return void 0===this.observer}};var Cx=function(e,t){var n,r=vx(this,new wx(e));f||(this.closed=!1);try{(n=re(e,"start"))&&m(n,e,this)}catch(e){Ph(e)}if(!r.isClosed()){var i=r.subscriptionObserver=new Sx(r);try{var a=t(i),o=a;null!=a&&(r.cleanup=H(a.unsubscribe)?function(){o.unsubscribe()}:ie(a))}catch(e){return void i.error(e)}r.isClosed()&&r.clean()}};Cx.prototype=Co({},{unsubscribe:function(){var e=yx(this);e.isClosed()||(e.close(),e.clean())}}),f&&ux(Cx.prototype,"closed",{configurable:!0,get:function(){return yx(this).isClosed()}});var Sx=function(e){vx(this,{type:fx,subscriptionState:e}),f||(this.closed=!1)};Sx.prototype=Co({},{next:function(e){var t=xx(this).subscriptionState;if(!t.isClosed()){var n=t.observer;try{var r=re(n,"next");r&&m(r,n,e)}catch(e){Ph(e)}}},error:function(e){var t=xx(this).subscriptionState;if(!t.isClosed()){var n=t.observer;t.close();try{var r=re(n,"error");r?m(r,n,e):Ph(e)}catch(e){Ph(e)}t.clean()}},complete:function(){var e=xx(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var n=re(t,"complete");n&&m(n,t)}catch(e){Ph(e)}e.clean()}}}),f&&ux(Sx.prototype,"closed",{configurable:!0,get:function(){return xx(this).subscriptionState.isClosed()}});var kx=function(e){So(this,Ex),vx(this,{type:dx,subscriber:ie(e)})},Ex=kx.prototype;Co(Ex,{subscribe:function(e){var t=arguments.length;return new Cx(H(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:_(e)?e:{},mx(this).subscriber)}}),Co(kx,{from:function(e){var t=Un(this)?this:kx,n=re(He(e),hx);if(n){var r=He(m(n,e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}var i=ki(e);return new t((function(e){nl(i,(function(t,n){if(e.next(t),e.closed)return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))},of:function(){for(var e=Un(this)?this:kx,t=arguments.length,n=bx(t),r=0;r<t;)n[r]=arguments[r++];return new e((function(e){for(var r=0;r<t;r++)if(e.next(n[r]),e.closed)return;e.complete()}))}}),Je(Ex,hx,(function(){return this})),c({global:!0},{Observable:kx}),ho(dx),c({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=Ah(t),r=n.resolve,i=n.reject,a=Oh((function(){var n=ie(t.resolve),i=[],a=0,o=1;nl(e,(function(e){var s=a++,l=!1;o++,m(n,t,e).then((function(e){l||(l=!0,i[s]={status:"fulfilled",value:e},--o||r(i))}),(function(e){l||(l=!0,i[s]={status:"rejected",reason:e},--o||r(i))}))})),--o||r(i)}));return a.error&&i(a.value),n.promise}});var Tx="No one promise resolved";c({target:"Promise",stat:!0},{any:function(e){var t=this,n=Y("AggregateError"),r=Ah(t),i=r.resolve,a=r.reject,o=Oh((function(){var r=ie(t.resolve),o=[],s=0,l=1,c=!1;nl(e,(function(e){var u=s++,h=!1;l++,m(r,t,e).then((function(e){h||c||(c=!0,i(e))}),(function(e){h||c||(h=!0,o[u]=e,--l||a(new n(o,Tx)))}))})),--l||a(new n(o,Tx))}));return o.error&&a(o.value),r.promise}}),c({target:"Promise",stat:!0},{try:function(e){var t=Ah(this),n=Oh(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var Mx;a("4gaLD");h=a("gdFSe");var Ix=Y("Map"),Rx=Y("WeakMap"),Ax=T([].push),Lx=he("metadata"),Px=Lx.store||(Lx.store=new Rx),Ox=function(e,t,n){var r=Px.get(e);if(!r){if(!n)return;Px.set(e,r=new Ix)}var i=r.get(t);if(!i){if(!n)return;r.set(t,i=new Ix)}return i},Dx=(Mx={store:Px,getMap:Ox,has:function(e,t,n){var r=Ox(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=Ox(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){Ox(n,r,!0).set(e,t)},keys:function(e,t){var n=Ox(e,t,!1),r=[];return n&&n.forEach((function(e,t){Ax(r,t)})),r},toKey:function(e){return void 0===e||"symbol"==(void 0===e?"undefined":h.default(e))?e:String(e)}}).toKey,Bx=Mx.set;c({target:"Reflect",stat:!0},{defineMetadata:function(e,t,n){var r=arguments.length<4?void 0:Dx(arguments[3]);Bx(e,t,He(n),r)}});var zx=Mx.toKey,jx=Mx.getMap,Fx=Mx.store;c({target:"Reflect",stat:!0},{deleteMetadata:function(e,t){var n=arguments.length<3?void 0:zx(arguments[2]),r=jx(He(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var i=Fx.get(t);return i.delete(n),!!i.size||Fx.delete(t)}});var Nx=Mx.has,_x=Mx.get,Hx=Mx.toKey,Ux=function(e,t,n){if(Nx(e,t,n))return _x(e,t,n);var r=Gi(t);return null!==r?Ux(e,r,n):void 0};c({target:"Reflect",stat:!0},{getMetadata:function(e,t){var n=arguments.length<3?void 0:Hx(arguments[2]);return Ux(e,He(t),n)}});var Yx,Xx=Y("Map"),Vx=Xx.prototype,Wx=T(Vx.forEach),Gx=T(Vx.has),Kx=T(Vx.set),qx=T([].push);Yx=function(e){var t,n,r,i=ye(this),a=Bt(i),o=_n(i,0),s=new Xx,l=null!=e?ie(e):function(e){return e};for(t=0;t<a;t++)r=l(n=i[t]),Gx(s,r)||Kx(s,r,n);return Wx(s,(function(e){qx(o,e)})),o};var Jx=T(Yx),Zx=T([].concat),Qx=Mx.keys,$x=Mx.toKey,eb=function(e,t){var n=Qx(e,t),r=Gi(e);if(null===r)return n;var i=eb(r,t);return i.length?n.length?Jx(Zx(n,i)):i:n};c({target:"Reflect",stat:!0},{getMetadataKeys:function(e){var t=arguments.length<2?void 0:$x(arguments[1]);return eb(He(e),t)}});var tb=Mx.get,nb=Mx.toKey;c({target:"Reflect",stat:!0},{getOwnMetadata:function(e,t){var n=arguments.length<3?void 0:nb(arguments[2]);return tb(e,He(t),n)}});var rb=Mx.keys,ib=Mx.toKey;c({target:"Reflect",stat:!0},{getOwnMetadataKeys:function(e){var t=arguments.length<2?void 0:ib(arguments[1]);return rb(He(e),t)}});var ab=Mx.has,ob=Mx.toKey,sb=function(e,t,n){if(ab(e,t,n))return!0;var r=Gi(t);return null!==r&&sb(e,r,n)};c({target:"Reflect",stat:!0},{hasMetadata:function(e,t){var n=arguments.length<3?void 0:ob(arguments[2]);return sb(e,He(t),n)}});var lb=Mx.has,cb=Mx.toKey;c({target:"Reflect",stat:!0},{hasOwnMetadata:function(e,t){var n=arguments.length<3?void 0:cb(arguments[2]);return lb(e,He(t),n)}});var ub=Mx.toKey,hb=Mx.set;c({target:"Reflect",stat:!0},{metadata:function(e,t){return function(n,r){hb(e,t,He(n),ub(r))}}});var db;db=function(){for(var e=He(this),t=ie(e.add),n=0,r=arguments.length;n<r;n++)m(t,e,arguments[n]);return e},c({target:"Set",proto:!0,real:!0,forced:de},{addAll:db}),c({target:"Set",proto:!0,real:!0,forced:de},{deleteAll:By}),c({target:"Set",proto:!0,real:!0,forced:de},{difference:function(e){var t=He(this),n=new(xs(t,Y("Set")))(t),r=ie(n.delete);return nl(e,(function(e){m(r,n,e)})),n}});var pb;pb=function(e){return m(Set.prototype.values,e)},c({target:"Set",proto:!0,real:!0,forced:de},{every:function(e){var t=He(this),n=pb(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return!nl(n,(function(e,n){if(!r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),c({target:"Set",proto:!0,real:!0,forced:de},{filter:function(e){var t=He(this),n=pb(t),r=Fn(e,arguments.length>1?arguments[1]:void 0),i=new(xs(t,Y("Set"))),a=ie(i.add);return nl(n,(function(e){r(e,e,t)&&m(a,i,e)}),{IS_ITERATOR:!0}),i}}),c({target:"Set",proto:!0,real:!0,forced:de},{find:function(e){var t=He(this),n=pb(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return nl(n,(function(e,n){if(r(e,e,t))return n(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),c({target:"Set",stat:!0},{from:jy}),c({target:"Set",proto:!0,real:!0,forced:de},{intersection:function(e){var t=He(this),n=new(xs(t,Y("Set"))),r=ie(t.has),i=ie(n.add);return nl(e,(function(e){m(r,t,e)&&m(i,n,e)})),n}}),c({target:"Set",proto:!0,real:!0,forced:de},{isDisjointFrom:function(e){var t=He(this),n=ie(t.has);return!nl(e,(function(e,r){if(!0===m(n,t,e))return r()}),{INTERRUPTED:!0}).stopped}}),c({target:"Set",proto:!0,real:!0,forced:de},{isSubsetOf:function(e){var t=ki(this),n=He(e),r=n.has;return H(r)||(n=new(Y("Set"))(e),r=ie(n.has)),!nl(t,(function(e,t){if(!1===m(r,n,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),c({target:"Set",proto:!0,real:!0,forced:de},{isSupersetOf:function(e){var t=He(this),n=ie(t.has);return!nl(e,(function(e,r){if(!1===m(n,t,e))return r()}),{INTERRUPTED:!0}).stopped}});var fb=T([].join),gb=[].push;c({target:"Set",proto:!0,real:!0,forced:de},{join:function(e){var t=He(this),n=pb(t),r=void 0===e?",":rn(e),i=[];return nl(n,gb,{that:i,IS_ITERATOR:!0}),fb(i,r)}}),c({target:"Set",proto:!0,real:!0,forced:de},{map:function(e){var t=He(this),n=pb(t),r=Fn(e,arguments.length>1?arguments[1]:void 0),i=new(xs(t,Y("Set"))),a=ie(i.add);return nl(n,(function(e){m(a,i,r(e,e,t))}),{IS_ITERATOR:!0}),i}}),c({target:"Set",stat:!0},{of:Hy});var vb=d.TypeError;c({target:"Set",proto:!0,real:!0,forced:de},{reduce:function(e){var t=He(this),n=pb(t),r=arguments.length<2,i=r?void 0:arguments[1];if(ie(e),nl(n,(function(n){r?(r=!1,i=n):i=e(i,n,n,t)}),{IS_ITERATOR:!0}),r)throw vb("Reduce of empty set with no initial value");return i}}),c({target:"Set",proto:!0,real:!0,forced:de},{some:function(e){var t=He(this),n=pb(t),r=Fn(e,arguments.length>1?arguments[1]:void 0);return nl(n,(function(e,n){if(r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),c({target:"Set",proto:!0,real:!0,forced:de},{symmetricDifference:function(e){var t=He(this),n=new(xs(t,Y("Set")))(t),r=ie(n.delete),i=ie(n.add);return nl(e,(function(e){m(r,n,e)||m(i,n,e)})),n}}),c({target:"Set",proto:!0,real:!0,forced:de},{union:function(e){var t=He(this),n=new(xs(t,Y("Set")))(t);return nl(e,ie(n.add),{that:n}),n}});var mb=Fp.charAt,yb=g((function(){return"𠮷"!=="𠮷".at(-2)}));c({target:"String",proto:!0,forced:yb},{at:function(e){var t=rn(z(this)),n=t.length,r=Rt(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:mb(t,i)}});var xb=Fp.codeAt,bb=Fp.charAt,wb="String Iterator",Cb=$e.set,Sb=$e.getterFor(wb),kb=Yi((function(e){Cb(this,{type:wb,string:e,index:0})}),"String",(function(){var e,t=Sb(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=bb(n,r),t.index+=e.length,{value:{codePoint:xb(e,0),position:r},done:!1})}));c({target:"String",proto:!0},{codePoints:function(){return new kb(rn(z(this)))}});var Eb=ue("matchAll"),Tb="RegExp String",Mb="RegExp String Iterator",Ib=$e.set,Rb=$e.getterFor(Mb),Ab=RegExp.prototype,Lb=d.TypeError,Pb=T(Nd),Ob=T("".indexOf),Db=T("".matchAll),Bb=!!Db&&!g((function(){Db("a",/./)})),zb=Yi((function(e,t,n,r){Ib(this,{type:Mb,regexp:e,string:t,global:n,unicode:r,done:!1})}),Tb,(function(){var e=Rb(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,r=mf(t,n);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===rn(r[0])&&(t.lastIndex=gf(n,zt(t.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})})),jb=function(e){var t,n,r,i,a,o,s=He(this),l=rn(e);return t=xs(s,RegExp),void 0===(n=s.flags)&&V(Ab,s)&&!("flags"in Ab)&&(n=Pb(s)),r=void 0===n?"":rn(n),i=new t(t===RegExp?s.source:s,r),a=!!~Ob(r,"g"),o=!!~Ob(r,"u"),i.lastIndex=zt(s.lastIndex),new zb(i,l,a,o)};c({target:"String",proto:!0,forced:Bb},{matchAll:function(e){var t,n,r,i=z(this);if(null!=e){if(Bd(e)&&(t=rn(z("flags"in Ab?e.flags:Pb(e))),!~Ob(t,"g")))throw Lb("`.matchAll` does not allow non-global regexes");if(Bb)return Db(i,e);if(r=re(e,Eb))return m(r,e,i)}else if(Bb)return Db(i,e);return n=rn(i),new RegExp(e,"g")[Eb](n)}}),Eb in Ab||Je(Ab,Eb,jb);var Fb=ue("replace"),Nb=RegExp.prototype,_b=d.TypeError,Hb=T(Nd),Ub=T("".indexOf),Yb=(T("".replace),T("".slice)),Xb=Math.max,Vb=function(e,t,n){return n>e.length?-1:""===t?n:Ub(e,t,n)};c({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,i,a,o,s,l,c,u=z(this),h=0,d=0,p="";if(null!=e){if(Bd(e)&&(n=rn(z("flags"in Nb?e.flags:Hb(e))),!~Ub(n,"g")))throw _b("`.replaceAll` does not allow non-global regexes");if(r=re(e,Fb))return m(r,e,u,t)}for(i=rn(u),a=rn(e),(o=H(t))||(t=rn(t)),s=a.length,l=Xb(1,s),h=Vb(i,a,0);-1!==h;)c=o?rn(t(a,h,i)):Rf(a,i,h,[],void 0,t),p+=Yb(i,d,h)+c,d=h+s,h=Vb(i,a,h+l);return d<i.length&&(p+=Yb(i,d)),p}}),Ln("dispose"),Ln("observable"),Ln("patternMatch"),c({target:"WeakMap",proto:!0,real:!0,forced:de},{deleteAll:By}),c({target:"WeakMap",stat:!0},{from:jy}),c({target:"WeakMap",stat:!0},{of:Hy}),c({target:"WeakSet",proto:!0,real:!0,forced:de},{addAll:db}),c({target:"WeakSet",proto:!0,real:!0,forced:de},{deleteAll:By}),c({target:"WeakSet",stat:!0},{from:jy}),c({target:"WeakSet",stat:!0},{of:Hy});var Wb;Wb={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};var Gb,Kb=Oe("span").classList,qb=Kb&&Kb.constructor&&Kb.constructor.prototype;Gb=qb===Object.prototype?void 0:qb;var Jb,Zb=jn.forEach,Qb=zi("forEach");Jb=Qb?[].forEach:function(e){return Zb(this,e,arguments.length>1?arguments[1]:void 0)};var $b=function(e){if(e&&e.forEach!==Jb)try{_e(e,"forEach",Jb)}catch(t){e.forEach=Jb}};for(var ew in Wb)Wb[ew]&&$b(d[ew]&&d[ew].prototype);$b(Gb);var tw=ue("iterator"),nw=ue("toStringTag"),rw=Hi.values,iw=function(e,t){if(e){if(e[tw]!==rw)try{_e(e,tw,rw)}catch(t){e[tw]=rw}if(e[nw]||_e(e,nw,t),Wb[t])for(var n in Hi)if(e[n]!==Hi[n])try{_e(e,n,Hi[n])}catch(t){e[n]=Hi[n]}}};for(var aw in Wb)iw(d[aw]&&d[aw].prototype,aw);iw(Gb,"DOMTokenList");var ow=!d.setImmediate||!d.clearImmediate;c({global:!0,bind:!0,enumerable:!0,forced:ow},{setImmediate:Yu.set,clearImmediate:Yu.clear});var sw=d.process;c({global:!0,enumerable:!0,noTargetGet:!0},{queueMicrotask:function(e){var t=Ba&&sw.domain;hh(t?t.bind(e):e)}});var lw,cw=ue("iterator");lw=!g((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[cw]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}));var uw,hw=dn,dw=Fp.codeAt,pw=2147483647,fw=/[^\0-\u007E]/,gw=/[.\u3002\uFF0E\uFF61]/g,vw="Overflow: input needs wider integers to process",mw=d.RangeError,yw=T(gw.exec),xw=Math.floor,bw=String.fromCharCode,ww=T("".charCodeAt),Cw=T([].join),Sw=T([].push),kw=T("".replace),Ew=T("".split),Tw=T("".toLowerCase),Mw=function(e){return e+22+75*(e<26)},Iw=function(e,t,n){var r=0;for(e=n?xw(e/700):e>>1,e+=xw(e/t);e>455;)e=xw(e/35),r+=36;return xw(r+36*e/(e+38))},Rw=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=ww(e,n++);if(i>=55296&&i<=56319&&n<r){var a=ww(e,n++);56320==(64512&a)?Sw(t,((1023&i)<<10)+(1023&a)+65536):(Sw(t,i),n--)}else Sw(t,i)}return t}(e);var n,r,i=e.length,a=128,o=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&Sw(t,bw(r));var l=t.length,c=l;for(l&&Sw(t,"-");c<i;){var u=pw;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<u&&(u=r);var h=c+1;if(u-a>xw((pw-o)/h))throw mw(vw);for(o+=(u-a)*h,a=u,n=0;n<e.length;n++){if((r=e[n])<a&&++o>pw)throw mw(vw);if(r==a){for(var d=o,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(d<f)break;var g=d-f,v=36-f;Sw(t,bw(Mw(f+g%v))),d=xw(g/v),p+=36}Sw(t,bw(Mw(d))),s=Iw(o,h,c==l),o=0,c++}}o++,a++}return Cw(t,"")};uw=function(e){var t,n,r=[],i=Ew(kw(Tw(e),gw,"."),".");for(t=0;t<i.length;t++)n=i[t],Sw(r,yw(fw,n)?"xn--"+Rw(n):n);return Cw(r,".")};var Aw,Lw,Pw=d.TypeError;Lw=function(e,t){if(e<t)throw Pw("Not enough arguments");return e};var Ow=ue("iterator"),Dw="URLSearchParams",Bw="URLSearchParamsIterator",zw=$e.set,jw=$e.getterFor(Dw),Fw=$e.getterFor(Bw),Nw=Y("fetch"),_w=Y("Request"),Hw=Y("Headers"),Uw=_w&&_w.prototype,Yw=Hw&&Hw.prototype,Xw=d.RegExp,Vw=d.TypeError,Ww=d.decodeURIComponent,Gw=d.encodeURIComponent,Kw=T("".charAt),qw=T([].join),Jw=T([].push),Zw=T("".replace),Qw=T([].shift),$w=T([].splice),eC=T("".split),tC=T("".slice),nC=/\+/g,rC=Array(4),iC=function(e){return rC[e-1]||(rC[e-1]=Xw("((?:%[\\da-f]{2}){"+e+"})","gi"))},aC=function(e){try{return Ww(e)}catch(t){return e}},oC=function(e){var t=Zw(e,nC," "),n=4;try{return Ww(t)}catch(e){for(;n;)t=Zw(t,iC(n--),aC);return t}},sC=/[!'()~]|%20/g,lC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},cC=function(e){return lC[e]},uC=function(e){return Zw(Gw(e),sC,cC)},hC=Yi((function(e,t){zw(this,{type:Bw,iterator:ki(jw(e).entries),kind:t})}),"Iterator",(function(){var e=Fw(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),dC=function(e){this.entries=[],this.url=null,void 0!==e&&(_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Kw(e,0)?tC(e,1):e:rn(e)))};dC.prototype={type:Dw,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,l=Ei(e);if(l)for(n=(t=ki(e,l)).next;!(r=m(n,t)).done;){if(a=(i=ki(He(r.value))).next,(o=m(a,i)).done||(s=m(a,i)).done||!m(a,i).done)throw Vw("Expected sequence with length 2");Jw(this.entries,{key:rn(o.value),value:rn(s.value)})}else for(var c in e)xe(e,c)&&Jw(this.entries,{key:c,value:rn(e[c])})},parseQuery:function(e){if(e)for(var t,n,r=eC(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=eC(t,"="),Jw(this.entries,{key:oC(Qw(n)),value:oC(qw(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Jw(n,uC(e.key)+"="+uC(e.value));return qw(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var pC=function(){So(this,fC);var e=arguments.length>0?arguments[0]:void 0;zw(this,new dC(e))},fC=pC.prototype;if(Co(fC,{append:function(e,t){Lw(arguments.length,2);var n=jw(this);Jw(n.entries,{key:rn(e),value:rn(t)}),n.updateURL()},delete:function(e){Lw(arguments.length,1);for(var t=jw(this),n=t.entries,r=rn(e),i=0;i<n.length;)n[i].key===r?$w(n,i,1):i++;t.updateURL()},get:function(e){Lw(arguments.length,1);for(var t=jw(this).entries,n=rn(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Lw(arguments.length,1);for(var t=jw(this).entries,n=rn(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Jw(r,t[i].value);return r},has:function(e){Lw(arguments.length,1);for(var t=jw(this).entries,n=rn(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Lw(arguments.length,1);for(var n,r=jw(this),i=r.entries,a=!1,o=rn(e),s=rn(t),l=0;l<i.length;l++)(n=i[l]).key===o&&(a?$w(i,l--,1):(a=!0,n.value=s));a||Jw(i,{key:o,value:s}),r.updateURL()},sort:function(){var e=jw(this);Ka(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=jw(this).entries,r=Fn(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new hC(this,"keys")},values:function(){return new hC(this,"values")},entries:function(){return new hC(this,"entries")}},{enumerable:!0}),Je(fC,Ow,fC.entries,{name:"entries"}),Je(fC,"toString",(function(){return jw(this).serialize()}),{enumerable:!0}),Dn(pC,Dw),c({global:!0,forced:!lw},{URLSearchParams:pC}),!lw&&H(Hw)){var gC=T(Yw.has),vC=T(Yw.set),mC=function(e){if(_(e)){var t,n=e.body;if(on(n)===Dw)return t=e.headers?new Hw(e.headers):new Hw,gC(t,"content-type")||vC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),pn(e,{body:S(0,rn(n)),headers:S(0,t)})}return e};if(H(Nw)&&c({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Nw(e,arguments.length>1?mC(arguments[1]):{})}}),H(_w)){var yC=function(e){return So(this,Uw),new _w(e,arguments.length>1?mC(arguments[1]):{})};Uw.constructor=yC,yC.prototype=Uw,c({global:!0,forced:!0},{Request:yC})}}Aw={URLSearchParams:pC,getState:jw};var xC,bC=$e.set,wC=$e.getterFor("URL"),CC=Aw.URLSearchParams,SC=Aw.getState,kC=d.URL,EC=d.TypeError,TC=d.parseInt,MC=Math.floor,IC=Math.pow,RC=T("".charAt),AC=T(/./.exec),LC=T([].join),PC=T(1..toString),OC=T([].pop),DC=T([].push),BC=T("".replace),zC=T([].shift),jC=T("".split),FC=T("".slice),NC=T("".toLowerCase),_C=T([].unshift),HC="Invalid scheme",UC="Invalid host",YC="Invalid port",XC=/[a-z]/i,VC=/[\d+-.a-z]/i,WC=/\d/,GC=/^0x/i,KC=/^[0-7]+$/,qC=/^\d+$/,JC=/^[\da-f]+$/i,ZC=/[\0\t\n\r #%/:<>?@[\\\]^|]/,QC=/[\0\t\n\r #/:<>?@[\\\]^|]/,$C=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,eS=/[\t\n\r]/g,tS=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)_C(t,e%256),e=MC(e/256);return LC(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=PC(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},nS={},rS=lu({},nS,{" ":1,'"':1,"<":1,">":1,"`":1}),iS=lu({},rS,{"#":1,"?":1,"{":1,"}":1}),aS=lu({},iS,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),oS=function(e,t){var n=dw(e,0);return n>32&&n<127&&!xe(t,e)?e:encodeURIComponent(e)},sS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},lS=function(e,t){var n;return 2==e.length&&AC(XC,RC(e,0))&&(":"==(n=RC(e,1))||!t&&"|"==n)},cS=function(e){var t;return e.length>1&&lS(FC(e,0,2))&&(2==e.length||"/"===(t=RC(e,2))||"\\"===t||"?"===t||"#"===t)},uS=function(e){return"."===e||"%2e"===NC(e)},hS={},dS={},pS={},fS={},gS={},vS={},mS={},yS={},xS={},bS={},wS={},CS={},SS={},kS={},ES={},TS={},MS={},IS={},RS={},AS={},LS={},PS=function(e,t,n){var r,i,a,o=rn(e);if(t){if(i=this.parse(o))throw EC(i);this.searchParams=null}else{if(void 0!==n&&(r=new PS(n,!0)),i=this.parse(o,null,r))throw EC(i);(a=SC(new CC)).bindURL(this),this.searchParams=a}};PS.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,l=this,c=t||hS,u=0,h="",d=!1,p=!1,f=!1;for(e=rn(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=BC(e,$C,"")),e=BC(e,eS,""),r=mi(e);u<=r.length;){switch(i=r[u],c){case hS:if(!i||!AC(XC,i)){if(t)return HC;c=pS;continue}h+=NC(i),c=dS;break;case dS:if(i&&(AC(VC,i)||"+"==i||"-"==i||"."==i))h+=NC(i);else{if(":"!=i){if(t)return HC;h="",c=pS,u=0;continue}if(t&&(l.isSpecial()!=xe(sS,h)||"file"==h&&(l.includesCredentials()||null!==l.port)||"file"==l.scheme&&!l.host))return;if(l.scheme=h,t)return void(l.isSpecial()&&sS[l.scheme]==l.port&&(l.port=null));h="","file"==l.scheme?c=kS:l.isSpecial()&&n&&n.scheme==l.scheme?c=fS:l.isSpecial()?c=yS:"/"==r[u+1]?(c=gS,u++):(l.cannotBeABaseURL=!0,DC(l.path,""),c=RS)}break;case pS:if(!n||n.cannotBeABaseURL&&"#"!=i)return HC;if(n.cannotBeABaseURL&&"#"==i){l.scheme=n.scheme,l.path=Sn(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,c=LS;break}c="file"==n.scheme?kS:vS;continue;case fS:if("/"!=i||"/"!=r[u+1]){c=vS;continue}c=xS,u++;break;case gS:if("/"==i){c=bS;break}c=IS;continue;case vS:if(l.scheme=n.scheme,i==xC)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Sn(n.path),l.query=n.query;else if("/"==i||"\\"==i&&l.isSpecial())c=mS;else if("?"==i)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Sn(n.path),l.query="",c=AS;else{if("#"!=i){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Sn(n.path),l.path.length--,c=IS;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=Sn(n.path),l.query=n.query,l.fragment="",c=LS}break;case mS:if(!l.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,c=IS;continue}c=bS}else c=xS;break;case yS:if(c=xS,"/"!=i||"/"!=RC(h,u+1))continue;u++;break;case xS:if("/"!=i&&"\\"!=i){c=bS;continue}break;case bS:if("@"==i){d&&(h="%40"+h),d=!0,a=mi(h);for(var g=0;g<a.length;g++){var v=a[g];if(":"!=v||f){var m=oS(v,aS);f?l.password+=m:l.username+=m}else f=!0}h=""}else if(i==xC||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()){if(d&&""==h)return"Invalid authority";u-=mi(h).length+1,h="",c=wS}else h+=i;break;case wS:case CS:if(t&&"file"==l.scheme){c=TS;continue}if(":"!=i||p){if(i==xC||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()){if(l.isSpecial()&&""==h)return UC;if(t&&""==h&&(l.includesCredentials()||null!==l.port))return;if(o=l.parseHost(h))return o;if(h="",c=MS,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),h+=i}else{if(""==h)return UC;if(o=l.parseHost(h))return o;if(h="",c=SS,t==CS)return}break;case SS:if(!AC(WC,i)){if(i==xC||"/"==i||"?"==i||"#"==i||"\\"==i&&l.isSpecial()||t){if(""!=h){var y=TC(h,10);if(y>65535)return YC;l.port=l.isSpecial()&&y===sS[l.scheme]?null:y,h=""}if(t)return;c=MS;continue}return YC}h+=i;break;case kS:if(l.scheme="file","/"==i||"\\"==i)c=ES;else{if(!n||"file"!=n.scheme){c=IS;continue}if(i==xC)l.host=n.host,l.path=Sn(n.path),l.query=n.query;else if("?"==i)l.host=n.host,l.path=Sn(n.path),l.query="",c=AS;else{if("#"!=i){cS(LC(Sn(r,u),""))||(l.host=n.host,l.path=Sn(n.path),l.shortenPath()),c=IS;continue}l.host=n.host,l.path=Sn(n.path),l.query=n.query,l.fragment="",c=LS}}break;case ES:if("/"==i||"\\"==i){c=TS;break}n&&"file"==n.scheme&&!cS(LC(Sn(r,u),""))&&(lS(n.path[0],!0)?DC(l.path,n.path[0]):l.host=n.host),c=IS;continue;case TS:if(i==xC||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&lS(h))c=IS;else if(""==h){if(l.host="",t)return;c=MS}else{if(o=l.parseHost(h))return o;if("localhost"==l.host&&(l.host=""),t)return;h="",c=MS}continue}h+=i;break;case MS:if(l.isSpecial()){if(c=IS,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=xC&&(c=IS,"/"!=i))continue}else l.fragment="",c=LS;else l.query="",c=AS;break;case IS:if(i==xC||"/"==i||"\\"==i&&l.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=NC(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(l.shortenPath(),"/"==i||"\\"==i&&l.isSpecial()||DC(l.path,"")):uS(h)?"/"==i||"\\"==i&&l.isSpecial()||DC(l.path,""):("file"==l.scheme&&!l.path.length&&lS(h)&&(l.host&&(l.host=""),h=RC(h,0)+":"),DC(l.path,h)),h="","file"==l.scheme&&(i==xC||"?"==i||"#"==i))for(;l.path.length>1&&""===l.path[0];)zC(l.path);"?"==i?(l.query="",c=AS):"#"==i&&(l.fragment="",c=LS)}else h+=oS(i,iS);break;case RS:"?"==i?(l.query="",c=AS):"#"==i?(l.fragment="",c=LS):i!=xC&&(l.path[0]+=oS(i,nS));break;case AS:t||"#"!=i?i!=xC&&("'"==i&&l.isSpecial()?l.query+="%27":l.query+="#"==i?"%23":oS(i,nS)):(l.fragment="",c=LS);break;case LS:i!=xC&&(l.fragment+=oS(i,rS))}u++}},parseHost:function(e){var t,n,r;if("["==RC(e,0)){if("]"!=RC(e,e.length-1))return UC;if(t=function(e){var t,n,r,i,a,o,s,l=[0,0,0,0,0,0,0,0],c=0,u=null,h=0,d=function(){return RC(e,h)};if(":"==d()){if(":"!=RC(e,1))return;h+=2,u=++c}for(;d();){if(8==c)return;if(":"!=d()){for(t=n=0;n<4&&AC(JC,d());)t=16*t+TC(d(),16),h++,n++;if("."==d()){if(0==n)return;if(h-=n,c>6)return;for(r=0;d();){if(i=null,r>0){if(!("."==d()&&r<4))return;h++}if(!AC(WC,d()))return;for(;AC(WC,d());){if(a=TC(d(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;h++}l[c]=256*l[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==d()){if(h++,!d())return}else if(d())return;l[c++]=t}else{if(null!==u)return;h++,u=++c}}if(null!==u)for(o=c-u,c=7;0!=c&&o>0;)s=l[c],l[c--]=l[u+o-1],l[u+--o]=s;else if(8!=c)return;return l}(FC(e,1,-1)),!t)return UC;this.host=t}else if(this.isSpecial()){if(e=uw(e),AC(ZC,e))return UC;if(t=function(e){var t,n,r,i,a,o,s,l=jC(e,".");if(l.length&&""==l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=l[r]))return e;if(a=10,i.length>1&&"0"==RC(i,0)&&(a=AC(GC,i)?16:8,i=FC(i,8==a?1:2)),""===i)o=0;else{if(!AC(10==a?qC:8==a?KC:JC,i))return e;o=TC(i,a)}DC(n,o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=IC(256,5-t))return null}else if(o>255)return null;for(s=OC(n),r=0;r<n.length;r++)s+=n[r]*IC(256,3-r);return s}(e),null===t)return UC;this.host=t}else{if(AC(QC,e))return UC;for(t="",n=mi(e),r=0;r<n.length;r++)t+=oS(n[r],nS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return xe(sS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&lS(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,l=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=tS(i),null!==a&&(c+=":"+a)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+LC(o,"/"):"",null!==s&&(c+="?"+s),null!==l&&(c+="#"+l),c},setHref:function(e){var t=this.parse(e);if(t)throw EC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new DS(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+tS(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(rn(e)+":",hS)},getUsername:function(){return this.username},setUsername:function(e){var t=mi(rn(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=oS(t[n],aS)}},getPassword:function(){return this.password},setPassword:function(e){var t=mi(rn(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=oS(t[n],aS)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?tS(e):tS(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wS)},getHostname:function(){var e=this.host;return null===e?"":tS(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,CS)},getPort:function(){var e=this.port;return null===e?"":rn(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=rn(e))?this.port=null:this.parse(e,SS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+LC(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,MS))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=rn(e))?this.query=null:("?"==RC(e,0)&&(e=FC(e,1)),this.query="",this.parse(e,AS)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=rn(e))?("#"==RC(e,0)&&(e=FC(e,1)),this.fragment="",this.parse(e,LS)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var OS,DS=function(e){var t=So(this,BS),n=arguments.length>1?arguments[1]:void 0,r=bC(t,new PS(e,!1,n));f||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},BS=DS.prototype,zS=function(e,t){return{get:function(){return wC(this)[e]()},set:t&&function(e){return wC(this)[t](e)},configurable:!0,enumerable:!0}};if(f&&hw(BS,{href:zS("serialize","setHref"),origin:zS("getOrigin"),protocol:zS("getProtocol","setProtocol"),username:zS("getUsername","setUsername"),password:zS("getPassword","setPassword"),host:zS("getHost","setHost"),hostname:zS("getHostname","setHostname"),port:zS("getPort","setPort"),pathname:zS("getPathname","setPathname"),search:zS("getSearch","setSearch"),searchParams:zS("getSearchParams"),hash:zS("getHash","setHash")}),Je(BS,"toJSON",(function(){return wC(this).serialize()}),{enumerable:!0}),Je(BS,"toString",(function(){return wC(this).serialize()}),{enumerable:!0}),kC){var jS=kC.createObjectURL,FS=kC.revokeObjectURL;jS&&Je(DS,"createObjectURL",Fn(jS,kC)),FS&&Je(DS,"revokeObjectURL",Fn(FS,kC))}if(Dn(DS,"URL"),c({global:!0,forced:!lw,sham:!f},{URL:DS}),c({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return m(URL.prototype.toString,this)}}),OS=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.appendChild(t)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:OS})})),"scrollTo"in Element.prototype||Object.defineProperty(Element.prototype,"scrollTo",{value:function(e,t){this.scrollLeft=e,this.scrollTop=t}}),"scrollBy"in Element.prototype||Object.defineProperty(Element.prototype,"scrollBy",{value:function(e,t){this.scrollLeft+=e,this.scrollTop+=t}}),!("localStorage"in window))try{window.localStorage={getItem:function(){return null},setItem:function(){},removeItem:function(){}}}catch(e){}function NS(e,t){var n=document.createElement("canvas");return e&&t&&(n.width=e,n.height=t),n}var _S,HS,US,YS,XS=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,VS=function(){var e,t=null;return document.body?(e=new Event(""),t=e.timeStamp<36e5):window.addEventListener("DOMContentLoaded",(function(e){t=e.timeStamp<36e5})),function(){if(null===t)throw"eventUsesHighResTimeStamp not initialized";return t}}(),WS=function(){if(!("MouseEvent"in window))return!1;var e;try{e=new MouseEvent("mousemove")}catch(e){return!1}return"movementX"in e&&!XS}(),GS=!!window.PointerEvent,KS=(_S=function(){var e=NS();try{return e.getContext("experimental-webgl",{premultipliedAlpha:!1}),!0}catch(e){return!1}}(),function(){return _S}),qS=(HS={chrome:!1,gl:!1},window.chrome&&window.chrome.app&&(HS.chrome=!0),HS.gl=KS(),function(){return JSON.parse(JSON.stringify(HS))}),JS=(US=function(){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="max(0px, 25px)",document.body.appendChild(e),setTimeout((function(){YS=25===e.offsetLeft,document.body.removeChild(e)}),25)},YS=null,document.body?US():window.addEventListener("DOMContentLoaded",(function(){US()})),function(){if(null===YS)throw new Error("isCssMinMaxSupported not initialized");return YS}),ZS={},QS=function(e,t,n,r){GS||(t=t.replace("pointer","mouse")),t in ZS||(ZS[t]=[]),ZS[t].push(n),e.addEventListener(t,n,r)},$S=function(e,t,n,r){if(GS||(t=t.replace("pointer","mouse")),t in ZS)for(var i=0;i<ZS[t].length;i++)ZS[t][i]===n&&(ZS[t].splice(i,1),i--);e.removeEventListener(t,n,r)};function ek(e,t){for(var n,r=Object.keys(t),i=e.style,a=0;a<r.length;a++)i[n=r[a]]=t[n],i.alignContent="true","userSelect"===n&&(i.webkitUserSelect=t[n])}function tk(e,t){return t?tk(t,e%t):e}function nk(e,t){var n=tk(e,t);return[e/n,t/n]}a("4gaLD");var rk=a("5nGP2"),ik=a("8TCpN"),ak=function(){for(var e=function(e,t,n,r){h.forEach((function(i){i[0]&&i[0](e,t,n,r)}))},t=function(e,t,n){h.forEach((function(r){r[1]&&r[1](e,t,n)}))},n=function(t){var n=t.key,r="code"in t?t.code:t.keyCode;if(console.log(r),n in l){var i=l[n];if(s[i])return void e(i,t,c.join("+"),!0);s[i]=!0,u[r]=i,c.push(i),e(i,t,c.join("+"))}},r=function(e){e.key;var n="code"in e?e.code:e.keyCode,r=c.join("+");if(["Meta","MetaLeft","MetaRight","OSLeft","OSRight"].includes(n))i(null);else if(n in u&&null!==u[n]){var a=u[n];s[a]=!1,u[n]=null;for(var o=0;o<c.length;o++)c[o]==a&&(c.splice(o,1),o--);t(a,e,r)}},i=function(e){var n=c.join("+");c=[],u={};for(var r=[],i=0;i<o.length;i++)s[o[i]]&&(s[o[i]]=!1,r.push(o[i]));for(var a=0;a<r.length;a++)t(r[a],{preventDefault:function(){},stopPropagation:function(){}},n);h.forEach((function(e){e[2]&&e[2]()}))},a={space:[" ","Spacebar"],alt:["Alt","AltGraph"],shift:"Shift",ctrl:"Control",cmd:["Meta","MetaLeft","MetaRight"],enter:"Enter",esc:"Escape",backspace:"Backspace",delete:"Delete",sqbr_open:"[",sqbr_close:"]",a:["a","A"],b:["b","B"],c:["c","C"],e:["e","E"],f:["f","F"],g:["g","G"],r:["r","R"],s:["s","S"],t:["t","T"],u:["u","U"],x:["x","X"],y:["y","Y"],z:["z","Z"],plus:"+",minus:"-",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",home:"Home",end:"End"},o=Object.keys(a),s={},l={},c=[],u={},h=[],d=0;d<o.length;d++){s[o[d]]=!1;var p=a[o[d]];if("string"==typeof p)l[a[o[d]]]=o[d];else for(var f=0;f<p.length;f++)l[p[f]]=o[d]}return{add:function(e){if(!h.includes(e)){var t=0===h.length;h.push(e),t&&(QS(document,"keydown",n),QS(document,"keyup",r),QS(window,"blur",i))}},remove:function(e){if(h.includes(e)){for(var t=1===h.length,a=0;a<h.length;a++)if(h[a]===e){h.splice(a,1);break}t&&($S(document,"keydown",n),$S(document,"keyup",r),$S(window,"blur",i))}},getIsDown:function(){return s},getCombo:function(){return c}}}(),ok=function(){"use strict";function e(t){rk.default(this,e),this.onDown=t.onDown,this.onUp=t.onUp,this.onBlur=t.onBlur,this.ref=[this.onDown,this.onUp,this.onBlur],ak.add(this.ref)}return ik.default(e,[{key:"isPressed",value:function(e){if(!(e in ak.getIsDown()))throw'key "'+e+'" not found';return ak.getIsDown()[e]}},{key:"getComboStr",value:function(){return ak.getCombo().join("+")}},{key:"comboOnlyContains",value:function(e){for(var t=0;t<ak.getCombo().length;t++)if(!e.includes(ak.getCombo()[t]))return!1;return!0}},{key:"destroy",value:function(){ak.remove(this.ref)}}]),e}();function sk(e,t,n){return e*(1-n)+t*n}function lk(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}function ck(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function uk(e,t){return 180*ck(e,t)/Math.PI}function hk(e,t,n){return e<=t?t:e>=n?n:e}function dk(e,t,n){var r=n*(Math.PI/180),i=Math.cos(r),a=Math.sin(r);return{x:e*i-t*a,y:e*a+t*i}}var pk,fk,gk,vk,mk,yk=function(e){var t,n=function(t){e({deltaY:Math.round(t/o),pageX:l.pageX,pageY:l.pageY,clientX:l.clientX,clientY:l.clientY})},r=function(){null!==s&&(n(s),s=null),null===o||i.includes(o)||i.push(o),a=0,o=null},i=[100],a=0,o=null,s=null,l=null;this.process=function(e){l={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},clearTimeout(t),t=setTimeout(r,200);var c=e.deltaY;"deltaMode"in e&&1===e.deltaMode&&(c*=100/3);var u=Math.abs(c);if(a>0&&null===o)s=null;else{if(0===a){if(a++,u<50)return;return o=u,void(i.includes(o)?n(c):s=c)}if(0!==u){if(u===o||u/o%1<1e-4);else if(o/u%1<1e-4)o=u;else if(u!==o)return o=null,void(s=null);null!==s&&(n(s),s=null),n(c)}}}},xk=(pk=[],fk=0,gk=null,vk=!1,mk=1,function(e){var t,n,r,i=function(e){for(var t=0;t<L.length;t++)if(e===L[t].pointerId)return L[t];return null},a=function(e){for(var t=null,n=0;n<P.length;n++)P[n]===e&&(t=L[n],L.splice(n,1),P.splice(n,1),n--);return t},o=function(e,t){return 0===e||1===e?e:(fk<60?(gk=0===fk?e:sk(e,gk,.95),fk++):vk||(vk=!0,gk<.13&&(mk=2.3)),Math.pow(e,1/mk))},s=function(e){if(e.corrected)return e.corrected;var t={pointerId:e.pointerId,pointerType:e.pointerType,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,timeStamp:e.timeStamp+I,pressure:o(e.pressure,e.type),buttons:e.buttons,button:e.button,coalescedArr:[],eventPreventDefault:function(){e.preventDefault()},eventStopPropagation:function(){e.stopPropagation()}};e.corrected=t;var n=null;"pointerId"in e?"pressure"in e&&0!==e.buttons&&(["mouse"].includes(e.pointerType)||"touch"===e.pointerType&&0===e.pressure)&&(t.pressure=1,n=1):(t.pointerId=0,t.pointerType="mouse",t.pressure=0!==e.buttons?1:0,n=t.pressure),XS&&"mouse"!=e.pointerType&&"pointermove"===e.type&&0===e.buttons&&(t.buttons=1);var r=[];"getCoalescedEvents"in e&&(r=e.getCoalescedEvents());var i=function(e){for(var t=pk.length-1;t>=0;t--)if(e.pointerId===pk[t].pointerId)return pk[t];return null}(t);null===i&&(i=function(e){var t={pointerId:e.pointerId,lastPageX:null,lastPageY:null};return pk.push(t),pk.length>15&&pk.shift(),t}(t));for(var a=i.lastPageX,s=i.lastPageY,l=0;l<r.length;l++){var c=r[l];t.coalescedArr.push({pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,movementX:null===i.lastPageX?0:c.pageX-i.lastPageX,movementY:null===i.lastPageY?0:c.pageY-i.lastPageY,timeStamp:0===c.timeStamp?t.timeStamp:c.timeStamp+I,pressure:null===n?o(c.pressure):n}),i.lastPageX=c.pageX,i.lastPageY=c.pageY}return i.lastPageX=t.pageX,i.lastPageY=t.pageY,t.movementX=null===a?0:i.lastPageX-a,t.movementY=null===s?0:i.lastPageY-s,t},l=function(e,t,n){var r=b.getBoundingClientRect(),i={type:e,pointerId:t.pointerId,pointerType:t.pointerType,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.clientX-r.left+b.scrollLeft,relY:t.clientY-r.top+b.scrollTop,dX:t.movementX,dY:t.movementY,time:t.timeStamp,eventPreventDefault:t.eventPreventDefault,eventStopPropagation:t.eventStopPropagation};if("pointermove"===e&&(i.coalescedArr=[],t.coalescedArr.length>1))for(var a,o=0;o<t.coalescedArr.length;o++)a=t.coalescedArr[o],i.coalescedArr.push({pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,relX:a.clientX-r.left+b.scrollLeft,relY:a.clientY-r.top+b.scrollTop,dX:a.movementX,dY:a.movementY,time:a.timeStamp});if(n)for(var s=Object.keys(n),l=0;l<s.length;l++)i[s[l]]=n[s[l]];return i},c=function(e,t,n,r){var i=b.getBoundingClientRect(),a={type:e,pointerId:t.identifier,pointerType:"touch",pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.pageX-i.left+b.scrollLeft,relY:t.pageY-i.top+b.scrollTop,time:n.timeStamp+I,eventPreventDefault:function(){n.preventDefault()},eventStopPropagation:function(){n.stopPropagation()}};"pointermove"===e&&(a.coalescedArr=[]);for(var o=Object.keys(r),s=0;s<o.length;s++)a[o[s]]=r[o[s]];return a},u=function(){$S(document,"pointermove",g),$S(document,"pointerup",v),$S(document,"pointerleave",m)},h=function(){O++,S&&S(!0)},d=function(){O--,S&&S(!1)},p=function(e){e=s(e);var t=R;if(R=e.pointerType,P.includes(e.pointerId)||P.length===k||"touch"===e.pointerType)A=!1;else if(A||"mouse"!==e.pointerType||"pen"!==t){A=!1;var n=l("pointermove",e);w(n)}else A=!0},f=function(e){if(e=s(e),!P.includes(e.pointerId)&&P.length!==k&&[1,2,4].includes(e.buttons)){0===L.length&&(QS(document,"pointermove",g),QS(document,"pointerup",v),QS(document,"pointerleave",m));var t={pointerId:e.pointerId,pointerType:e.pointerType,downPageX:e.pageX,downPageY:e.pageY,buttons:e.buttons,lastPageX:e.pageX,lastPageY:e.pageY,lastTimeStamp:e.timeStamp};L.push(t),y(t),P.push(e.pointerId);var n=l("pointerdown",e,{downPageX:e.pageX,downPageY:e.pageY,button:E[e.buttons],pressure:e.pressure});w(n)}},g=function(e){if(e=s(e),P.includes(e.pointerId)){var t=i(e.pointerId);if(x(t),e.buttons===t.buttons){if(y(t),"pen"!==e.pointerType||e.pageX!==t.lastPageX||e.pageY!==t.lastPageY||e.timeStamp!==t.lastTimeStamp){var n=l("pointermove",e,{downPageX:t.downPageX,downPageY:t.downPageY,button:E[e.buttons],pressure:e.pressure});t.lastPageX=e.pageX,t.lastPageY=e.pageY,t.lastTimeStamp=e.timeStamp,w(n)}}else{1===L.length&&u(),a(e.pointerId);var r=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});w(r)}}},v=function(e){if(e=s(e),P.includes(e.pointerId)){1===L.length&&u();var t=a(e.pointerId);x(t);var n=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});w(n)}},m=function(e){if(e=s(e),P.includes(e.pointerId)){1===L.length&&u();var t=a(e.pointerId);x(t);var n=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});w(n)}},y=function(e){"touch"===e.pointerType&&(e.touchTimeout=setTimeout((function(){!function(e){var t={pointerId:e.pointerId,pointerType:e.pointerType,type:"pointerup",timeStamp:performance.now(),pageX:0,pageY:0,clientX:0,clientY:0,preventDefault:function(){},stopPropagation:function(){}};v(t)}(e)}),2500))},x=function(e){e.touchTimeout&&(clearTimeout(e.touchTimeout),e.touchTimeout=null)},b=e.target,w=e.onPointer,C=e.onWheel,S=e.onEnterLeave,k="maxPointers"in e?e.maxPointers:1,E={1:"left",2:"right",4:"middle"},T=new yk((function(e){if(!M&&C){var t=b.getBoundingClientRect();e.relX=e.clientX-t.left+b.scrollLeft,e.relY=e.clientY-t.top+b.scrollTop,C(e)}})),M=!1,I=VS()?0:-performance.timing.navigationStart,R="",A=!1,L=[],P=[],O=0;S&&(QS(b,"pointerenter",h),QS(b,"pointerleave",d)),w&&(QS(b,"pointermove",p),QS(b,"pointerdown",f)),C&&QS(b,"wheel",T.process),GS?e.fixScribble&&QS(b,"touchmove",n=function(e){e.preventDefault()}):(t=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length&&L.length<k;i++){var a=t[i];0===L.length&&(QS(document,"touchmove",n),QS(document,"touchend",r),QS(document,"touchcancel",r)),L.push({pointerId:a.identifier,downPageX:a.pageX,downPageY:a.pageY,buttons:1,lastPageX:a.pageX,lastPageY:a.pageY}),P.push(a.identifier);var o=c("pointerdown",a,e,{dX:0,dY:0,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",pressure:1});w(o)}},n=function(e){e.preventDefault();for(var t=e.changedTouches,n=0;n<t.length;n++){var r=t[n];if(P.includes(r.identifier)){var a=i(r.identifier),o=c("pointermove",r,e,{dX:r.pageX-a.lastPageX,dY:r.pageY-a.lastPageY,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",isCoalesced:!1,pressure:1});a.lastPageX=r.pageX,a.lastPageY=r.pageY,w(o)}}},r=function(e){"touchcancel"!==e.type&&e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++){var o=t[i];if(P.includes(o.identifier)){1===L.length&&($S(document,"touchmove",n),$S(document,"touchend",r),$S(document,"touchcancel",r));var s=a(o.identifier),l=c("pointerup",o,e,{dX:o.pageX-s.lastPageX,dY:o.pageY-s.lastPageY,downPageX:s.downPageX,downPageY:s.downPageY});w(l)}}},w&&QS(b,"touchstart",t)),this.isOver=function(){return O>0},this.destroy=function(){M||(M=!0,$S(b,"pointerenter",h),$S(b,"pointerleave",d),$S(b,"pointermove",p),$S(b,"pointerdown",f),$S(b,"wheel",T.process),L.length>0&&u(),GS?$S(b,"touchmove",n):($S(b,"touchstart",t),L.length>0&&($S(document,"touchmove",n),$S(document,"touchend",r),$S(document,"touchcancel",r))))}}),bk={};e(bk,"EventChain",(function(){return wk})),e(bk,"DoubleTapper",(function(){return Ck})),e(bk,"NFingerTapper",(function(){return Sk})),e(bk,"PinchZoomer",(function(){return kk})),e(bk,"CoalescedExploder",(function(){return Ek})),e(bk,"OnePointerLimiter",(function(){return Tk})),e(bk,"LinetoolProcessor",(function(){return Mk})),e(bk,"LineSanitizer",(function(){return Ik})),e(bk,"LineSmoothing",(function(){return Rk}));var wk=function(e){for(var t=function(e,t){for(;e<n.length;e++)if(null===(t=n[e].chainIn(t)))return null;return r(t),null},n=e.chainArr,r=function(){},i=0;i<n.length;i++)!function(e){n[e].setChainOut((function(n){t(e+1,n)}))}(i);this.chainIn=function(e){return t(0,e)},this.setChainOut=function(e){r=e}},Ck=function(e){var t=function(){if(0!==f.length){clearTimeout(x.fail),clearTimeout(x.maxUntilSecondDown),clearTimeout(x.success),x.fail=null,x.maxUntilSecondDown=null,x.success=null;for(var e=0;e<y.length;e++)i(y[e]);y=[],f=[]}},n=function(){x.fail=null,x.success=null,y=[];var t=f[f.length-1];f=[],e.onDoubleTap({pageX:t.pageX,pageY:t.pageY})},r=function(e,t,n){var r=n-m;return!(r<=0)&&(x[e]=setTimeout(t,r),!0)},i=function(){},a=400,o=300,s=10,l=19,c=500,u=300,h=250,d=["touch","mouse","pen"],p=["left"],f=[],g=[],v=0,m=0,y=[],x={fail:null,maxUntilSecondDown:null,success:null};this.chainIn=function(e){return function(e){if("pointerdown"===e.type)g.push(e.pointerId);else if("pointerup"===e.type)for(var i=0;i<g.length;i++)if(g[i]===e.pointerId){g.splice(i,1);break}if(d.includes(e.pointerType)){m=performance.now();var y=f.length>0?f[f.length-1]:null;if("pointerup"===e.type&&(v=e.time),"pointerdown"===e.type){if(g.length>1)return void t();if(null!==x.success)return void t();if(0===f.length&&m-v<a)return void t();if(!p.includes(e.button))return void t();if(y&&y.isDown||f.length>2)return void t();if(y&&lk(y.position[0],y.position[1],e.pageX,e.pageY)>l&&(t(),m-y.time<a))return;if(f.push({isDown:!0,time:m,position:[e.pageX,e.pageY],pointerId:e.pointerId}),f.length>1)clearTimeout(x.maxUntilSecondDown);else if(!r("maxUntilSecondDown",t,e.time+u))return void t();if(clearTimeout(x.fail),!r("fail",t,e.time+o))return void t()}if(y&&"pointermove"===e.type&&y.pointerId===e.pointerId&&lk(y.position[0],y.position[1],e.pageX,e.pageY)>s)return void t();if(y&&"pointerup"===e.type){if(y.pointerId!==e.pointerId)return void t();if(m>=y.time+o)return void t();if(clearTimeout(x.fail),f.length<3)return r("fail",t,e.time+c)?void(f=[y,{isUp:!0,time:m,position:[e.pageX,e.pageY]}]):void t();m<f[1].time+c?(f.push({pageX:e.pageX,pageY:e.pageY}),r("success",n,e.time+h)||t()):t()}}else t()}(e),0===f.length?(t(),e):(y.push(e),null)},this.setChainOut=function(e){i=e},this.setAllowedPointerTypeArr=function(e){d=e},this.setAllowedButtonArr=function(e){p=e}},Sk=function(e){var t,n,r=function(){if(0!==p.length){clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout);for(var e=0;e<p.length;e++)s(p[e]);p=[],d=[]}},i=function(e,t){var i=t-n;return!(i<=0)&&(v[e]=setTimeout(r,i),!0)},a=function(a){var s=f;if(f=a.time,"pointerdown"===a.type)g.push(a.pointerId);else if("pointerup"===a.type)for(var m=0;m<g.length;m++)if(g[m]===a.pointerId){g.splice(m,1);break}if("touch"===a.pointerType){if(n=performance.now(),"pointerdown"===a.type)return d.length+1!==g.length||d.length===o||d.length>0&&a.time-u>d[0].downTime||0===d.length&&a.time-l<s?void r():0!==d.length||(t=a.time,i("firstLastDownTimeout",a.time+u)&&i("tapTimeout",a.time+c))?void d.push({pointerId:a.pointerId,downTime:a.time,downPageX:a.pageX,downPageY:a.pageY}):void r();if("pointermove"===a.type){if(0===d.length)return;for(var y=null,x=0;x<d.length;x++)if(d[x].pointerId===a.pointerId){y=d[x];break}if(null===y)return void r();if(a.time-c>t)return void r();if(lk(a.pageX,a.pageY,y.downPageX,y.downPageY)>h)return void r()}if("pointerup"===a.type){if(0===d.length)return;if(d.length!==o)return void r();for(var b=null,w=0;w<d.length;w++)if(d[w].pointerId===a.pointerId){b=d[w];break}if(null===b)return;if(a.time-c>t)return void r();if(lk(a.pageX,a.pageY,b.downPageX,b.downPageY)>h)return void r();b.isUp=!0;for(var C=!0,S=0;S<d.length;S++)if(!d[S].isUp){C=!1;break}if(C)return clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout),p=[],d=[],e.onTap(),!0}}else d.length>0&&r()},o=e.fingers,s=function(){},l=50,c=500,u=250,h=12,d=[],p=[],f=0,g=[],v={firstLastDownTimeout:null,tapTimeout:null};this.chainIn=function(e){return!0===a(e)?null:0===d.length?e:(p.push(e),null)},this.setChainOut=function(e){s=e}},kk=function(e){var t,n=function(){d=null,p=[]},r=function(e){if(d){if(clearTimeout(f.secondFingerTimeout),!e)for(var t=0;t<p.length;t++)u(p[t]);n()}},i=function(e){if("pointerdown"===e.type)h.push(e.pointerId);else if("pointerup"===e.type)for(var i=0;i<h.length;i++)if(h[i]===e.pointerId){h.splice(i,1);break}if(d||!("touch"!==e.pointerType||"pointermove"===e.type&&h.length>0||h.length>1||"pointerup"===e.type)){if(t=performance.now(),"pointerdown"===e.type)return d?"touch"===e.pointerType?(d.touchPointerArr.push({pointerId:e.pointerId,relX:e.relX,relY:e.relY}),void(d.isInProgress?o(d,{type:"down",index:d.touchPointerArr.length-1}):(clearTimeout(f.secondFingerTimeout),d.isInProgress=!0,a(d)))):void(d.isInProgress?d.otherPointerIdArr.push(e.pointerId):r()):(d={touchPointerArr:[{pointerId:e.pointerId,relX:e.relX,relY:e.relY,downRelX:e.relX,downRelY:e.relY}],otherPointerIdArr:[],isInProgress:!1},u="secondFingerTimeout",p=function(){r()},g=e.time+c,(v=g-t)<=0||(f[u]=setTimeout(p,v),0)?void r():void 0);var u,p,g,v;if("pointermove"!==e.type||"touch"!==e.pointerType){if("pointerup"===e.type){if("touch"===e.pointerType){for(var m=0;m<d.touchPointerArr.length;m++)if(d.touchPointerArr[m].pointerId===e.pointerId){d.touchPointerArr.splice(m,1);break}d.touchPointerArr.length>0&&o(d,{type:"up",index:m})}else for(var y=0;y<d.otherPointerIdArr.length;y++)if(d.otherPointerIdArr[y]===e.pointerId){d.otherPointerIdArr.splice(y,1);break}if(0===d.touchPointerArr.length&&0===d.otherPointerIdArr.length)return void(d.isInProgress?(n(),s()):r())}}else{for(var x=null,b=0;b<d.touchPointerArr.length;b++)if(e.pointerId===d.touchPointerArr[b].pointerId){x=d.touchPointerArr[b];break}if(x.relX=e.relX,x.relY=e.relY,d.isInProgress)b<2&&o(d,{type:"move",index:b});else if(lk(x.downRelX,x.downRelY,x.relX,x.relY)>l)return void r()}}},a=function(t){for(var n=0;n<t.touchPointerArr.length;n++){var r=t.touchPointerArr[n];g.push({pointerId:r.pointerId,relX:r.relX,relY:r.relY,downRelX:r.relX,downRelY:r.relY})}var i={type:"move",angleRad:0,scale:1};1===g.length?(i.relX=g[0].downRelX,i.relY=g[0].downRelY):(i.relX=.5*(g[0].downRelX+g[1].downRelX),i.relY=.5*(g[0].downRelY+g[1].downRelY)),i.downRelX=i.relX,i.downRelY=i.relY,e.onPinch(i)},o=function(t,n){if(!(n.index>1))if("move"===n.type){var r;if(g[n.index].relX=t.touchPointerArr[n.index].relX,g[n.index].relY=t.touchPointerArr[n.index].relY,1===g.length)r={type:"move",downRelX:g[0].downRelX,downRelY:g[0].downRelY,relX:g[0].relX,relY:g[0].relY,angleRad:0,scale:1};else{var i=lk(g[0].downRelX,g[0].downRelY,g[1].downRelX,g[1].downRelY),o=lk(g[0].relX,g[0].relY,g[1].relX,g[1].relY),l=ck({x:g[0].downRelX,y:g[0].downRelY},{x:g[1].downRelX,y:g[1].downRelY}),c=ck({x:g[0].relX,y:g[0].relY},{x:g[1].relX,y:g[1].relY});r={type:"move",downRelX:.5*(g[0].downRelX+g[1].downRelX),downRelY:.5*(g[0].downRelY+g[1].downRelY),relX:.5*(g[0].relX+g[1].relX),relY:.5*(g[0].relY+g[1].relY),angleRad:c-l,scale:o/i}}e.onPinch(r)}else"down"!==n.type&&"up"!==n.type||(s(),a(t))},s=function(){g=[],e.onPinch({type:"end"})},l=10,c=250,u=function(){},h=[],d=null,p=[],f={secondFingerTimeout:null},g=[];this.chainIn=function(e){return i(e),d?(d.isInProgress||p.push(e),null):e},this.setChainOut=function(e){u=e}},Ek=function(){var e=function(){};this.chainIn=function(t){if("pointermove"!==t.type)return t;if(!(t.coalescedArr.length>0))return t;var n,r=JSON.parse(JSON.stringify(t));r.coalescedArr=[];for(var i=0;i<t.coalescedArr.length;i++)i>0&&(r=JSON.parse(JSON.stringify(t))),n=t.coalescedArr[i],r.pageX=n.pageX,r.pageY=n.pageY,r.relX=n.relX,r.relY=n.relY,r.dX=n.dX,r.dY=n.dY,r.time=n.time,i<t.coalescedArr.length-1&&(r.isCoalesced=!0),e(r);return null},this.setChainOut=function(t){e=t}},Tk=function(e){var t=null,n=[];this.chainIn=function(e){if(n.includes(e.pointerId)){if("pointerup"===e.type)for(var r=0;r<n.length;r++)if(n[r]===e.pointerId){n.splice(r,1);break}return null}return null===t?("pointerdown"===e.type&&(t=e.pointerId),e):e.pointerId!==t?("pointerdown"===e.type&&n.push(e.pointerId),null):("pointerup"===e.type&&(t=null),e)},this.setChainOut=function(e){e}},Mk=function(e){var t=null,n=[],r=null;this.process=function(i){if("down"===i.type&&(t=i,r=null,i.shiftIsPressed))return e.onDraw({type:"line",x0:null,y0:null,pressure0:null,x1:i.x,y1:i.y,pressure1:i.pressure}),void n.push(i);if("move"===i.type)if(i.shiftIsPressed){if(null===r){var a=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y);if(a>5||o>5){r=a>o?0:1;for(var s=0;s<n.length;s++){var l=n[s];0===r?l.y=t.y:l.x=t.x,e.onDraw(JSON.parse(JSON.stringify(l)))}n=[]}}if(null===r)return void n.push(i);0===r?i.y=t.y:i.x=t.x}else if(n.length>0){for(var c=0;c<n.length;c++)e.onDraw(JSON.parse(JSON.stringify(n[c])));n=[]}"up"===i.type&&(n=[]),e.onDraw(JSON.parse(JSON.stringify(i)))}},Ik=function(){var e=function(){},t=!1;this.chainIn=function(n){return"down"===n.type&&(t?e({type:"up",scale:n.scale,shiftIsPressed:n.shiftIsPressed,isCoalesced:!1}):t=!0),t||"move"!==n.type&&"up"!==n.type?("up"===n.type&&t&&(t=!1),n):null},this.setChainOut=function(t){e=t},this.getIsDrawing=function(){return t}},Rk=function(e){var t,n,r,i=function(){},a=hk(e.smoothing,0,1);this.chainIn=function(e){if(e=JSON.parse(JSON.stringify(e)),clearTimeout(r),clearInterval(n),"down"===e.type&&(t={x:e.x,y:e.y,pressure:e.pressure}),"move"===e.type){var o=e.x,s=e.y,l=e.pressure;e.x=sk(e.x,t.x,a),e.y=sk(e.y,t.y,a),e.pressure=sk(e.pressure,t.pressure,a),t={x:e.x,y:e.y,pressure:e.pressure},a>0&&(r=setTimeout((function(){n=setInterval((function(){(e=JSON.parse(JSON.stringify(e))).x=sk(o,t.x,a),e.y=sk(s,t.y,a),e.pressure=sk(l,t.pressure,a),t={x:e.x,y:e.y,pressure:e.pressure},i(e)}),35)}),80))}return e},this.setChainOut=function(e){i=e},this.setSmoothing=function(e){a=hk(e,0,1)}};var Ak,Lk=function(e){var t,n=NS();if(e<1){if(n.width=1,n.height=1,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(128, 128, 128)",t.fillRect(0,0,1,1)}else if(e>200)n.width=401,n.height=401;else{if(n.width=2*e,n.height=2*e,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,2*e,2*e),t.fillStyle="rgb(200, 200, 200)",t.fillRect(0,0,e,e),t.fillRect(e,e,2*e,2*e)}return n},Pk=(Ak={8:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC",4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC"},function(e,t){var n=function(e){if(e=parseInt(""+e),Ak[""+e])return Ak[""+e];var t=Lk(e).toDataURL("image/png");return Ak[""+e]=t,t};if(!t)return n(e);setTimeout((function(){t(n(e))}),1)});var Ok,Dk={getIdentity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiplyMatrixAndPoint:Ok=function(e,t){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15]]},multiplyMatrices:function(e,t){var n=[t[0],t[1],t[2],t[3]],r=[t[4],t[5],t[6],t[7]],i=[t[8],t[9],t[10],t[11]],a=[t[12],t[13],t[14],t[15]],o=Ok(e,n),s=Ok(e,r),l=Ok(e,i),c=Ok(e,a);return[o[0],o[1],o[2],o[3],s[0],s[1],s[2],s[3],l[0],l[1],l[2],l[3],c[0],c[1],c[2],c[3]]},createTranslationMatrix:function(e,t){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]},createRotationMatrix:function(e){return[Math.cos(-e),-Math.sin(-e),0,0,Math.sin(-e),Math.cos(-e),0,0,0,0,1,0,0,0,0,1]},createScaleMatrix:function(e){return[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]}},Bk={add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},nor:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return{x:e.x/t,y:e.y/t}},len:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},dist:function(e,t){return Bk.len(Bk.sub(e,t))},mul:function(e,t){return{x:e.x*t,y:e.y*t}},angle:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},dot:function(e,t){var n=[e.x,e.y],r=[t.x,t.y];return n.map((function(e,t){return n[t]*r[t]})).reduce((function(e,t){return e+t}))}},zk=function(e){for(var t=[],n=this,r=0;r<e.points.length;r++)!function(n){var r=void 0;n<e.points.length-1&&(r=lk(e.points[n].x,e.points[n].y,e.points[n+1].x,e.points[n+1].y)),t[n]={x:e.points[n].x,y:e.points[n].y,length:r}}(r);this.getAtDist=function(e){for(var r=Math.min(n.getLength(),e),i=0;r>t[i].length&&i<t.length-2;i++)r-=t[i].length;var a=Math.min(1,Math.max(0,r/t[i].length));return{x:t[i].x*(1-a)+t[i+1].x*a,y:t[i].y*(1-a)+t[i+1].y*a}},this.getLength=function(){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].length;return e}},jk=function(e){var t,n=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[];var r=e[0][0],i=e[e.length-1][0];for(e.sort((function(e,t){return e[0]-t[0]})),t=0;t<n;t++)this.xa.push(e[t][0]),this.ya.push(e[t][1]);for(this.u[0]=0,this.y2[0]=0,t=1;t<n-1;++t){var a=this.xa[t+1]-this.xa[t-1],o=(this.xa[t]-this.xa[t-1])/a,s=o*this.y2[t-1]+2;this.y2[t]=(o-1)/s;var l=(this.ya[t+1]-this.ya[t])/(this.xa[t+1]-this.xa[t])-(this.ya[t]-this.ya[t-1])/(this.xa[t]-this.xa[t-1]);this.u[t]=(6*l/a-o*this.u[t-1])/s}for(this.y2[n-1]=0,t=n-2;t>=0;--t)this.y2[t]=this.y2[t]*this.y2[t+1]+this.u[t];this.getFirstX=function(){return r},this.getLastX=function(){return i}};jk.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6},jk.prototype.findX=function(e,t){for(var n=null,r=null,i=0;i<=t;i++){var a=i/t,o=this.interpolate(a);if(null!==n){var s=Math.abs(o-e);if(!(s<r))break;n=a,r=s}else n=a,r=Math.abs(o-e)}return n};a("4gaLD");rk=a("5nGP2");var Fk=function e(t,n,r){"use strict";rk.default(this,e),this.h=Math.max(0,Math.min(360,t)),this.s=Math.max(.001,Math.min(100,n)),this.v=Math.max(0,Math.min(100,r))},Nk=function e(t,n,r){"use strict";rk.default(this,e),this.r=Math.max(0,Math.min(255,t)),this.g=Math.max(0,Math.min(255,n)),this.b=Math.max(0,Math.min(255,r))},_k=function e(t,n,r,i){"use strict";rk.default(this,e),this.c=Math.max(0,Math.min(100,t)),this.m=Math.max(0,Math.min(100,n)),this.y=Math.max(0,Math.min(100,r)),this.k=Math.max(0,Math.min(100,i))},Hk={_RGBtoHSV:function(e){var t=new Fk(0,0,0),n=e.r/255,r=e.g/255,i=e.b/255,a=Math.min(n,r,i),o=Math.max(n,r,i),s=o-a;if(t.v=o,0==s)t.h=0,t.s=0;else{t.s=s/o;var l=((o-n)/6+s/2)/s,c=((o-r)/6+s/2)/s,u=((o-i)/6+s/2)/s;n==o?t.h=u-c:r==o?t.h=1/3+l-u:i==o&&(t.h=2/3+c-l),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t,n,r,i,a,o,s,l,c=new Nk(0,0,0),u=e.h/360%1,h=e.s/100,d=e.v/100;return 0==h?(c.r=255*d,c.g=255*d,c.b=255*d):(r=d*(1-h),i=d*(1-h*((t=6*u)-(n=Math.floor(t)))),a=d*(1-h*(1-(t-n))),0==n?(o=d,s=a,l=r):1==n?(o=i,s=d,l=r):2==n?(o=r,s=d,l=a):3==n?(o=r,s=i,l=d):4==n?(o=a,s=r,l=d):(o=d,s=r,l=i),c.r=255*o,c.g=255*s,c.b=255*l,c.r=Math.round(c.r),c.g=Math.round(c.g),c.b=Math.round(c.b)),c},_CMYKtoRGB:function(e){var t=new Nk(0,0,0),n=e.c/100,r=e.m/100,i=e.y/100,a=e.k/100;return t.r=1-Math.min(1,n*(1-a)+a),t.g=1-Math.min(1,r*(1-a)+a),t.b=1-Math.min(1,i*(1-a)+a),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new _k(0,0,0,0),n=e.r/255,r=e.g/255,i=e.b/255;return t.k=Math.min(1-n,1-r,1-i),t.c=(1-n-t.k)/(1-t.k),t.m=(1-r-t.k)/(1-t.k),t.y=(1-i-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){return e instanceof Nk?e:e instanceof Fk?this._HSVtoRGB(e):e instanceof _k?this._CMYKtoRGB(e):void 0},toHSV:function(e){return e instanceof Fk?e:e instanceof Nk?this._RGBtoHSV(e):e instanceof _k?this._RGBtoHSV(this._CMYKtoRGB(e)):void 0},toCMYK:function(e){return e instanceof _k?e:e instanceof Nk?this._RGBtoCMYK(e):e instanceof Fk?this._RGBtoCMYK(this._HSVtoRGB(e)):void 0},toHexString:function(e){if(e instanceof Nk){var t=parseInt(""+e.r).toString(16),n=parseInt(""+e.g).toString(16),r=parseInt(""+e.b).toString(16);return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==r.length&&(r="0"+r),t+n+r}},toRgbStr:function(e){return"rgb("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+")"},toRgbaStr:function(e){return"rgba("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+", "+e.a+")"},hexToRGB:function(e){e=(e=e.trim()).replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new Nk(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):null}};var Uk,Yk=(Uk=function(e){e.preventDefault();var t=!1;if(e.relatedTarget)try{e.relatedTarget.focus(),t=!0}catch(e){console.error("failed to focus")}t||e.currentTarget.blur()},function(e){e.setAttribute("tabindex","-1"),QS(e,"focus",Uk)}),Xk=[];a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var Vk=function(){"use strict";function e(){rk.default(this,e)}return ik.default(e,null,[{key:"subscribe",value:function(t){e.listeners.includes(t)||e.listeners.push(t)}},{key:"unsubscribe",value:function(t){for(var n=0;n<e.listeners.length;n++)if(t===e.listeners[n])return void e.listeners.splice(n,1)}},{key:"emit",value:function(t){e.listeners.forEach((function(e){e(t)}))}}]),e}();Vk.listeners=[],a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var Wk=function(){"use strict";function e(){rk.default(this,e)}return ik.default(e,null,[{key:"getItem",value:function(e){var t=null;try{t=localStorage.getItem(e)}catch(e){this.error=e}return t}},{key:"setItem",value:function(e,t){try{localStorage.setItem(e,t)}catch(e){this.error=e}}},{key:"removeItem",value:function(e){try{localStorage.removeItem(e)}catch(e){this.error=e}}},{key:"getError",value:function(){return this.error}}]),e}(),Gk={eventUsesHighResTimeStamp:VS,mouseEventHasMovement:WS,hasPointerEvents:GS,hasWebGl:KS,getVisitor:qS,isCssMinMaxSupported:JS,canShareFiles:function(){return"share"in navigator&&"canShare"in navigator},insertAfter:function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)},loadImage:function(e,t){var n=0;!function r(){1e3!==n?e.complete?(n++,t()):setTimeout(r,1):alert("couldn't load")}()},css:ek,setAttributes:function(e,t){for(var n,r=Object.keys(t),i=0;i<r.length;i++)n=r[i],e.setAttribute(n,t[n])},addClassName:function(e,t){var n=e.getAttribute("class"),r=null===n?[]:n.split(" ");r.includes(t)||(r.push(t),e.setAttribute("class",r.join(" ")))},removeClassName:function(e,t){var n=e.getAttribute("class"),r=null===n?[]:n.split(" ");if(r.includes(t)){for(var i=0;i<r.length;i++)r[i]===t&&(r.splice(i,1),i--);e.setAttribute("class",r.join(" "))}},append:function(e,t){var n=document.createDocumentFragment();t.forEach((function(e){return e?n.append(e):null})),e.append(n)},fitInto:function(e,t,n,r,i){var a=e*n,o=t*n;return a>n&&(o*=n/a,a=n),o>r&&(a*=r/o,o=r),i&&(a=Math.max(i,a),o=Math.max(i,o)),{width:a,height:o}},centerWithin:function(e,t,n,r){return{x:e/2-n/2,y:t/2-r/2}},getDate:function(){var e=new Date;return e.getFullYear()+"_"+(e.getMonth()+1).toString().padStart(2,"0")+"_"+e.getDate().toString().padStart(2,"0")+"_"+(60*e.getHours()+e.getMinutes()).toString(36).padStart(3,"0")+"_"},gcd:tk,reduce:nk,decToFraction:function(e){var t=e.toString().length-2,n=Math.pow(10,t);return nk(e*n,n)},imageBlobToUrl:function(e){if(!e)throw new Error("blobObj is undefined or null");if(window.Blob&&e instanceof Blob)return URL.createObjectURL(e);if("Object"===e.constructor.name){var t=e;return"data:"+t.type+";"+t.encoding+","+t.data}throw new Error("unknown blob format")},dateDayDifference:function(e,t){return e=new Date(e),t=new Date(t),e.setHours(0,0,0,0),t.setHours(0,0,0,0),(t.getTime()-e.getTime())/864e5},copyObj:function(e){return JSON.parse(JSON.stringify(e))},shareCanvas:function(e){var t="image/png",n=function(){return alert("sharing not supported")};e.canvas.toBlob((function(r){if(null===r)return n(),void e.callback();try{var i=[new File([r],e.fileName,{type:t})];navigator.share({title:e.title,files:i}).then((function(e){})).catch((function(e){n()}))}catch(e){n()}e.callback()}),t)},handleClick:function(e){var t=e.target;return!!t&&(!(!["A","LABEL","INPUT"].includes(t.tagName)&&!t.allowClick)||(e.preventDefault(),!1))},createSvg:function e(t){for(var n,r=document.createElementNS("http://www.w3.org/2000/svg",t.elementType),i=Object.keys(t),a=0;a<i.length;a++)if("childrenArr"===(n=i[a]))for(var o=0;o<t.childrenArr.length;o++)r.appendChild(e(t.childrenArr[o]));else"elementType"!==n&&r.setAttribute(n,t[n]);return r},BbLog:Vk,LocalStorage:Wk,mix:sk,dist:lk,distSquared:function(e,t,n,r){return Math.pow(e-n,2)+Math.pow(t-r,2)},lenSquared:function(e,t){return e*e+t*t},pointsToAngleRad:ck,pointsToAngleDeg:uk,clamp:hk,rotate:dk,rotateAround:function(e,t,n){var r=dk(t.x-e.x,t.y-e.y,n);return r.x+=e.x,r.y+=e.y,r},Matrix:Dk,Vec2:Bk,intDxy:function(e,t,n){e.x+=t,e.y+=n;var r=Math.round(e.x),i=Math.round(e.y);return e.x-=r,e.y-=i,{dX:r,dY:i}},roundEven:function(e){if(e%1==0)return e%2==0?e:e+1;var t=Math.ceil(e),n=Math.floor(e);return t%2==0?t:n},roundUneven:function(e){if(e%1==0)return e%2==0?e+1:e;var t=Math.ceil(e),n=Math.floor(e);return t%2==1?t:n},updateBounds:function(e,t){return t?(e?(e.x1=Math.min(e.x1,t.x1),e.y1=Math.min(e.y1,t.y1),e.x2=Math.max(e.x2,t.x2),e.y2=Math.max(e.y2,t.y2)):e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},e):e},boundsInArea:function(e,t,n){var r=Math.max(0,e.x1),i=Math.max(0,e.y1),a=Math.min(t-1,e.x2),o=Math.min(n-1,e.y2);return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}},projectPointOnLine:function(e,t,n){if(e.x===t.x)return{x:e.x,y:n.y};var r=(t.y-e.y)/(t.x-e.x),i=e.y-r*e.x;return{x:(r*n.y+n.x-r*i)/(r*r+1),y:(r*r*n.y+r*n.x+i)/(r*r+1)}},PointLine:zk,BezierLine:function(){var e,t,n,r=this,i=[],a=0,o=null;this.add=function(r,s,l,c,u){if(!e||r!==e.x||s!==e.y)if(e={x:r,y:s},i[i.length]={x:r,y:s,spacing:l},1!==i.length){if(2===i.length)return i[0].dir=Bk.nor(Bk.sub(i[1],i[0])),a=l,void(o=l);var h=i[i.length-1],d=i[i.length-2],p=i[i.length-3];d.dir=Bk.nor(Bk.sub(h,p)),(isNaN(d.dir.x)||isNaN(d.dir.y))&&(d.dir=JSON.parse(JSON.stringify(p.dir)));var f,g,v=i[i.length-3],m=i[i.length-2],y=v,x=Bk.add(v,Bk.mul(v.dir,Bk.dist(v,m)/4)),b=Bk.sub(m,Bk.mul(m.dir,Bk.dist(v,m)/4)),w=m;if(c)g=function(e,t,n,r,i){for(var a,o,s=[],l=0;l<=i;l++)a=l/i,(o={}).x=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*Math.pow(a,2)*n.x+Math.pow(a,3)*r.x,o.y=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*Math.pow(a,2)*n.y+Math.pow(a,3)*r.y,s[s.length]=o;return s}(y,x,b,w,20),f=new zk({points:g});else f=new zk({points:[y,w]});for(var C=f.getLength(),S=sk(o,l,hk(a/C,0,1)),k=a;k<=C;k+=S){S=sk(o,l,hk(k/C,0,1));var E=f.getAtDist(k),T=t?uk(t,E):void 0;c&&c({x:E.x,y:E.y,t:k/C,angle:T,dAngle:t?T-n:0}),t=E,n=T}c?a=k-C:(a=0,u({p1:y,p2:x,p3:b,p4:w})),o=l}else o=l},this.addFinal=function(e,t,n){if(!(i.length<2)){var a=i[i.length-2],o=i[i.length-1],s=Bk.add(o,Bk.sub(o,a));r.add(s.x,s.y,e,t,n)}}},SplineInterpolator:jk,quadraticSplineInput:function(e,t,n){for(var r=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},i=[],a=0;a<=1;a+=n)i.push([r(a,4),r(e+Math.pow(a,2)*(t-e),4)]);return i},canvas:NS,copyCanvas:function(e){var t=NS(e.width,e.height),n=t.getContext("2d");if(!n)throw new Error("2d context not supported or canvas already initialized");return n.drawImage(e,0,0),t},testShouldPixelate:function(e,t,n){if(![1,-1].includes(t)||![1,-1].includes(n)||e.width%1!=0||e.height%1!=0||Math.abs(e.angleDeg)%90!=0)return!1;var r=Math.abs(e.angleDeg-90)%180==0,i=r?e.height:e.width,a=r?e.width:e.height;return(Math.abs(i)%2==0&&e.x%1==0||Math.abs(i)%2==1&&e.x%1==.5)&&(Math.abs(a)%2==0&&e.y%1==0||Math.abs(a)%2==1&&e.y%1==.5)},drawTransformedImageWithBounds:function(e,t,n,r,i){r||(r={x:0,y:0,width:t.width,height:t.height}),e.save(),i?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"),e.translate(n.x,n.y),e.rotate(n.angleDeg/180*Math.PI),e.scale(n.width>0?1:-1,n.height>0?1:-1),e.drawImage(t,r.x,r.y,r.width,r.height,-Math.abs(n.width)/2,-Math.abs(n.height)/2,Math.abs(n.width),Math.abs(n.height)),e.restore()},drawTransformedImageOnCanvas:function(e,t,n){(n=JSON.parse(JSON.stringify(n))).center||(n.center={x:t.width/2,y:t.height/2}),n.scale||(n.scale={x:1,y:1}),n.angleDegree||(n.angleDegree=0),n.translate||(n.translate={x:0,y:0});var r=e.getContext("2d");if(!r)throw new Error("2d context not supported or canvas already initialized");r.save(),Math.abs(n.scale.x-1)>1e-6||Math.abs(n.scale.y-1)>1e-6||Math.abs(n.angleDegree%90)>1e-6?(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high"):r.imageSmoothingEnabled=!1,r.translate(n.translate.x,n.translate.y),r.translate(n.center.x,n.center.y),r.rotate(n.angleDegree/180*Math.PI),r.scale(n.scale.x,n.scale.y),r.translate(-n.center.x,-n.center.y),r.drawImage(t,0,0,t.width,t.height),r.restore()},createCheckerCanvas:Lk,createCheckerDataUrl:Pk,resizeCanvas:function e(t,n,r,i,a){if(n&&r&&(n!==t.width||r!==t.height))if(n=Math.max(n,1),r=Math.max(r,1),n<=t.width&&r<=t.height){i=i||NS(),a=a||NS();var o,s,l=function(e,t,n,r){var i={oldWidthEx:Math.round(Math.log2(e)),oldHeightEx:Math.round(Math.log2(t)),newWidthEx:Math.ceil(Math.log2(n)),newHeightEx:Math.ceil(Math.log2(r))};return i.oldWidthEx=Math.max(i.oldWidthEx,i.newWidthEx),i.oldHeightEx=Math.max(i.oldHeightEx,i.newHeightEx),i}(t.width,t.height,n,r);a.width=l.oldWidthEx>l.newWidthEx?Math.pow(2,l.oldWidthEx):n,a.height=l.oldHeightEx>l.newHeightEx?Math.pow(2,l.oldHeightEx):r,i.getContext("2d").save(),a.getContext("2d").save();var c=i,u=a;o=l.oldWidthEx,s=l.oldHeightEx;var h=u.getContext("2d");h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.globalCompositeOperation="copy",h.drawImage(t,0,0,u.width,u.height);for(var d=u.width,p=u.height;o>l.newWidthEx||s>l.newHeightEx;o--,s--){(h=c.getContext("2d")).imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.globalCompositeOperation="copy";var f=o>l.newWidthEx?d/2:d,g=s>l.newHeightEx?p/2:p;c.width=f,c.height=g,h.drawImage(u,0,0,d,p,0,0,f,g),d=f,p=g;var v=c;c=u,u=v}t.width=n,t.height=r;var m=t.getContext("2d");m.save(),m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(u,0,0,d,p,0,0,n,r),m.restore(),i.getContext("2d").restore(),a.getContext("2d").restore()}else if(n>=t.width&&r>=t.height){(i=i||NS()).width=n,i.height=r;var y=i.getContext("2d");y.save(),y.imageSmoothingEnabled=!0,y.imageSmoothingQuality="high",y.drawImage(t,0,0,n,r),y.restore(),t.width=n,t.height=r,t.getContext("2d").drawImage(i,0,0)}else e(t,n,t.height,i,a),e(t,n,r,i,a)},convertToAlphaChannelCanvas:function(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=0;n<t.data.length;n+=4)0!==t.data[n+3]&&(t.data[n+3]=(t.data[n]+t.data[n+1]+t.data[n+2])/3*(t.data[n+3]/255));e.getContext("2d").putImageData(t,0,0)},HSV:Fk,RGB:Nk,CMYK:_k,ColorConverter:Hk,testIsWhiteBestContrast:function(e){return.299*e.r+.587*e.g+.114*e.b<125},appendTextDiv:function(e,t){var n=document.createElement("div");return n.innerHTML=t,e.appendChild(n),n},clearSelection:function(){if(window.getSelection){var e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}else"selection"in document&&document.selection.empty()},makeUnfocusable:Yk,el:function(e){var t=document.createElement(e.tagName?e.tagName:"div");e.css&&ek(t,e.css),e.content&&("string"==typeof e.content?t.innerHTML=e.content:Array.isArray(e.content)?Gk.append(t,e.content):t.appendChild(e.content)),e.textContent&&(t.textContent=e.textContent),e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.parent&&e.parent.appendChild(t),"title"in e&&void 0!==e.title&&(t.title=e.title);var n=[];if("onClick"in e&&(QS(t,"click",e.onClick),n.push(["click",e.onClick])),"onChange"in e&&(QS(t,"change",e.onChange),n.push(["change",e.onChange])),n.length>0&&Xk.push({el:t,listeners:n}),"custom"in e)for(var r=Object.keys(e.custom),i=0;i<r.length;i++)t.setAttribute(r[i],e.custom[r[i]]);return t},destroyEl:function(e){for(var t=0;t<Xk.length;t++){var n=Xk[t];if(n.el===e)return n.listeners.forEach((function(t){e.removeEventListener(t[0],t[1])})),void Xk.splice(t,1)}},isInputFocused:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName);return e?t:t&&!document.activeElement.getAttribute("data-ignore-focus")},addEventListener:QS,removeEventListener:$S,setEventListener:function(e,t,n){GS||(t=t.replace("pointer","mouse")),e[t]=n},KeyListener:ok,PointerListener:xk,sameKeys:function(e,t){return e.split("+").sort().join("+")===t.split("+").sort().join("+")},EventChain:bk};a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var Kk=!1,qk=function(){"use strict";function e(){rk.default(this,e)}return ik.default(e,[{key:"pause",value:function(e){}},{key:"addListener",value:function(e){}},{key:"push",value:function(e){}},{key:"undo",value:function(){return[]}},{key:"redo",value:function(){return[]}},{key:"getAll",value:function(){return[]}},{key:"canRedo",value:function(){return!1}},{key:"canUndo",value:function(){return!1}},{key:"getState",value:function(){return 0}},{key:"getActionNumber",value:function(){return 0}}]),e}(),Jk=function(){"use strict";function e(){if(rk.default(this,e),this.max=20,Kk)throw new Error("klHistory already instantiated");Kk=!0,this.state=0,this.dataArr=[],this.listeners=[],this.pauseStack=0,this.maxState=-1,this.actionNumber=-1}return ik.default(e,[{key:"broadcast",value:function(e){var t=this;setTimeout((function(){for(var n=0;n<t.listeners.length;n++)t.listeners[n](e);t.state++}),1)}},{key:"pause",value:function(e){!1===e?this.pauseStack=Math.max(0,this.pauseStack-1):this.pauseStack++}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"push",value:function(e){if(!(this.pauseStack>0)){for(;this.actionNumber<this.dataArr.length-1;)this.dataArr.pop();var t=this.dataArr[this.dataArr.length-1];if("layerOpacity"===e.action&&t&&"layerOpacity"===t.action&&t.params[0]===e.params[0])return this.dataArr[this.dataArr.length-1]=e,void this.state++;if("focusLayer"===e.action&&t&&"focusLayer"===t.action)return this.dataArr[this.dataArr.length-1]=e,void this.state++;this.dataArr[this.dataArr.length]=e,this.actionNumber=this.dataArr.length-1;var n=this.maxState;this.maxState=Math.max(this.maxState,this.actionNumber-this.max),n<this.maxState?this.broadcast({bufferUpdate:this.dataArr[this.maxState]}):this.broadcast(null),this.maxState>=0&&(this.dataArr[this.maxState]=null)}}},{key:"undo",value:function(){var e;if(this.canUndo()){e=[];for(var t=this.maxState+1;t<this.actionNumber;t++)e.push(this.dataArr[t]);this.actionNumber--,this.broadcast(null)}return e}},{key:"redo",value:function(){var e=[];return this.canRedo()&&(this.actionNumber++,e.push(this.dataArr[this.actionNumber]),this.broadcast(null)),e}},{key:"getAll",value:function(){return[].concat(this.dataArr)}},{key:"canRedo",value:function(){return this.actionNumber<this.dataArr.length-1}},{key:"canUndo",value:function(){return this.actionNumber>this.maxState}},{key:"getState",value:function(){return this.state}},{key:"getActionNumber",value:function(){return this.actionNumber+1}}]),e}(),Zk=new Jk;a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var Qk,$k=new(function(){"use strict";function e(){rk.default(this,e),this.listeners=[],this.count=0}return ik.default(e,[{key:"emit",value:function(){var e=this;this.listeners.forEach((function(t){t(e.count)}))}},{key:"increase",value:function(e){void 0!==e?this.count+=e:this.count++,this.emit()}},{key:"decrease",value:function(e){void 0!==e?this.count-=e:this.count--,this.emit()}},{key:"get",value:function(){return this.count}},{key:"subscribe",value:function(e){this.listeners.push(e)}}]),e}());Qk=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("l7FYj");var eE;eE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("kbyFQ");var tE=a("4gaLD");a("4gaLD");o=a("1ELdT");var nE=t(JSON.parse('{"switch-ui-left-right":"Switch left/right UI","toggle-show-tools":"Show/Hide Tools","scroll":"Scroll","donate":"Donate","home":"Home","modal-new-tab":"Open in new tab","tab-layers":"Layers","tab-edit":"Edit","tab-file":"File","tool-brush":"Brush","tool-paint-bucket":"Paint Bucket","tool-shape":"Shape","tool-text":"Text","tool-hand":"Hand Tool","tool-zoom":"Zoom","tool-undo-redo":"Undo / Redo","undo":"Undo","redo":"Redo","brush-pen":"Pen","brush-blend":"Blend","brush-sketchy":"Sketchy","brush-pixel":"Pixel","brush-chemy":"Chemy","brush-smudge":"Smudge","brush-size":"Size","brush-blending":"Blending","brush-toggle-pressure":"Toggle Pressure Sensitivity","brush-lock-alpha":"Lock Alpha","brush-lock-alpha-title":"Locks layer\'s alpha channel","brush-pen-circle":"Circle","brush-pen-chalk":"Chalk","brush-pen-calligraphy":"Calligraphy","brush-pen-square":"Square","brush-sketchy-scale":"Scale","brush-pixel-dither":"Dither","brush-chemy-fill":"Fill","brush-chemy-stroke":"Stroke","brush-chemy-mirror-x":"Horizontal Symmetry","brush-chemy-mirror-y":"Vertical Symmetry","brush-chemy-gradient":"Gradient","brush-eraser-transparent-bg":"Transparent Background","stabilizer":"Stabilizer","stabilizer-title":"Stroke Stabilizer","eyedropper":"Eyedropper","secondary-color":"Secondary Color","manual-color-input":"Manual Color Input","mci-hex":"Hex","mci-copy":"Copy","modal-ok":"Ok","modal-cancel":"Cancel","modal-close":"Close","layers-active-layer":"Active Layer","layers-layer":"Layer","layers-copy":"copy","layers-blending":"Blending","layers-new":"New Layer","layers-remove":"Remove Layer","layers-duplicate":"Duplicate Layer","layers-merge":"Merge with layer below","layers-rename":"Rename","layers-blend-normal":"normal","layers-blend-darken":"darken","layers-blend-multiply":"multiply","layers-blend-color-burn":"color burn","layers-blend-lighten":"lighten","layers-blend-screen":"screen","layers-blend-color-dodge":"color dodge","layers-blend-overlay":"overlay","layers-blend-soft-light":"soft light","layers-blend-hard-light":"hard light","layers-blend-difference":"difference","layers-blend-exclusion":"exclusion","layers-blend-hue":"hue","layers-blend-saturation":"saturation","layers-blend-color":"color","layers-blend-luminosity":"luminosity","layers-rename-title":"Rename Layer","layers-rename-name":"Name","layers-rename-clear":"Clear Name","layers-rename-sketch":"Sketch","layers-rename-colors":"Colors","layers-rename-lines":"Lines","layers-rename-foreground":"Foreground","layers-merge-modal-title":"Merge/Mix Layers","layers-merge-description":"Merges the selected layer with the one underneath. Select the mix mode:","file-no-autosave":"No autosave, no cloud storage","file-new":"New","file-import":"Import","file-save":"Save","file-save-png":"Save PNG","file-save-psd":"Save PSD","file-save-layers":"Save Layers","file-copy":"Copy","file-copy-title":"Copy To Clipboard","file-share":"Share","file-storage":"Browser Storage","file-storage-thumb-title":"Restores when reopening page","file-storage-about":"About Browser Storage","file-storage-cant-access":"Can\'t access","file-storage-empty":"Empty","file-storage-store":"Store","file-storage-clear":"Clear","file-storage-storing":"Storing","file-storage-overwrite":"Overwrite","file-storage-min-ago":"{x}min ago","file-storage-hours-ago":"{x}h ago","file-storage-days-ago":"{x}d ago","file-storage-month-ago":"> 1month ago","file-storage-restored":"Restored from Browser Storage","file-storage-stored":"Stored to Browser Storage","file-storage-failed":"Failed to store to Browser Storage","file-storage-failed-1":"Failed to store. Possible causes:","file-storage-failed-2":"Out of disk space","file-storage-failed-3":"Storage disabled in incognito tab","file-storage-failed-4":"Browser doesn\'t support storage","file-storage-failed-clear":"Failed to clear.","file-upload":"Upload","cleared-layer":"Cleared layer","filled":"Filled","new-title":"New Image","new-current":"Current","new-fit":"Fit","new-oversize":"Oversize","new-square":"Square","new-landscape":"Landscape","new-portrait":"Portrait","new-screen":"Screen","new-video":"Video","new-din-paper":"DIN Paper","new-px":"px","new-ratio":"Ratio","upload-title":"Upload to Imgur","upload-link-notice":"Anyone with the link to your uploaded image will be able to view it.","upload-name":"Title","upload-title-untitled":"Untitled","upload-caption":"Caption","upload-tos":"Terms of Service","upload-tos-2":"for imgur.com","upload-submit":"Upload","upload-uploading":"Uploading...","upload-success":"Upload Successful","upload-failed":"Upload failed.","upload-delete":"To delete your image from Imgur visit:","cropcopy-title-copy":"Copy To Clipboard","cropcopy-title-crop":"Crop","cropcopy-btn-copy":"To Clipboard","cropcopy-copied":"Copied.","cropcopy-btn-crop":"Apply Crop","crop-drag-to-crop":"Drag to crop","filter-crop-extend":"Crop/Extend","filter-flip":"Flip","filter-perspective":"Perspective","filter-resize":"Resize","filter-rotate":"Rotate","filter-transform":"Transform","filter-bright-contrast":"Bright/Contrast","filter-curves":"Curves","filter-hue-sat":"Hue/Saturation","filter-invert":"Invert","filter-tilt-shift":"Tilt Shift","filter-to-alpha":"To Alpha","filter-triangle-blur":"Triangle Blur","filter-unsharp-mask":"Unsharp Mask","filter-crop-title":"Crop / Extend","filter-crop-description":"Crop or extend the image.","filter-crop-left":"Left","filter-crop-right":"Right","filter-crop-top":"Top","filter-crop-bottom":"Bottom","filter-crop-rule-thirds":"Rule of Thirds","filter-crop-fill":"Fill","filter-flip-title":"Flip","filter-flip-description":"Flips layer or whole image.","filter-flip-horizontal":"Horizontal","filter-flip-vertical":"Vertical","filter-flip-image":"Flip Image","filter-flip-layer":"Flip Layer","filter-perspective-title":"Perspective","filter-perspective-description":"Transforms the selected layer.","filter-perspective-before":"Before","filter-perspective-after":"After","filter-resize-title":"Resize","filter-resize-description":"Resizes the image.","filter-rotate-title":"Rotate","filter-rotate-description":"Rotates the image.","filter-transform-empty":"Layer is empty.","filter-transform-title":"Transform","filter-transform-description":"Transforms selected layer. Hold Shift for additional behavior.","filter-transform-rotation":"Rotation","filter-transform-flip":"Flip","filter-transform-center":"Center","filter-transform-constrain":"Constrain","filter-transform-snap":"Snap","filter-transform-snap-title":"Snap Rotation And Position","filter-bright-contrast-title":"Brightness / Contrast","filter-bright-contrast-description":"Change brightness and contrast for the selected layer.","filter-bright-contrast-brightness":"Brightness","filter-bright-contrast-contrast":"Contrast","filter-curves-title":"Curves","filter-curves-description":"Apply curves on the selected layer.","filter-curves-all":"All","filter-hue-sat-title":"Hue / Saturation","filter-hue-sat-description":"Change hue and saturation for the selected layer.","filter-hue-sat-hue":"Hue","filter-hue-sat-saturation":"Saturation","filter-applied":"applied","filter-tilt-shift-title":"Tilt Shift","filter-tilt-shift-description":"Applies tilt shift on the selected layer.","filter-tilt-shift-blur":"Blur Radius","filter-tilt-shift-gradient":"Gradient Radius","filter-to-alpha-title":"To Alpha","filter-to-alpha-description":"Generates alpha channel for selected layer from:","filter-to-alpha-inverted-lum":"Inverted Luminance","filter-to-alpha-lum":"Luminance","filter-to-alpha-replace":"Replace RGB","filter-triangle-blur-title":"Triangle Blur","filter-triangle-blur-description":"Applies triangle blur on the selected layer.","filter-unsharp-mask-title":"Unsharp Mask","filter-unsharp-mask-description":"Sharpens the selected layer by scaling pixels away from the average of their neighbors.","filter-unsharp-mask-strength":"Strength","import-opening":"Opening file...","import-title":"Import Image","import-too-large":"Image too large, will be downscaled.","import-btn-as-layer":"As Layer","import-btn-as-image":"As Image","import-as-layer-title":"Import Image as New Layer","import-as-layer-description":"Adjust the position of the imported image.","import-as-layer-limit-reached":"Layer limit reached. Image will be placed on existing layer.","import-as-layer-fit":"Fit","import-flatten":"Flatten image","import-unsupported-file":"Unsupported file type. See Help for supported types.","import-broken-file":"Couldn\'t load image. File might be corrupted.","import-psd-unsupported":"Unsupported features. PSD had to be flattened.","import-psd-limited-support":"PSD support is limited. Flattened will more likely look correct.","import-psd-too-large":"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.","import-psd-size":"Image size","hand-reset":"Reset","hand-fit":"Fit","bucket-tolerance":"Tolerance","bucket-sample":"Sample","bucket-sample-title":"Which layers to sample color from","bucket-sample-all":"All","bucket-sample-active":"Active","bucket-sample-above":"Above","bucket-grow":"Grow","bucket-grow-title":"Grow filled area (in pixels)","bucket-contiguous":"Contiguous","bucket-contiguous-title":"Only fill connected areas","shape-stroke":"Stroke","shape-fill":"Fill","shape-rect":"Rectangle","shape-ellipse":"Ellipse","shape-line":"Line","shape-line-width":"Line Width","shape-outwards":"Outwards","shape-fixed":"Fixed 1:1","shape-snap":"Snap","shape-snap-title":"45° Angle Snapping","text-instruction":"Click canvas to place text","text-title":"Add Text","text-placeholder":"Your text (multiline Shift+Enter)","text-color":"Color","text-size":"Size","text-left":"Left","text-center":"Center","text-right":"Right","text-italic":"Italic","text-bold":"Bold","save-reminder-title":"Reminder to save","save-reminder-text":"Unsaved work may get lost.","submit":"Submit","submit-title":"Submit Drawing","submit-prompt":"Submit drawing?","submit-submitting":"Submitting","embed-init-loading":"Loading app","embed-init-waiting":"Waiting for image","unsaved":"Unsaved","help":"Help","tab-settings":"Settings","settings-language":"Language","settings-preferred-language":"Preferred Language","settings-language-reload":"Will update after reloading.","licenses":"Licenses","source-code":"Source Code","auto":"auto","zoom-in":"Zoom In","zoom-out":"Zoom Out","radius":"Radius","constrain-proportions":"Constrain Proportions","width":"Width","height":"Height","opacity":"Opacity","red":"Red","green":"Green","blue":"Blue","eraser":"Eraser","center":"Center","background":"Background","scaling-algorithm":"Scaling Algorithm","algorithm-smooth":"Smooth","algorithm-pixelated":"Pixelated","preview":"Preview"}')),rE=[{code:"en",name:"English"},{code:"de",name:"Deutsch"},{code:"ja",name:"日本語"},{code:"zh-CN",name:"简体中文"}],iE=o.default(t(s).mark((function e(n){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en"!==n){e.next=4;break}return e.abrupt("return",nE);case 4:if("de"!==n){e.next=10;break}return e.next=7,a("iPIW6");case 7:case 13:case 19:return e.abrupt("return",e.sent);case 10:if("ja"!==n){e.next=16;break}return e.next=13,a("hb3Ll");case 16:if("zh-CN"!==n){e.next=20;break}return e.next=19,a("fW7LR");case 20:throw new Error("unknown language code");case 21:case"end":return e.stop()}}),e)}))),aE="klecks-language",oE=function(){"use strict";function e(){tE.classCallCheck(this,e),this.listeners=[],this.data=tE.objectSpread({},nE),this.code="en"}return tE.createClass(e,[{key:"setLanguage",value:function(e){return tE.asyncToGenerator(t(s).mark((function n(){return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("en"!==e){t.next=4;break}this.data=tE.objectSpread({},nE),t.next=11;break;case 4:return t.t0=tE,t.t1={},t.t2=nE,t.next=9,iE(e);case 9:t.t3=t.sent,this.data=t.t0.objectSpread.call(t.t0,t.t1,t.t2,t.t3);case 11:this.code=e,document.documentElement.setAttribute("lang",e),this.listeners.forEach((function(e){e()}));case 14:case"end":return t.stop()}}),n,this)})).bind(this))()}},{key:"get",value:function(e){if(!(e in this.data))throw new Error("translation code doesn't exist: "+e);return this.data[e]}},{key:"getLanguage",value:function(){var e=this;return rE.find((function(t){return t.code===e.code}))}},{key:"getCode",value:function(){return this.code}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}}]),e}(),sE="en",lE=function(e){var t=cE[e];if(rE.find((function(e){return e.code.toLowerCase()===t.toLowerCase()})))return sE=t,"break"},cE=[];(navigator.languages?navigator.languages:[navigator.language]).forEach((function(e){var t=e.split("-");cE.push(e),2===t.length&&cE.push(t[0])}));try{localStorage.getItem(aE)&&cE.unshift(localStorage.getItem(aE))}catch(e){}for(var uE=0;uE<cE.length;uE++){if("break"===lE(uE))break}var hE=new oE,dE=function(e,t){if(t){var n=hE.get(e);return Object.keys(t).forEach((function(e){n=n.replace("{".concat(e,"}"),t[e])})),n}return hE.get(e)};function pE(e){var n=function(t){r||(r=!0,Gk.clearSelection(),document.body.removeChild(i),$k.decrease(),Gk.destroyEl(l),Gk.destroyEl(s),h.destroy(),Gk.removeEventListener(a,"wheel",d),a.onclick=null,v.forEach((function(e){Gk.destroyEl(e)})),v.splice(0,v.length),e.callback&&e.callback(t))};$k.increase();var r=!1,i=Gk.el({parent:document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",overflow:"hidden"}}),a=Gk.el({parent:i,className:"kl-popup"}),o=Gk.el({parent:a,css:{width:"100%",minHeight:"100%",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}),s=Gk.el({parent:o,onClick:function(){e.ignoreBackground||n("Cancel")},css:{position:"absolute",left:"0",top:"0",zIndex:"0",width:"100%",height:"100%"}}),l=Gk.el({tagName:"button",className:"popup-x",content:'<img alt="'.concat(dE("modal-close"),'" height="20" src="').concat(t(eE),'">'),title:dE("modal-close"),onClick:function(){n("Cancel")},css:{width:"40px",height:"40px",lineHeight:"40px",position:"absolute",right:"0",top:"0",background:"none",boxShadow:"none"}}),c=["kl-popup-box"];c.push("kl-popup-box--sm");var u=Gk.el({content:[l,Gk.el({content:e.message,css:{marginBottom:e.div?"10px":null,marginRight:"15px"}}),e.div],className:c.join(" "),css:e.style?e.style:null});o.append(Gk.el({css:{flex:"0.5"}}),u,Gk.el({css:{flex:"1"}})),"error"===e.type&&Gk.addClassName(u,"poperror"),"ok"===e.type&&Gk.addClassName(u,"popok"),"warning"===e.type&&Gk.addClassName(u,"popwarning"),"upload"===e.type&&Gk.addClassName(u,"popupload");var h=new Gk.KeyListener({onDown:function(e,t,i){r||(f&&"enter"===i&&!Gk.isInputFocused()&&(t.stopPropagation(),setTimeout((function(){f.click()}),10)),"esc"===i&&(t.stopPropagation(),n("Cancel")))}}),d=function(e){h.isPressed("ctrl")&&e.preventDefault()};Gk.addEventListener(a,"wheel",d),a.onclick=Gk.handleClick;var p=null;p=e.autoFocus?e.autoFocus:!1===e.autoFocus?null:"Ok";var f,g=e.buttons&&e.buttons.length>0?Gk.el({parent:u,css:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginTop:"12px",marginLeft:"-8px"}}):null,v=[];e.buttons&&e.buttons.forEach((function(r){var i,o=["kl-popup__btn"];("Ok"===r||e.primaries&&e.primaries.includes(r))&&o.push("kl-button-primary");var s=r;"Ok"===r&&(s=dE("modal-ok"),i=t(Qk)),"Cancel"===r&&(s=dE("modal-cancel"),i=t(eE));var l=null;i&&(l=Gk.el({tagName:"img",custom:{src:i,height:"17"}}));var c=Gk.el({parent:g,tagName:"button",className:o.join(" "),content:[l,s],onClick:function(){n(r)}});v.push(c),p===r&&(setTimeout((function(){c.focus(),a.scrollTo(0,0)}),10),setTimeout((function(){a.scrollTo(0,0)}),20)),r===e.clickOnEnter&&(f=c)})),e.closefunc&&e.closefunc((function(){n("Cancel")}))}window.onscroll=function(e){e.preventDefault()};var fE=function(e){var n=function(){$k.decrease(),a.onclick=null,i.removeChild(a),clearInterval(undefined),window.removeEventListener("resize",r),h.destroy(),Gk.destroyEl(c),Gk.destroyEl(o),e.onClose&&e.onClose()},r=function(){var e=s.offsetWidth,t=s.offsetHeight;Gk.css(s,{left:Math.max(0,(window.innerWidth-e)/2)+"px",top:Math.max(20,(window.innerHeight-t)/2-.2*t)+"px"})};$k.increase();var i=document.body,a=Gk.el({parent:i,className:"g-root",css:{position:"fixed",left:"0",top:"0",bottom:"0",right:"0",background:"rgba(0, 0, 0, 0.45)",overflow:"auto",animationName:"consoleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"}});a.onclick=Gk.handleClick;var o=Gk.el({parent:a,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"},onClick:n}),s=Gk.el({parent:a,css:{position:"absolute",width:Gk.isCssMinMaxSupported()?"min(calc(100% - 40px), "+(e.width?e.width:400)+"px)":(e.width?e.width:400)+"px",height:"calc(100% - 40px)",background:"#eee",borderRadius:"10px",overflow:"hidden",boxShadow:"rgba(0, 0, 0, 0.25) 0px 5px 60px"}});r(),window.addEventListener("resize",r);var l=Gk.el({parent:s,css:{height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"20px"}});e.title&&l.appendChild(e.title);var c=Gk.el({parent:l,tagName:"button",className:"popup-x",content:'<img alt="'.concat(dE("modal-close"),'" height="20" src="').concat(t(eE),'">'),title:dE("modal-close"),onClick:n,css:{width:"40px",height:"40px",lineHeight:"40px",background:"none",boxShadow:"none"},custom:{tabindex:"0"}}),u=Gk.el({parent:s,css:{height:"calc(100% - 40px)"}});e.content&&u.appendChild(e.content);var h=new Gk.KeyListener({onDown:function(e,t){"esc"===e&&(t.stopPropagation(),n())}});this.close=function(){n()}};a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var gE=function(){"use strict";function e(t){var n=this;rk.default(this,e),this.element=Gk.el({className:"kl-checkbox"});var r=Gk.el({parent:this.element,tagName:"label",className:"kl-checkbox__inner"});this.check=Gk.el({parent:r,tagName:"input",css:{marginLeft:"0",display:"inline-block"},custom:{type:"checkbox"}}),this.check.checked=t.init,t.doHighlight&&this.check.checked&&Gk.addClassName(this.element,"kl-checkbox--highlight"),t.allowTab||(this.check.tabIndex=-1),t.title&&(r.title=t.title);var i=document.createElement("div");i.style.display="inline-block",i.innerHTML=t.label,i.allowClick=!0,r.appendChild(i),this.check.onchange=function(){var e=n;t.doHighlight&&(n.check.checked?Gk.addClassName(n.element,"kl-checkbox--highlight"):Gk.removeClassName(n.element,"kl-checkbox--highlight")),t.callback(n.check.checked),setTimeout((function(){e.check.blur()}),0)},t.css&&Gk.css(this.element,t.css)}return ik.default(e,[{key:"getValue",value:function(){return this.check.checked}},{key:"getElement",value:function(){return this.element}},{key:"destroy",value:function(){this.check.onchange=null}}]),e}(),vE=function(e){var t=document.createElement("input");if(e.type)try{t.type=e.type}catch(e){}else t.type="text";return void 0!==e.min&&(t.min=""+e.min),void 0!==e.max&&(t.max=""+e.max),t.value=""+e.init,e.callback&&(t.onchange=function(){e.callback(t.value)}),e.css&&Gk.css(t,e.css),t};a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var mE,yE=function(){"use strict";function e(t){var n=this;rk.default(this,e),this.destroy=function(){n.selectEl.removeEventListener("change",n.changeListener)},this.selectEl=Gk.el({tagName:"select",title:t.title,css:{cursor:"pointer",fontSize:"15px",padding:"3px",background:"#fff",colorScheme:"only light"}}),t.css&&Gk.css(this.selectEl,t.css);var r=t.isFocusable;r||(this.selectEl.tabIndex=-1),this.optionArr=t.optionArr;for(var i=0;i<this.optionArr.length;i++)if(null!==this.optionArr[i]){var a=document.createElement("option");a.value=this.optionArr[i][0],a.textContent=this.optionArr[i][1],this.selectEl.append(a)}this.onChange=t.onChange,this.changeListener=function(e){r||n.selectEl.blur(),n.onChange(n.selectEl.value)},this.selectEl.addEventListener("change",this.changeListener),this.selectEl.value="initValue"in t?t.initValue:null}return ik.default(e,[{key:"setValue",value:function(e){this.selectEl.value=e}},{key:"getValue",value:function(){return this.selectEl.value}},{key:"setDeltaValue",value:function(e){for(var t=0,n=0;n<this.optionArr.length;n++)if(""+this.optionArr[n][0]===this.selectEl.value){t=n;break}t=Math.max(0,Math.min(this.optionArr.length-1,t+e)),this.selectEl.value=this.optionArr[t][0],this.onChange(this.selectEl.value)}},{key:"getElement",value:function(){return this.selectEl}}]),e}(),xE=function(e){var t=function(){n?Gk.addClassName(r,"image-toggle-active"):Gk.removeClassName(r,"image-toggle-active")},n=!!e.initValue,r=Gk.el({className:"image-toggle",title:e.title,css:{backgroundImage:"url('"+e.image+"')"},onClick:function(r){r.preventDefault(),e.isRadio&&n||(n=!n,t(),e.onChange(n))}});t(),this.setValue=function(e){n=!!e,t()},this.getElement=function(){return r},this.getValue=function(){return n}},bE=function(e){for(var t,n=function(n,a){a.id===e.initId&&(t=n);var o=new xE({image:a.image,title:a.title,initValue:a.id===e.initId,isRadio:!0,onChange:function(){!function(n,r){t=n;for(var a=0;a<i.length;a++)i[a].setValue(a===t);e.onChange(r)}(n,a.id)}});return r.appendChild(o.getElement()),o},r=Gk.el({className:"image-radio-wrapper",css:{display:"flex"}}),i=[],a=0;a<e.optionArr.length;a++)i.push(n(a,e.optionArr[a]));this.getElement=function(){return r},this.getValue=function(){return e.optionArr[t].id}};mE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("5H9IS");var wE,CE=function(e,n){var r=function(){e?Gk.css(i,{backgroundColor:"#fff",opacity:"0.9",border:"1px solid var(--active-highlight-color)"}):Gk.css(i,{backgroundColor:"transparent",opacity:"0.5",border:"1px solid #666"})},i=Gk.el({css:{cssFloat:"right",borderRadius:"3px",width:"18px",height:"18px",backgroundImage:'url("'+t(mE)+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer",boxSizing:"border-box",colorScheme:"only light"}});return Gk.hasPointerEvents||(i.style.display="none"),i.title=dE("brush-toggle-pressure"),i.onclick=function(){e=!e,r(),n(e)},r(),n(e),i},SE=function(e,t){var n=Math.min(10,1+Math.pow(Math.floor(e/50),2));return t&&(n*=2),1/n},kE=function(e){var t,n=function(e){return u?t.findX(e,Math.floor(1.5*p)):(e-f)/(g-f)},r=function(){c?Gk.css(w,{opacity:null,pointerEvents:null}):Gk.css(w,{opacity:"0.5",pointerEvents:"none"})},i=function(){var e=f+T*(g-f);return u&&(e=t.interpolate(T)),e},a=function(){var e=function(e){var n=f+e*(g-f);return u&&(n=t.interpolate(e)),n}(T);e=(e=y?y(e):parseInt(e)).toLocaleString(hE.getCode()),S.innerHTML=C+'&nbsp;&nbsp;<span style="font-weight:bold">'+e+"</span>",k.style.width=T*h+"px"},o=function(e){if(e||!m)if(x&&!e){var t=performance.now();t-A>=x&&(A=t,v(i()))}else v(i())},s=function(e){if(e.eventPreventDefault(),c){if("pointerdown"===e.type&&(w.className="sliderWrapper sliderWrapperActive","left"===e.button&&(T=e.relX/h,T=Math.max(0,Math.min(1,T)),a(),o(!1)),I=T),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=e.dX,n=Math.abs(e.pageY-e.downPageY);t*=SE(n,"right"===e.button),I+=t/=h,T=Math.max(0,Math.min(1,I)),a(),o(!1)}"pointerup"===e.type&&(w.className="sliderWrapper",o(!0))}},l=this,c=!1!==e.isEnabled,u=!!e.curve;if(!e.label||!e.onChange)throw"PcSlider missing params";if(!(0==e.min||0==e.max||0==e.initValue||e.min&&e.max&&e.initValue))throw"PcSlider broken params";if(e.min>=e.max)throw"PcSlider broken params";var h=e.width,d=e.height,p=e.resolution?e.resolution:h,f=e.min,g=e.max,v=e.onChange,m=!!e.isChangeOnFinal,y=e.formatFunc,x=e.eventResMs;if(u){var b="quadratic"===e.curve?Gk.quadraticSplineInput(f,g,.1):e.curve;t=new Gk.SplineInterpolator(b)}var w=Gk.el({className:"sliderWrapper",css:{overflow:"hidden",position:"relative",width:h+"px",height:d+"px",userSelect:"none"}}),C=e.label,S=document.createElement("div"),k=document.createElement("div"),E=document.createElement("div"),T=n(e.initValue);w.appendChild(k),w.appendChild(S),k.appendChild(E),k.className="sliderInner",w.oncontextmenu=function(){return!1},S.innerHTML=C,k.style.position="absolute",k.style.left="0",k.style.top="0",k.style.width=T*h+"px",k.style.height=d+"px";var M=d-14;Gk.css(S,{position:"absolute",left:"7px",top:d/2-M/2+1+"px",lineHeight:M+"px",fontSize:M+"px",pointerEvents:"none"}),r();var I,R,A=0,L=setTimeout((function(){R=new Gk.PointerListener({target:w,maxPointers:1,fixScribble:!0,onPointer:s,onWheel:function(e){u?(T+=-e.deltaY*(t.getLastX()-t.getFirstX())/40,T=Math.max(t.getFirstX(),Math.min(t.getLastX(),T))):(T+=-e.deltaY/40,T=Math.max(0,Math.min(1,T))),a(),v(i())}}),a()}),1);this.increaseValue=function(e){T=Math.min(1,T+Math.abs(e)),a(),v(i())},this.decreaseValue=function(e){T=Math.max(0,T-Math.abs(e)),a(),v(i())},this.setValue=function(e){T=n(e),a()},this.getValue=function(){return i()},this.update=function(e){if(f=e.min,g=e.max,u=!!e.curve){var n="quadratic"===e.curve?Gk.quadraticSplineInput(f,g,.1):e.curve;t=new Gk.SplineInterpolator(n)}else t=null;l.setIsEnabled(!e.isDisabled)},this.setIsEnabled=function(e){c=!!e,r()},this.destroy=function(){clearTimeout(L),R&&R.destroy()},this.getElement=function(){return w}};wE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("la7yv");var EE,TE=function(e){var n=function(e,t){var n={},o=Gk.el({css:{display:"flex",alignItems:"center",marginTop:"5px"}}),s=Gk.el({content:e,css:{width:"60px"}}),c=vE({init:r[t],min:0,max:255,type:"number",css:{width:"80px"},callback:function(){""===c.value||parseFloat(c.value)<0||parseFloat(c.value)>255?n.update():(c.value=""+Math.round(parseFloat(c.value)),r[t]=c.value,a.style.background="#"+Gk.ColorConverter.toHexString(r),l.value="#"+Gk.ColorConverter.toHexString(r))}});return o.appendChild(s),o.appendChild(c),i.appendChild(o),n.update=function(){c.value=r[t]},n},r=new Gk.RGB(e.color.r,e.color.g,e.color.b),i=Gk.el({}),a=Gk.el({css:{width:"20px",height:"20px",marginBottom:"10px",boxShadow:"inset 0 0 0 1px #fff, 0 0 0 1px #000",background:"#"+Gk.ColorConverter.toHexString(r),colorScheme:"only light"}});i.appendChild(a);var o=Gk.el({css:{display:"flex",alignItems:"center",marginBottom:"15px"}}),s=Gk.el({content:dE("mci-hex"),css:{width:"60px"}}),l=vE({init:"#"+Gk.ColorConverter.toHexString(r),css:{width:"80px"},callback:function(){var e=Gk.ColorConverter.hexToRGB(l.value);null===e?(e=r,l.value="#"+Gk.ColorConverter.toHexString(r)):r=e,a.style.background="#"+Gk.ColorConverter.toHexString(e);for(var t=0;t<u.length;t++)u[t].update()}}),c=Gk.el({tagName:"button",content:'<img src="'+t(wE)+'" height="20"/>',title:dE("mci-copy"),css:{marginLeft:"10px"},onClick:function(){l.select(),document.execCommand("copy")}});o.appendChild(s),o.appendChild(l),o.appendChild(c),i.appendChild(o),setTimeout((function(){l.focus(),l.select()}),0);var u=[];u.push(n(dE("red"),"r")),u.push(n(dE("green"),"g")),u.push(n(dE("blue"),"b")),pE({target:document.body,message:"<b>".concat(dE("manual-color-input"),"</b>"),div:i,autoFocus:!1,clickOnEnter:"Ok",buttons:["Ok","Cancel"],callback:function(t){var n=null;"Ok"===t&&(n=Gk.ColorConverter.hexToRGB(l.value)),e.onClose(n)}})};EE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("cTtMO");var ME=function(e){var t=function(){for(var e=o.getContext("2d"),t=0;t<o.height;t+=1){var n=e.createLinearGradient(0,0,o.width,0),r=Gk.ColorConverter.toRGB(new Gk.HSV(a.h,1,100-t/o.height*100)),i=Gk.ColorConverter.toRGB(new Gk.HSV(a.h,100,100-t/o.height*100));n.addColorStop(0,"#"+Gk.ColorConverter.toHexString(r)),n.addColorStop(1,"#"+Gk.ColorConverter.toHexString(i)),e.fillStyle="#ff0000",e.fillStyle=n,e.fillRect(0,t,o.width,1)}},n=function(){var t=a.s/100*e.width-4,n=(1-a.v/100)*e.heightSV-4;Gk.css(l,{left:t+"px",top:n+"px"})},r=function(){c.style.left=a.h/359.999*e.width-1+"px"},i=document.createElement("div");i.oncontextmenu=function(e){e.preventDefault()};var a=Gk.ColorConverter.toHSV(new Gk.RGB(e.color.r,e.color.g,e.color.b));Gk.css(i,{width:e.width+"px",position:"relative",overflow:"hidden",userSelect:"none"});var o=Gk.canvas(10,10);o.style.width=e.width+"px",o.style.height=e.heightSV+"px",o.style.cursor="crosshair",t();var s=Gk.canvas(e.width,e.heightH);s.style.cursor="ew-resize",function(){for(var t=s.getContext("2d"),n=t.createLinearGradient(0,0,e.width,0),r=0;r<1;r+=.01){var i=Gk.ColorConverter.toRGB(new Gk.HSV(360*r,100,100));n.addColorStop(r,"rgba("+parseInt(""+i.r)+", "+parseInt(""+i.g)+", "+parseInt(""+i.b)+", 1)")}t.fillStyle=n,t.fillRect(0,0,e.width,e.heightH)}(),Gk.css(o,{width:e.width+"px",height:e.heightSV+"px",overflow:"hidden",position:"relative"}),o.style.cssFloat="left",s.style.cssFloat="left",i.appendChild(o),i.appendChild(s);var l=document.createElement("div");Gk.css(l,{width:"8px",height:"8px",borderRadius:"8px",position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 1px #000, inset 0 0 0 1px #fff"}),i.appendChild(l);var c=document.createElement("div");Gk.css(c,{width:"0",height:e.heightH+"px",borderLeft:"1px solid #fff",borderRight:"1px solid #000",position:"absolute",top:e.heightSV+"px",pointerEvents:"none"}),i.appendChild(c),n(),r();var u={h:0,s:0,v:0},h=null,d=new Gk.PointerListener({target:o,maxPointers:1,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&(h=t.pointerId,"left"===t.button?(u.s=t.relX/e.width*100,u.v=100-t.relY/e.heightSV*100,a=new Gk.HSV(a.h,u.s,u.v),n(),e.callback(Gk.ColorConverter.toRGB(a))):(u.s=a.s,u.v=a.v)),"pointermove"===t.type&&["left","right"].includes(t.button)&&h===t.pointerId){var r=1;"right"===t.button&&(r=.5),u.s+=t.dX/e.width*100*r,u.v-=t.dY/e.heightSV*100*r,a=new Gk.HSV(a.h,u.s,u.v),n(),e.callback(Gk.ColorConverter.toRGB(a))}"pointerup"===t.type&&(h=null)}}),p=null,f=new Gk.PointerListener({target:s,maxPointers:1,fixScribble:!0,onPointer:function(n){if("pointerdown"===n.type&&(p=n.pointerId,"left"===n.button?(u.h=n.relX/e.width*359.99,a=new Gk.HSV(u.h,a.s,a.v),t(),r(),e.callback(Gk.ColorConverter.toRGB(a))):u.h=a.h),"pointermove"===n.type&&["left","right"].includes(n.button)&&p===n.pointerId){var i=Math.abs(n.pageY-n.downPageY),o=SE(i,"right"===n.button);u.h+=n.dX/e.width*359.99*o,"right"===n.button&&(u.h=u.h%359.99,u.h<0&&(u.h+=359.99)),u.h=Math.min(359.99,u.h),a=new Gk.HSV(u.h,a.s,a.v),t(),r(),e.callback(Gk.ColorConverter.toRGB(a))}"pointerup"===n.type&&(p=null)}}),g=document.createElement("div");g.style.clear="both",i.appendChild(g),this.setColor=function(e){a=Gk.ColorConverter.toHSV(new Gk.RGB(e.r,e.g,e.b)),t(),n(),r()},this.getColor=function(){return Gk.ColorConverter.toRGB(a)},this.getElement=function(){return i},this.destroy=function(){d.destroy(),f.destroy()},this.end=function(){h=null,p=null}},IE=function(e){var t=function(){o.style.left=i+"px",o.style.boxShadow=s?"0 0 6px rgba(0,0,0,1)":"0 0 3px rgba(0,0,0,0.8)"},n=function(){return i/(e.width-e.pointSize)},r=document.createElement("div");r.style.position="relative";var i,a=Gk.el({}),o=Gk.el({css:{colorScheme:"only light"}});r.appendChild(a),r.appendChild(o);var s=!1;Gk.css(a,{marginTop:parseInt(""+(e.pointSize/2-1))+"px",height:"2px",background:"#aaa",width:e.width+"px"});var l,c,u;Gk.el({parent:o,css:{margin:"-7px 0 0 -7px",width:"calc(100% + 14px)",height:"calc(100% + 7px)"}});i=Gk.clamp(e.init*(e.width-e.pointSize),0,e.width-e.pointSize),Gk.css(o,{position:"absolute",top:"0px",backgroundColor:"#eaeaea",boxShadow:"0 0 3px rgba(0,0,0,0.8)",width:e.pointSize+"px",height:e.pointSize+"px",borderRadius:e.pointSize+"px",cursor:"ew-resize",transition:"box-shadow 0.2s ease-in-out"}),t(),l=new Gk.PointerListener({target:o,fixScribble:!0,onPointer:function(r){"pointerdown"===r.type&&"left"===r.button?(c=!0,s=!0,u=i,t(),r.eventStopPropagation()):"pointermove"===r.type&&"left"===r.button&&(r.eventStopPropagation(),u+=r.dX,i=parseInt(""+Gk.clamp(u,0,e.width-e.pointSize)),t(),e.callback(n(),c,!1),c=!1),"pointerup"===r.type&&(r.eventStopPropagation(),s=!1,t(),e.callback(n(),!1,!0))}}),this.getEl=function(){return r},this.setActive=function(e){o.style.backgroundColor=e?"#fff":"#eaeaea"},this.destroy=function(){l.destroy()}},RE=function(e){for(var t=function(){for(var e=0;e<a.length;e++)a[e].setIsSelected(e===r)},n=Gk.el({content:e.label?e.label:"",css:{display:"flex",alignItems:"center",colorScheme:"only light"}}),r=0,i=[],a=[],o=Gk.createCheckerDataUrl(5),s=0;s<e.colorArr.length;s++){for(var l=e.colorArr[s],c=!1,u=0;u<i.length;u++){var h=i[u];if(null!==h&&null!==l&&(h.r===l.r&&h.g===l.g&&h.b===l.b&&h.a===l.a)){c=!0;break}}c||(i.push(l),"initialIndex"in e&&e.initialIndex===s&&(r=i.length-1))}for(var d=0;d<i.length;d++)!function(s){var l=Gk.el({content:i[s]?"":"X",css:{width:"22px",height:"22px",backgroundColor:i[s]?Gk.ColorConverter.toRgbaStr(i[s]):"transparent",marginLeft:"7px",boxShadow:"0 0 0 1px #aaa",cursor:"pointer",userSelect:"none",textAlign:"center",lineHeight:"23px",color:"#aaa"}});i[s]&&0===i[s].a&&(l.style.backgroundImage="url("+o+")"),l.onclick=function(n){n.preventDefault(),r=s,t(),e.onChange(i[s])},l.setIsSelected=function(e){e?Gk.css(l,{boxShadow:"0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)",pointerEvents:"none"}):Gk.css(l,{boxShadow:"0 0 0 1px #aaa",pointerEvents:""})},n.appendChild(l),a.push(l)}(d);t(),this.getElement=function(){return n},this.destroy=function(){a.forEach((function(e){e.onclick=null})),a.splice(0,a.length)}},AE=function(e){for(var t=function(t){var r={id:t.id,el:null},i=["kl-option"];e.isSmall&&i.push("kl-option--small"),"string"!=typeof t.label&&(i.push("kl-option--custom-el"),Gk.css(t.label,{display:"block",pointerEvents:"none"})),r.el=Gk.el({parent:a,content:t.label,className:i.join(" "),onClick:function(){s!==r.id&&(s=r.id,n(),e.onChange(s))}}),t.title&&(r.el.title=t.title),o.push(r)},n=function(){for(var e=0;e<o.length;e++)o[e].id===s?Gk.addClassName(o[e].el,"kl-option-selected"):Gk.removeClassName(o[e].el,"kl-option-selected")},r=function(){for(var e=0;e<o.length;e++)if(o[e].id===s)return e},i=Gk.el({}),a=Gk.el({parent:i,className:"kl-option-wrapper",css:{display:"flex"}}),o=[],s=("initialId"in e?e.initialId:e.optionArr[0].id),l=0;l<e.optionArr.length;l++)t(e.optionArr[l]);n(),e.changeOnInit&&setTimeout((function(){e.onChange(s)}),0),this.getElement=function(){return i},this.getValue=function(){return s},this.next=function(){s=o[(r()+1)%o.length].id,n(),e.onChange(s)},this.previous=function(){s=o[(o.length+r()-1)%o.length].id,n(),e.onChange(s)},this.destroy=function(){o.forEach((function(e){Gk.destroyEl(e.el)})),o.splice(0,o.length)}};a("4gaLD");var LE;rk=a("5nGP2"),ik=a("8TCpN");LE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("iQ1f0");var PE=function(){"use strict";function e(){rk.default(this,e),this.init()}return ik.default(e,[{key:"updateUiState",value:function(){this.el&&(setTimeout((function(){}),100),"left"===this.uiState?this.el.style.left="271px":this.el.style.removeProperty("left"))}},{key:"init",value:function(){this.el=Gk.el({className:"top-overlay g-root",onClick:Gk.handleClick}),this.isWide&&(this.el.style.width="100%"),this.updateUiState(),this.innerEl=Gk.el({className:"top-overlay-inner"}),this.angleIm=new Image,this.angleIm.src=t(LE),Gk.css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginLeft:"5px",borderRadius:"10px"}),this.innerInnerEl=document.createElement("div"),this.innerInnerEl.style.display="inline-block",this.innerEl.appendChild(this.innerInnerEl),this.innerEl.appendChild(this.angleIm),this.el.appendChild(this.innerEl),document.body.appendChild(this.el),this.el.style.display="none"}},{key:"setWide",value:function(e){this.isWide=!!e,this.el&&(this.isWide?(this.el.style.width="100%",this.el.style.left=""):(this.el.style.removeProperty("width"),this.el.style.left="left"===this.uiState?"271px":""))}},{key:"setUiState",value:function(e){this.uiState=e,this.updateUiState()}},{key:"out",value:function(e,t){var n=this;if(e&&"object"==typeof e?"transform"===e.type?(this.angleIm.style.display="inline-block",this.angleIm.style.transform="rotate("+e.angleDeg+"deg)",e.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.7)":this.angleIm.style.boxShadow="",this.innerInnerEl.innerHTML=Math.round(100*e.scale)+"%"):this.angleIm.style.display="none":"string"==typeof e&&(this.angleIm.style.display="none",this.innerInnerEl.innerHTML=e),t){var r=this;this.innerEl.style.animation="",setTimeout((function(){return r.innerEl.style.animation="top-overlay-pulse 0.5s ease-out"}),20),this.timeout3&&clearTimeout(this.timeout3),this.timeout3=window.setTimeout((function(){return r.innerEl.style.animation=""}),520)}this.timeout&&clearTimeout(this.timeout),this.timeout2&&clearTimeout(this.timeout2),this.el.style.animationName=t?"consoleInFast":"consoleIn",this.el.style.opacity="1",this.timeout=window.setTimeout((function(){var e=n;n.el.style.opacity="0",n.el.style.animationName="consoleOut",n.timeout2=window.setTimeout((function(){e.el.style.display="none",e.timeout2=0}),450),n.timeout=0}),1200),this.el.style.display="flex"}}]),e}();function OE(e){var t,n=function(){t={x:0,y:0,width:e.canvas.width,height:e.canvas.height}},r=function(){c.width=Math.round(t.width),c.height=Math.round(t.height),c.getContext("2d").drawImage(e.canvas,Math.round(-t.x),Math.round(-t.y)),h&&(h.src=c.toDataURL("image/png")),e.onChange&&e.onChange(c.width,c.height)},i=function(){Gk.css(w,{left:y+t.x*g+"px",top:x+t.y*v+"px",width:t.width*g+"px",height:t.height*v+"px"}),e.onChange&&e.onChange(Math.round(t.width),Math.round(t.height))},a=function(t){return{x:Gk.clamp((t.x-y)/g,0,e.canvas.width),y:Gk.clamp((t.y-x)/v,0,e.canvas.height)}},o=function(e,t){var n={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},r={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},i=a(n),o=a(r);return i.x=Math.floor(i.x),i.y=Math.floor(i.y),o.x=Math.ceil(o.x),o.y=Math.ceil(o.y),{x:i.x,y:i.y,width:o.x-i.x,height:o.y-i.y}},s=function(){return 0===t.x&&0===t.y&&t.width===e.canvas.width&&t.height===e.canvas.height},l=document.createElement("div");Gk.css(l,{position:"relative",height:e.height+"px",width:e.width+"px",overflow:"hidden",colorScheme:"only light"}),l.style.position="relative",n();var c=Gk.canvas(),u=c,h=null;e.isNotCopy||(h=new Image,u=h),Gk.css(u,{height:e.height+"px",width:e.width+"px"}),l.appendChild(u),r();var d=Gk.el({css:{width:e.width+"px",height:e.height+"px",position:"absolute",left:"0",top:"0",pointerEvents:"none"}});l.appendChild(d),Gk.createCheckerDataUrl(4,(function(e){d.style.backgroundImage="url("+e+")"}));var p=Gk.fitInto(e.canvas.width,e.canvas.height,e.width-40,e.height-40,1),f=Gk.canvas(Math.round(p.width),Math.round(p.height));f.style.imageRendering="pixelated";var g=f.width/e.canvas.width,v=f.height/e.canvas.height,m=f.getContext("2d");m.imageSmoothingEnabled=!1,m.drawImage(e.canvas,0,0,f.width,f.height),d.appendChild(f);var y=parseInt(""+(e.width-f.width)/2),x=parseInt(""+(e.height-f.height)/2);Gk.css(f,{position:"absolute",left:y+"px",top:x+"px"});var b,w=Gk.el({css:{position:"absolute",boxShadow:"0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000"}});d.appendChild(w),i();var C,S=null,k=!1,E=!1,T=new Gk.PointerListener({target:u,fixScribble:!0,onPointer:function(a){var l,c,u,h,d;"pointerdown"===a.type&&"left"===a.button?(a.eventPreventDefault(),k=!0,b={x:a.relX,y:a.relY},!s()&&(l=b,c=Math.round(y+t.x*g),u=Math.round(x+t.y*v),h=Math.round(t.width*g),d=Math.round(t.height*v),c<=l.x&&l.x<=c+h&&u<=l.y&&l.y<=u+d)?S={x:t.x,y:t.y,width:t.width,height:t.height}:t=o(b,b)):"pointermove"===a.type&&"left"===a.button?(a.eventPreventDefault(),E=!0,S?(t.x=S.x+Math.round((a.relX-b.x)/g),t.y=S.y+Math.round((a.relY-b.y)/v),t.x=Gk.clamp(t.x,0,e.canvas.width-t.width),t.y=Gk.clamp(t.y,0,e.canvas.height-t.height)):t=o(b,{x:a.relX,y:a.relY}),i()):"pointerup"===a.type&&b&&(a.eventPreventDefault(),k=!1,S=null,b=null,0!==t.width&&0!==t.height&&E||(n(),i()),E=!1,C=setTimeout(r,1))}}),M=new Gk.KeyListener({onDown:function(n,a,o){if(!k){var s=!1,l=Math.max(1,1/g),c=M.isPressed("shift");"left"===n&&(c?t.width=Gk.clamp(t.width-l,1,e.canvas.width-t.x):t.x=Gk.clamp(t.x-l,0,e.canvas.width-t.width),s=!0),"right"===n&&(c?t.width=Gk.clamp(t.width+l,1,e.canvas.width-t.x):t.x=Gk.clamp(t.x+l,0,e.canvas.width-t.width),s=!0),"up"===n&&(c?t.height=Gk.clamp(t.height-l,1,e.canvas.height-t.y):t.y=Gk.clamp(t.y-l,0,e.canvas.height-t.height),s=!0),"down"===n&&(c?t.height=Gk.clamp(t.height+l,1,e.canvas.height-t.y):t.y=Gk.clamp(t.y+l,0,e.canvas.height-t.height),s=!0),s&&(a.preventDefault(),i(),clearTimeout(C),C=setTimeout(r,100))}}});this.getEl=function(){return l},this.reset=function(){n(),r(),i()},this.destroy=function(){u.style.removeProperty("width"),u.style.removeProperty("height"),M.destroy(),T.destroy()},this.isReset=function(){return s()},this.getRect=function(){return JSON.parse(JSON.stringify(t))},this.getCroppedImage=function(){return c}}a("4gaLD");o=a("1ELdT");var DE=a("iXkAt");var BE;BE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("1mb1v");var zE;zE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("11KJK");var jE;jE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("floUo");var FE;FE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("kino6");var NE;NE=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hhQeq"),a("4gaLD");var _E,HE;rk=a("5nGP2"),ik=a("8TCpN");function UE(e,t,n,r,i,a){for(var o=n;o<=i;o++)for(var s=r;s<=a;s++)255!==e[s*t+o]&&(e[s*t+o]=254)}function YE(e,t,n,r,i){return _E=n%e+r,HE=Math.floor(n/e)+i,_E<0||HE<0||_E>=e||HE>=t?null:HE*e+_E}function XE(e,t,n,r,i,a,o){return null!==o&&255!==t[o]&&((e[4*o]===i[0]&&e[4*o+1]===i[1]&&e[4*o+2]===i[2]&&e[4*o+3]===i[3]||a>0&&Math.abs(e[4*o]-i[0])<=a&&Math.abs(e[4*o+1]-i[1])<=a&&Math.abs(e[4*o+2]-i[2])<=a&&Math.abs(e[4*o+3]-i[3])<=a)&&(t[o]=255,!0))}function VE(e,t,n,r,i,a,o,s){r=Math.round(r),i=Math.round(i);var l=new Uint8Array(new ArrayBuffer(t*n));return function(e,t,n,r,i,a,o,s,l){var c=[e[4*(a*n+i)],e[4*(a*n+i)+1],e[4*(a*n+i)+2],e[4*(a*n+i)+3]];if(l){var u,h,d=[];for(d.push(a*n+i),t[a*n+i]=255;d.length;)XE(e,t,0,0,c,o,h=YE(n,r,u=d.pop(),-1,0))&&d.push(h),XE(e,t,0,0,c,o,h=YE(n,r,u,1,0))&&d.push(h),XE(e,t,0,0,c,o,h=YE(n,r,u,0,-1))&&d.push(h),XE(e,t,0,0,c,o,h=YE(n,r,u,0,1))&&d.push(h)}else for(var p=0;p<n*r;p++)XE(e,t,0,0,c,o,p);if(0!==s){for(var f=void 0,g=void 0,v=void 0,m=void 0,y=void 0,x=void 0,b=void 0,w=void 0,C=void 0,S=void 0,k=void 0,E=void 0,T=0;T<n;T++)for(var M=0;M<r;M++)255===t[M*n+T]&&(f=T,g=T,v=M,m=M,y=255!==t[M*n+T-1],x=255!==t[(M-1)*n+T-1],b=255!==t[(M-1)*n+T],w=255!==t[(M-1)*n+T+1],C=255!==t[M*n+T+1],S=255!==t[(M+1)*n+T+1],k=255!==t[(M+1)*n+T],E=255!==t[(M+1)*n+T-1],y&&(f=T-s),y&&x&&b&&(f=T-s,v=M-s),b&&(v=Math.min(v,M-s)),b&&w&&C&&(v=Math.min(v,M-s),g=T+s),C&&(g=Math.max(g,T+1*s)),C&&S&&k&&(g=Math.max(g,T+1*s),m=Math.max(m,M+1*s)),k&&(m=Math.max(m,M+1*s)),k&&E&&y&&(f=Math.min(f,T-1*s),m=Math.max(m,M+1*s)),(y||x||b||w||C||S||k||E)&&UE(t,n,Math.max(0,f),Math.max(0,v),Math.min(n-1,g),Math.min(r-1,m)));for(var I=0;I<n*r;I++)254===t[I]&&(t[I]=255)}}(e,l,t,n,r,i,a,o,s),{data:l}}function WE(e,t){if(!["rect","ellipse","line"].includes(t.type))throw new Error("unknown shape");var n=Math.round(t.lineWidth),r=180*t.angleRad/Math.PI;e.save(),t.opacity&&(e.globalAlpha=t.opacity),t.isEraser&&(e.globalCompositeOperation="destination-out"),e.rotate(-t.angleRad),t.fillRgb?e.fillStyle=Gk.ColorConverter.toRgbStr(t.fillRgb):t.strokeRgb&&(e.strokeStyle=Gk.ColorConverter.toRgbStr(t.strokeRgb),e.lineWidth=n);var i=t.x1,a=t.y1,o=t.x2,s=t.y2;if(t.isAngleSnap){var l=Gk.rotate(i,a,t.angleRad/Math.PI*180),c=Gk.rotate(o,s,t.angleRad/Math.PI*180),u=Gk.pointsToAngleDeg(l,c)+90,h=45*Math.round(u/45),d=Gk.rotateAround({x:i,y:a},{x:o,y:s},h-u);o=d.x,s=d.y,(r+h)%90==0&&(Math.round((r-h)/90)%2==0?o=i:s=a)}var p,f,g=i,v=a,m=o-i,y=s-a;if("line"!==t.type&&t.isFixedRatio){var x=Gk.rotate(t.x1,t.y1,t.angleRad/Math.PI*180),b=Gk.rotate(t.x2,t.y2,t.angleRad/Math.PI*180),w=x.x,C=x.y,S=b.x-x.x,k=b.y-x.y;Math.abs(S)<Math.abs(k)?k=Math.abs(S)*(k<0?-1:1):S=Math.abs(k)*(S<0?-1:1),b.x=w+S,b.y=C+k,x=Gk.rotate(x.x,x.y,-t.angleRad/Math.PI*180),b=Gk.rotate(b.x,b.y,-t.angleRad/Math.PI*180),g=i=x.x,v=a=x.y,m=(o=b.x)-i,y=(s=b.y)-a}if(t.isOutwards&&(i=g-=m,a=v-=y,o=g+(m*=2),s=v+(y*=2)),"line"===t.type){var E=Math.round(i),T=Math.round(a),M=Math.round(o),I=Math.round(s),R=Math.floor(i),A=Math.floor(a),L=Math.floor(o),P=Math.floor(s);n%2==0?T===I?(p={x:R,y:T},f={x:L,y:I},R<L?f.x+=1:p.x+=1):E===M?(p={x:E,y:A},f={x:M,y:P},A<P?f.y+=1:p.y+=1):(p={x:i,y:a},f={x:o,y:s}):(p={x:R,y:A},f={x:L,y:P},A===P?(R<L?f.x+=1:p.x+=1,p.y+=.5,f.y+=.5):R===L?(A<P?f.y+=1:p.y+=1,p.x+=.5,f.x+=.5):(p.x=i,p.y=a,f.x=o,f.y=s)),p=Gk.rotate(p.x,p.y,t.angleRad/Math.PI*180),f=Gk.rotate(f.x,f.y,t.angleRad/Math.PI*180),e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(f.x,f.y),e.stroke()}else if("rect"===t.type){var O=Math.floor(i),D=Math.floor(a),B=Math.floor(o),z=Math.floor(s);r%90==0?t.fillRgb?(i%1==0&&(i+=1),a%1==0&&(a+=1),o%1==0&&(o+=1),s%1==0&&(s+=1),p={x:i<o?O:B,y:a<s?D:z},(f={x:Math.ceil((i<o?o:i)-p.x),y:Math.ceil((a<s?s:a)-p.y)}).x=p.x+f.x,f.y=p.y+f.y):n%2==0?(p={x:O,y:D},f={x:B,y:z}):(p={x:O+.5,y:D+.5},f={x:B+.5,y:z+.5}):(p={x:i,y:a},f={x:o,y:s}),p=Gk.rotate(p.x,p.y,t.angleRad/Math.PI*180),(f=Gk.rotate(f.x,f.y,t.angleRad/Math.PI*180)).x=f.x-p.x,f.y=f.y-p.y,t.fillRgb?e.fillRect(p.x,p.y,f.x,f.y):e.strokeRect(p.x,p.y,f.x,f.y)}else p=Gk.rotate(i,a,t.angleRad/Math.PI*180),f=Gk.rotate(o,s,t.angleRad/Math.PI*180),g=p.x,v=p.y,m=f.x-p.x,y=f.y-p.y,e.beginPath(),e.ellipse(g+m/2,v+y/2,Math.abs(m/2),Math.abs(y/2),0,0,2*Math.PI),t.fillRgb?e.fill():e.stroke();e.restore()}function GE(e,t){for(var n=""===t.textStr?" ":t.textStr,r=Gk.el({css:{position:"fixed",left:"0",top:"0",width:"100000px",fontSize:t.size+"px",lineHeight:t.lineHeight?t.lineHeight+"px":"default"}}),i=Gk.el({parent:r,css:{display:"inline-block",textAlign:t.align?t.align:"left",fontFamily:t.font?t.font:"sans-serif",fontSize:t.size+"px",fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",lineHeight:t.lineHeight?t.lineHeight+"px":"default",opacity:"0",pointerEvents:"none"}}),a="",o=0;o<n.length;o++)"\n"!==n[o]?a+=n[o].replace("\t","    "):(i.appendChild(Gk.el({tagName:"span",textContent:a,css:{whiteSpace:"pre"}})),a="",i.appendChild(Gk.el({tagName:"br"})));i.appendChild(Gk.el({tagName:"span",textContent:a,css:{whiteSpace:"pre"}})),document.body.appendChild(r);for(var s={x0:99999999,y0:99999999,x1:0,y1:0},l=0;l<i.children.length;l++){var c=i.children[l];s.x0=Math.min(s.x0,c.offsetLeft),s.y0=Math.min(s.y0,c.offsetTop),s.x1=Math.max(s.x1,c.offsetLeft+c.offsetWidth),s.y1=Math.max(s.y1,c.offsetTop+c.offsetHeight)}var u=e.getContext("2d");u.save();var h=[];t.isItalic&&h.push("italic"),t.isBold&&h.push("bold"),h.push(t.size+"px "+(t.font?t.font:"sans-serif")),u.font=h.join(" "),u.fillStyle=t.color?t.color:"#000";var d=t.x,p=t.y;"right"===t.align&&(d+=-s.x1+s.x0),"center"===t.align&&(d+=(-s.x1+s.x0)/2),u.translate(t.x,t.y),u.rotate(t.angleRad?-t.angleRad:0),u.translate(-t.x,-t.y),u.translate(d,p);for(var f=0;f<i.children.length;f++){var g=i.children[f];u.fillText(g.innerText,g.offsetLeft,g.offsetTop)}return t.isDebug?(u.lineWidth=1,u.strokeRect(0,.85*-t.size,s.x1,s.y1),u.restore(),u.fillRect(t.x-1,t.y-1,2,2)):u.restore(),document.body.removeChild(r),{x:d-t.x,y:p-t.y-.85*t.size,width:s.x1-s.x0,height:s.y1-s.y0}}function KE(e,t){var n=Gk.canvas(Math.max(1,Math.round(e.width*t)),Math.max(1,Math.round(e.height*t))),r=n.getContext("2d");r.save(),t>1&&(r.imageSmoothingEnabled=!1);for(var i=0;i<e.layers.length;i++)0!==e.layers[i].opacity&&(r.globalAlpha=e.layers[i].opacity,r.globalCompositeOperation=e.layers[i].mixModeStr?e.layers[i].mixModeStr:"source-over",r.drawImage(e.layers[i].image,0,0,n.width,n.height));return r.restore(),n}var qE=["source-over","darken","multiply","color-burn","lighten","screen","color-dodge","overlay","soft-light","hard-light","difference","exclusion","hue","saturation","color","luminosity"],JE=16,ZE=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(rk.default(this,e),this.layerNrOffset=n,this.layerCanvasArr=[],this.pickCanvas=Gk.canvas(1,1),this.history=new qk,"copy"in t?(this.width=1,this.height=1):"width"in t&&"height"in t?(this.width=t.width,this.height=t.height):(this.width=1,this.height=1),this.init(this.width,this.height),this.changeListenerArr=[],"copy"in t)this.copy(t.copy);else if("projectObj"in t){var r=[].concat(t.projectObj.layers);if(this.init(t.projectObj.width,t.projectObj.height),!r.length)throw new Error("project.layers needs at least 1 layer");for(var i=0;i<r.length;i++){if(r[i].mixModeStr&&!qE.includes(r[i].mixModeStr))throw new Error("unknown mixModeStr "+r[i].mixModeStr);this.addLayer(),this.layerOpacity(i,r[i].opacity),this.layerCanvasArr[i].name=r[i].name,this.layerCanvasArr[i].mixModeStr=r[i].mixModeStr?r[i].mixModeStr:"source-over",this.layerCanvasArr[i].getContext("2d").drawImage(r[i].image,0,0)}}this.updateIndices()}return ik.default(e,[{key:"init",value:function(e,t){if(!e||!t||isNaN(e)||isNaN(t)||e<1||t<1)throw new Error("init - invalid canvas size");this.width=e,this.height=t}},{key:"emitChange",value:function(){this.changeListenerArr.forEach((function(e){return e()}))}},{key:"updateIndices",value:function(){this.layerCanvasArr.forEach((function(e,t){e.index=t}))}},{key:"setHistory",value:function(e){this.history=e}},{key:"reset",value:function(e){if(!e.width||!e.height||e.width<1||e.height<1||isNaN(e.width)||isNaN(e.height))throw new Error("invalid canvas size");if(this.history.pause(!0),this.width=e.width,this.height=e.height,this.layerCanvasArr.splice(1,Math.max(0,this.layerCanvasArr.length-1)),e.layers)for(var t=0;t<e.layers.length;t++){var n=e.layers[t];this.layerCanvasArr[t]||this.addLayer(),this.layerCanvasArr[t].name=n.name,this.layerCanvasArr[t].width=this.width,this.layerCanvasArr[t].height=this.height,this.layerCanvasArr[t].mixModeStr=n.mixModeStr?n.mixModeStr:"source-over",this.layerCanvasArr[t].getContext("2d").drawImage(n.image,0,0),this.layerOpacity(t,n.opacity)}else this.layerCanvasArr[0].name=e.layerName?e.layerName:dE("layers-layer")+" 1",this.layerCanvasArr[0].width=this.width,this.layerCanvasArr[0].height=this.height,this.layerCanvasArr[0].mixModeStr="source-over",this.layerOpacity(0,1),e.color?this.layerFill(0,e.color):e.image&&this.layerCanvasArr[0].getContext("2d").drawImage(e.image,0,0);return this.updateIndices(),this.history.pause(!1),this.history.push({tool:["canvas"],action:"reset",params:[e]}),this.layerCanvasArr.length-1}},{key:"isLayerLimitReached",value:function(){return this.layerCanvasArr.length>=JE}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(e){if(e.getWidth()<1||e.getHeight()<1||isNaN(e.getWidth())||isNaN(e.getHeight()))throw new Error("invalid canvas size");for(var t=e.getLayers();this.layerCanvasArr.length>t.length;)this.removeLayer(this.layerCanvasArr.length-1);e.getWidth()==this.width&&e.getHeight()==this.height||this.init(e.getWidth(),e.getHeight());for(var n=0;n<t.length;n++)n>=this.layerCanvasArr.length?this.addLayer():(this.layerCanvasArr[n].width=this.width,this.layerCanvasArr[n].height=this.height),this.layerOpacity(n,t[n].opacity),this.layerCanvasArr[n].name=t[n].name,this.layerCanvasArr[n].mixModeStr=t[n].mixModeStr,this.layerCanvasArr[n].getContext("2d").drawImage(t[n].context.canvas,0,0);this.updateIndices()}},{key:"getLayerCount",value:function(){return this.layerCanvasArr.length}},{key:"resize",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth";if(!e||!t||e===this.width&&t===this.height||isNaN(e)||isNaN(t)||e<1||t<1)return!1;if(e=Math.max(e,1),t=Math.max(t,1),"pixelated"===i){var a=(n=Gk.canvas(e,t)).getContext("2d");a.imageSmoothingEnabled=!1;for(var o=0;o<this.layerCanvasArr.length;o++){o>0&&a.clearRect(0,0,e,t);var s=this.layerCanvasArr[o];a.drawImage(s,0,0,e,t),s.width=e,s.height=t;var l=s.getContext("2d");l.drawImage(n,0,0)}}else{if("smooth"!==i)throw new Error("unknown resize algorithm");n=Gk.canvas(),r=Gk.canvas();for(var c=0;c<this.layerCanvasArr.length;c++)Gk.resizeCanvas(this.layerCanvasArr[c],e,t,n,r)}return this.width=e,this.height=t,!0}},{key:"resizeCanvas",value:function(e){var t=Math.round(e.left)+this.width+Math.round(e.right),n=Math.round(e.top)+this.height+Math.round(e.bottom),r=Math.round(e.left),i=Math.round(e.top);if(isNaN(t)||isNaN(n)||t<1||n<1)throw new Error("KlCanvas.resizeCanvas - invalid canvas size");for(var a=0;a<this.layerCanvasArr.length;a++){var o=Gk.canvas(this.width,this.height),s=this.layerCanvasArr[a],l=this.layerCanvasArr[a].getContext("2d");o.getContext("2d").drawImage(s,0,0),this.layerCanvasArr[a].width=t,this.layerCanvasArr[a].height=n,l.save(),0===a&&e.fillColor&&(l.fillStyle=Gk.ColorConverter.toRgbStr(e.fillColor),l.fillRect(0,0,t,n),l.clearRect(r,i,this.width,this.height)),l.drawImage(o,r,i),l.restore()}this.width=t,this.height=n}},{key:"addLayer",value:function(e){if(this.isLayerLimitReached())return!1;var t=Gk.canvas(this.width,this.height);return t.mixModeStr="source-over",void 0===e?(this.layerCanvasArr[this.layerCanvasArr.length]=t,e=Math.max(0,this.layerCanvasArr.length-1)):(this.layerCanvasArr.splice(e+1,0,t),e++),t.name=dE("layers-layer")+" "+(this.layerCanvasArr.length+this.layerNrOffset),this.history.pause(!0),this.layerOpacity(e,1),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"addLayer",params:[e-1]}),e}},{key:"duplicateLayer",value:function(e){if(!this.layerCanvasArr[e]||this.isLayerLimitReached())return!1;var t=Gk.canvas(this.width,this.height);return this.layerCanvasArr.splice(e+1,0,t),t.name=this.layerCanvasArr[e].name+" "+dE("layers-copy"),t.mixModeStr=this.layerCanvasArr[e].mixModeStr,t.getContext("2d").drawImage(this.layerCanvasArr[e],0,0),this.history.pause(!0),this.layerOpacity(e+1,this.layerCanvasArr[e].opacity),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"duplicateLayer",params:[e]}),e+1}},{key:"getLayerContext",value:function(e,t){if(this.layerCanvasArr[e])return this.layerCanvasArr[e].getContext("2d");if(t)return null;throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)")}},{key:"removeLayer",value:function(e){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr.splice(e,1),this.updateIndices(),this.history.push({tool:["canvas"],action:"removeLayer",params:[e]}),Math.max(0,e-1))}},{key:"renameLayer",value:function(e,t){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr[e].name=t,this.history.push({tool:["canvas"],action:"renameLayer",params:[e,t]}),!0)}},{key:"layerOpacity",value:function(e,t){this.layerCanvasArr[e]&&(t=Math.max(0,Math.min(1,t)),this.layerCanvasArr[e].opacity=t,this.history.push({tool:["canvas"],action:"layerOpacity",params:[e,t]}),this.emitChange())}},{key:"moveLayer",value:function(e,t){if(0!==t&&this.layerCanvasArr[e]){var n=this.layerCanvasArr[e];this.layerCanvasArr.splice(e,1);var r=Math.max(0,Math.min(e+t,this.layerCanvasArr.length));return this.layerCanvasArr.splice(r,0,n),this.updateIndices(),this.history.push({tool:["canvas"],action:"moveLayer",params:[e,t]}),r}}},{key:"mergeLayers",value:function(e,t,n){if(this.layerCanvasArr[e]&&this.layerCanvasArr[t]&&e!==t){if(e>t){var r=e;e=t,t=r}var i=this.layerCanvasArr[t].opacity;if(0!==i&&i){var a=this.layerCanvasArr[e].getContext("2d");a.save(),"as-alpha"===n?(Gk.convertToAlphaChannelCanvas(this.layerCanvasArr[t]),a.globalCompositeOperation="destination-in",a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)):(n&&(a.globalCompositeOperation=n),a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)),a.restore(),n&&(a.save(),a.fillStyle="rgba(0,0,0,0.01)",a.fillRect(-.9999999,-.9999999,1,1),a.restore())}return this.updateIndices(),this.history.pause(!0),this.removeLayer(t),this.history.pause(!1),this.history.push({tool:["canvas"],action:"mergeLayers",params:[e,t,n]}),e}}},{key:"rotate",value:function(e){for(;e<0;)e+=360;if((e%=360)%90==0&&0!==e){var t=Gk.canvas();0===e||180===e?(t.width=this.width,t.height=this.height):90!==e&&270!==e||(t.width=this.height,t.height=this.width);for(var n=t.getContext("2d"),r=0;r<this.layerCanvasArr.length;r++)n.clearRect(0,0,t.width,t.height),n.save(),n.translate(t.width/2,t.height/2),n.rotate(e*Math.PI/180),180===e?n.drawImage(this.layerCanvasArr[r],-t.width/2,-t.height/2):90!==e&&270!==e||n.drawImage(this.layerCanvasArr[r],-t.height/2,-t.width/2),this.layerCanvasArr[r].width=t.width,this.layerCanvasArr[r].height=t.height,this.layerCanvasArr[r].getContext("2d").clearRect(0,0,this.layerCanvasArr[r].width,this.layerCanvasArr[r].height),this.layerCanvasArr[r].getContext("2d").drawImage(t,0,0),n.restore();this.width=t.width,this.height=t.height}}},{key:"flip",value:function(e,t,n){if(e||t){var r=Gk.canvas(this.width,this.height);r.width=this.width,r.height=this.height;for(var i=r.getContext("2d"),a=0;a<this.layerCanvasArr.length;a++)(!n&&0!==n||a===n)&&(i.save(),i.clearRect(0,0,r.width,r.height),i.translate(r.width/2,r.height/2),i.scale(e?-1:1,t?-1:1),i.drawImage(this.layerCanvasArr[a],-r.width/2,-r.height/2),i.restore(),this.layerCanvasArr[a].getContext("2d").clearRect(0,0,this.layerCanvasArr[a].width,this.layerCanvasArr[a].height),this.layerCanvasArr[a].getContext("2d").drawImage(r,0,0))}}},{key:"layerFill",value:function(e,t,n){var r=this.layerCanvasArr[e].getContext("2d");r.save(),n&&(r.globalCompositeOperation=n),r.fillStyle="rgba("+t.r+","+t.g+","+t.b+",1)",r.fillRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),r.restore(),r.save(),r.fillStyle="rgba(0,0,0,0.01)",r.fillRect(-.9999999,-.9999999,1,1),r.restore(),this.history.push({tool:["canvas"],action:"layerFill",params:[e,t,n]})}},{key:"floodFill",value:function(e,t,n,r,i,a,o,s,l){if(!(t<0||n<0||t>=this.width||n>=this.height||0===i)){if(a=Math.round(a),!["above","current","all"].includes(o))throw new Error("invalid sampleStr");var c,u,h,d,p,f;if("all"===o){var g=1===this.layerCanvasArr.length?this.layerCanvasArr[0]:this.getCompleteCanvas(1);c=VE((h=(u=g.getContext("2d")).getImageData(0,0,this.width,this.height)).data,this.width,this.height,t,n,a,Math.round(s),l),g=null,u=null,h=null,null,p=(d=this.layerCanvasArr[e].getContext("2d")).getImageData(0,0,this.width,this.height)}else{var v="above"===o?e+1:e;if(v>=this.layerCanvasArr.length)return;c=VE((h=(u=this.layerCanvasArr[v].getContext("2d")).getImageData(0,0,this.width,this.height)).data,this.width,this.height,t,n,a,Math.round(s),l),e!==v&&(u=null,h=null,null),d=e===v?u:this.layerCanvasArr[e].getContext("2d"),p=e===v?h:d.getImageData(0,0,this.width,this.height)}if(f=p.data,1===i)for(var m=0;m<this.width*this.height;m++)255===c.data[m]&&(f[4*m]=r.r,f[4*m+1]=r.g,f[4*m+2]=r.b,f[4*m+3]=255);else for(var y=0;y<this.width*this.height;y++)255===c.data[y]&&(f[4*y]=Gk.mix(f[4*y],r.r,i),f[4*y+1]=Gk.mix(f[4*y+1],r.g,i),f[4*y+2]=Gk.mix(f[4*y+2],r.b,i),f[4*y+3]=Gk.mix(f[4*y+3],255,i));d.putImageData(p,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,p]})}}},{key:"drawShape",value:function(e,t){WE(this.layerCanvasArr[e].getContext("2d"),t),this.history.push({tool:["canvas"],action:"drawShape",params:[e,Gk.copyObj(t)]})}},{key:"text",value:function(e,t){GE(this.layerCanvasArr[e],Gk.copyObj(t)),this.history.push({tool:["canvas"],action:"text",params:[e,Gk.copyObj(t)]})}},{key:"replaceLayer",value:function(e,t){this.layerCanvasArr[e].getContext("2d").putImageData(t,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,t]})}},{key:"clearLayer",value:function(e){var t=this.layerCanvasArr[e].getContext("2d");t.save(),t.clearRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),t.restore(),this.history.push({tool:["canvas"],action:"clearLayer",params:[e]})}},{key:"getLayers",value:function(){return this.layerCanvasArr.map((function(e){return{context:e.getContext("2d"),opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayersFast",value:function(){return this.layerCanvasArr.map((function(e){return{canvas:e,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayerIndex",value:function(e,t){for(var n=0;n<this.layerCanvasArr.length;n++)if(this.layerCanvasArr[n]===e)return n;if(!t)throw new Error("layer not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getLayer",value:function(e,t){if(this.layerCanvasArr[e])return{context:this.layerCanvasArr[e].getContext("2d"),opacity:this.layerCanvasArr[e].opacity,name:this.layerCanvasArr[e].name,id:e};if(!t)throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getColorAt",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var n=this.pickCanvas.getContext("2d");n.save(),n.imageSmoothingEnabled=!1,n.clearRect(0,0,1,1);for(var r=0;r<this.layerCanvasArr.length;r++)n.globalAlpha=this.layerCanvasArr[r].opacity,n.globalCompositeOperation=this.layerCanvasArr[r].mixModeStr,n.drawImage(this.layerCanvasArr[r],-e,-t);n.restore();var i=n.getImageData(0,0,1,1);return new Gk.RGB(i.data[0],i.data[1],i.data[2])}},{key:"getCompleteCanvas",value:function(e){return KE(this.getProject(),e)}},{key:"getProject",value:function(){return{width:this.width,height:this.height,layers:this.layerCanvasArr.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e}}))}}},{key:"addChangeListener",value:function(e){this.changeListenerArr.includes(e)||this.changeListenerArr.push(e)}},{key:"removeChangeListener",value:function(e){for(var t=0;t<this.changeListenerArr.length;t++)if(this.changeListenerArr[t]===e)return void this.changeListenerArr.splice(t,1)}},{key:"setMixMode",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].mixModeStr=t,this.history.push({tool:["canvas"],action:"setMixMode",params:[e,""+t]})}},{key:"setComposite",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].compositeObj=t}}]),e}();function QE(e){if(!e)return dE("layers-blend-normal");var t={"source-over":"layers-blend-normal",darken:"layers-blend-darken",multiply:"layers-blend-multiply","color-burn":"layers-blend-color-burn",lighten:"layers-blend-lighten",screen:"layers-blend-screen","color-dodge":"layers-blend-color-dodge",overlay:"layers-blend-overlay","soft-light":"layers-blend-soft-light","hard-light":"layers-blend-hard-light",difference:"layers-blend-difference",exclusion:"layers-blend-exclusion",hue:"layers-blend-hue",saturation:"layers-blend-saturation",color:"layers-blend-color",luminosity:"layers-blend-luminosity"};if(!(e in t))throw new Error("unknown blend mode");return dE(t[e])}a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var $E=function(){"use strict";function e(t){rk.default(this,e),this.rootElement=Gk.createSvg({elementType:"svg",width:""+t.width,height:""+t.height}),Gk.css(this.rootElement,{position:"absolute",left:"0",top:"0",pointerEvents:"none",userSelect:"none"}),this.brushCircleOuter=Gk.createSvg({elementType:"circle",r:"10",stroke:"rgba(0,0,0,0.7)","stroke-width":"1",fill:"none"}),this.brushCircleInner=Gk.createSvg({elementType:"circle",r:"9",stroke:"rgba(255,255,255,0.7)","stroke-width":"1",fill:"none"}),this.rootElement.append(this.brushCircleOuter,this.brushCircleInner),this.pickerPreviewBorder=Gk.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"22",fill:"none"}),this.pickerPreviewBorder.style.opacity="0",this.pickerPreviewCol=Gk.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"20",fill:"none"}),this.pickerPreviewCol.style.opacity="0",this.rootElement.append(this.pickerPreviewBorder,this.pickerPreviewCol),this.compassSize=30,this.compass=Gk.createSvg({elementType:"g",transform:"translate("+t.width/2+", "+t.height/2+")"}),Gk.css(this.compass,{transition:"opacity 0.25s ease-in-out",opacity:"0"}),this.compassInner=Gk.createSvg({elementType:"g",transform:"rotate(45)"}),this.compassBaseCircle=Gk.createSvg({elementType:"circle",fill:"rgba(0,0,0,0.9)",stroke:"none",cx:"0",cy:"0",r:""+this.compassSize}),this.compassLineCircle=Gk.createSvg({elementType:"circle",fill:"none",stroke:"rgba(255,255,255,0.75)","stroke-width":"1",cx:"0",cy:"0",r:""+.9*this.compassSize}),this.compassUpperTriangle=Gk.createSvg({elementType:"path",fill:"#f00",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,-"+.9*this.compassSize+" z"}),this.compassLowerTriangle=Gk.createSvg({elementType:"path",fill:"#fff",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,"+.9*this.compassSize+" z"}),this.compassInner.append(this.compassBaseCircle,this.compassLineCircle,this.compassUpperTriangle,this.compassLowerTriangle),this.compass.append(this.compassInner),this.rootElement.append(this.compass)}return ik.default(e,[{key:"getElement",value:function(){return this.rootElement}},{key:"setSize",value:function(e,t){this.rootElement.setAttribute("width",""+e),this.rootElement.setAttribute("height",""+t),this.compass.setAttribute("transform","translate("+e/2+", "+t/2+")")}},{key:"updateCursor",value:function(e){"x"in e&&(this.brushCircleOuter.setAttribute("cx",""+e.x),this.brushCircleInner.setAttribute("cx",""+e.x)),"y"in e&&(this.brushCircleOuter.setAttribute("cy",""+e.y),this.brushCircleInner.setAttribute("cy",""+e.y)),"radius"in e&&(this.brushCircleOuter.setAttribute("r",""+Math.max(0,e.radius)),this.brushCircleInner.setAttribute("r",""+Math.max(0,e.radius-1))),"isVisible"in e&&(this.brushCircleOuter.style.opacity=e.isVisible?"1":"0",this.brushCircleInner.style.opacity=e.isVisible?"1":"0")}},{key:"updateColorPreview",value:function(e){if("x"in e&&(this.pickerPreviewCol.setAttribute("cx",""+e.x),this.pickerPreviewBorder.setAttribute("cx",""+e.x)),"y"in e&&(this.pickerPreviewCol.setAttribute("cy",""+e.y),this.pickerPreviewBorder.setAttribute("cy",""+e.y)),"color"in e){this.pickerPreviewCol.setAttribute("stroke",Gk.ColorConverter.toRgbStr(e.color));var t=Gk.testIsWhiteBestContrast(e.color)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";this.pickerPreviewBorder.setAttribute("stroke",t)}"isVisible"in e&&(this.pickerPreviewCol.style.opacity=e.isVisible?"1":"0",this.pickerPreviewBorder.style.opacity=e.isVisible?"1":"0")}},{key:"updateCompass",value:function(e){"angleDeg"in e&&(this.compassInner.setAttribute("transform","rotate("+e.angleDeg+")"),this.compassLineCircle.style.opacity=e.angleDeg%90==0?"1":"0"),"isVisible"in e&&(this.compass.style.opacity=e.isVisible?"1":"0")}}]),e}();a("4gaLD");var eT;rk=a("5nGP2"),ik=a("8TCpN");eT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("1dLwT");var tT;tT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("9wZxU");var nT;nT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hQSEH");var rT;rT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("916ZI");var iT,aT,oT=.0625;(aT=iT||(iT={}))[aT.Draw=0]="Draw",aT[aT.Hand=1]="Hand",aT[aT.HandGrabbing=2]="HandGrabbing",aT[aT.Pick=3]="Pick",aT[aT.Zoom=4]="Zoom",aT[aT.Rotate=5]="Rotate",aT[aT.Rotating=6]="Rotating",aT[aT.Fill=7]="Fill",aT[aT.Text=8]="Text",aT[aT.Shape=9]="Shape";var sT=function(){"use strict";function e(t){var n=this;rk.default(this,e);var r=this;this.rootEl=Gk.el({css:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",cursor:"crosshair",userSelect:"none",colorScheme:"only light"}}),this.klCanvas=t.klCanvas,this.onViewChange=t.onViewChange,this.renderTargetCanvas=Gk.canvas(t.width,t.height),this.renderTargetCtx=this.renderTargetCanvas.getContext("2d"),this.renderWidth=t.width,this.renderHeight=t.height,this.compositeCanvas=Gk.canvas(1,1),this.compositeCtx=this.compositeCanvas.getContext("2d"),this.doResizeCanvas=!1,this.oldTransformObj=null,this.targetTransformObj={x:0,y:0,scale:1,angle:0},this.highResTransformObj={x:0,y:0,scale:1,angle:0},this.renderedTransformObj={x:null,y:null,scale:null,angle:null},this.cursorPos={x:0,y:0},this.usesCssCursor=!1,this.bgVisible=!0,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.svgOverlay=new $E({width:t.width,height:t.height}),Gk.css(this.renderTargetCanvas,{userSelect:"none",pointerEvents:"none"}),Gk.createCheckerDataUrl(8,(function(e){n.renderTargetCanvas.style.background="url("+e+")"})),this.rootEl.appendChild(this.renderTargetCanvas),this.rootEl.appendChild(this.svgOverlay.getElement()),Gk.addEventListener(this.rootEl,"touchend",(function(e){return e.preventDefault(),!1})),Gk.addEventListener(this.rootEl,"contextmenu",(function(e){return e.preventDefault(),!1})),Gk.addEventListener(this.rootEl,"dragstart",(function(e){return e.preventDefault(),!1})),this.emptyCanvas=Gk.canvas(1,1),this.emptyCanvas.getContext("2d").fillRect(0,0,1,1),this.keyListener=new Gk.KeyListener({onDown:function(e,t,r,i){if("alt"===e&&t.preventDefault(),!i)if(n.currentInputProcessor)n.currentInputProcessor.onKeyDown(e,t,r,i);else{if([iT.Draw,iT.Pick,iT.Fill,iT.Text,iT.Shape].includes(n.globalMode)&&"space"===r)return n.currentInputProcessor=n.inputProcessorObj.spaceHand,void n.currentInputProcessor.onKeyDown(e,t,r,i);if([iT.Draw,iT.Hand,iT.Fill,iT.Text,iT.Shape].includes(n.globalMode)&&"alt"===r)return n.currentInputProcessor=n.inputProcessorObj.altPicker,void n.currentInputProcessor.onKeyDown(e,t,r,i);if(["r","shift+r"].includes(r))return n.currentInputProcessor=n.inputProcessorObj.rotate,void n.currentInputProcessor.onKeyDown(e,t,r,i);if("z"===r)return n.currentInputProcessor=n.inputProcessorObj.zoom,void n.currentInputProcessor.onKeyDown(e,t,r,i)}},onUp:function(e,t,r){n.currentInputProcessor&&n.currentInputProcessor.onKeyUp(e,t,r)}}),this.updateChangeListener(),this.currentMode=iT.Draw,this.globalMode=iT.Draw,this.renderTime=0,this.lastDrawEvent=null,this.linetoolProcessor=new Gk.EventChain.LinetoolProcessor({onDraw:function(e){var r=n,i=function(){var e=r.getRenderedTransform(),t=Gk.Matrix.getIdentity();return t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createScaleMatrix(1/e.scale)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createRotationMatrix(-e.angle)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createTranslationMatrix(-e.x,-e.y))};if("line"===e.type&&!n.lastDrawEvent){var a=i(),o=[e.x1,e.y1,0,1];return o=Gk.Matrix.multiplyMatrixAndPoint(a,o),void(n.lastDrawEvent={x:o[0],y:o[1],pressure:e.pressure1})}if("x"in e||"x0"in e){var s=i();if("x"in e){var l=[e.x,e.y,0,1];l=Gk.Matrix.multiplyMatrixAndPoint(s,l),e.x=l[0],e.y=l[1]}if("x0"in e){e.x0=n.lastDrawEvent.x,e.y0=n.lastDrawEvent.y,e.pressure0=n.lastDrawEvent.pressure;var c=[e.x1,e.y1,0,1];c=Gk.Matrix.multiplyMatrixAndPoint(s,c),e.x1=c[0],e.y1=c[1],n.lastDrawEvent={x:e.x1,y:e.y1,pressure:e.pressure1}}}["down","move"].includes(e.type)&&(n.lastDrawEvent=e),t.onDraw(e)}}),this.pointer=null,this.isDrawing=!1,this.inputProcessorObj={draw:{onPointer:function(e){n.reqFrame(),n.updateCursor(iT.Draw);var t=n.keyListener.getComboStr(),r={scale:n.highResTransformObj.scale};if(r.shiftIsPressed="shift"===t,r.pressure=e.pressure,r.isCoalesced=!!e.isCoalesced,"pointerdown"===e.type)n.isDrawing=!0,r.type="down";else{if(!e.button)return"pointerup"===e.type?(n.isDrawing=!1,r.type="up",n.linetoolProcessor.process(r),void n.resetInputProcessor()):void 0;r.type="move"}r.x=e.relX,r.y=e.relY,n.linetoolProcessor.process(r)},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},fill:{onPointer:function(e){if(n.reqFrame(),n.updateCursor(iT.Fill),"pointerdown"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});t.onFill(Math.floor(r.x),Math.floor(r.y))}else if("pointerup"===e.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},text:{onPointer:function(e){if(n.reqFrame(),n.updateCursor(iT.Text),"pointerdown"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});t.onText(Math.floor(r.x),Math.floor(r.y),n.renderedTransformObj.angle)}else if("pointerup"===e.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},shape:{onPointer:function(e){n.reqFrame(),n.updateCursor(iT.Shape);var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});"pointerdown"===e.type?(n.isDrawing=!0,t.onShape("down",r.x,r.y,n.renderedTransformObj.angle)):"pointermove"===e.type?t.onShape("move",r.x,r.y,n.renderedTransformObj.angle):"pointerup"===e.type&&(n.isDrawing=!1,t.onShape("up",r.x,r.y,n.renderedTransformObj.angle),n.resetInputProcessor())},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},hand:{onPointer:function(e){n.updateCursor(iT.Hand),["left","middle"].includes(e.button)?(n.updateCursor(iT.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0)):"pointerup"===e.type&&n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},spaceHand:{onPointer:function(e){n.updateCursor(iT.Hand),["left","middle"].includes(e.button)&&(n.updateCursor(iT.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0))},onKeyDown:function(e,t,r,i){"space"!==r?n.resetInputProcessor():n.updateCursor(iT.Hand)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},zoom:{onPointer:function(e){if(n.updateCursor(iT.Zoom),"left"===e.button&&!e.isCoalesced&&0!=e.dX){var t=e.pageX-e.relX,r=e.pageY-e.relY;n.internalZoomByStep(e.dX/175,e.downPageX-t,e.downPageY-r),n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})}},onKeyDown:function(e,t,r,i){"z"!==r?n.resetInputProcessor():n.updateCursor(iT.Zoom)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},picker:{onPointer:function(e){if(n.updateCursor(iT.Pick),["left","right"].includes(e.button)&&!e.isCoalesced||"pointerup"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY}),i=n.klCanvas.getColorAt(r.x,r.y);t.onPick(i,"pointerup"===e.type),n.svgOverlay.updateColorPreview({x:e.relX,y:e.relY,color:i,isVisible:"pointerup"!==e.type}),"pointerup"===e.type&&n.resetInputProcessor()}},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},altPicker:{onPointer:function(e){if(n.updateCursor(iT.Pick),["left","right"].includes(e.button)&&!e.isCoalesced||"pointerup"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY}),i=n.klCanvas.getColorAt(r.x,r.y);t.onPick(i,"pointerup"===e.type),n.svgOverlay.updateColorPreview({x:e.relX,y:e.relY,color:i,isVisible:"pointerup"!==e.type})}},onKeyDown:function(e,t,r,i){"alt"!==r?n.resetInputProcessor():n.updateCursor(iT.Pick)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},rotate:{onPointer:function(e){if(n.updateCursor("left"===e.button?iT.Rotating:iT.Rotate),"pointerdown"===e.type&&"left"===e.button)n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj));else if("left"===e.button&&!e.isCoalesced&&n.oldTransformObj){var t=e.pageX-e.relX,r=e.pageY-e.relY,i={x:n.renderWidth/2,y:n.renderHeight/2},a=Gk.Vec2.angle(i,{x:e.downPageX-t,y:e.downPageY-r}),o=Gk.Vec2.angle(i,{x:e.pageX-t,y:e.pageY-r})-a;n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),n.targetTransformObj.angle+=o,n.keyListener.isPressed("shift")&&(n.targetTransformObj.angle=Math.round(n.targetTransformObj.angle/Math.PI*8)*Math.PI/8,o=n.targetTransformObj.angle-n.oldTransformObj.angle),n.targetTransformObj.angle=n.minimizeAngleRad(n.targetTransformObj.angle);var s=Gk.Matrix.getIdentity();s=Gk.Matrix.multiplyMatrices(s,Gk.Matrix.createTranslationMatrix(i.x,i.y)),s=Gk.Matrix.multiplyMatrices(s,Gk.Matrix.createRotationMatrix(o)),s=Gk.Matrix.multiplyMatrices(s,Gk.Matrix.createTranslationMatrix(-i.x,-i.y));var l=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];l=Gk.Matrix.multiplyMatrixAndPoint(s,l),n.targetTransformObj.x=l[0],n.targetTransformObj.y=l[1],n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.transformIsDirty=!0,n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle})}},onKeyDown:function(e,t,r,i){["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(r)?n.updateCursor(iT.Rotate):n.resetInputProcessor()},onKeyUp:function(e,t,r){var i=n.keyListener.getComboStr();["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(i)?n.updateCursor(iT.Rotate):n.resetInputProcessor()}}},this.currentInputProcessor=null,this.angleIsExtraSticky=!1,this.pinchZoomer=new Gk.EventChain.PinchZoomer({onPinch:function(e){if("move"===e.type){n.oldTransformObj||(n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.angleIsExtraSticky=n.targetTransformObj.angle%(Math.PI/2)==0),n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),e.scale=Math.max(oT,Math.min(64,n.targetTransformObj.scale*e.scale))/n.targetTransformObj.scale,n.targetTransformObj.scale*=e.scale,n.targetTransformObj.angle+=e.angleRad,n.targetTransformObj.angle=n.minimizeAngleRad(n.snapAngleRad(n.targetTransformObj.angle,90,n.angleIsExtraSticky?12:4)),n.targetTransformObj.angle%(Math.PI/2)!=0&&(n.angleIsExtraSticky=!1),e.angleRad=n.targetTransformObj.angle-n.oldTransformObj.angle;var t=Gk.Matrix.getIdentity();t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createTranslationMatrix(e.relX,e.relY)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createScaleMatrix(e.scale)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createRotationMatrix(e.angleRad)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createTranslationMatrix(-e.relX,-e.relY)),t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createTranslationMatrix(e.relX-e.downRelX,e.relY-e.downRelY));var r=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];r=Gk.Matrix.multiplyMatrixAndPoint(t,r),n.targetTransformObj.x=r[0],n.targetTransformObj.y=r[1],n.highResTransformObj=Gk.copyObj(n.targetTransformObj),n.onViewChange({changed:["scale","angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle}),n.reqFrame(),n.transformIsDirty=!0,n.lastRenderedState=-1}else"end"===e.type&&(n.oldTransformObj=null)}});var i=function(){var e=JSON.parse(JSON.stringify(n.targetTransformObj));r.fitView(),n.lastRenderedState=-1,n.reqFrame(),e.scale===n.targetTransformObj.scale&&e.angle===n.targetTransformObj.angle||n.onViewChange({changed:["scale","angle"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})};this.mainDoubleTapper=new Gk.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper=new Gk.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper.setAllowedButtonArr(["middle"]),this.twoFingerTap=new Gk.EventChain.NFingerTapper({fingers:2,onTap:function(){t.onUndo()}}),this.threeFingerTap=new Gk.EventChain.NFingerTapper({fingers:3,onTap:function(){t.onRedo()}}),this.pointerEventChain=new Gk.EventChain.EventChain({chainArr:[this.twoFingerTap,this.threeFingerTap,this.mainDoubleTapper,this.middleDoubleTapper,this.pinchZoomer,new Gk.EventChain.OnePointerLimiter,new Gk.EventChain.CoalescedExploder]}),this.pointerEventChain.setChainOut((function(e){if(n.cursorPos.x=e.relX,n.cursorPos.y=e.relY,"pointerup"===e.type&&"touch"===e.pointerType?(n.pointer=null,n.lastRenderedState=-1,n.reqFrame()):(n.pointer||(n.pointer={x:0,y:0}),n.pointer.x=e.relX,n.pointer.y=e.relY),n.currentInputProcessor)n.currentInputProcessor.onPointer(e);else{var t=n.keyListener.getComboStr();n.globalMode===iT.Draw?["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.draw,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(iT.Draw),n.reqFrame()):n.globalMode===iT.Hand?"pointerdown"===e.type&&["left","middle"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):n.updateCursor(iT.Hand):n.globalMode===iT.Pick?"pointerdown"===e.type&&["left","right"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):n.updateCursor(iT.Pick):n.globalMode===iT.Fill?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.fill,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(iT.Fill),n.reqFrame()):n.globalMode===iT.Text?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.text,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(iT.Text),n.reqFrame()):n.globalMode===iT.Shape&&(["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.shape,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(iT.Shape),n.reqFrame()))}})),Gk.addEventListener(this.rootEl,"wheel",(function(e){e.preventDefault()})),setTimeout((function(){var e=n;n.pointerListener=new Gk.PointerListener({target:n.rootEl,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&"middle"===t.button)try{t.eventPreventDefault()}catch(e){}e.pointerEventChain.chainIn(t)},onWheel:function(t){e.isDrawing||(e.reqFrame(),e.internalZoomByStep(-t.deltaY/(e.keyListener.isPressed("shift")?8:2),t.relX,t.relY)&&e.onViewChange({changed:["scale"],angle:e.targetTransformObj.angle,scale:e.targetTransformObj.scale}),e.lastRenderedState=-1)},onEnterLeave:function(t){t||e.isDrawing||(e.pointer=null,e.lastRenderedState=-1)},maxPointers:4})}),1),this.brushRadius=1,this.animationFrameRequested=!1,this.lastRenderedState=-2,this.lastRenderTime=performance.now(),window.requestAnimationFrame((function(){return n.updateLoop()})),this.resetView()}return ik.default(e,[{key:"getRenderedTransform",value:function(){var e=this.renderedTransformObj;return e.x=this.highResTransformObj.x,e.y=this.highResTransformObj.y,e.scale=this.highResTransformObj.scale,e.angle=this.highResTransformObj.angle,e.angle%(Math.PI/2)==0&&e.scale%1==0&&(e.x=Math.round(e.x),e.y=Math.round(e.y)),e}},{key:"updateChangeListener",value:function(){var e=this;this.klCanvas.addChangeListener((function(){e.lastRenderedState=-1,e.reqFrame()}))}},{key:"updateCursor",value:function(e,n){if(e!==this.currentMode||n){var r=this.currentMode;if(this.currentMode=e,this.lastRenderedState=-1,this.currentMode===iT.Draw?this.rootEl.style.cursor="crosshair":this.currentMode===iT.Hand?this.rootEl.style.cursor="grab":this.currentMode===iT.HandGrabbing?this.rootEl.style.cursor="grabbing":this.currentMode===iT.Pick?this.rootEl.style.cursor="url('"+t(eT)+"') 0 15, crosshair":this.currentMode===iT.Zoom?this.rootEl.style.cursor="url('"+t(tT)+"') 7 7, zoom-in":this.currentMode===iT.Rotate?this.rootEl.style.cursor="grab":this.currentMode===iT.Rotating?this.rootEl.style.cursor="grabbing":this.currentMode===iT.Fill?this.rootEl.style.cursor="url('"+t(nT)+"') 1 12, crosshair":this.currentMode===iT.Text?this.rootEl.style.cursor="url('"+t(rT)+"') 1 12, crosshair":this.currentMode===iT.Shape&&(this.rootEl.style.cursor="crosshair"),[iT.Draw,iT.Pick,iT.Fill,iT.Text,iT.Shape].includes(this.globalMode)){var i=[iT.Hand,iT.HandGrabbing].includes(r),a=[iT.Hand,iT.HandGrabbing].includes(this.currentMode);!i&&a&&this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"]),i&&!a&&this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])}this.currentMode!==iT.Pick&&this.svgOverlay.updateColorPreview({isVisible:!1})}}},{key:"internalZoomByStep",value:function(e,t,n){var r=Math.log2(this.targetTransformObj.scale)/Math.abs(e);r+=e>0?1:-1,r=Math.round(r),r*=Math.abs(e);var i=Math.max(oT,Math.min(64,Math.pow(2,r)));if(i===this.targetTransformObj.scale)return!1;var a=i/this.targetTransformObj.scale;this.targetTransformObj.scale=i;var o=Gk.Matrix.getIdentity();o=Gk.Matrix.multiplyMatrices(o,Gk.Matrix.createTranslationMatrix(t,n)),o=Gk.Matrix.multiplyMatrices(o,Gk.Matrix.createScaleMatrix(a)),o=Gk.Matrix.multiplyMatrices(o,Gk.Matrix.createTranslationMatrix(-t,-n));var s=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];return s=Gk.Matrix.multiplyMatrixAndPoint(o,s),this.targetTransformObj.x=s[0],this.targetTransformObj.y=s[1],this.transformIsDirty=!0,!0}},{key:"mixTransformObj",value:function(e,t,n){if(e.angle===t.angle)return e.scale=Gk.mix(e.scale,t.scale,n),e.x=Gk.mix(e.x,t.x,n),e.y=Gk.mix(e.y,t.y,n),void(e.angle=Gk.mix(e.angle,t.angle,n));var r=this.klCanvas.getWidth(),i=this.klCanvas.getHeight(),a=this.canvasToWorkspaceCoord({x:r/2,y:i/2},e),o=this.canvasToWorkspaceCoord({x:r/2,y:i/2},t);e.x=Gk.mix(a.x,o.x,n),e.y=Gk.mix(a.y,o.y,n),e.scale=Gk.mix(e.scale,t.scale,n),e.angle=Gk.mix(e.angle,t.angle,n);var s=this.canvasToWorkspaceCoord({x:-r/2,y:-i/2},e);e.x=s.x,e.y=s.y}},{key:"render",value:function(){this.doResizeCanvas&&(this.doResizeCanvas=!1,this.renderTargetCanvas.width=this.renderWidth,this.renderTargetCanvas.height=this.renderHeight),this.renderContext(this.renderTargetCtx)}},{key:"testBgVisible",value:function(){var e=[[0,0],[this.renderWidth,0],[this.renderWidth,this.renderHeight],[0,this.renderHeight]],t=this.getRenderedTransform(),n=Gk.Matrix.getIdentity();n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createScaleMatrix(1/t.scale)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createRotationMatrix(-t.angle)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createTranslationMatrix(-t.x,-t.y));for(var r=0;r<e.length;r++){var i=[e[r][0],e[r][1],0,1];if(!(0<=(i=Gk.Matrix.multiplyMatrixAndPoint(n,i))[0]&&i[0]<=this.klCanvas.getWidth()&&0<=i[1]&&i[1]<=this.klCanvas.getHeight()))return!0}return!1}},{key:"renderContext",value:function(e){var t=this.klCanvas.getWidth(),n=this.klCanvas.getHeight(),r=this.getRenderedTransform();if(r.scale>=4||1===r.scale&&0===r.angle?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low"),e.save(),this.bgVisible?(e.fillStyle="rgb(158,158,158)",e.fillRect(0,0,this.renderWidth,this.renderHeight)):e.clearRect(0,0,this.renderWidth,this.renderHeight),this.bgVisible){e.save(),e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle),e.imageSmoothingEnabled=!1;e.globalAlpha=.2,e.drawImage(this.emptyCanvas,-1/r.scale,-1/r.scale,t+2/r.scale,n+2/r.scale),e.globalAlpha=1,e.globalCompositeOperation="destination-out",e.drawImage(this.emptyCanvas,0,0,t,n),e.restore()}e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle);for(var i=this.klCanvas.getLayersFast(),a=0;a<i.length;a++)i[a].opacity>0&&(e.globalAlpha=i[a].opacity,e.globalCompositeOperation=i[a].mixModeStr,i[a].canvas.compositeObj?(this.compositeCanvas.width!==i[a].canvas.width||this.compositeCanvas.height!==i[a].canvas.height?(this.compositeCanvas.width=i[a].canvas.width,this.compositeCanvas.height=i[a].canvas.height):this.compositeCtx.clearRect(0,0,this.compositeCanvas.width,this.compositeCanvas.height),this.compositeCtx.drawImage(i[a].canvas,0,0),i[a].canvas.compositeObj.draw(this.compositeCtx),e.drawImage(this.compositeCanvas,0,0,t,n)):e.drawImage(i[a].canvas,0,0,t,n));e.globalAlpha=1,e.restore(),iT.Rotate===this.currentMode||iT.Rotating===this.currentMode?this.svgOverlay.updateCompass({isVisible:!0,angleDeg:r.angle/Math.PI*180}):this.svgOverlay.updateCompass({isVisible:!1})}},{key:"workspaceToCanvasCoord",value:function(e){var t=this.getRenderedTransform(),n=Gk.Matrix.getIdentity();n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createScaleMatrix(1/t.scale)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createRotationMatrix(-t.angle)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createTranslationMatrix(-t.x,-t.y));var r=[e.x,e.y,0,1];return{x:(r=Gk.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"canvasToWorkspaceCoord",value:function(e,t){var n=Gk.Matrix.getIdentity();n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createTranslationMatrix(t.x,t.y)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createRotationMatrix(t.angle)),n=Gk.Matrix.multiplyMatrices(n,Gk.Matrix.createScaleMatrix(t.scale));var r=[e.x,e.y,0,1];return{x:(r=Gk.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"snapAngleRad",value:function(e,t,n){var r=180*e/Math.PI,i=Math.abs(r%t);return Math.min(i,t-i)<=n&&(r=Math.round(r/t)*t),r/180*Math.PI}},{key:"minimizeAngleRad",value:function(e){return(e%=2*Math.PI)>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}},{key:"resetInputProcessor",value:function(){this.currentInputProcessor=null,this.updateCursor(this.globalMode),this.reqFrame(!0)}},{key:"reqFrame",value:function(e){this.animationFrameRequested=!0,e&&(this.lastRenderedState=-1)}},{key:"updateLoop",value:function(){var e=this;window.requestAnimationFrame((function(){return e.updateLoop()}));var t=Zk.getState(),n=this.lastRenderedState<t,r=performance.now(),i=60*(r-this.lastRenderTime)/1e3;this.lastRenderTime=r,(this.animationFrameRequested||n)&&(this.animationFrameRequested=!1,this.checkChange(i))}},{key:"checkChange",value:function(e){var t=Zk.getState(),n=this.lastRenderedState<t||this.highResTransformObj.scale!==this.targetTransformObj.scale||this.highResTransformObj.x!==this.targetTransformObj.x||this.highResTransformObj.y!==this.targetTransformObj.y;if(!this.doAnimateTranslate&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else if((this.highResTransformObj.x===this.targetTransformObj.x||Math.abs(this.highResTransformObj.x-this.targetTransformObj.x)<.5)&&(this.highResTransformObj.y===this.targetTransformObj.y||Math.abs(this.highResTransformObj.y-this.targetTransformObj.y)<.5)&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.doAnimateTranslate=!1,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else{this.reqFrame();var r=Math.min(1,.3*e);this.mixTransformObj(this.highResTransformObj,this.targetTransformObj,r),this.bgVisible=!0,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale})}if(this.pointer&&this.currentMode==iT.Draw&&!this.usesCssCursor?this.svgOverlay.updateCursor({x:this.pointer.x,y:this.pointer.y,isVisible:!0}):this.svgOverlay.updateCursor({isVisible:!1}),n){this.lastRenderedState=t;var i=performance.now();this.render(),this.renderTime=Gk.mix(this.renderTime,performance.now()-i,.05)}}},{key:"getElement",value:function(){return this.rootEl}},{key:"setCanvas",value:function(e){this.klCanvas=e,this.lastDrawEvent=null,this.resetView(),this.updateChangeListener(),this.lastRenderedState=-1,this.reqFrame()}},{key:"setSize",value:function(e,t){var n=this.renderWidth,r=this.renderHeight;e===n&&t===r||(this.doResizeCanvas=!0,this.renderWidth=e,this.renderHeight=t,this.svgOverlay.setSize(e,t),this.targetTransformObj.x+=(e-n)/2,this.targetTransformObj.y+=(t-r)/2,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.bgVisible=this.testBgVisible(),this.lastRenderedState=-1,this.reqFrame())}},{key:"setMode",value:function(e){"draw"===e&&(this.globalMode=iT.Draw,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"fill"===e&&(this.globalMode=iT.Fill,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"text"===e&&(this.globalMode=iT.Text,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"shape"===e&&(this.globalMode=iT.Shape,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"hand"===e&&(this.globalMode=iT.Hand,this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"])),"pick"===e&&(this.globalMode=iT.Pick,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"]))}},{key:"setEnabled",value:function(e){}},{key:"setCursorSize",value:function(e){if(this.brushRadius=e/2,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale}),null===this.pointer){var t=this;clearTimeout(this.hideBrushCursorTimeout),this.svgOverlay.updateCursor({x:this.renderWidth/2,y:this.renderHeight/2,isVisible:!0}),this.hideBrushCursorTimeout=setTimeout((function(){null===t.pointer&&t.svgOverlay.updateCursor({isVisible:!1})}),500)}}},{key:"zoomByStep",value:function(e){this.internalZoomByStep(e,this.renderWidth/2,this.renderHeight/2)&&(this.lastRenderedState=-1,this.reqFrame(),this.onViewChange({changed:["scale"],angle:this.targetTransformObj.angle,scale:this.targetTransformObj.scale}))}},{key:"resetView",value:function(e){this.targetTransformObj.scale=1,this.targetTransformObj.angle=0,this.targetTransformObj.x=(this.renderWidth-this.klCanvas.getWidth())/2,this.targetTransformObj.y=(this.renderHeight-this.klCanvas.getHeight())/2,e?(this.doAnimateTranslate=!0,this.transformIsDirty=!0):this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.bgVisible=this.testBgVisible(),this.reqFrame(),e&&this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"fitView",value:function(){var e=[[0,0],[this.klCanvas.getWidth(),0],[this.klCanvas.getWidth(),this.klCanvas.getHeight()],[0,this.klCanvas.getHeight()],[this.klCanvas.getWidth()/2,this.klCanvas.getHeight()/2]],t=Gk.Matrix.getIdentity();t=Gk.Matrix.multiplyMatrices(t,Gk.Matrix.createRotationMatrix(this.targetTransformObj.angle));for(var n=0;n<e.length;n++){var r=[e[n][0],e[n][1],0,1];r=Gk.Matrix.multiplyMatrixAndPoint(t,r),e[n][0]=r[0],e[n][1]=r[1]}for(var i={x0:null,y0:null,x1:null,y1:null},a=0;a<e.length;a++)(null===i.x0||e[a][0]<i.x0)&&(i.x0=e[a][0]),(null===i.y0||e[a][1]<i.y0)&&(i.y0=e[a][1]),(null===i.x1||e[a][0]>i.x1)&&(i.x1=e[a][0]),(null===i.y1||e[a][1]>i.y1)&&(i.y1=e[a][1]);var o=i.x1-i.x0,s=i.y1-i.y0,l=Gk.fitInto(o,s,this.renderWidth-40,this.renderHeight-40,1).width/o;this.targetTransformObj.x=this.renderWidth/2-(e[4][0]-e[0][0])*l,this.targetTransformObj.y=this.renderHeight/2-(e[4][1]-e[0][1])*l,this.targetTransformObj.scale=l,this.doAnimateTranslate=!0,this.transformIsDirty=!0,this.reqFrame(),this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"setAngle",value:function(e,t){var n={x:this.renderWidth/2,y:this.renderHeight/2},r=this.targetTransformObj.angle,i=e/180*Math.PI;t?this.targetTransformObj.angle+=i:this.targetTransformObj.angle=i,this.targetTransformObj.angle=this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle,90,4));var a=Gk.Matrix.getIdentity();a=Gk.Matrix.multiplyMatrices(a,Gk.Matrix.createTranslationMatrix(n.x,n.y)),a=Gk.Matrix.multiplyMatrices(a,Gk.Matrix.createRotationMatrix(this.targetTransformObj.angle-r)),a=Gk.Matrix.multiplyMatrices(a,Gk.Matrix.createTranslationMatrix(-n.x,-n.y));var o=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];o=Gk.Matrix.multiplyMatrixAndPoint(a,o),this.targetTransformObj.x=o[0],this.targetTransformObj.y=o[1],this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.transformIsDirty=!0,this.reqFrame(!0)}},{key:"translateView",value:function(e,t){this.targetTransformObj.x+=40*e,this.targetTransformObj.y+=40*t,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.reqFrame(!0)}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"getScale",value:function(){return this.targetTransformObj.scale}},{key:"getAngleDeg",value:function(){return 180*this.targetTransformObj.angle/Math.PI}},{key:"getMaxScale",value:function(){return 64}},{key:"getMinScale",value:function(){return oT}},{key:"requestFrame",value:function(){this.lastRenderedState=-1,this.reqFrame()}},{key:"setLastDrawEvent",value:function(e,t,n){null!==e?(this.lastDrawEvent||(this.lastDrawEvent={x:0,y:0,pressure:0}),this.lastDrawEvent.x=e,this.lastDrawEvent.y=t,this.lastDrawEvent.pressure=n):this.lastDrawEvent=null}}]),e}();function lT(e){var t=function(){o.save(),o.clearRect(0,0,a.width,a.height);for(var t=0;t<e.layers.length;t++)o.globalAlpha=e.layers[t].opacity,o.globalCompositeOperation=e.layers[t].mixModeStr,a.width>e.layers[t].image.width&&(o.imageSmoothingEnabled=!1),o.drawImage(e.layers[t].image,0,0,a.width,a.height);o.restore()},n=e.width/e.layers[0].image.width,r=n>1?e.layers[0].image.width:e.width,i=n>1?e.layers[0].image.height:e.height,a=Gk.canvas(r,i);a.style.backgroundImage="url("+Gk.createCheckerDataUrl(8)+")";var o=a.getContext("2d");Gk.css(a,{width:"100%",height:"100%",imageRendering:n>1?"pixelated":null}),setTimeout(t,0),this.getElement=function(){return a},this.render=function(){t()}}a("4gaLD");var cT;rk=a("5nGP2"),ik=a("8TCpN");function uT(e){if(Math.abs(e.angleDeg)%90==0){e.width=Math.round(e.width),e.height=Math.round(e.height);var t=Math.abs(e.angleDeg-90)%180==0;e.x=(t?e.height:e.width)%2==0?Math.round(e.x):Math.round(e.x-.5)+.5,e.y=(t?e.width:e.height)%2==0?Math.round(e.y):Math.round(e.y-.5)+.5}}function hT(e){return{x:e.x,y:e.y,width:e.width,height:e.height,angleDeg:e.angleDeg}}function dT(e,t,n){var r,i;r=e-n.x,i=t-n.y;var a=Gk.rotateAround({x:0,y:0},{x:r,y:i},-n.angleDeg);return{x:r=a.x,y:i=a.y}}function pT(e,t,n){var r=Gk.rotateAround({x:0,y:0},{x:e,y:t},n.angleDeg);return{x:r.x+n.x,y:r.y+n.y}}cT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("045N6");var fT=function(){"use strict";function e(n){var r=this;rk.default(this,e);this.scaled={x:0,y:0,width:0,height:0,corners:[{x:0,y:0}]},this.minSnapDist=7,this.cornerCursors=["nw","n","ne","e","se","s","sw","w"],this.gripSize=14,this.edgeSize=10,this.corners=[],this.edges=[],this.transform={x:n.x,y:n.y,width:n.width,height:n.height,angleDeg:n.angleDeg},this.isConstrained=!!n.isConstrained,this.snapX=n.snapX,this.snapY=n.snapY,this.callback=n.callback,this.scale=n.scale,this.snappingEnabled=!0,this.ratio=this.transform.width/this.transform.height,this.rootEl=Gk.el({className:"kl-free-transform",css:{userSelect:"none"}}),this.transEl=Gk.el({parent:this.rootEl,css:{position:"absolute"}}),this.boundsEl=Gk.el({css:{position:"absolute",cursor:"move",boxShadow:"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px"}});var i={x:0,y:0};this.keyListener=new Gk.KeyListener({});var a,o={x:0,y:0};this.boundsPointerListener=new Gk.PointerListener({target:this.boundsEl,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointerdown"===e.type&&(o={x:r.transform.x,y:r.transform.y}),"pointermove"===e.type&&"left"===e.button){var t;r.transform.x=o.x+(e.pageX-e.downPageX)/r.scale,r.transform.y=o.y+(e.pageY-e.downPageY)/r.scale;var n={};if(r.snappingEnabled){var i,a;for(i=0;i<r.snapX.length;i++)(t=Math.abs(r.transform.x-r.snapX[i]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[i],n.distX=t);for(i=0;i<r.snapY.length;i++)(t=Math.abs(r.transform.y-r.snapY[i]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[i],n.distY=t);for(i=0;i<4;i++){a=pT(r.corners[i].x,r.corners[i].y,r.transform);var s=void 0;for(s=0;s<r.snapX.length;s++)(t=Math.abs(a.x-r.snapX[s]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[s]-(a.x-r.transform.x),n.distX=t);for(s=0;s<r.snapY.length;s++)(t=Math.abs(a.y-r.snapY[s]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[s]-(a.y-r.transform.y),n.distY=t)}}if("shift"===r.keyListener.getComboStr()){var l=Gk.projectPointOnLine({x:0,y:o.y},{x:10,y:o.y},{x:r.transform.x,y:r.transform.y}),c=Gk.dist(l.x,l.y,r.transform.x,r.transform.y);(n={}).x=l.x,n.y=l.y,n.distX=c,n.distY=c,l=Gk.projectPointOnLine({x:o.x,y:0},{x:o.x,y:10},{x:r.transform.x,y:r.transform.y}),(c=Gk.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c),l=Gk.projectPointOnLine({x:o.x,y:o.y},{x:o.x+1,y:o.y+1},{x:r.transform.x,y:r.transform.y}),(c=Gk.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c),l=Gk.projectPointOnLine({x:o.x,y:o.y},{x:o.x+1,y:o.y-1},{x:r.transform.x,y:r.transform.y}),(c=Gk.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c)}null!=n.x&&(r.transform.x=n.x),null!=n.y&&(r.transform.y=n.y),Math.abs(r.transform.angleDeg)%90==0&&(uT(r.transform),r.updateCornerPositions()),r.updateDOM()}}});for(var s=0;s<4;s++)!function(e){var t=r,n=r.corners[e]={i:e,el:Gk.el({css:{width:r.gripSize+"px",height:r.gripSize+"px",background:"#fff",borderRadius:r.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,virtualPos:{x:0,y:0},updateDOM:null,pointerListener:null};n.updateDOM=function(){var r=t,i=[[-1,-1],[1,-1],[1,1],[-1,1]].map((function(e){return e[0]*=r.transform.width>0?1:-1,e[1]*=r.transform.height>0?1:-1,e})),a=Math.abs(t.scaled.width)<20||Math.abs(t.scaled.height)<20?10:0;Gk.css(n.el,{left:t.scaled.corners[n.i].x-t.gripSize/2+i[e][0]*a+"px",top:t.scaled.corners[n.i].y-t.gripSize/2+i[e][1]*a+"px"});for(var o=Gk.pointsToAngleDeg({x:t.transform.x,y:t.transform.y},pT(n.x,n.y,t.transform))+135;o<0;)o+=360;var s=Math.round(o/45)%t.cornerCursors.length;Gk.css(n.el,{cursor:t.cornerCursors[s]+"-resize"})},n.pointerListener=new Gk.PointerListener({target:r.corners[e].el,fixScribble:!0,onPointer:function(n){if(n.eventPreventDefault(),"pointerdown"===n.type&&"left"===n.button)t.corners[e].virtualPos=pT(t.corners[e].x,t.corners[e].y,t.transform);else if("pointermove"===n.type&&"left"===n.button){t.corners[e].virtualPos.x+=n.dX/t.scale,t.corners[e].virtualPos.y+=n.dY/t.scale;var r={x:t.corners[e].virtualPos.x,y:t.corners[e].virtualPos.y};r=t.constrainCorner(e,r.x,r.y),t.isConstrained||(r=t.snapCorner(r.x,r.y)),Math.abs(t.transform.angleDeg)%90==0&&(r.x=Math.round(r.x),r.y=Math.round(r.y));var i=dT(r.x,r.y,t.transform),a=i.x-t.corners[e].x,o=i.y-t.corners[e].y;t.corners[e].x=i.x,t.corners[e].y=i.y;var s=[];0===e?s=[3,1,2]:1===e?s=[2,0,3]:2===e?s=[1,3,0]:3===e&&(s=[0,2,1]),t.corners[s[0]].x=t.corners[e].x,t.corners[s[1]].y=t.corners[e].y,t.keyListener.isPressed("shift")&&(t.corners[s[2]].x-=a,t.corners[s[2]].y-=o,t.corners[s[1]].x=t.corners[s[2]].x,t.corners[s[0]].y=t.corners[s[2]].y),t.updateTransformViaCorners()}}})}(s);this.updateCornerPositions(),this.updateScaled();for(var l=0;l<4;l++)!function(e){var t=r;r.edges[e]={el:Gk.el({css:{width:r.edgeSize+"px",height:r.edgeSize+"px",position:"absolute"}}),updateDOM:null,pointerListener:null};var n=r.edges[e];n.updateDOM=function(){0===e?Gk.css(n.el,{left:Math.min(t.scaled.corners[0].x,t.scaled.corners[1].x)+"px",top:Math.min(t.scaled.corners[0].y,t.scaled.corners[3].y)-t.edgeSize+"px",width:Math.abs(t.scaled.width)+"px",height:t.edgeSize+"px"}):1===e?Gk.css(n.el,{left:Math.max(t.scaled.corners[0].x,t.scaled.corners[1].x)+"px",top:Math.min(t.scaled.corners[1].y,t.scaled.corners[2].y)+"px",width:t.edgeSize+"px",height:Math.abs(t.scaled.height)+"px"}):2===e?Gk.css(n.el,{left:Math.min(t.scaled.corners[3].x,t.scaled.corners[2].x)+"px",top:Math.max(t.scaled.corners[0].y,t.scaled.corners[3].y)+"px",width:Math.abs(t.scaled.width)+"px",height:t.edgeSize+"px"}):3===e&&Gk.css(n.el,{left:Math.min(t.scaled.corners[0].x,t.scaled.corners[1].x)-t.edgeSize+"px",top:Math.min(t.scaled.corners[0].y,t.scaled.corners[3].y)+"px",width:t.edgeSize+"px",height:Math.abs(t.scaled.height)+"px"});for(var r=Math.round(t.transform.angleDeg/45);r<0;)r+=8;r=(2*e+1+r)%t.cornerCursors.length,n.el.style.cursor=t.cornerCursors[r]+"-resize"};var o=[0,2].includes(e);n.pointerListener=new Gk.PointerListener({target:r.edges[e].el,fixScribble:!0,onPointer:function(n){if(n.eventPreventDefault(),"pointerdown"===n.type&&"left"===n.button&&(a=o?t.corners[0].y>=t.corners[3].y:t.corners[0].x>=t.corners[1].x,i.x=0,i.y=0),"pointermove"===n.type&&"left"===n.button){var r=Gk.rotateAround({x:0,y:0},{x:n.dX/t.scale,y:n.dY/t.scale},-t.transform.angleDeg),s={dX:r.x,dY:r.y};Math.abs(t.transform.angleDeg)%90==0&&(s=Gk.intDxy(i,r.x,r.y));var l=[];0===e?l=[2,3,0,1]:1===e?l=[0,3,1,2]:2===e?l=[0,1,2,3]:3===e&&(l=[1,2,0,3]);var c=o?"y":"x",u=o?s.dY:s.dX;a?(t.corners[l[0]][c]+=u,t.corners[l[1]][c]+=u):(t.corners[l[2]][c]+=u,t.corners[l[3]][c]+=u),t.keyListener.isPressed("shift")&&(a?(t.corners[l[2]][c]-=u,t.corners[l[3]][c]-=u):(t.corners[l[0]][c]-=u,t.corners[l[1]][c]-=u)),o?t.restoreRatio(!1,!0):t.restoreRatio(!0,!1),t.updateTransformViaCorners()}}})}(l);this.angleGrip={el:Gk.el({css:{cursor:"url("+t(cT)+") 10 10, move",width:this.gripSize+"px",height:this.gripSize+"px",background:"#0ff",borderRadius:this.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,snap:!1,updateDOM:function(){Gk.css(r.angleGrip.el,{left:r.angleGrip.x-r.gripSize/2+"px",top:r.angleGrip.y-r.gripSize/2+"px"})}},Gk.el({parent:this.angleGrip.el,css:{width:"2px",height:"13px",left:this.gripSize/2-1+"px",top:this.gripSize+"px",background:"#0ff",position:"absolute"}}),this.anglePointerListener=new Gk.PointerListener({target:this.angleGrip.el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.rootEl.getBoundingClientRect(),n={x:t.left-r.rootEl.scrollLeft,y:t.top-r.rootEl.scrollTop},i={x:(e.clientX-n.x)/r.scale,y:(e.clientY-n.y)/r.scale},a=Gk.pointsToAngleDeg({x:r.transform.x,y:r.transform.y},i)+90;r.transform.angleDeg=a;var o=45*Math.round(a/360*8);("shift"===r.keyListener.getComboStr()||r.snappingEnabled&&Math.abs(o-a)<8)&&(r.transform.angleDeg=o),r.updateDOM()}"pointerup"===e.type&&Math.abs(r.transform.angleDeg)%90==0&&(uT(r.transform),r.updateCornerPositions(),r.updateDOM())}}),uT(this.transform),this.updateDOM(!0),Gk.append(this.transEl,[this.boundsEl,this.edges[0].el,this.edges[1].el,this.edges[2].el,this.edges[3].el,this.corners[0].el,this.corners[1].el,this.corners[2].el,this.corners[3].el,this.angleGrip.el])}return ik.default(e,[{key:"updateScaled",value:function(){var e=this;this.scaled.x=this.transform.x*this.scale,this.scaled.y=this.transform.y*this.scale,this.scaled.width=this.transform.width*this.scale,this.scaled.height=this.transform.height*this.scale,this.scaled.corners=this.corners.map((function(t){return{x:t.x*e.scale,y:t.y*e.scale}}))}},{key:"snapCorner",value:function(e,t){if(!this.snappingEnabled)return{x:e,y:t};for(var n,r={x:null,y:null,dist:{x:null,y:null}},i=0;i<this.snapX.length;i++)(n=Math.abs(e-this.snapX[i]))<this.minSnapDist/this.scale&&(null===r.x||n<r.dist.x)&&(r.x=this.snapX[i],r.dist.x=n);for(var a=0;a<this.snapY.length;a++)(n=Math.abs(t-this.snapY[a]))<this.minSnapDist/this.scale&&(null===r.y||n<r.dist.y)&&(r.y=this.snapY[a],r.dist.y=n);return null===r.x&&null===r.y?{x:e,y:t}:{x:null===r.x?e:r.x,y:null===r.y?t:r.y}}},{key:"constrainCorner",value:function(e,t,n){if(!this.isConstrained)return{x:t,y:n};var r=this.transform.width*this.transform.height<0?-1:1;return Gk.projectPointOnLine({x:this.transform.x,y:this.transform.y},pT(this.ratio,r*([0,2].includes(e)?1:-1),this.transform),{x:t,y:n})}},{key:"updateCornerPositions",value:function(){this.corners[0].x=-this.transform.width/2,this.corners[0].y=-this.transform.height/2,this.corners[1].x=this.transform.width/2,this.corners[1].y=-this.transform.height/2,this.corners[2].x=this.transform.width/2,this.corners[2].y=this.transform.height/2,this.corners[3].x=-this.transform.width/2,this.corners[3].y=this.transform.height/2}},{key:"restoreRatio",value:function(e,t){if(this.isConstrained){var n=Math.abs(this.transform.angleDeg)%90==0,r=Math.abs(this.transform.angleDeg-90)%180==0;if(t&&!e){var i=Math.abs(this.corners[3].y-this.corners[0].y),a=this.ratio*i;n&&(a=0==(r?this.transform.y%1:this.transform.x%1)?Gk.roundEven(a):Gk.roundUneven(a)),this.corners[1].x-this.corners[0].x<0&&(a*=-1),this.corners[0].x=-a/2,this.corners[3].x=-a/2,this.corners[1].x=a/2,this.corners[2].x=a/2}if(!t&&e){var o=Math.abs(this.corners[0].x-this.corners[1].x)/this.ratio;n&&(o=0==(r?this.transform.x%1:this.transform.y%1)?Gk.roundEven(o):Gk.roundUneven(o)),this.corners[3].y-this.corners[0].y<0&&(o*=-1),this.corners[0].y=-o/2,this.corners[1].y=-o/2,this.corners[2].y=o/2,this.corners[3].y=o/2}}}},{key:"updateTransformViaCorners",value:function(){var e=Gk.rotateAround({x:0,y:0},{x:(this.corners[0].x+this.corners[1].x)/2,y:(this.corners[0].y+this.corners[3].y)/2},this.transform.angleDeg);this.transform.x=e.x+this.transform.x,this.transform.y=e.y+this.transform.y,this.transform.width=this.corners[1].x-this.corners[0].x,this.transform.height=this.corners[3].y-this.corners[0].y,this.updateCornerPositions(),this.updateDOM()}},{key:"updateDOM",value:function(e){this.updateScaled(),Gk.css(this.transEl,{left:this.scaled.x+"px",top:this.scaled.y+"px",transformOrigin:"0 0",transform:"rotate("+this.transform.angleDeg+"deg)"}),Gk.css(this.boundsEl,{width:Math.abs(this.scaled.width)+"px",height:Math.abs(this.scaled.height)+"px",left:Math.min(this.scaled.corners[0].x,this.scaled.corners[1].x)+"px",top:Math.min(this.scaled.corners[0].y,this.scaled.corners[3].y)+"px"}),this.corners[0].updateDOM(),this.corners[1].updateDOM(),this.corners[2].updateDOM(),this.corners[3].updateDOM(),this.edges[0].updateDOM(),this.edges[1].updateDOM(),this.edges[2].updateDOM(),this.edges[3].updateDOM(),this.angleGrip.x=0,this.angleGrip.y=-Math.abs(this.transform.height*this.scale)/2-20,this.angleGrip.updateDOM(),e||this.callback&&this.callback(hT(this.transform))}},{key:"getTransform",value:function(){return hT(this.transform)}},{key:"setConstrained",value:function(e){this.isConstrained=!!e,e&&0!==this.transform.width&&0!==this.transform.height&&(this.ratio=Math.abs(this.transform.width/this.transform.height))}},{key:"setSnapping",value:function(e){this.snappingEnabled=!!e}},{key:"setPos",value:function(e){this.transform.x=e.x,this.transform.y=e.y,this.updateDOM(!0)}},{key:"move",value:function(e,t){this.transform.x+=e,this.transform.y+=t,this.updateDOM(!1)}},{key:"setSize",value:function(e,t){this.transform.width=e,this.transform.height=t,Math.abs(this.transform.angleDeg)%90==0&&uT(this.transform),this.updateCornerPositions(),this.updateDOM(!1)}},{key:"setAngleDeg",value:function(e){this.transform.angleDeg=e,Math.abs(this.transform.angleDeg)%90==0&&(uT(this.transform),this.updateCornerPositions()),this.updateDOM(!0)}},{key:"getElement",value:function(){return this.rootEl}},{key:"getRatio",value:function(){return this.ratio}},{key:"destroy",value:function(){this.keyListener.destroy(),this.boundsPointerListener.destroy(),this.corners[0].pointerListener.destroy(),this.corners[1].pointerListener.destroy(),this.corners[2].pointerListener.destroy(),this.corners[3].pointerListener.destroy(),this.edges[0].pointerListener.destroy(),this.edges[1].pointerListener.destroy(),this.edges[2].pointerListener.destroy(),this.edges[3].pointerListener.destroy(),this.anglePointerListener.destroy()}}]),e}();function gT(e){var t=function(){if(s){var t=s.getTransform();r<1&&(t.x*=r,t.y*=r,t.width*=r,t.height*=r);var n=o[e.transformIndex].image,i=n.getContext("2d");i.save(),i.clearRect(0,0,n.width,n.height),Gk.drawTransformedImageWithBounds(i,e.layers[e.transformIndex].image,t,null,Gk.testShouldPixelate(t,t.width/l.width,t.height/l.height)),i.restore(),c.render()}},n=Gk.fitInto(e.imageWidth,e.imageHeight,e.elementWidth-20,e.elementHeight-60,1),r=n.width/e.imageWidth,i=Gk.el({css:{width:e.elementWidth+"px",height:e.elementHeight+"px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"}});i.oncontextmenu=function(){return!1};var a=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:n.width+"px",height:n.height+"px"}});i.appendChild(a);var o=e.layers.map((function(e){return{image:e.image,mixModeStr:e.mixModeStr,opacity:e.opacity}}));o[o.length-1].image=Gk.canvas(r>1?e.imageWidth:n.width,r>1?e.imageHeight:n.height);var s,l,c=new lT({width:n.width,height:n.height,layers:o});a.appendChild(c.getElement());var u={width:e.layers[e.transformIndex].image.width*r,height:e.layers[e.transformIndex].image.height*r};(u.width>n.width||u.height>n.height)&&(u=Gk.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,n.width,n.height,1)),l={x:e.imageWidth/2,y:e.imageHeight/2,width:e.layers[e.transformIndex].image.width,height:e.layers[e.transformIndex].image.height},s=new fT({x:l.x,y:l.y,width:l.width,height:l.height,angleDeg:0,isConstrained:!0,snapX:[0,e.imageWidth],snapY:[0,e.imageHeight],scale:r,callback:function(e){t()}}),Gk.css(s.getElement(),{position:"absolute",left:"0",top:"0"}),a.appendChild(s.getElement()),setTimeout(t,0),this.move=function(e,t){s.move(e,t)},this.reset=function(){var n=e.layers[e.transformIndex].image.width,r=e.layers[e.transformIndex].image.height;s.setSize(n,r),s.setPos({x:n/2,y:r/2}),s.setAngleDeg(0),t()},this.setTransformFit=function(){var n=Gk.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,e.imageWidth,e.imageHeight,1);s.setSize(n.width,n.height),s.setPos({x:n.width/2,y:n.height/2}),s.setAngleDeg(0),t()},this.setTransformCenter=function(){s.setPos({x:e.imageWidth/2,y:e.imageHeight/2}),s.setAngleDeg(0),t()},this.getTransformation=function(){return!!s&&s.getTransform()},this.getIsPixelated=function(){var e=s.getTransform();return Gk.testShouldPixelate(e,e.width/l.width,e.height/l.height)},this.getElement=function(){return i},this.destroy=function(){s.destroy()}}function vT(e){var t=function(e){E[0].y+=e,E[0].y=Math.max(E[3].y-g,Math.min(E[3].y-1,E[0].y)),E[1].y=E[0].y},n=function(e){E[1].x+=e,E[1].x=Math.min(E[0].x+f,Math.max(E[0].x+1,E[1].x)),E[2].x=E[1].x},r=function(e){E[2].y+=e,E[2].y=Math.min(E[1].y+g,Math.max(E[1].y+1,E[2].y)),E[3].y=E[2].y},i=function(e){E[0].x+=e,E[0].x=Math.max(E[1].x-f,Math.min(E[1].x-1,E[0].x)),E[3].x=E[0].x},a=function(){b.x=0,b.y=0,p(o())},o=function(){return E[1].x-=E[0].x,E[1].y-=E[0].y,E[2].x-=E[0].x,E[2].y-=E[0].y,E[3].x-=E[0].x,E[3].y-=E[0].y,l+=E[0].x,c+=E[0].y,E[0].x=0,E[0].y=0,{x:l,y:c,width:E[1].x,height:E[2].y}},s=function(){T[0].update(),T[1].update(),T[2].update(),T[3].update(),D[0].update(),D[1].update(),D[2].update(),D[3].update(),I[0].update(),I[1].update(),I[2].update(),I[3].update(),x.update(),C.update(),S.update()},l=e.x,c=e.y,u=e.width,h=e.height,d=e.scale,p=e.callback,f=e.maxW,g=e.maxH,v=document.createElement("div"),m=["nw","n","ne","e","se","s","sw","w"],y=new Gk.KeyListener({});Gk.css(v,{position:"absolute",left:l*d+"px",top:c*d+"px"});var x=document.createElement("div");Gk.css(x,{position:"absolute",border:"1px dashed #fff",cursor:"move"}),x.update=function(){Gk.css(x,{left:E[0].x*d-1+"px",top:E[0].y*d-1+"px",width:(E[2].x-E[0].x)*d+"px",height:(E[2].y-E[0].y)*d+"px"})};var b={x:0,y:0},w=new Gk.PointerListener({target:x,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=Gk.intDxy(b,e.dX/d,e.dY/d),n=t.dX,r=t.dY;E[0].x+=n,E[0].y+=r,E[1].x+=n,E[1].y+=r,E[2].x+=n,E[2].y+=r,E[3].x+=n,E[3].y+=r,s()}"pointerup"===e.type&&a()}}),C=document.createElement("div");Gk.css(C,{position:"absolute",borderTop:"1px solid #0ff",borderBottom:"1px solid #0ff"}),C.update=function(){Gk.css(C,{left:E[0].x*d+"px",top:(E[0].y+(E[2].y-E[0].y)/3)*d+"px",width:(E[2].x-E[0].x)*d+"px",height:(E[2].y-E[0].y)/3*d+"px"})};var S=document.createElement("div");Gk.css(S,{position:"absolute",borderLeft:"1px solid #0ff",borderRight:"1px solid #0ff"}),S.update=function(){Gk.css(S,{left:(E[0].x+(E[2].x-E[0].x)/3)*d+"px",top:E[0].y*d+"px",width:(E[2].x-E[0].x)/3*d+"px",height:(E[2].y-E[0].y)*d+"px"})};for(var k=10,E=[{x:0,y:0},{x:u,y:0},{x:u,y:h},{x:0,y:h}],T=[],M=0;M<4;M++)!function(e){T[e]=document.createElement("div");var t=T[e];t.style.width="40px",t.style.height="40px",t.style.position="absolute",t.update=function(){0===e?(t.style.left=E[0].x*d+k+"px",t.style.top=E[0].y*d-80+k+"px",t.style.width=(E[1].x-E[0].x)*d-20+"px",t.style.height="80px"):1===e?(t.style.left=E[1].x*d-k+"px",t.style.top=E[1].y*d+k+"px",t.style.width="80px",t.style.height=(E[2].y-E[1].y)*d-20+"px"):2===e?(t.style.left=E[3].x*d+k+"px",t.style.top=E[3].y*d-k+"px",t.style.width=(E[2].x-E[3].x)*d-20+"px",t.style.height="80px"):3===e&&(t.style.left=E[0].x*d-80+k+"px",t.style.top=E[0].y*d+k+"px",t.style.width="80px",t.style.height=(E[3].y-E[0].y)*d-20+"px");var n=2*e+1;t.style.cursor=m[n]+"-resize"}}(M);for(var I=[],R=0;R<4;R++)!function(e){I[e]=document.createElement("div");var t=I[e];t.style.position="absolute",t.style.background="#000",t.style.opacity="0.5",t.update=function(){0===e?(t.style.left=E[0].x*d+"px",t.style.top=E[0].y*d-8e3+"px",t.style.width=(E[1].x-E[0].x)*d+"px",t.style.height="8000px"):1===e?(t.style.left=E[1].x*d+"px",t.style.top=E[1].y*d-8e3+"px",t.style.width="8000px",t.style.height="16000px"):2===e?(t.style.left=E[3].x*d+"px",t.style.top=E[3].y*d+"px",t.style.width=(E[2].x-E[3].x)*d+"px",t.style.height="8000px"):3===e&&(t.style.left=E[0].x*d-8e3+"px",t.style.top=E[0].y*d-8e3+"px",t.style.width="8000px",t.style.height="16000px")}}(R);var A=new Gk.PointerListener({target:T[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=Gk.intDxy(b,e.dX/d,e.dY/d),i=(n.dX,n.dY);t(i),y.isPressed("shift")&&r(-i),s()}"pointerup"===e.type&&a()}}),L=new Gk.PointerListener({target:T[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=Gk.intDxy(b,e.dX/d,e.dY/d),r=t.dX;t.dY;n(r),y.isPressed("shift")&&i(-r),s()}"pointerup"===e.type&&a()}}),P=new Gk.PointerListener({target:T[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=Gk.intDxy(b,e.dX/d,e.dY/d),i=(n.dX,n.dY);r(i),y.isPressed("shift")&&t(-i),s()}"pointerup"===e.type&&a()}}),O=new Gk.PointerListener({target:T[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=Gk.intDxy(b,e.dX/d,e.dY/d),r=t.dX;t.dY;i(r),y.isPressed("shift")&&n(-r),s()}"pointerup"===e.type&&a()}}),D=[];!function(){for(var e=0;e<4;e++)!function(e){D[e]=document.createElement("div");var t=D[e];Gk.css(t,{width:"80px",height:"80px",position:"absolute"}),t.style.cursor=["nwse-resize","nesw-resize"][e%2],t.update=function(){0===e?Gk.css(t,{left:E[0].x*d-80+k+"px",top:E[0].y*d-80+k+"px"}):1===e?Gk.css(t,{left:E[1].x*d-k+"px",top:E[1].y*d-80+k+"px"}):2===e?Gk.css(t,{left:E[1].x*d-k+"px",top:E[2].y*d-k+"px"}):3===e&&Gk.css(t,{left:E[0].x*d-80+k+"px",top:E[2].y*d-k+"px"})}}(e)}();var B=new Gk.PointerListener({target:D[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=Gk.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;i(l),t(c),y.isPressed("shift")&&(n(-l),r(-c)),s()}"pointerup"===e.type&&a()}}),z=new Gk.PointerListener({target:D[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=Gk.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;n(l),t(c),y.isPressed("shift")&&(i(-l),r(-c)),s()}"pointerup"===e.type&&a()}}),j=new Gk.PointerListener({target:D[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=Gk.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;n(l),r(c),y.isPressed("shift")&&(i(-l),t(-c)),s()}"pointerup"===e.type&&a()}}),F=new Gk.PointerListener({target:D[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=Gk.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;i(l),r(c),y.isPressed("shift")&&(n(-l),t(-c)),s()}"pointerup"===e.type&&a()}});v.append(I[1],I[0],I[2],I[3],C,S,x,T[1],T[0],T[2],T[3],D[0],D[1],D[2],D[3]),s(),this.getTransform=o,this.setTransform=function(e){l=e.x,c=e.y,u=e.width,h=e.height,Gk.css(v,{left:l*d+"px",top:c*d+"px"}),E[0].x=0,E[0].y=0,E[1].x=u,E[1].y=0,E[2].x=u,E[2].y=h,E[3].x=0,E[3].y=h,s(),a()},this.setScale=function(e){d=e,Gk.css(v,{left:l*d+"px",top:c*d+"px"}),s()},this.showThirds=function(e){e?(C.style.display="block",S.style.display="block"):(C.style.display="none",S.style.display="none")},this.getElement=function(){return v},this.destroy=function(){y.destroy(),w.destroy(),B.destroy(),z.destroy(),j.destroy(),F.destroy(),A.destroy(),L.destroy(),P.destroy(),O.destroy()}}var mT;mT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("eHdqz");var yT;yT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("3x5dR");var xT;xT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hbDTd");var bT;bT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("16iGk");var wT;wT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("2ME3z");var CT;CT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hZnSk");var ST;ST=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("6mHrC");var kT;kT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hS5Hj");var ET;ET=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("doX4v");var TT;TT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("7NqHO");var MT;function IT(e){var n=function(e){var t={},n=Gk.el({parent:S,className:"tool-dropdown-button",title:e.title,css:{padding:"10px 0",height:100/(s.length-1)+"%",boxSizing:"border-box"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick(e.index,e.id)}});t.wrapper=n;Gk.el({parent:n,css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",height:"100%",pointerEvents:"none",opacity:"0.75"}});return t.show=function(e){n.style.display=e?"block":"none"},t.setIsSmall=function(e){n.style.padding=e?v:"10px 0"},t},r=function(t,n){a(),h=!0,u=t,o(),e.onChange(s[u])},i=function(){$k.increase(.5),d=!0;for(var e=0;e<s.length;e++)k[e].show(u!==e);w.style.display="none",m.style.zIndex="1",document.body.appendChild(C),m.appendChild(S)},a=function(){$k.decrease(.5),d=!1,w.style.removeProperty("display"),m.style.removeProperty("z-index"),document.body.removeChild(C),m.removeChild(S)},o=function(){x.title=c[u],b.style.backgroundImage="url('"+l[u]+"')"},s=["draw","fill","text","shape"],l=[t(ST),t(kT),t(ET),t(TT)],c=["".concat(dE("tool-brush")," [B]"),"".concat(dE("tool-paint-bucket")," [G]"),"".concat(dE("tool-text")," [T]"),"".concat(dE("tool-shape")," [U]")],u=0,h=!0,d=!1;setTimeout((function(){for(var e=1;e<l.length;e++){(new Image).src=l[e]}}),100);var p,f,g,v="6px 0",m=Gk.el({css:{position:"relative",flexGrow:"1"}}),y=!1;Gk.hasPointerEvents&&new Gk.PointerListener({target:m,maxPointers:1,onPointer:function(t){if("pointerdown"===t.type){if(d)return;p=setTimeout((function(){i()}),400),y=!0,f=t.pageX,g=t.pageY}else if("pointermove"===t.type)y&&!d&&Gk.dist(f,g,t.pageX,t.pageY)>5&&(clearTimeout(p),i());else if("pointerup"===t.type){if(clearTimeout(p),d&&y)for(var n=document.elementFromPoint(t.pageX,t.pageY),r=0;r<k.length;r++)if(n===k[r].wrapper){a(),h=!0,u=r,o(),e.onChange(s[u]);break}y=!1}}});for(var x=Gk.el({parent:m,className:"toolspace-row-button nohighlight toolspace-row-button-activated",title:c[u],onClick:function(t){if(h&&!d)return t.preventDefault(),t.stopPropagation(),void i();h=!0,e.onChange(s[u]),d&&a()},css:{padding:"10px 0",pointerEvents:"auto",height:"100%",boxSizing:"border-box"}}),b=Gk.el({parent:x,css:{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",width:"calc(100% - 7px)",height:"100%",pointerEvents:"none",opacity:"0.75"}}),w=Gk.el({parent:x,css:{position:"absolute",right:"1px",bottom:"1px",width:"18px",height:"18px",cursor:"pointer",backgroundImage:"url('"+t(MT)+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"60%"},title:"More Tools",onClick:function(e){e.preventDefault(),e.stopPropagation(),i()}}),C=Gk.el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}}),S=(new Gk.PointerListener({target:C,pointers:1,onPointer:function(e){"pointerdown"===e.type&&(e.eventPreventDefault(),a())}}),Gk.el({className:"tool-dropdown-wrapper",css:{position:"absolute",width:"100%",height:100*(s.length-1)+"%",top:"100%",left:"0",zIndex:"1",boxSizing:"border-box",cursor:"pointer",transition:"height 0.1s ease-in-out, opacity 0.1s ease-in-out",borderBottomLeftRadius:"5px",borderBottomRightRadius:"5px",overflow:"hidden"}})),k=[],E=0;E<s.length;E++)k.push(n({index:E,id:s[E],image:l[E],title:c[E],onClick:r}));o(),this.setIsSmall=function(e){x.style.padding=e?v:"10px 0";for(var t=0;t<s.length;t++)k[t].setIsSmall(e);e?(w.style.width="14px",w.style.height="14px"):(w.style.width="18px",w.style.height="18px")},this.setActive=function(e){if(s.includes(e)){h=!0;for(var t=0;t<s.length;t++)if(s[t]===e){u=t;break}Gk.addClassName(x,"toolspace-row-button-activated"),o()}else h=!1,Gk.removeClassName(x,"toolspace-row-button-activated")},this.getActive=function(){return s[u]},this.getElement=function(){return m}}MT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("dz3mY");var RT;RT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("2gZH2");var AT;AT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("04ZZm");var LT;LT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("j9xio");var PT;PT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("AnO0a");var OT;OT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("nTvP2");var DT;DT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("6toXQ");var BT;BT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("b1UMP"),a("4gaLD");var zT,jT=a("aoONY");zT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("lvwQ5");var FT;FT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("imAvm");var NT;NT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("dC0sF");var _T;_T=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("h3hPo");var HT;HT=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("1pAeY");var UT,YT,XT={};function VT(){if(!UT){UT={"source-over":"normal",darken:"darken",multiply:"multiply","color-burn":"color burn",lighten:"lighten",screen:"screen","color-dodge":"color dodge",overlay:"overlay","soft-light":"soft light","hard-light":"hard light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"},YT={};for(var e=Object.keys(UT),t=0;t<e.length;t++)YT[UT[e[t]]]=e[t]}}function WT(e){return VT(),YT[e]}function GT(e){return VT(),UT[e]}function KT(e){var t=function(e){i.warningArr||(i.warningArr=[]),i.warningArr.includes(e)||i.warningArr.push(e)},n=function(e){var n=WT(e);return n||(t("blend-mode"),n="source-over"),n},r=function(e,t){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height);if(0===t)for(var i=0;i<r.data.length;i+=4)r.data[i+3]=r.data[i];else for(var a=0;a<r.data.length;a+=4)r.data[a+3]=255-r.data[a];n.putImageData(r,0,0)},i={type:"psd",canvas:e.canvas,width:e.width,height:e.height};if(8!==e.bitsPerChannel&&t("bits-per-channel"),!e.children)return i.error=!0,i;var a=0;if(a+=function e(n){var r=0;if(n.blendMode){var i=WT(n.blendMode);if(i&&"source-over"!==i)return 1}for(var a=0;a<n.children.length;a++){var o=n.children[a];o.clipping||o.adjustment||(o.children?(t("group"),r+=e(o)):r++)}return r}(e),a>16)return i.error=!0,i;return i.layers=[],i.layers=function e(a){var o,s,l=[],c=a.hidden?0:a.opacity,u=n(a.blendMode);"source-over"!==u&&(s=(o=NS(i.width,i.height)).getContext("2d")),a.mask&&(t("mask"),r(a.mask.canvas,a.mask.defaultColor));for(var h=0;h<a.children.length;h++){var d=a.children[h];if(!d.clipping)if(d.adjustment)t("adjustment");else{var p=(d.children||d.canvas)&&a.children[h+1]&&a.children[h+1].clipping;if(p&&t("clipping"),d.children)for(var f=e(d),g=0;g<f.length;g++){var v=f[g],m=v.image.getContext("2d");if(p){var y=NS(i.width,i.height),x=y.getContext("2d");x.drawImage(v.image,0,0);for(var b=h+1;b<a.children.length&&a.children[b].clipping;b++){var w=a.children[b];0===w.opacity||w.hidden||(x.globalCompositeOperation=n(w.blendMode),x.globalAlpha=w.opacity,x.drawImage(w.canvas,w.left,w.top))}m.globalCompositeOperation="source-atop",m.drawImage(y,0,0)}a.mask&&(m.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",m.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),o?(s.globalCompositeOperation=v.mixModeStr,s.globalAlpha=v.opacity,s.drawImage(v.image,0,0)):(v.opacity=v.opacity*c,l.push(v))}else{var C=NS(i.width,i.height),S=C.getContext("2d");if(d.canvas&&S.drawImage(d.canvas,d.left,d.top),d.effects&&t("layer-effect"),d.mask&&(t("mask"),r(d.mask.canvas,d.mask.defaultColor),S.globalCompositeOperation=0===d.mask.defaultColor?"destination-in":"destination-out",S.drawImage(d.mask.canvas,d.mask.left,d.mask.top)),p){var k=NS(d.right-d.left,d.bottom-d.top),E=k.getContext("2d");E.drawImage(d.canvas,0,0);for(var T=h+1;T<a.children.length&&a.children[T].clipping;T++){var M=a.children[T];0===M.opacity||M.hidden||(E.globalCompositeOperation=n(M.blendMode),E.globalAlpha=M.opacity,E.drawImage(M.canvas,M.left-d.left,M.top-d.top))}S.globalCompositeOperation="source-atop",S.drawImage(k,d.left,d.top)}a.mask&&(S.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",S.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),o?c>0&&(s.globalCompositeOperation=n(d.blendMode),s.globalAlpha=d.hidden?0:d.opacity,s.drawImage(C,0,0)):l.push({name:d.name,opacity:(d.hidden?0:d.opacity)*c,mixModeStr:n(d.blendMode),image:C})}}}return o&&(l=[{name:a.name,opacity:c,mixModeStr:u,image:o}]),l}({name:"root",opacity:1,blendMode:"normal",children:e.children}),i}function qT(e){var t={width:e.width,height:e.height,layers:[]};return e.layers?t.layers=t.layers.concat(e.layers.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e.image}}))):t.layers.push({name:dE("background"),opacity:1,mixModeStr:"source-over",image:e.canvas}),t}e(XT,"blendPsdToKl",(function(){return WT})),e(XT,"blendKlToPsd",(function(){return GT})),e(XT,"readPsd",(function(){return KT})),e(XT,"klPsdToKlProject",(function(){return qT}));var JT={};e(JT,"setDbName",(function(){return eM})),e(JT,"getKlProjectObj",(function(){return nM})),e(JT,"storeKlProjectObj",(function(){return rM})),e(JT,"clear",(function(){return iM}));var ZT=!!window.indexedDB,QT="Klecks",$T="ProjectStore";function eM(e){QT=""+e}function tM(e,t,n){var r=function(e){i||(i=!0,n(e))},i=!1;if(ZT){var a;try{a=window.indexedDB.open(QT,1)}catch(e){return void r(e.message)}a.onupgradeneeded=function(e){try{a.result.createObjectStore($T,{keyPath:"id"}).createIndex("id","id",{unique:!0})}catch(e){r(e.message)}},a.onerror=function(e){r("indexedDB.open failed, "+a.error)},a.onsuccess=function(n){var o,s,l;try{if(!(o=a.result).objectStoreNames.contains($T))return window.indexedDB.deleteDatabase(QT),void r("object store ProjectStore missing. destroying db");(l=(s=o.transaction($T,"readwrite")).objectStore($T)).index("id")}catch(e){return void r(e.message)}o.onerror=function(e){r("database error, "+o.error)};try{e(l)}catch(e){return void r(e.message)}s.oncomplete=function(){i||(i=!0,t()),o.close()},s.onerror=function(){r("transaction error, "+s.error)}}}else setTimeout((function(){r("no indexed db available")}),0)}function nM(e,t){var n;ZT?tM((function(e){n=e.get(1)}),(function(){e(n.result)}),(function(e){t("execIndexedDBTransaction error, "+e)})):e(null)}function rM(e,t,n){tM((function(t){t.put(e)}),(function(){t()}),(function(e){n(e)}))}function iM(e,t){tM((function(e){e.delete(1)}),(function(){e()}),(function(e){t(e)}))}var aM;aM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("5tPq3");var oM;oM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("cazOx");var sM;sM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("245NA");var lM;lM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("1hkCG");var cM;cM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("k2eFf");var uM;uM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("krKGd");var hM;hM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("ehfxY");var dM;dM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("beOjS");var pM;pM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("Gk9bV");var fM;fM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("csed7");var gM;gM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("equSE");var vM;vM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("h1dN3");var mM;mM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("LfAXI");var yM={isLoaded:!1},xM={glBrightnessContrast:{lang:{name:"filter-bright-contrast-title",button:"filter-bright-contrast"},name:"",buttonLabel:"",webgl:!0,updateContext:!0,icon:t(aM),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},cropExtend:{lang:{name:"filter-crop-title",button:"filter-crop-extend"},name:"",buttonLabel:"",icon:t(oM),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},glCurves:{lang:{name:"filter-curves-title",button:"filter-curves"},name:"",buttonLabel:"",icon:t(sM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},flip:{lang:{name:"filter-flip-title",button:"filter-flip"},name:"",buttonLabel:"",icon:t(lM),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},glHueSaturation:{lang:{name:"filter-hue-sat-title",button:"filter-hue-sat"},name:"",buttonLabel:"",icon:t(cM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},invert:{lang:{name:"filter-invert",button:"filter-invert"},name:"",icon:t(uM),webgl:!0,updateContext:!0,updatePos:!1,isInstant:!0,getDialog:null,apply:null,inEmbed:!0},glPerspective:{lang:{name:"filter-perspective-title",button:"filter-perspective"},name:"",buttonLabel:"",icon:t(hM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},resize:{lang:{name:"filter-resize-title",button:"filter-resize"},name:"",buttonLabel:"",icon:t(dM),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},rotate:{lang:{name:"filter-rotate-title",button:"filter-rotate"},name:"",buttonLabel:"",icon:t(DT),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},glTiltShift:{lang:{name:"filter-tilt-shift-title",button:"filter-tilt-shift"},name:"",buttonLabel:"",icon:t(pM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},toAlpha:{lang:{name:"filter-to-alpha-title",button:"filter-to-alpha"},name:"",buttonLabel:"",icon:t(fM),webgl:!0,updateContext:!1,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},transform:{lang:{name:"filter-transform-title",button:"filter-transform"},name:"",buttonLabel:"",icon:t(gM),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!1,ieFails:!0,getDialog:null,apply:null,inEmbed:!0},glBlur:{lang:{name:"filter-triangle-blur-title",button:"filter-triangle-blur"},name:"",buttonLabel:"",icon:t(vM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},glUnsharpMask:{lang:{name:"filter-unsharp-mask-title",button:"filter-unsharp-mask"},name:"",buttonLabel:"",icon:t(mM),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0}};function bM(){Object.keys(xM).forEach((function(e){xM[e].name=dE(xM[e].lang.name),xM[e].buttonLabel=dE(xM[e].lang.button)}))}bM(),hE.subscribe((function(){bM()}));var wM={};function CM(e,t,n){this.x=e,this.y=t,this.z=n}CM.prototype.dot2=function(e,t){return this.x*e+this.y*t};var SM=[new CM(1,1,0),new CM(-1,1,0),new CM(1,-1,0),new CM(-1,-1,0),new CM(1,0,1),new CM(-1,0,1),new CM(1,0,-1),new CM(-1,0,-1),new CM(0,1,1),new CM(0,-1,1),new CM(0,1,-1),new CM(0,-1,-1)],kM=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],EM=new Array(512),TM=new Array(512);wM.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?kM[t]^255&e:kM[t]^e>>8&255,EM[t]=EM[t+256]=n,TM[t]=TM[t+256]=SM[n%12]}},wM.seed(0);var MM=.5*(Math.sqrt(3)-1),IM=(3-Math.sqrt(3))/6;wM.simplex2=function(e,t){var n,r,i=(e+t)*MM,a=Math.floor(e+i),o=Math.floor(t+i),s=(a+o)*IM,l=e-a+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+IM,h=c-r+IM,d=l-1+2*IM,p=c-1+2*IM,f=TM[(a&=255)+EM[o&=255]],g=TM[a+n+EM[o+r]],v=TM[a+1+EM[o+1]],m=.5-l*l-c*c,y=.5-u*u-h*h,x=.5-d*d-p*p;return 70*((m<0?0:(m*=m)*m*f.dot2(l,c))+(y<0?0:(y*=y)*y*g.dot2(u,h))+(x<0?0:(x*=x)*x*v.dot2(d,p)))};var RM=wM;function AM(e){for(var t=e/500,n=e,r=Gk.canvas(e,n),i=r.getContext("2d"),a=i.createImageData(e,n),o=0;o<e;o++)for(var s=0;s<n;s++){var l=4*(s*e+o),c=t+.04*RM.simplex2(o/50/t,s/50/t),u=100+(RM.simplex2(o/50/c,s/50/c)+1)/2*100;u-=(RM.simplex2(o/10/t,s/10/t)+1)/2*100;var h=Gk.dist(e/2,n/2,o,s);u*=Gk.clamp(1-((h-e/2.5)/(e/14)+RM.simplex2(o/22/c,s/22/c)),0,1),u*=2*Gk.clamp(1-h/e,0,1),a.data[l]=0,a.data[l+1]=0,a.data[l+2]=0,a.data[l+3]=Gk.clamp(u,0,255)}return i.putImageData(a,0,0),r}function LM(e,t,n){var r=Gk.Vec2.sub(n,t),i=Gk.Vec2.sub(e,t),a=Gk.clamp(Gk.Vec2.dot(i,r)/Gk.Vec2.dot(r,r),0,1);return Gk.Vec2.len(Gk.Vec2.sub(i,Gk.Vec2.mul(r,a)))}function PM(e){var t=.25;for(var n={x:t*e,y:e-e*t},r={x:e-e*t,y:t*e},i=e,a=Gk.canvas(e,i),o=a.getContext("2d"),s=o.createImageData(e,i),l=0;l<e;l++)for(var c=0;c<i;c++){var u=4*(c*e+l),h=LM({x:l,y:c},n,r);h=Gk.clamp(255-(h-.16666666666666666*e)/(.08333333333333333*e)*255,0,255),s.data[u]=0,s.data[u+1]=0,s.data[u+2]=0,s.data[u+3]=h}return o.putImageData(s,0,0),a}var OM=[];OM[1]=AM(128),OM[2]=PM(128),a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var DM=256;function BM(e,t,n){return e<=t?t:e>=n?n:e}var zM=function(){"use strict";function e(){rk.default(this,e),this.isTesting=!1,this.size=29,this.opacity=.6,this.blending=.65,this.settingLockLayerAlpha=!1,this.settingSizePressure=!0,this.settingOpacityPressure=!1,this.blendCol={r:0,g:0,b:0,a:1},this.blendMix=.45,this.isDrawing=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0}}return ik.default(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=Gk.updateBounds(this.redrawBounds,e)}},{key:"getCellsWidth",value:function(){return Math.ceil(this.context.canvas.width/DM)}},{key:"drawChangedCells",value:function(){var e=this,t=this.cells.map((function(e){return null}));this.getTouchedCells(this.redrawBounds).forEach((function(n,r){n&&(t[r]=e.cells[r])})),this.drawCells(t),this.redrawBounds=null}},{key:"getTouchedCells",value:function(e){for(var t=this.cells.map((function(e){return!1})),n=this.getCellsWidth(),r=(e={x1:Math.floor(e.x1/DM),y1:Math.floor(e.y1/DM),x2:Math.floor(e.x2/DM),y2:Math.floor(e.y2/DM)}).x1;r<=e.x2;r++)for(var i=e.y1;i<=e.y2;i++)t[i*n+r]=!0;return t}},{key:"sliceBounds",value:function(e){var t=this,n=this.getCellsWidth(),r=[];return this.getTouchedCells(e).forEach((function(i,a){if(i){var o=a%n*DM,s=Math.floor(a/n)*DM,l=t.cells[a].width,c=t.cells[a].height,u={x1:Math.max(0,e.x1-o),y1:Math.max(0,e.y1-s),x2:Math.min(l-1,e.x2-o),y2:Math.min(c-1,e.y2-s)};u.x1>u.x2||u.y1>u.y2||r.push({index:a,bounds:u})}})),r}},{key:"copyFromCanvas",value:function(e){var t=this;if(e){var n=this.getTouchedCells(e),r=this.getCellsWidth();n.forEach((function(e,n){if(e&&!t.cells[n]){var i=n%r,a=Math.floor(n/r),o=(Math.min(i*DM+DM,t.context.canvas.width)-1)%DM+1,s=(Math.min(a*DM+DM,t.context.canvas.height)-1)%DM+1,l=Gk.canvas(o,s).getContext("2d");l.drawImage(t.context.canvas,-i*DM,-a*DM),t.cells[n]=l.getImageData(0,0,o,s)}}))}}},{key:"getAverage",value:function(e,t,n){var r=this;n=Math.max(.5,.75*n);var i=Math.max(0,Math.floor(e-n)),a=Math.max(0,Math.floor(t-n)),o=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),s=Math.min(this.context.canvas.height-1,Math.ceil(t+n));if(i>o||a>s)return{r:0,g:0,b:0,a:0};var l,c=0,u=0,h=0,d=0;return this.sliceBounds({x1:i,y1:a,x2:o,y2:s}).forEach((function(e){for(var t=r.cells[e.index].width,n=r.cells[e.index].data,i=e.bounds,a=i.y1;a<=i.y2;a+=4)for(var o=i.x1,s=a*t*4+4*i.x1;o<=i.x2;o+=4,s+=16)l=n[s+3],c+=n[s]*l,u+=n[s+1]*l,h+=n[s+2]*l,d+=l})),0!==d&&(c/=d,u/=d,h/=d,d=Math.min(1,d)),{r:c,g:u,b:h,a:d}}},{key:"prepDot",value:function(e,t,n){n=Math.max(.5,n);var r=Math.max(0,Math.floor(e-n)),i=Math.max(0,Math.floor(t-n)),a=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),o=Math.min(this.context.canvas.height-1,Math.ceil(t+n));return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}}},{key:"drawDot",value:function(e){for(var t=this,n=0,r=e.size>30?1024:512,i=[],a=0;a<r;a++)i[a]=(Math.random()-.5)/1.001+.5;var o=[8,4,4,4,2,2,2,2,2,2][Math.floor(2*e.size)],s=o?o*o:0,l=[];if(o)for(var c=0,u=0;u<o;u++)for(var h=0;h<o;h++,c+=2)l[c]=(u+1)/o,l[c+1]=(h+1)/o;var d=.8*Math.pow(e.opacity,2),p=1-d,f=d/p,g=e.size*e.size,v=g*p/e.opacity,m=(1+f)*e.opacity,y=this.sliceBounds({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),x=this.getCellsWidth();y.forEach((function(a){for(var o=a.index%x*DM,c=Math.floor(a.index/x)*DM,u=t.cells[a.index].width,h=t.cells[a.index].data,d=a.bounds.y1,p=d+c-e.y;d<=a.bounds.y2;d++,p++)for(var f=a.bounds.x1,y=d*u*4+4*a.bounds.x1,b=f+o-e.x;f<=a.bounds.x2;f++,y+=4,b++){var w=0;if(s){for(var C=0;C<l.length;C+=2){var S=Gk.lenSquared(b+l[C],p+l[C+1]);S>=g||(w+=BM(m-S/v,0,e.opacity))}if(!w)continue;w/=s}else{var k=Math.pow(b,2)+Math.pow(p,2);if(k>=g)continue;w=BM(m-k/v,0,e.opacity)}var E=1-w,T=h[y+3]/255;if(t.settingLockLayerAlpha){var M=e.r*w+h[y]*E,I=e.g*w+h[y+1]*E,R=e.b*w+h[y+2]*E;T&&(h[y]=Math.floor(M+i[n]),h[y+1]=Math.floor(I+i[n]),h[y+2]=Math.floor(R+i[n]))}else{var A=e.r*w+h[y]*T*E,L=e.g*w+h[y+1]*T*E,P=e.b*w+h[y+2]*T*E,O=1-E*(1-T);h[y+3]=Math.floor(Math.min(255,255*O)+.5),O&&(h[y]=Math.floor(A/O+i[n]),h[y+1]=Math.floor(L/O+i[n]),h[y+2]=Math.floor(P/O+i[n]))}n=(n+1)%r}}))}},{key:"calcSpacing",value:function(e){return Gk.mix(2*e/2,2*e/9,Gk.clamp((e-2.7)/9.3,0,1))}},{key:"continueLine",value:function(e,t,n,r){var i,a,o=this;this.drawBuffer=[];var s,l=this.settingSizePressure?Math.max(1,n*this.size):Math.max(1,this.size),c=this.calcSpacing(l),u=e,h=t;if(null===e&&(u=this.lastInput.x,h=this.lastInput.y),0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{var d;if(r)d={r:this.localColOld.r,g:this.localColOld.g,b:this.localColOld.b,a:0};else{var p=[u,h,this.settingSizePressure?Math.max(.5,n*this.size):Math.max(.5,this.size)],f=this.prepDot(p[0],p[1],p[2]);this.copyFromCanvas(f),d=this.getAverage(p[0],p[1],p[2])}s={r:0,g:0,b:0,a:0},d.a>0&&0===this.blendCol.a?(this.blendCol.r=d.r,this.blendCol.g=d.g,this.blendCol.b=d.b,this.blendCol.a=d.a,s.r=this.blendCol.r,s.g=this.blendCol.g,s.b=this.blendCol.b,s.a=this.blendCol.a):(0===d.a&&(d.r=this.color.r,d.g=this.color.g,d.b=this.color.b,d.a=1-this.blending),this.blendCol.r=Gk.mix(this.blendCol.r,Gk.mix(this.blendCol.r,d.r,this.blendMix),d.a),this.blendCol.g=Gk.mix(this.blendCol.g,Gk.mix(this.blendCol.g,d.g,this.blendMix),d.a),this.blendCol.b=Gk.mix(this.blendCol.b,Gk.mix(this.blendCol.b,d.b,this.blendMix),d.a),this.blendCol.a=Math.min(1,this.blendCol.a+d.a),s.r=this.blendCol.r,s.g=this.blendCol.g,s.b=this.blendCol.b,s.a=this.blendCol.a)}var g=function(e){if(!(o.blending>=1&&o.blendCol.a<=0)){var t=e.t;i=o.lastInput2.pressure*(1-t)+n*t,a=o.settingOpacityPressure?o.opacity*i*i:o.opacity,l=o.settingSizePressure?Math.max(.1,i*o.size):Math.max(.1,o.size),0!=o.blending&&(o.mixr=Gk.mix(o.localColOld.r,s.r,t),o.mixg=Gk.mix(o.localColOld.g,s.g,t),o.mixb=Gk.mix(o.localColOld.b,s.b,t)),1===o.blending&&0===o.localColOld.a&&(o.mixr=s.r,o.mixg=s.g,o.mixb=s.b);var r=o.prepDot(e.x,e.y,l);r&&(o.updateRedrawBounds(r),o.drawBuffer.push({x:e.x,y:e.y,size:l,opacity:a,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,r:Gk.mix(o.color.r,o.mixr,o.blending),g:Gk.mix(o.color.g,o.mixg,o.blending),b:Gk.mix(o.color.b,o.mixb,o.blending)}))}};null===e?this.bezierLine.addFinal(c,g):this.bezierLine.add(e,t,c,g),this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){o.drawDot(e)})),this.drawBuffer=[],this.localColOld=s}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e){this.size=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getBlending",value:function(){return this.blending}},{key:"setBlending",value:function(e){this.blending=e}},{key:"setColor",value:function(e){this.color=Gk.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setSizePressure",value:function(e){this.settingSizePressure=!!e}},{key:"setOpacityPressure",value:function(e){this.settingOpacityPressure=!!e}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setIsTesting",value:function(e){this.isTesting=!!e}},{key:"startLine",value:function(e,t,n){var r=this;this.historyEntry={tool:["brush","BlendBrush"],actions:[]};var i=Math.ceil(this.context.canvas.width/DM)*Math.ceil(this.context.canvas.height/DM);this.cells="0".repeat(i).split("").map((function(e){return null})),this.isDrawing=!0,n=Math.max(0,Math.min(1,n));var a=this.settingOpacityPressure?this.opacity*n*n:this.opacity,o=this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size);if(0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{this.copyFromCanvas(this.prepDot(e,t,o));var s=this.getAverage(e,t,this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size));0===s.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:s.r,g:s.g,b:s.b,a:s.a},this.mixr=this.blendCol.r,this.mixg=this.blendCol.g,this.mixb=this.blendCol.b}if(this.localColOld={r:this.mixr,g:this.mixg,b:this.mixb,a:this.blendCol.a},this.redrawBounds=null,this.drawBuffer=[],this.blending<1||this.blendCol.a>0){var l=this.prepDot(e,t,o);l&&(this.updateRedrawBounds(l),this.drawBuffer.push({x:e,y:t,size:o,opacity:a,x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,r:Gk.mix(this.color.r,this.mixr,this.blending),g:Gk.mix(this.color.g,this.mixg,this.blending),b:Gk.mix(this.color.b,this.mixb,this.blending)}))}this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){r.drawDot(e)})),this.drawBuffer=[],this.bezierLine=new Gk.BezierLine,this.bezierLine.add(e,t,0,(function(){})),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2=Gk.copyObj(this.lastInput),this.redrawBounds&&!this.isTesting&&this.drawChangedCells()}},{key:"goLine",value:function(e,t,n,r){this.isDrawing&&(this.continueLine(e,t,this.lastInput.pressure,r),this.lastInput2=Gk.copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.redrawBounds&&!this.isTesting&&this.drawChangedCells())}},{key:"endLine",value:function(){this.bezierLine&&this.continueLine(null,null,this.lastInput.pressure,!1),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&this.drawChangedCells(),this.historyEntry&&this.history&&this.cells.find((function(e){return!!e}))&&(this.historyEntry.actions.push({action:"drawCells",params:[this.cells]}),this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}},{key:"drawCells",value:function(e){var t=this,n=this.getCellsWidth();e.forEach((function(e,r){if(e){var i=r%n*DM,a=Math.floor(r/n)*DM;t.context.putImageData(e,i,a)}}))}},{key:"drawLineSegment",value:function(e,t,n,r){var i=this;if(this.lastInput.x=n,this.lastInput.y=r,!this.isDrawing&&void 0!==e){var a=Math.ceil(this.context.canvas.width/DM)*Math.ceil(this.context.canvas.height/DM);this.cells="0".repeat(a).split("").map((function(e){return null})),this.redrawBounds=null,this.drawBuffer=[],this.copyFromCanvas(this.prepDot(e,t,Math.max(.1,this.size)));var o=this.getAverage(e,t,Math.max(.1,this.size));0===o.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:o.r,g:o.g,b:o.b,a:o.a},this.mixr=this.color.r*(1-this.blendCol.a)+(this.blending*this.blendCol.r+this.color.r*(1-this.blending))*this.blendCol.a,this.mixg=this.color.g*(1-this.blendCol.a)+(this.blending*this.blendCol.g+this.color.g*(1-this.blending))*this.blendCol.a,this.mixb=this.color.b*(1-this.blendCol.a)+(this.blending*this.blendCol.b+this.color.b*(1-this.blending))*this.blendCol.a;for(var s=this.settingOpacityPressure?1*this.opacity*1:this.opacity,l=this.settingSizePressure?Math.max(.1,1*this.size):Math.max(.1,this.size),c=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),u=(n-e)/c,h=(r-t)/c,d=this.calcSpacing(l),p=0;p<=c;p+=d){var f=this.prepDot(e+u*p,t+h*p,l);f&&(this.copyFromCanvas(f),this.drawBuffer.push({x:e+u*p,y:t+h*p,size:l,opacity:s,x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,r:Gk.mix(this.color.r,this.mixr,this.blending),g:Gk.mix(this.color.g,this.mixg,this.blending),b:Gk.mix(this.color.b,this.mixb,this.blending)}))}this.drawBuffer.forEach((function(e){i.drawDot(e)})),this.drawBuffer=[],this.history&&this.cells.find((function(e){return!!e}))&&(this.drawCells(this.cells),this.historyEntry={tool:["brush","BlendBrush"],actions:[{action:"drawCells",params:[this.cells]}]},this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}}}]),e}(),jM=Gk.canvas(32,32),FM=jM.getContext("2d");a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var NM=256;function _M(e,t){for(var n=(t=Gk.copyObj(t)).brush.size,r=t.brush.center.x,i=t.brush.center.y,a=t.aP.y*e.width+t.aP.x,o=4*(t.bP.y*e.width+t.bP.x-a),s=0,l=n>30?1024:512,c=[],u=0;u<l;u++)c[u]=(Math.random()-.5)/1.001+.5;var h=Math.max(3,Math.min(8,t.brush.size-8)),d=function(a,o,u,d){var p,f,g,v=Gk.dist(r,i,u,d),m=1-t.brush.opacity*(1-(g=1,(p=(v-(n-h))/h)<=(f=0)?f:p>=g?g:p));if(1!==m){if(e.data[a+3])if(e.data[o+3]){var y;y=e.data[a+3]<e.data[o+3]?1-e.data[a+3]/e.data[o+3]*(1-m):e.data[o+3]/e.data[a+3]*m,e.data[o]=Math.floor(Gk.mix(e.data[a],e.data[o+0],y)+c[s]),e.data[o+1]=Math.floor(Gk.mix(e.data[a+1],e.data[o+1],y)+c[s]),e.data[o+2]=Math.floor(Gk.mix(e.data[a+2],e.data[o+2],y)+c[s]),s=(s+1)%l}else e.data[o]=e.data[a+0],e.data[o+1]=e.data[a+1],e.data[o+2]=e.data[a+2];else;t.brush.alphaLock||(e.data[o+3]=Math.floor(Gk.mix(e.data[a+3],e.data[o+3],m)+.5))}},p=4*t.bP.x,f=p+4*(t.size.w-1);if(t.aP.y<t.bP.y)for(var g=t.size.h-1,v=t.bP.y+t.size.h-1;g>=0;g--,v--)for(var m=(g+t.bP.y)*e.width*4,y=f+m,x=f+m-o,b=t.bP.x+t.size.w-1;y>=p+m;y-=4,x-=4,b--)d(x,y,b,v);else if(t.aP.y>t.bP.y)for(var w=0,C=t.bP.y;w<t.size.h;w++,C++)for(var S=(w+t.bP.y)*e.width*4,k=f+S,E=f+S-o,T=t.bP.x+t.size.w-1;k>=p+S;k-=4,E-=4,T--)d(E,k,T,C);else if(t.aP.x<t.bP.x)for(var M=t.size.h-1,I=t.bP.y+t.size.h-1;M>=0;M--,I--)for(var R=(M+t.bP.y)*e.width*4,A=f+R,L=f+R-o,P=t.bP.x+t.size.w-1;A>=p+R;A-=4,L-=4,P--)d(L,A,P,I);else for(var O=0,D=t.bP.y;O<t.size.h;O++,D++)for(var B=(O+t.bP.y)*e.width*4,z=p+B,j=p+B-o,F=t.bP.x;z<f+B;z+=4,j+=4,F++)d(j,z,F,D)}var HM=function(){"use strict";function e(){rk.default(this,e),this.history=new DI.DecoyKlHistory,this.settingColor={r:0,g:0,b:0},this.settingSize=35,this.settingSpacing=.20446882736951905,this.settingOpacity=.8,this.settingHasSizePressure=!1,this.settingHasOpacityPressure=!1,this.settingLockLayerAlpha=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.isDrawing=!1,this.bezierLine=null,this.drawBuffer=[]}return ik.default(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=Gk.updateBounds(this.redrawBounds,e)}},{key:"updateCompleteRedrawBounds",value:function(e,t,n,r){this.completeRedrawBounds=Gk.updateBounds(this.completeRedrawBounds,{x1:e,y1:t,x2:n,y2:r})}},{key:"copyFromCanvas",value:function(){var e=this,t=this.copiedCells.map((function(e){return!1})),n=[],r=Math.ceil(this.copyImageData.width/NM);this.redrawBounds&&(n.push({x1:Math.floor(this.redrawBounds.x1/NM),y1:Math.floor(this.redrawBounds.y1/NM),x2:Math.floor(this.redrawBounds.x2/NM),y2:Math.floor(this.redrawBounds.y2/NM)}),n.forEach((function(e){for(var n=e.x1;n<=e.x2;n++)for(var i=e.y1;i<=e.y2;i++)t[i*r+n]=!0})),t.forEach((function(t,n){if(t&&!e.copiedCells[n]){e.copiedCells[n]=!0;var i=n%r,a=Math.floor(n/r),o=(Math.min(i*NM+NM,e.copyImageData.width)-1)%NM+1,s=(Math.min(a*NM+NM,e.copyImageData.height)-1)%NM+1,l=Gk.canvas(o,s).getContext("2d");l.drawImage(e.context.canvas,-i*NM,-a*NM);for(var c=l.getImageData(0,0,o,s),u=0;u<s;u++)for(var h=0,d=u*o*4,p=4*((a*NM+u)*e.copyImageData.width+i*NM);h<o;h++,d+=4,p+=4)e.copyImageData.data[p]=c.data[d],e.copyImageData.data[p+1]=c.data[d+1],e.copyImageData.data[p+2]=c.data[d+2],e.copyImageData.data[p+3]=c.data[d+3]}})))}},{key:"prepDot",value:function(e,t,n,r){if(this.lastDot){n=Math.round(n);var i=Math.round(2*n),a=Math.round(2*n),o=function(e,t,n,r,i){if(n.x===r.x&&n.y===r.y)return null;n=Gk.copyObj(n),r=Gk.copyObj(r),i=Gk.copyObj(i);var a=0,o=0,s=0,l=0;return n.x<0&&(l=-n.x),n.y<0&&(a=-n.y),r.x<0&&(l=Math.max(l,-r.x)),r.y<0&&(a=Math.max(a,-r.y)),n.x+i.w>e&&(o=n.x+i.w-e),n.y+i.h>t&&(s=n.y+i.h-t),r.x+i.w>e&&(o=Math.max(o,r.x+i.w-e)),r.y+i.h>t&&(s=Math.max(s,r.y+i.h-t)),n.x+=l,r.x+=l,n.y+=a,r.y+=a,i.w=i.w-l-o,i.h=i.h-a-s,i.w<=0||i.h<=0?null:{aP:{x:n.x,y:n.y},bP:{x:r.x,y:r.y},size:{w:i.w,h:i.h}}}(this.copyImageData.width,this.copyImageData.height,{x:Math.round(this.lastDot.x-n),y:Math.round(this.lastDot.y-n)},{x:Math.round(e-n),y:Math.round(t-n)},{w:i,h:a});if(o){var s={aP:o.aP,bP:o.bP,size:o.size,brush:{center:{x:e,y:t},size:n,opacity:r,alphaLock:this.settingLockLayerAlpha}};this.updateRedrawBounds({x1:s.bP.x,y1:s.bP.y,x2:s.bP.x+2*s.brush.size,y2:s.bP.y+2*s.brush.size}),this.drawBuffer.push(s)}this.lastDot={x:e,y:t}}else this.lastDot={x:e,y:t}}},{key:"continueLine",value:function(e,t,n,r){var i=this;this.drawBuffer=[],null===this.bezierLine&&(this.bezierLine=new Gk.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,(function(){})));var a=[],o=function(e){var t=Gk.mix(i.lastInput2.pressure,r,e.t),n=i.settingOpacity*(i.settingHasOpacityPressure?t*t:1),o=Math.max(.1,i.settingSize*(i.settingHasSizePressure?t:1));a.push([e.x,e.y,o,n,e.angle])},s=n*this.settingSpacing/3;null===e?this.bezierLine.addFinal(s,o):this.bezierLine.add(e,t,s,o);for(var l=0;l<a.length;l++){var c=a[l];this.prepDot(c[0],c[1],c[2],c[3]),c}this.copyFromCanvas();for(var u=0;u<this.drawBuffer.length;u++)_M(this.copyImageData,this.drawBuffer[u])}},{key:"startLine",value:function(e,t,n){this.historyEntry={tool:["brush","SmudgeBrush"],actions:[]},n=Gk.clamp(n,0,1);var r=this.settingHasOpacityPressure?this.settingOpacity*n*n:this.settingOpacity,i=this.settingHasSizePressure?Math.max(.1,n*this.settingSize):Math.max(.1,this.settingSize);this.lastDot=null,this.isDrawing=!0,this.copyImageData=new ImageData(this.context.canvas.width,this.context.canvas.height);var a=Math.ceil(this.context.canvas.width/NM)*Math.ceil(this.context.canvas.height/NM);this.copiedCells="0".repeat(a).split("").map((function(e){return!1})),this.prepDot(e,t,i,r),this.lineToolLastDot=i*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2.pressure=n,this.completeRedrawBounds=null}},{key:"goLine",value:function(e,t,n){if(this.isDrawing){this.redrawBounds=null;var r=Gk.clamp(n,0,1),i=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,i,this.lastInput.pressure),this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=r}}},{key:"endLine",value:function(){this.redrawBounds=null;var e=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(null,null,e,this.lastInput.pressure),this.context.restore(),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.historyEntry&&this.completeRedrawBounds){var t=this.copyImageData;if(!(0===this.completeRedrawBounds.x1&&0===this.completeRedrawBounds.y1&&this.completeRedrawBounds.x2>=this.context.canvas.width-1&&this.completeRedrawBounds.y2>=this.context.canvas.height-1)){var n=Gk.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);n.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),t=n}this.historyEntry.actions.push({action:"drawImage",params:[t,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}),this.history.push(this.historyEntry),this.historyEntry=void 0}this.copyImageData=null}},{key:"drawImage",value:function(e,t,n){e instanceof ImageData?this.context.putImageData(e,t,n):(this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n))}},{key:"drawLineSegment",value:function(e,t,n,r){}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setColor",value:function(e){this.settingColor.r===e.r&&this.settingColor.g===e.g&&this.settingColor.b===e.b||(this.settingColor={r:e.r,g:e.g,b:e.b},this.settingColorStr=Gk.ColorConverter.toRgbStr(this.settingColor))}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=!!e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=!!e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN"),jT=a("aoONY");var UM,YM=function(){"use strict";function e(){rk.default(this,e),this.settingSize=.25,this.settingOpacity=1,this.settingLockLayerAlpha=!1,this.settingIsEraser=!1,this.settingMode="fill",this.settingDistort=0,this.settingXSymmetry=!1,this.settingYSymmetry=!1,this.settingGradient=!1,this.isDrawing=!1}return ik.default(e,[{key:"updateCompleteRedrawBounds",value:function(e,t){var n={x1:e,y1:t,x2:e,y2:t};this.settingXSymmetry&&(n=Gk.updateBounds(n,{x1:-e+this.copyCanvas.width,y1:t,x2:-e+this.copyCanvas.width,y2:t})),this.settingYSymmetry&&(n=Gk.updateBounds(n,{x1:e,y1:-t+this.copyCanvas.height,x2:e,y2:-t+this.copyCanvas.height}));var r="stroke"===this.settingMode?this.settingSize+1:1;n.x1=Math.floor(n.x1-r),n.y1=Math.floor(n.y1-r),n.x2=Math.ceil(n.x2+r),n.y2=Math.ceil(n.y2+r),this.completeRedrawBounds=Gk.updateBounds(this.completeRedrawBounds,n)}},{key:"drawShape",value:function(){this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(this.copyCanvas,0,0);var e=jT.default({},this.settingColor);if(this.settingIsEraser?(e.r=255,e.g=255,e.b=255,this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),this.path){var t=this,n=new Path2D;this.path.forEach((function(e,t){0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}));var r=Gk.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:this.settingOpacity});if(this.settingGradient){var i=this.path[0].x>this.path[this.path.length-1].x,a=this.context.createLinearGradient(0,i?this.minY:this.maxY,0,i?this.maxY:this.minY);a.addColorStop(0,Gk.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:this.settingOpacity})),a.addColorStop(1,Gk.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:0})),r=a}"fill"===this.settingMode?this.context.fillStyle=r:(this.context.lineWidth=2*this.settingSize,this.context.lineJoin="bevel",this.context.strokeStyle=r);var o=function(){"fill"===t.settingMode?t.context.fill(n):t.context.stroke(n)};o(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,0),this.context.scale(-1,1),this.context.translate(-this.context.canvas.width/2,0),o(),this.context.restore()),this.settingYSymmetry&&(this.context.save(),this.context.translate(0,this.context.canvas.height/2),this.context.scale(1,-1),this.context.translate(0,-this.context.canvas.height/2),o(),this.context.restore(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(-1,-1),this.context.translate(-this.context.canvas.width/2,-this.context.canvas.height/2),o(),this.context.restore()))}this.context.restore()}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return"stroke"===this.settingMode?this.settingSize:0}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setColor",value:function(e){this.settingColor=Gk.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setMode",value:function(e){this.settingMode=e}},{key:"getMode",value:function(){return this.settingMode}},{key:"setDistort",value:function(e){this.settingDistort=Gk.clamp(e,0,1)}},{key:"getDistort",value:function(){return this.settingDistort}},{key:"setXSymmetry",value:function(e){this.settingXSymmetry=!!e}},{key:"getXSymmetry",value:function(){return this.settingXSymmetry}},{key:"setYSymmetry",value:function(e){this.settingYSymmetry=!!e}},{key:"getYSymmetry",value:function(){return this.settingYSymmetry}},{key:"setGradient",value:function(e){this.settingGradient=!!e}},{key:"getGradient",value:function(){return this.settingGradient}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"setIsEraser",value:function(e){this.settingIsEraser=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"startLine",value:function(e,t){this.isDrawing=!0,this.path=[{x:e,y:t}],this.minY=t,this.maxY=t,this.copyCanvas=Gk.canvas(this.context.canvas.width,this.context.canvas.height),this.copyCanvas.getContext("2d").drawImage(this.context.canvas,0,0),this.completeRedrawBounds=null,this.updateCompleteRedrawBounds(e,t)}},{key:"goLine",value:function(e,t){if(this.isDrawing){var n={x:e,y:t};this.settingDistort>0&&(n.x+=(Math.random()-.5)*this.settingDistort*80,n.y+=(Math.random()-.5)*this.settingDistort*80),this.minY=Math.min(this.minY,n.y),this.maxY=Math.max(this.maxY,n.y),this.path.push(n),this.updateCompleteRedrawBounds(e,t),this.drawShape()}}},{key:"endLine",value:function(){if(this.isDrawing=!1,this.completeRedrawBounds=Gk.boundsInArea(this.completeRedrawBounds,this.copyCanvas.width,this.copyCanvas.height),this.path.length>1&&this.completeRedrawBounds){var e=Gk.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);e.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),this.history.push({tool:["brush","ChemyBrush"],actions:[{action:"drawImage",params:[e,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}]})}this.path=null,this.copyCanvas=null}},{key:"drawImage",value:function(e,t,n){this.context.save(),this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n),this.context.restore()}},{key:"drawLineSegment",value:function(e,t,n,r){}}]),e}(),XM={PenBrush:function(){var e,t,n,r,i=function(){if(m!==f&&m!==v)for(var e,t=[[C,128],[S,64],[k,32]],r=0;r<t.length;r++)(e=t[r][0].getContext("2d")).save(),e.clearRect(0,0,t[r][1],t[r][1]),e.fillStyle="rgba("+n.r+", "+n.g+", "+n.b+", "+w[m]+")",e.fillRect(0,0,t[r][1],t[r][1]),e.globalCompositeOperation="destination-in",e.imageSmoothingQuality="high",e.drawImage(OM[m],0,0,t[r][1],t[r][1]),e.restore()},a=function(t,n,i,a,o,s){if(!(i<=0))if(p&&(e.globalCompositeOperation="source-atop"),s&&s[3]===a||(e.globalAlpha=a),s||m!==f&&m!==v||(e.fillStyle=r),m===f)e.beginPath(),e.arc(t,n,i,0,T),e.closePath(),e.fill();else if(m===v)void 0!==o&&(e.save(),e.translate(t,n),e.rotate(o/180*Math.PI),e.fillRect(-i,-i,2*i,2*i),e.restore());else{e.save(),e.translate(t,n);var l=C;i<=32&&i>16?l=S:i<=16&&(l=k),e.scale(i,i),m===g&&e.rotate(53123*(t+n)%T),e.drawImage(l,-1,-1,2,2),e.restore()}},o=function(t,n,r,i){null===E&&(E=new Gk.BezierLine).add(y.x,y.y,0,(function(){}));var o=[];function s(e){var t=Gk.mix(x.pressure,i,e.t),n=u*(d?t*t:1),r=Math.max(.1,l*(h?t:1));o.push([e.x,e.y,r,n,e.angle])}var p,f=r*c;null===t?E.addFinal(f,s):E.add(t,n,f,s),e.save();for(var g=0;g<o.length;g++){var v=o[g];a(v[0],v[1],v[2],v[3],v[4],p),p=v}e.restore()},s=new DI.DecoyKlHistory,l=2,c=.8489,u=1,h=!0,d=!1,p=!1,f=0,g=1,v=3,m=f,y={x:0,y:0,pressure:0},x={x:0,y:0,pressure:0},b=!1,w=[1,.9,1,1],C=document.createElement("canvas");C.width=128,C.height=128;var S=document.createElement("canvas");S.width=64,S.height=64;var k=document.createElement("canvas");k.width=32,k.height=32;var E=null,T=2*Math.PI;this.startLine=function(r,i,o){(t={tool:["brush","PenBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[d]}),t.actions.push({action:"sizePressure",params:[h]}),t.actions.push({action:"setSize",params:[l]}),t.actions.push({action:"setSpacing",params:[c]}),t.actions.push({action:"setOpacity",params:[u]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setAlpha",params:[m]}),t.actions.push({action:"setLockAlpha",params:[p]}),o=Gk.clamp(o,0,1);var s=d?u*o*o:u,f=h?Math.max(.1,o*l):Math.max(.1,l);b=!0,e.save(),a(r,i,f,s),e.restore(),f*c,y.x=r,y.y=i,y.pressure=o,x.pressure=o,t.actions.push({action:"startLine",params:[r,i,o]})},this.goLine=function(n,r,i){if(b){t.actions.push({action:"goLine",params:[n,r,i]});var a=Gk.clamp(i,0,1),s=h?Math.max(.1,y.pressure*l):Math.max(.1,l);e.save(),o(n,r,s,y.pressure),e.restore(),y.x=n,y.y=r,x.pressure=y.pressure,y.pressure=a}},this.endLine=function(n,r){var i=h?Math.max(.1,y.pressure*l):Math.max(.1,l);e.save(),o(null,null,i,y.pressure),e.restore(),b=!1,E=null,t&&(t.actions.push({action:"endLine",params:[n,r]}),s.push(t),t=void 0)},this.drawLineSegment=function(e,t,r,i){if(y.x=r,y.y=i,y.pressure=1,!b&&void 0!==e){var o,f=Gk.pointsToAngleDeg({x:e,y:t},{x:r,y:i}),g=Math.sqrt(Math.pow(r-e,2)+Math.pow(i-t,2)),v=(r-e)/g,x=(i-t)/g,w=l*c;for(o=l*c;o<=g;o+=w)a(e+v*o,t+x*o,l,u,f);var C={tool:["brush","PenBrush"],actions:[]};C.actions.push({action:"opacityPressure",params:[d]}),C.actions.push({action:"sizePressure",params:[h]}),C.actions.push({action:"setSize",params:[l]}),C.actions.push({action:"setSpacing",params:[c]}),C.actions.push({action:"setOpacity",params:[u]}),C.actions.push({action:"setColor",params:[n]}),C.actions.push({action:"setAlpha",params:[m]}),C.actions.push({action:"setLockAlpha",params:[p]}),C.actions.push({action:"drawLineSegment",params:[e,t,r,i]}),s.push(C)}},this.isDrawing=function(){return b},this.setAlpha=function(e){m!==e&&(m=e,i())},this.setColor=function(e){n!==e&&(n={r:e.r,g:e.g,b:e.b},r="rgb("+n.r+","+n.g+","+n.b+")",i())},this.setContext=function(t){e=t},this.setHistory=function(e){s=e},this.setSize=function(e){l=e},this.setOpacity=function(e){u=e},this.setSpacing=function(e){c=e},this.sizePressure=function(e){h=e},this.opacityPressure=function(e){d=e},this.setLockAlpha=function(e){p=e},this.getSpacing=function(){return c},this.getSize=function(){return l},this.getOpacity=function(){return u},this.getLockAlpha=function(e){return p}},BlendBrush:zM,SketchyBrush:function(){var e,t,n,r,i,a=1,o=.2,s=.5,l=1,c=!1,u={x:0,y:0,pressure:0},h=new DI.DecoyKlHistory,d=0;this.setHistory=function(e){h=e},this.setSeed=function(e){d=parseInt(e)},this.getSeed=function(){return parseInt(""+d)};var p=[],f=0,g=[function(e,t){return e},function(e,t){var n=new Gk.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n},function(e,t){var n=new Gk.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n}];this.getSize=function(){return a/2},this.setColor=function(e){t=e},this.getOpacity=function(){return o},this.setOpacity=function(e){o=e},this.getBlending=function(){return s},this.setBlending=function(e){s=e},this.setSize=function(e){a=2*e},this.getScale=function(){return l},this.setScale=function(e){l=e},this.setContext=function(t){e=t},this.startLine=function(e,h,d,p){if(p&&u.x){u.x,u.y;c=!0,this.endLine()}else c=!0,n=e,r=h,u.x=e,u.y=h,(i={tool:["brush","SketchyBrush"],actions:[]}).actions.push({action:"setScale",params:[l]}),i.actions.push({action:"setSize",params:[a/2]}),i.actions.push({action:"setOpacity",params:[o]}),i.actions.push({action:"setColor",params:[t]}),i.actions.push({action:"setBlending",params:[s]}),i.actions.push({action:"startLine",params:[e,h,d]})},this.goLine=function(h,v,m,y){if(c&&(h!==u.x||v!==u.y)){var x,b,w,C,S=parseInt(h),k=parseInt(v);p.push([S,k]);var E=t.r,T=t.g,M=t.b;if(null!==y)E=y.r,T=y.g,M=y.b;else if(0!==s&&S+5>=0&&k+5>=0&&S-5<e.canvas.width-1&&k-5<e.canvas.height-1){E=0,T=0,M=0;var I=Math.min(e.canvas.width-1,Math.max(0,S-5)),R=Math.min(e.canvas.height-1,Math.max(0,k-5)),A=Math.min(e.canvas.width-1,Math.max(0,S+5)),L=Math.min(e.canvas.height-1,Math.max(0,k+5));if(L-=R,(A-=I)>0&&L>0){for(var P=e.getImageData(I,R,A,L),O=0,D=0;D<P.data.length;D+=4)E+=P.data[D+0],T+=P.data[D+1],M+=P.data[D+2],O++;E/=O,T/=O,M/=O}var B=g[0](new Gk.RGB(E,T,M),t);E=parseInt(""+Gk.mix(t.r,B.r,s)),T=parseInt(""+Gk.mix(t.g,B.g,s)),M=parseInt(""+Gk.mix(t.b,B.b,s))}for(e.save(),e.strokeStyle="rgba("+E+", "+T+", "+M+", "+o+")",e.lineWidth=a,e.beginPath(),e.moveTo(n,r),e.lineTo(S,k),x=0;x<p.length;x++)(C=(b=p[x][0]-p[f][0])*b+(w=p[x][1]-p[f][1])*w)<4e3*l*l&&(d++,.5*Math.sin(6324634.2345*Math.cos(5342.3423*d))+.5>C/2e3/l/l)&&(e.moveTo(p[f][0]+.3*b,p[f][1]+.3*w),e.lineTo(p[x][0]-.3*b,p[x][1]-.3*w));e.stroke(),e.restore(),f++,n=S,r=k,u.x=S,u.y=k,i.actions.push({action:"goLine",params:[h,v,m,{r:E,g:T,b:M}]})}},this.endLine=function(){c=!1,f=0,p=[],i&&(i.actions.push({action:"endLine",params:[]}),h.push(i),i=void 0)},this.drawLineSegment=function(n,r,i,d){if(u.x=i,u.y=d,!c&&void 0!==n){e.save(),e.lineWidth=a;var p=t.r,f=t.g,v=t.b;if(n+5>=0&&r+5>=0&&n-5<e.canvas.width-1&&r-5<e.canvas.height-1){p=0,f=0,v=0;var m=Math.min(e.canvas.width-1,Math.max(0,n-5)),y=Math.min(e.canvas.height-1,Math.max(0,r-5)),x=Math.min(e.canvas.width-1,Math.max(0,n+5)),b=Math.min(e.canvas.height-1,Math.max(0,r+5));if(b-=y,(x-=m)>0&&b>0){var w=Math.min(jM.width,x),C=Math.min(jM.height,b);FM.save(),FM.globalCompositeOperation="copy",FM.drawImage(e.canvas,m,y,x,b,0,0,w,C),FM.restore();for(var S=FM.getImageData(m,y,x,b),k=0,E=0;E<S.data.length;E+=4)p+=S.data[E+0],f+=S.data[E+1],v+=S.data[E+2],k++;p/=k,f/=k,v/=k}}var T=g[0](new Gk.RGB(p,f,v),t);p=parseInt(""+(s*T.r+t.r*(1-s))),f=parseInt(""+(s*T.g+t.g*(1-s))),v=parseInt(""+(s*T.b+t.b*(1-s))),e.strokeStyle="rgba("+p+", "+f+", "+v+", "+o+")",e.beginPath(),e.moveTo(n,r),e.lineTo(i,d),e.stroke(),e.strokeStyle="rgba("+p+", "+f+", "+v+", "+o+")",e.restore();var M={tool:["brush","SketchyBrush"],actions:[]};M.actions.push({action:"setScale",params:[l]}),M.actions.push({action:"setSize",params:[a/2]}),M.actions.push({action:"setOpacity",params:[o]}),M.actions.push({action:"setColor",params:[t]}),M.actions.push({action:"setBlending",params:[s]}),M.actions.push({action:"drawLineSegment",params:[n,r,i,d]}),h.push(M)}},this.isDrawing=function(){return c}},PixelBrush:function(){var e,t,n,r,i,a=function(){k.clearRect(0,0,4,4),k.fillStyle=m?"#fff":r;for(var t=0;t<Math.max(1,Math.round(p*E.length));t++)k.fillRect(E[t][0],E[t][1],1,1);i=e.createPattern(S,"repeat")},o=function(t,n,a,o,s){e.save(),m?(e.fillStyle=y?i:"#fff",e.globalCompositeOperation=v?"source-atop":"destination-out"):(e.fillStyle=y?i:r,v&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=y?1:p,t=Math.floor(t),n=Math.floor(n),a=Math.floor(a),o=Math.floor(o);for(var l=Math.abs(a-t),c=t<a?1:-1,u=-Math.abs(o-n),h=n<o?1:-1,d=l+u;s?s=!1:e.fillRect(t,n,1,1),t!==a||n!==o;){var f=2*d;f>=u&&(d+=u,t+=c),f<=l&&(d+=l,n+=h)}e.restore()},s=function(e,t,n,r){var i=function(e,t,n,r,i){var a=Gk.Vec2.nor({x:r.x-e.x,y:r.y-e.y}),o=Gk.Vec2.nor({x:t.x-e.x,y:t.y-e.y}),s=Gk.Vec2.nor({x:r.x-n.x,y:r.y-n.y});return Math.abs(Gk.Vec2.angle(a,o)%Math.PI),Math.PI,Math.abs(Gk.Vec2.angle(a,s)%Math.PI),Math.PI,Math.max(Gk.Vec2.dist(a,o),Gk.Vec2.dist(a,s))>i}(e,t,n,r,.1);e.x=Math.floor(e.x),e.y=Math.floor(e.y),r.x=Math.floor(r.x),r.y=Math.floor(r.y);var a=Gk.dist(e.x,e.y,r.x,r.y);if(!i||a<7)o(e.x,e.y,r.x,r.y,!0);else{for(var s=Math.max(2,Math.round(a/4)),l=[],c=0;c<=s;c++){var u=c/s,h=Math.pow(1-u,3),d=3*u*Math.pow(1-u,2),p=3*Math.pow(u,2)*(1-u),f=Math.pow(u,3);l.push({x:h*e.x+d*t.x+p*n.x+f*r.x,y:h*e.y+d*t.y+p*n.y+f*r.y})}for(var g=0;g<s;g++)o(Math.round(l[g].x),Math.round(l[g].y),Math.round(l[g+1].x),Math.round(l[g+1].y),!0)}},l=function(t,n,a,o,s){e.save(),m?(e.fillStyle=y?i:"#fff",e.globalCompositeOperation=v?"source-atop":"destination-out"):(e.fillStyle=y?i:r,v&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=y?1:o,e.fillRect(Math.round(t+-a),Math.round(n+-a),Math.round(2*a),Math.round(2*a)),e.restore()},c=function(t,n,r,i){function a(e){var t=Gk.mix(b.pressure,i,e.t),n=p*(g?t*t:1),r=Math.max(.5,h*(f?t:1));l(e.x,e.y,r,n,e.angle)}function o(e){s(e.p1,e.p2,e.p3,e.p4)}if(null===C&&(C=new Gk.BezierLine).add(x.x,x.y,0,(function(){})),e.save(),1===Math.round(2*h))null===t?C.addFinal(4,null,o):C.add(t,n,4,null,o);else{var c=r*d;null===t?C.addFinal(c,a):C.add(t,n,c,a)}e.restore()},u=new DI.DecoyKlHistory,h=.5,d=.9,p=1,f=!0,g=!1,v=!1,m=!1,y=!0,x={x:0,y:0,pressure:0},b={x:0,y:0,pressure:0},w=!1,C=null,S=(Math.PI,Gk.canvas(4,4)),k=S.getContext("2d"),E=[[3,2],[1,0],[3,0],[1,2],[2,1],[0,3],[0,1],[2,3],[2,0],[0,2],[0,0],[2,2],[1,1],[3,3],[3,1],[1,3]];this.startLine=function(e,r,i){(t={tool:["brush","PixelBrush"],actions:[]}).actions.push({action:"sizePressure",params:[f]}),t.actions.push({action:"setSize",params:[h]}),t.actions.push({action:"setSpacing",params:[d]}),t.actions.push({action:"setOpacity",params:[p]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setLockAlpha",params:[v]}),t.actions.push({action:"setIsEraser",params:[m]}),t.actions.push({action:"setUseDither",params:[y]}),y&&a(),i=Math.max(0,Math.min(1,i));var o=g?p*i*i:p,s=f?Math.max(.5,i*h):Math.max(.5,h);w=!0,l(e,r,s,o),s*d,x.x=e,x.y=r,x.pressure=i,b=Gk.copyObj(x),t.actions.push({action:"startLine",params:[e,r,i]})},this.goLine=function(e,n,r){if(w){t.actions.push({action:"goLine",params:[e,n,r]});var i=Gk.clamp(r,0,1),a=f?Math.max(.1,x.pressure*h):Math.max(.1,h);c(e,n,a,x.pressure),b=Gk.copyObj(x),x.x=e,x.y=n,x.pressure=i}},this.endLine=function(e,n){var r=f?Math.max(.1,x.pressure*h):Math.max(.1,h);c(null,null,r,x.pressure),w=!1,C=null,t&&(t.actions.push({action:"endLine",params:[e,n]}),u.push(t),t=void 0)},this.drawLineSegment=function(e,t,r,i){if(x.x=r,x.y=i,x.pressure=1,!w&&void 0!==e){if(y&&a(),1===Math.round(2*h))o(e,t,r,i,!0);else{Gk.pointsToAngleDeg({x:e,y:t},{x:r,y:i});var s,c=Math.sqrt(Math.pow(r-e,2)+Math.pow(i-t,2)),g=(r-e)/c,b=(i-t)/c,C=h*d;for(s=h*d;s<=c;s+=C)l(e+g*s,t+b*s,h,p)}var S={tool:["brush","PixelBrush"],actions:[]};S.actions.push({action:"sizePressure",params:[f]}),S.actions.push({action:"setSize",params:[h]}),S.actions.push({action:"setSpacing",params:[d]}),S.actions.push({action:"setOpacity",params:[p]}),S.actions.push({action:"setColor",params:[n]}),S.actions.push({action:"setLockAlpha",params:[v]}),S.actions.push({action:"setIsEraser",params:[m]}),S.actions.push({action:"setUseDither",params:[y]}),S.actions.push({action:"drawLineSegment",params:[e,t,r,i]}),u.push(S)}},this.isDrawing=function(){return w},this.setColor=function(e){n!==e&&(r="rgb("+(n=e).r+","+n.g+","+n.b+")")},this.setContext=function(t){e=t},this.setHistory=function(e){u=e},this.setSize=function(e){h=e},this.setOpacity=function(e){p=e},this.setSpacing=function(e){d=e},this.sizePressure=function(e){f=e},this.opacityPressure=function(e){g=e},this.setLockAlpha=function(e){v=e},this.setIsEraser=function(e){m=!!e},this.setUseDither=function(e){y=!!e},this.getSpacing=function(){return d},this.getSize=function(){return h},this.getOpacity=function(){return p},this.getLockAlpha=function(){return v},this.getIsEraser=function(){return m},this.getUseDither=function(){return y}},ChemyBrush:YM,SmudgeBrush:HM,EraserBrush:function(){var e,t,n,r=function(t,n,r,i){e.save(),e.globalCompositeOperation=f?g?"destination-out":"source-atop":"destination-out";var a=e.createRadialGradient(r,r,0,r,r,r),o=Math.pow(i,2);o=Math.max(0,Math.min((r-1)/r,o));var s=Math.max(0,Math.min(1,i)),l=2*s-s*s;a.addColorStop(o,"rgba(255, 255, 255, "+l+")"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=a,e.translate(t-r,n-r),e.fillRect(0,0,2*r,2*r),e.restore()},i=function(e,t,i){var a,h;i=Math.max(0,Math.min(1,i));var p=c?Math.max(.1,i*o):Math.max(.1,o),f=Math.max(1,Math.max(.5,1-l)*p*s);function g(e){var t=e.t;a=d.pressure*(1-t)+i*t,h=u?l*a*a:l,p=c?Math.max(.1,a*o):Math.max(.1,o),r(e.x,e.y,p,h)}null===e?n.addFinal(f,g):n.add(e,t,f,g)},a=new DI.DecoyKlHistory,o=30,s=.4,l=1,c=!0,u=!1,h={x:0,y:0,pressure:0},d={x:0,y:0,pressure:0},p=!1,f=!1,g=!1;this.startLine=function(i,a,v){(t={tool:["brush","EraserBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[u]}),t.actions.push({action:"sizePressure",params:[c]}),t.actions.push({action:"setSize",params:[o]}),t.actions.push({action:"setOpacity",params:[l]}),t.actions.push({action:"setTransparentBG",params:[g]}),f=0===e.canvas.index,v=Math.max(0,Math.min(1,v));var m=u?l*v*v:l,y=c?Math.max(.1,v*o):Math.max(.1,o);p=!0,y>1&&r(i,a,y,m),y*s,h.x=i,h.y=a,h.pressure=v,d=Gk.copyObj(h),(n=new Gk.BezierLine).add(i,a,0,(function(){})),t.actions.push({action:"startLine",params:[i,a,v]})},this.goLine=function(e,n,r){p&&(t.actions.push({action:"goLine",params:[e,n,r]}),i(e,n,h.pressure),d=Gk.copyObj(h),h.x=e,h.y=n,h.pressure=r)},this.endLine=function(){n&&i(null,null,h.pressure),p=!1,n=void 0,t&&(t.actions.push({action:"endLine",params:[]}),a.push(t),t=void 0)},this.drawLineSegment=function(t,n,i,d){if(f=0===e.canvas.index,h.x=i,h.y=d,!p&&void 0!==t){var v,m=Math.sqrt(Math.pow(i-t,2)+Math.pow(d-n,2)),y=(i-t)/m,x=(d-n)/m,b=Math.max(1,Math.max(.5,1-l)*o*s);for(v=0;v<=m;v+=b)r(t+y*v,n+x*v,o,l);var w={tool:["brush","EraserBrush"],actions:[]};w.actions.push({action:"opacityPressure",params:[u]}),w.actions.push({action:"sizePressure",params:[c]}),w.actions.push({action:"setSize",params:[o]}),w.actions.push({action:"setOpacity",params:[l]}),w.actions.push({action:"setTransparentBG",params:[g]}),w.actions.push({action:"drawLineSegment",params:[t,n,i,d]}),a.push(w)}},this.isDrawing=function(){return p},this.setContext=function(t){e=t},this.setHistory=function(e){a=e},this.setSize=function(e){o=e},this.setOpacity=function(e){l=e},this.sizePressure=function(e){c=e},this.opacityPressure=function(e){u=e},this.setTransparentBG=function(e){g=1==e},this.getSize=function(){return o},this.getOpacity=function(){return l}}},VM=20;UM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("iiCd6");var WM,GM,KM,qM=(WM={image:t(UM),tooltip:dE("brush-pen"),sizeSlider:{min:.5,max:100,curve:Gk.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},GM=[dE("brush-pen-circle"),dE("brush-pen-chalk"),dE("brush-pen-calligraphy"),dE("brush-pen-square")],hE.subscribe((function(){WM.tooltip=dE("brush-pen"),GM=[dE("brush-pen-circle"),dE("brush-pen-chalk"),dE("brush-pen-calligraphy"),dE("brush-pen-square")]})),WM.Ui=function(e){var t,n,r=function(){for(var e=0;e<s.length;e++)s[e].className=e===l?"brush-alpha-selected":"brush-alpha"},i=function(e){o.setSize(e),o.setSpacing(Math.max(2,h.interpolate(e))/15)},a=document.createElement("div"),o=new XM.PenBrush;o.setHistory(Zk),e.onSizeChange(o.getSize());for(var s=[],l=0,c=0;c<4;c++)!function(e){var t=Gk.el({title:GM[e],onClick:function(){var t;l=t=e,o.setAlpha(t),r()}}),n=Gk.canvas(70,70),i=n.getContext("2d");0===e||3===e?0===e?(i.beginPath(),i.arc(35,35,30,0,2*Math.PI),i.closePath(),i.fill()):i.fillRect(5,5,60,60):1===e?i.drawImage(AM(60),5,5):2===e&&i.drawImage(PM(60),5,5),t.style.backgroundImage="url("+n.toDataURL("image/png")+")",s.push(t)}(c);r();var u=new gE({init:o.getLockAlpha(),label:dE("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:dE("brush-lock-alpha-title"),css:{cssFloat:"right",textAlign:"right"}}),h=new Gk.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new kE({label:dE("brush-size"),width:225,height:30,min:WM.sizeSlider.min,max:WM.sizeSlider.max,initValue:o.getSize(),eventResMs:VM,onChange:function(t){i(t),e.onSizeChange(t)},curve:WM.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),n=new kE({label:dE("opacity"),width:225,height:30,min:WM.opacitySlider.min,max:WM.opacitySlider.max,initValue:WM.opacitySlider.max,eventResMs:VM,onChange:function(t){o.setOpacity(t),e.onOpacityChange(t)},curve:WM.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var r=CE(!1,(function(e){o.sizePressure(e)})),l=CE(!1,(function(e){o.opacityPressure(e)}));a.append(Gk.el({content:[t.getElement(),r],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),Gk.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));for(var c=document.createElement("div"),h=0;h<s.length;h++)c.appendChild(s[h]);c.style.marginTop="10px",a.appendChild(c),c.appendChild(u.getElement())}(),this.increaseSize=function(e){o.isDrawing()||t.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||t.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),n.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine(e,t)},this.getBrush=function(){return o},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},WM);KM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("6fRlX");var JM,ZM=function(){var e={image:t(KM),tooltip:dE("brush-blend"),sizeSlider:{min:.5,max:100,curve:Gk.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1},Ui:null};return hE.subscribe((function(){e.tooltip=dE("brush-blend")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new XM.BlendBrush;o.setHistory(Zk),t.onSizeChange(o.getSize()),function(){n=new kE({label:dE("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:29,eventResMs:VM,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return e*=2,Math.round(e)}}),r=new kE({label:dE("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:VM,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var s=new kE({label:dE("brush-blending"),width:225,height:30,min:0,max:100,initValue:100*o.getBlending(),eventResMs:VM,onChange:function(e){o.setBlending(e/100)}});s.getElement().style.marginTop="10px";var l=CE(!1,(function(e){o.setSizePressure(e)})),c=CE(!1,(function(e){o.setOpacityPressure(e)})),u=new gE({init:o.getLockAlpha(),label:dE("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:dE("brush-lock-alpha-title"),css:{marginTop:"10px",display:"inline-block"}});a.append(Gk.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),Gk.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),s.getElement(),u.getElement())}(),this.increaseSize=function(e){o.getIsDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n,r){o.goLine(e,t,n,r)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}();JM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("hC7PC");var QM,$M=function(){var e={image:t(JM),tooltip:dE("brush-sketchy"),sizeSlider:{min:.5,max:10},opacitySlider:{min:.01,max:1},Ui:null};return hE.subscribe((function(){e.tooltip=dE("brush-sketchy")})),e.Ui=function(t){var n,r,i=document.createElement("div"),a=new XM.SketchyBrush;a.setHistory(Zk),t.onSizeChange(a.getSize()),function(){n=new kE({label:dE("brush-size"),width:250,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:a.getSize(),eventResMs:VM,onChange:function(e){a.setSize(e),t.onSizeChange(a.getSize())},formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new kE({label:dE("opacity"),width:250,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:a.getOpacity(),eventResMs:VM,onChange:function(e){a.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var o=new kE({label:dE("brush-blending"),width:250,height:30,min:0,max:100,initValue:100*a.getBlending(),eventResMs:VM,onChange:function(e){a.setBlending(e/100)}}),s=new kE({label:dE("brush-sketchy-scale"),width:250,height:30,min:1,max:20,initValue:a.getScale(),eventResMs:VM,onChange:function(e){a.setScale(e)}});r.getElement().style.marginTop="10px",o.getElement().style.marginTop="10px",s.getElement().style.marginTop="10px",i.appendChild(n.getElement()),i.appendChild(r.getElement()),i.appendChild(o.getElement()),i.appendChild(s.getElement())}(),this.increaseSize=function(e){a.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){a.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return a.getSize()},this.setSize=function(e){!function(e){a.setSize(e)}(e),n.setValue(e)},this.getOpacity=function(){return a.getOpacity()},this.setOpacity=function(e){a.setOpacity(e),r.setValue(e)},this.setColor=function(e){a.setColor(e)},this.setContext=function(e){a.setContext(e)},this.startLine=function(e,t,n){a.startLine(e,t,n)},this.goLine=function(e,t,n){a.goLine(e,t,n,null)},this.endLine=function(){a.endLine()},this.getSeed=function(){return parseInt(a.getSeed())},this.setSeed=function(e){a.setSeed(parseInt(e))},this.getBrush=function(){return a},this.isDrawing=function(){return a.isDrawing()},this.getElement=function(){return i}},e}();QM=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("eZgVv");var eI,tI=function(){var e={image:t(QM),tooltip:dE("brush-pixel"),sizeSlider:{min:.5,max:100,curve:Gk.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null};return hE.subscribe((function(){e.tooltip=dE("brush-pixel")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e),o.setSpacing(u.interpolate(e)/e)},a=document.createElement("div"),o=new XM.PixelBrush;o.setHistory(Zk),t.onSizeChange(o.getSize());var s=new gE({init:o.getLockAlpha(),label:dE("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:dE("brush-lock-alpha-title"),css:{marginRight:"10px"}}),l=new gE({init:o.getIsEraser(),label:dE("eraser"),callback:function(e){o.setIsEraser(e)},css:{marginRight:"10px"}}),c=new gE({init:o.getUseDither(),label:dE("brush-pixel-dither"),callback:function(e){o.setUseDither(e)}}),u=new Gk.SplineInterpolator([[.5,.45],[100,4]]);!function(){n=new kE({label:dE("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:VM,onChange:function(e){e=Math.round(2*e)/2,i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return e*=2,Math.round(e)}}),r=new kE({label:dE("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:e.opacitySlider.max,eventResMs:VM,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},curve:e.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var u=CE(!1,(function(e){o.sizePressure(e)}));a.append(Gk.el({content:[n.getElement(),u],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),r.getElement());var h=Gk.el({parent:a,css:{display:"flex",marginTop:"10px"}});h.appendChild(s.getElement()),h.appendChild(l.getElement()),h.appendChild(c.getElement())}(),this.increaseSize=function(e){o.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine(e,t)},this.getBrush=function(){return o},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},e}();eI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("fPZin");var nI,rI=function(){var e={image:t(eI),tooltip:dE("eraser")+" [E]",sizeSlider:{min:.5,max:200,curve:Gk.quadraticSplineInput(.5,200,.1)},opacitySlider:{min:.01,max:1},Ui:null};return hE.subscribe((function(){e.tooltip=dE("eraser")+" [E]"})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new XM.EraserBrush;o.setHistory(Zk),t.onSizeChange(o.getSize());var s=!1;!function(){n=new kE({label:dE("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:30,eventResMs:VM,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new kE({label:dE("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:1,eventResMs:VM,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var l=CE(!1,(function(e){o.sizePressure(e)})),c=CE(!1,(function(e){o.opacityPressure(e)}));a.append(Gk.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),Gk.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));var u=new gE({init:!1,label:dE("brush-eraser-transparent-bg"),callback:function(e){s=e,o.setTransparentBG(e)},css:{marginTop:"10px"}});a.appendChild(u.getElement())}(),this.increaseSize=function(e){o.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.getIsTransparentBg=function(){return s},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},e}();nI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("fp7H1");var iI,aI=function(){var e={image:t(nI),tooltip:dE("brush-smudge"),sizeSlider:{min:.5,max:100,curve:Gk.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null};return hE.subscribe((function(){e.tooltip=dE("brush-smudge")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e),o.setSpacing(Math.max(2,l.interpolate(e))/15)},a=document.createElement("div"),o=new XM.SmudgeBrush;o.setHistory(Zk),t.onSizeChange(o.getSize());var s=new gE({init:o.getLockAlpha(),label:dE("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:dE("brush-lock-alpha-title")}),l=new Gk.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){n=new kE({label:dE("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:VM,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new kE({label:dE("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:VM,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},curve:e.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var l=CE(!1,(function(e){o.sizePressure(e)})),c=CE(!1,(function(e){o.opacityPressure(e)}));a.append(Gk.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),Gk.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),Gk.el({parent:a,css:{marginTop:"10px"}}).append(s.getElement())}(),this.increaseSize=function(e){o.getIsDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}();iI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("eX098"),a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var oI=function(){"use strict";function e(t){var n=this;rk.default(this,e),this.value=!!t.init,this.el=Gk.el({content:t.label,title:t.title,className:"string"==typeof t.label?"kl-box-toggle":"kl-box-toggle kl-box-toggle--custom-el",onClick:function(){n.value=!n.value,n.update(),t.onChange(n.value)},css:{cursor:"pointer"}}),"string"!=typeof t.label&&Gk.css(t.label,{display:"block",pointerEvents:"none"}),this.update()}return ik.default(e,[{key:"update",value:function(){this.value?Gk.addClassName(this.el,"kl-box-toggle--active"):Gk.removeClassName(this.el,"kl-box-toggle--active")}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=!!e,this.update()}},{key:"getElement",value:function(){return this.el}},{key:"destroy",value:function(){Gk.destroyEl(this.el)}}]),e}(),sI=function(){var e={image:t(iI),tooltip:dE("brush-chemy"),sizeSlider:{min:.25,max:25,curve:Gk.quadraticSplineInput(.25,25,.1),isDisabled:!0},opacitySlider:{min:.01,max:1},Ui:null};return hE.subscribe((function(){e.tooltip=dE("brush-chemy")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new XM.ChemyBrush;o.setHistory(Zk),t.onSizeChange(o.getSize()),function(){n=new kE({label:dE("brush-size"),width:250,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:VM,isEnabled:"stroke"===o.getMode(),onChange:function(e){i(e),t.onSizeChange(o.getSize())},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<5?Math.round(10*e)/10:Math.round(e)}}),r=new kE({label:dE("opacity"),width:250,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:VM,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}}),Gk.css(r.getElement(),{marginTop:"10px"});var s=new gE({init:o.getIsEraser(),label:dE("eraser"),callback:function(e){o.setIsEraser(e)},css:{marginTop:"10px",marginLeft:"10px"}}),l=new gE({init:o.getLockAlpha(),label:dE("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:dE("brush-lock-alpha-title"),css:{marginTop:"10px"}}),c=Gk.el({css:{display:"flex",marginTop:"10px"}}),u=19,h=new AE({optionArr:[{id:"fill",label:Gk.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"#000",style:"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(u,", ").concat(u,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:dE("brush-chemy-fill")},{id:"stroke",label:Gk.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(u,", ").concat(u,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:dE("brush-chemy-stroke")}],initId:o.getMode(),onChange:function(r){o.setMode(r),e.sizeSlider.isDisabled="fill"===o.getMode(),n.setIsEnabled(!e.sizeSlider.isDisabled),n.setValue(o.getSize()),t.onSizeChange(o.getSize()),t.onConfigChange()}}),d=new oI({label:Gk.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(17.5,",").concat(8," ").concat(17.5,",").concat(27)}]}),title:dE("brush-chemy-mirror-x"),init:o.getXSymmetry(),onChange:function(e){o.setXSymmetry(e)}}),p=new oI({label:Gk.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(8,",").concat(17.5," ").concat(27,",").concat(17.5)}]}),title:dE("brush-chemy-mirror-y"),init:o.getYSymmetry(),onChange:function(e){o.setYSymmetry(e)}}),f=new oI({label:Gk.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"defs",childrenArr:[{elementType:"linearGradient",id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",childrenArr:[{elementType:"stop",offset:"0%","stop-color":"rgba(0,0,0,0)"},{elementType:"stop",offset:"100%","stop-color":"rgba(0,0,0,1)"}]}]},{elementType:"rect",fill:"url('#gradient')",x:"8",y:"8",width:"19",height:"19"}]}),title:dE("brush-chemy-gradient"),init:o.getGradient(),onChange:function(e){o.setGradient(e)}});Gk.css(d.getElement(),{marginLeft:"10px"});var g={marginLeft:"4px"};Gk.css(p.getElement(),g),Gk.css(f.getElement(),g),c.append(h.getElement(),d.getElement(),p.getElement(),f.getElement()),a.append(n.getElement(),r.getElement(),c,Gk.el({content:[l.getElement(),s.getElement()],css:{display:"flex"}}))}(),this.increaseSize=function(e){o.getIsDrawing()||"stroke"!==o.getMode()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||"stroke"!==o.getMode()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t)},this.goLine=function(e,t,n,r){o.goLine(e,t)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}(),lI={penBrush:qM,blendBrush:ZM,sketchyBrush:$M,pixelBrush:tI,chemyBrush:sI,smudgeBrush:aI,eraserBrush:rI};function cI(e,t){if(t||!(window.innerHeight<500||window.innerWidth<700)){var n,r=Gk.el({tagName:"iframe",custom:{src:e},css:{width:"100%",height:"100%"}}),i=Gk.el({});t||(n=Gk.el({tagName:"a",parent:i,content:dE("modal-new-tab"),custom:{href:"help",target:"_blank"},onClick:function(){a.close()}}),r.onload=function(){Gk.setAttributes(n,{href:""+r.contentWindow.location})});var a=new fE({title:i,content:r,width:880,isMaxHeight:!0,onClose:function(){n&&Gk.destroyEl(n)}})}else window.open(e)}a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var uI=function(){"use strict";function e(t){var n=this;rk.default(this,e),this.inputs=[],this.el=Gk.el({className:"kl-radio"}),t.items.forEach((function(e){var r=Gk.el({tagName:"label"}),i=Gk.el({tagName:"input",parent:r,custom:{name:t.name,value:e.value,type:"radio"}});t.ignoreFocus&&i.setAttribute("data-ignore-focus","true"),t.init===e.value&&(i.checked=!0),r.append(e.label),n.el.append(r),n.inputs.push(i)}))}return ik.default(e,[{key:"getValue",value:function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return null}},{key:"getElement",value:function(){return this.el}}]),e}();a("4gaLD");rk=a("5nGP2"),o=a("1ELdT"),ik=a("8TCpN");var hI=function(){"use strict";function e(n,r,i,a){var l=this;rk.default(this,e);var c=this;this.projectStore=n,this.getProject=r,this.saveReminder=i,this.klRootEl=a,this.element=Gk.el({css:{display:"grid",gridTemplateColumns:"1fr 0fr",gridTemplateRows:"0fr 0fr 0fr",gap:"0 0",gridTemplateAreas:'"title title" "preview store" "preview clear"'}});var u=Gk.el({parent:this.element,content:dE("file-storage"),css:{gridArea:"title",display:"flex",margin:"-5px 0"}});Gk.el({parent:u,content:"?",title:dE("file-storage-about"),css:{cursor:"pointer",marginLeft:"5px",width:"19px",height:"19px",borderRadius:"100%",textAlign:"center",lineHeight:"19px",fontWeight:"bold",boxShadow:"inset 0 0 0 1px #000"},onClick:function(){cI("./help/#help-browser-storage",!1)}});this.projectStore.isBroken()?Gk.el({parent:this.element,content:"🔴 "+dE("file-storage-cant-access"),css:{marginTop:"10px"}}):(this.previewEl=Gk.el({parent:this.element,title:dE("file-storage-thumb-title"),css:{gridArea:"preview",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"10px",position:"relative",boxShadow:"inset 0 0 0 1px #aaa",background:"#cdcdcd",color:"#545454",colorScheme:"only light"}}),this.ageEl=Gk.el({css:{position:"absolute",right:"0",bottom:"0",width:"100%",textAlign:"center",background:"rgba(0,0,0,0.7)",color:"#fff",textSize:"13px"}}),this.storeEl=Gk.el({parent:this.element,tagName:"button",className:"gridButton",content:dE("file-storage-store"),css:{gridArea:"store"},custom:{tabIndex:-1},onClick:function(){return l.store()}}),this.storeEl.tabIndex=-1,this.clearEl=Gk.el({parent:this.element,tagName:"button",className:"gridButton",content:'<img src="'+t(FE)+'" height="20"/> '+dE("file-storage-clear"),css:{gridArea:"clear"},custom:{tabIndex:-1},onClick:function(){return l.clear()}}),this.projectStore.subscribe({onUpdate:function(e,t){l.updateThumb(e,t)}}),setInterval((function(){return l.updateAge()}),6e4),o.default(t(s).mark((function e(){var n;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.projectStore.read();case 3:(n=e.sent)?c.updateThumb(n.timestamp,n.thumbnail):c.updateThumb(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),setTimeout((function(){throw new Error("storage-ui: failed initial read browser storage, "+e.t0)}),0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))())}return ik.default(e,[{key:"updateAge",value:function(){if(this.timestamp){var e,t=(new Date).getTime()-this.timestamp;t=Math.floor(t/1e3/60),e=dE("file-storage-min-ago").replace("{x}",""+t),t>60&&(t=Math.floor(t/60),e=dE("file-storage-hours-ago").replace("{x}",""+t),t>24&&(t=Math.floor(t/24),e=dE("file-storage-days-ago").replace("{x}",""+t),t>31&&(e=dE("file-storage-month-ago")))),this.ageEl.textContent=e}}},{key:"resetButtons",value:function(){this.timestamp?(this.storeEl.textContent=dE("file-storage-overwrite"),this.storeEl.disabled=!1,this.clearEl.disabled=!1):(this.storeEl.textContent=dE("file-storage-store"),this.storeEl.disabled=!1,this.clearEl.disabled=!0)}},{key:"updateThumb",value:function(e,t){this.timestamp=e,this.timestamp?(Gk.css(t,{display:"block",maxWidth:"calc(100% - 2px)",maxHeight:"calc(100% - 2px)",margin:"0 auto",background:"url('"+Gk.createCheckerCanvas(4).toDataURL("image/png")+"')",boxShadow:"0 0 0 1px #aaa",pointerEvents:"none"}),this.previewEl.innerHTML="",this.updateAge(),this.previewEl.append(t,this.ageEl)):this.previewEl.innerHTML=dE("file-storage-empty"),this.resetButtons()}},{key:"store",value:function(){return o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storeEl.textContent=dE("file-storage-storing"),this.storeEl.disabled=!0,this.clearEl.disabled=!0,e.next=5,new Promise((function(e){setTimeout((function(){return e(null)}),20)}));case 5:return e.prev=5,e.next=8,this.projectStore.store(this.getProject());case 8:this.saveReminder.reset(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(5),this.resetButtons(),DI.popup({target:this.klRootEl,type:"error",message:["".concat(dE("file-storage-failed-1"),"<ul>"),"<li>".concat(dE("file-storage-failed-2"),"</li>"),"<li>".concat(dE("file-storage-failed-3"),"</li>"),"<li>".concat(dE("file-storage-failed-4"),"</li>"),"</ul>"].join(""),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to store browser storage, "+e.t0)}),0);case 16:case"end":return e.stop()}}),e,this,[[5,11]])})).bind(this))()}},{key:"clear",value:function(){return o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storeEl.disabled=!0,this.clearEl.disabled=!0,e.prev=2,e.next=5,this.projectStore.clear();case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),this.resetButtons(),DI.popup({target:this.klRootEl,type:"error",message:dE("file-storage-failed-clear"),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to clear browser storage, "+e.t0)}),0);case 12:case"end":return e.stop()}}),e,this,[[2,7]])})).bind(this))()}},{key:"getElement",value:function(){return this.element}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),e}();a("4gaLD");rk=a("5nGP2"),o=a("1ELdT"),ik=a("8TCpN");a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN"),o=a("1ELdT");function dI(e){for(var t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),n=atob(t[3]),r=new ArrayBuffer(n.length),i=new Uint8Array(r),a=0;a<i.length;a++)i[a]=n.charCodeAt(a);return new Blob([i],{type:t[1]})}function pI(e){return new Promise((function(t,n){var r=new Image;try{r.src=Gk.imageBlobToUrl(e)}catch(e){return void n("imageBlobToUrl, "+e.message)}r.onload=function(){t(r)},r.onabort=function(){n("layer image failed loading")},r.onerror=function(){n("layer image failed loading")}}))}var fI=function(){"use strict";function e(){rk.default(this,e)}return ik.default(e,null,[{key:"createThumbnail",value:function(e){return KE(e,Gk.fitInto(e.width,e.height,240,240).width/e.width)}},{key:"createStorageProject",value:function(t){return{id:1,timestamp:(new Date).getTime(),thumbnail:dI(e.createThumbnail(t).toDataURL("image/png")),width:t.width,height:t.height,layers:t.layers.map((function(e){var t;if(!(e.image instanceof HTMLCanvasElement))throw new Error("Not implemented");return t=dI(e.image.toDataURL("image/png")),{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,blob:t}}))}}},{key:"readStorageProject",value:function(n){return o.default(t(s).mark((function r(){var i,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n.width,t.t1=n.height,t.next=4,Promise.all(n.layers.map((function(e){return pI(e.blob)})));case 4:if(t.t2=t.sent.map((function(e,t){return{name:n.layers[t].name,opacity:n.layers[t].opacity,mixModeStr:n.layers[t].mixModeStr,image:e}})),i={width:t.t0,height:t.t1,layers:t.t2},!n.thumbnail){t.next=13;break}return t.next=10,pI(n.thumbnail);case 10:a=t.sent,t.next=14;break;case 13:a=e.createThumbnail(i);case 14:return t.abrupt("return",{project:i,timestamp:n.timestamp,thumbnail:a});case 15:case"end":return t.stop()}}),r)})))()}}]),e}();function gI(e){return new Promise((function(t,n){e(t,n)}))}var vI=function(){"use strict";function e(){var n=this;rk.default(this,e),this.listeners=[],this.accessHasFailed=!1,window.addEventListener("storage",(function(e){if("indexedDbUpdatedAt"===e.key&&0!==n.listeners.length)try{var r=n;o.default(t(s).mark((function e(){var n;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.read();case 2:(n=e.sent)?r.emit(n.timestamp,n.thumbnail):r.emit();case 4:case"end":return e.stop()}}),e)})))()}catch(e){"db-error"===e.message&&(n.accessHasFailed=!0)}}))}return ik.default(e,[{key:"lowLevelStore",value:function(e){return o.default(t(s).mark((function n(){return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){rM(e,t,n)}));case 2:case"end":return t.stop()}}),n)})))()}},{key:"lowLevelRead",value:function(){return o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gI(nM);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()}},{key:"lowLevelClear",value:function(){return o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gI(iM);case 2:case"end":return e.stop()}}),e)})))()}},{key:"emit",value:function(e,t){this.listeners.forEach((function(n){n.onUpdate(e,t)}))}},{key:"updateTimestamp",value:function(){Wk.setItem("indexedDbUpdatedAt",""+(new Date).getTime())}},{key:"read",value:function(){return o.default(t(s).mark((function e(){var n,r;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.lowLevelRead();case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.accessHasFailed=!0,new Error("db-error");case 11:if(n){e.next=13;break}return e.abrupt("return",null);case 13:return e.prev=14,e.next=17,fI.readStorageProject(n);case 17:r=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t1=e.catch(14),new Error("format-error");case 23:return e.abrupt("return",r);case 24:case"end":return e.stop()}}),e,this,[[1,7],[14,20]])})).bind(this))()}},{key:"store",value:function(e){var n=this;return o.default(t(s).mark((function r(){var i,a,o;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=fI.createStorageProject(e),t.next=4,this.lowLevelStore(i);case 4:t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(0),this.accessHasFailed=!0,new Error("db-error");case 10:return t.next=12,this.lowLevelRead();case 12:return a=t.sent,o=null,t.prev=14,t.next=17,fI.readStorageProject(a);case 17:o=t.sent,t.next=27;break;case 20:return t.prev=20,t.t1=t.catch(14),t.next=24,this.lowLevelClear();case 24:throw this.updateTimestamp(),setTimeout((function(){return n.emit()}),0),new Error("format-error");case 27:this.updateTimestamp(),setTimeout((function(){return n.emit(o.timestamp,o.thumbnail)}),0);case 29:case"end":return t.stop()}}),r,this,[[0,6],[14,20]])})).bind(this))()}},{key:"clear",value:function(){var e=this;return o.default(t(s).mark((function n(){return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lowLevelClear();case 2:this.updateTimestamp(),setTimeout((function(){return e.emit()}),0);case 4:case"end":return t.stop()}}),n,this)})).bind(this))()}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}},{key:"isBroken",value:function(){return this.accessHasFailed}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var mI=function(){"use strict";function e(n,r,i,a,o,s,l,c,u,h,d,p){var f=this;rk.default(this,e),this.exportType=a;var g=this;this.div=document.createElement("div");setTimeout((function(){var e=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.appendChild(t),e.appendChild(n),Gk.css(t,{clear:"both"}),Gk.css(n,{display:"none",marginLeft:"10px",marginRight:"10px",marginTop:"10px",borderBottom:"1px solid rgba(0,0,0,0.2)",clear:"both"}),e},u=document.createElement("div"),h=document.createElement("button"),d=document.createElement("button");h.style.cssFloat="left",Gk.css(d,{cssFloat:"left",clear:"both"}),h.tabIndex=-1,d.tabIndex=-1,h.innerHTML="<img src='".concat(t(yT),"' alt='icon' height='20'/>").concat(dE("file-new")),d.innerHTML="<img src='".concat(t(bT),"' alt='icon' height='20'/>").concat(dE("file-save")),h.className="gridButton",d.className="gridButton",f.importButton=document.createElement("input"),f.importButton.tabIndex=-1,f.importButton.type="file",f.importButton.multiple=!0,f.importButton.accept="image",f.importButton.size="71",f.importButton.textContent="Import";var v,m,y=f.importButton;!function(){(y=document.createElement("div")).className="gridButton",y.style.position="relative",y.style.cursor="pointer",y.style.cssFloat="left";var e=document.createElement("div");e.style.width="120px",e.style.height="28px",e.style.overflow="hidden",e.style.cursor="pointer",e.style.position="relative",y.appendChild(e),e.appendChild(g.importButton);var n=document.createElement("button");n.innerHTML="<img style='float:left' height='20' src='"+t(xT)+"' alt='icon'/>"+dE("file-import"),n.tabIndex=-1,Gk.css(n,{width:"120px",display:"box",position:"absolute",left:"0",top:"0",cursor:"pointer"}),Gk.css(g.importButton,{display:"none"}),y.appendChild(n),n.onclick=function(){g.importButton.click()}}(),f.importButton.onchange=function(e){s(g.importButton.files,"default"),g.importButton.value=""},v=Gk.el({css:{display:"none",fontSize:"15px",marginLeft:"10px",marginTop:"10px",cssFloat:"left",width:"calc(50% - 15px)",height:"30px"}}),m=new DI.Select({optionArr:[["png",dE("file-save-png")],["psd",dE("file-save-psd")],["layers",dE("file-save-layers")]],initValue:a,onChange:function(e){o(a=e),l()}}),Gk.css(m.getElement(),{width:"120px",height:"30px"}),v.appendChild(m.getElement()),h.onclick=c,d.onclick=function(){l()};var x=document.createElement("div");x.textContent="⚠️ "+dE("file-no-autosave"),Gk.css(x,{textAlign:"center",marginTop:"10px",background:"rgb(243, 243, 161)",padding:"5px 0px",color:"rgba(0,0,0,0.65)",fontSize:"15px"}),g.fileBrowserStorage=new hI(r,i,p,n),Gk.css(g.fileBrowserStorage.getElement(),{display:"none",margin:"10px"}),Gk.append(u,[x,h,y,Gk.el({css:{clear:"both"}}),d,v,Gk.el({css:{clear:"both"}}),Gk.el({css:{clear:"both"}}),e(),g.fileBrowserStorage.getElement(),e()]),f.div.appendChild(u)}),1)}return ik.default(e,[{key:"refresh",value:function(){}},{key:"getElement",value:function(){return this.div}},{key:"setIsVisible",value:function(e){e&&this.refresh()}},{key:"triggerImport",value:function(){this.importButton.click()}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var yI=function(){"use strict";function e(t,n,r,i,a,o,s,l,c,u,h,d){rk.default(this,e),this.klRootEl=t,this.klColorSlider=n,this.layerManager=r,this.setCurrentLayer=i,this.klCanvasWorkspace=a,this.handUi=o,this.getCurrentColor=s,this.getKlMaxCanvasSize=l,this.getKlCanvas=c,this.getCurrentLayerCtx=u,this.isEmbed=h,this.statusOverlay=d,this.isInit=!1,this.div=document.createElement("div")}return ik.default(e,[{key:"init",value:function(){var e=function(e,t){var n=document.createElement("button"),i=t[e].buttonLabel?t[e].buttonLabel:t[e].name,a='<img height="20" width="18" src="'+t[e].icon+'" alt="icon" />';return n.innerHTML=a+i,n.className="gridButton",Gk.css(n,{lineHeight:"20px",fontSize:"12px"}),n.tabIndex=-1,n.onclick=function(){if("apply"in t[e])if(t[e].isInstant)n.blur(),l(null),r.statusOverlay.out('"'+t[e].name+'" '+dE("filter-applied"),!0);else{var i,a=r.klColorSlider.getSecondaryRGB(),o=t[e].getDialog({context:r.getCurrentLayerCtx(),canvas:r.getKlCanvas(),maxWidth:r.getKlMaxCanvasSize(),maxHeight:r.getKlMaxCanvasSize(),currentColorRgb:{r:r.getCurrentColor().r,g:r.getCurrentColor().g,b:r.getCurrentColor().b},secondaryColorRgb:{r:a.r,g:a.g,b:a.b}});if(!o)return;o.errorCallback=function(e){setTimeout((function(){throw alert("Error: could not perform action"),e}),0),i()};var s={};"width"in o&&(s.width=o.width+"px"),DI.popup({target:r.klRootEl,message:"<b>"+t[e].name+"</b>",div:o.element,style:s,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(n){!function(n,r){if("Cancel"!=n){var i;try{i=r.getInput()}catch(n){throw-1!==n.message.indexOf(".getInput is not a function")?"filterDialog.getInput is not a function, filter: "+t[e].name:n}l(i)}else r.destroy&&r.destroy()}(n,o)},closefunc:function(e){i=e}})}else alert("Application not fully loaded");function l(n){!1===t[e].apply({context:r.getCurrentLayerCtx(),canvas:r.getKlCanvas(),history:Zk,input:n})&&alert("Couldn't apply the edit action"),!0===t[e].updateContext&&r.setCurrentLayer(r.getKlCanvas().getLayer(r.layerManager.getSelected())),!0===t[e].updatePos&&(r.klCanvasWorkspace.resetView(),r.handUi.update(r.klCanvasWorkspace.getScale(),r.klCanvasWorkspace.getAngleDeg())),r.layerManager.update()}},o[o.length]=n,n},t=function(e,t){if((t[e].webgl||t[e].ieFails)&&(!t[e].ieFails||"Microsoft Internet Explorer"===navigator.appName)){var n=t[e].buttonLabel?t[e].buttonLabel:t[e].name,r=document.createElement("button"),i='<img style="opacity: 0.5" src="img/'+t[e].icon+'" />',a=t[e].name;return a.length>11&&(a="<span style='font-size: 12px'>"+n+"</span>"),r.innerHTML=i+a,r.className="gridButton",r.disabled=!0,r}},n=function(n,a,o){for(var s in a)!a.hasOwnProperty[s]&&n.includes(s)&&(r.isEmbed&&!a[s].inEmbed||(a[s].webgl&&i||a[s].neededWithWebGL||!a[s].webgl&&!i&&(!a[s].ieFails||"Microsoft Internet Explorer"!=navigator.appName)?o.appendChild(e(s,a)):(o.appendChild(t(s,a)),a[s]=void 0)))},r=this,i=Gk.hasWebGl(),a=DI.filterLib,o=[];if(Gk.BbLog.emit({type:"init-filters"}),!DI.filterLibStatus.isLoaded)throw new Error("filters not loaded");var s=["cropExtend","flip","glPerspective","resize","rotate","transform"],l=[];for(var c in a)a.hasOwnProperty[c]||s.includes(c)||l.push(c);n(s,a,r.div);var u=document.createElement("div");if(u.className="gridHr",r.div.appendChild(u),n(l,a,r.div),!i){var h=Gk.appendTextDiv(r.div,"Some actions are disabled because WebGL isn't working.");h.style.margin="10px",Gk.css(h,{fontSize:"11px",color:"#555",background:"#ffe",padding:"10px",borderRadius:"10px",textAlign:"center"})}this.isInit=!0}},{key:"getElement",value:function(){return this.div}},{key:"show",value:function(){this.isInit||this.init(),this.div.style.display="block"}},{key:"hide",value:function(){this.div.style.display="none"}}]),e}();a("4gaLD");var xI;o=a("1ELdT");function bI(e,t,n,r,i){return wI.apply(this,arguments)}function wI(){return(wI=o.default(t(s).mark((function e(n,r,i,a,o){var l,c,u,h,d,p,f,g;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=dI(n.toDataURL("image/"+a)),c=window.open(),u=c.document.createElement("div"),(h=c.document.createElement("img")).src=t(xI),u.appendChild(h),Gk.css(h,{filter:"invert(1)"}),c.document.body.style.backgroundColor="#121211",c.document.body.style.backgroundImage="linear-gradient(#2b2b2b 0%, #121211 50%)",c.document.body.style.backgroundRepeat="no-repeat",(d=c.document.createElement("div")).style.marginTop="10px",u.appendChild(d),d.textContent=dE("upload-uploading"),c.document.body.appendChild(u),Gk.css(u,{marginLeft:"auto",marginRight:"auto",marginTop:"100px",fontFamily:"Arial, sans-serif",fontSize:"20px",textAlign:"center",transition:"opacity 0.3s ease-in-out",opacity:"0",color:"#ccc"}),setTimeout((function(){u.style.opacity="1"}),20),e.prev=18,(f=new FormData).append("title",r),f.append("description",i),f.append("image",l),e.next=25,fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID "+o},body:f});case 25:p=e.sent,e.next=32;break;case 28:throw e.prev=28,e.t0=e.catch(18),c.close(),new Error(e.t0);case 32:if(p.ok){e.next=35;break}throw c.close(),new Error;case 35:return e.next=37,p.json();case 37:return g=e.sent.data,c.location.href=g.link.replace(/\.(jpg|png)/,""),e.abrupt("return",g);case 40:case"end":return e.stop()}}),e,null,[[18,28]])})))).apply(this,arguments)}xI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("iGeXe"),a("4gaLD");var CI;o=a("1ELdT");function SI(){return(SI=o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(CI){e.next=5;break}return e.next=3,a("j1Ae5");case 3:CI=e.sent,Gk.BbLog.emit({type:"loaded-agpsd"});case 5:return e.abrupt("return",CI);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var kI=function(){"use strict";function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Klecks";rk.default(this,e),this.history=t,this.showReminder=n,this.changeTitle=r,this.title=i,this.oldActionNumber=null,this.remindersShowed=0}return ik.default(e,[{key:"init",value:function(){var e=this,t=function(e){e.preventDefault(),e.returnValue=""};null===this.oldActionNumber&&(this.oldActionNumber=this.history.getActionNumber(),this.showReminder&&setInterval((function(){if("visible"===document.visibilityState){var t=e.history.getActionNumber(),n=Math.abs(t-e.oldActionNumber);e.lastReminderResetAt+12e5<performance.now()&&n>=30&&(e.reset(!0),DI.showSaveReminderToast(e.remindersShowed++))}}),6e4),this.history.addListener((function(){var n=e.history.getActionNumber();e.oldActionNumber!==n?Gk.setEventListener(window,"onbeforeunload",t):Gk.setEventListener(window,"onbeforeunload",null)})),this.changeTitle&&document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState)document.title=e.title,clearInterval(e.unsavedInterval);else{var t=e.history.getActionNumber();if(e.oldActionNumber!==t){var n=e;document.title=dE("unsaved")+" - "+e.title;var r=0;e.unsavedInterval=setInterval((function(){r=(r+1)%2,document.title=1===r?dE("unsaved")+" · "+n.title:dE("unsaved")+" - "+n.title}),18e4)}}})))}},{key:"reset",value:function(e){null!==this.oldActionNumber&&(e||(this.remindersShowed=0),this.lastReminderResetAt=performance.now(),this.oldActionNumber=this.history.getActionNumber(),Gk.setEventListener(window,"onbeforeunload",null))}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var EI,TI,MI={};EI=MI,TI=function(){"use strict";var e=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){o(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()},t=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status},r=function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}},i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,a=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(n,a,o){var s=i.URL||i.webkitURL,l=document.createElement("a");a=a||n.name||"download",l.download=a,l.rel="noopener","string"==typeof n?(l.href=n,l.origin===location.origin?r(l):t(l.href)?e(n,a,o):r(l,l.target="_blank")):(l.href=s.createObjectURL(n),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(n,i,a){if(i=i||n.name||"download","string"!=typeof n)navigator.msSaveOrOpenBlob((s=n,void 0===(l=a)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s),i);else if(t(n))e(n,i,a);else{var o=document.createElement("a");o.href=n,o.target="_blank",setTimeout((function(){r(o)}))}var s,l}:function(t,n,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var s="application/octet-stream"===t.type,l=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||a)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},u.readAsDataURL(t)}else{var h=i.URL||i.webkitURL,d=h.createObjectURL(t);o?o.location=d:location.href=d,o=null,setTimeout((function(){h.revokeObjectURL(d)}),4e4)}});i.saveAs=o.saveAs=o,MI=o},"function"==typeof define&&define.amd?define([],TI):void 0!==MI?TI():(TI(),EI.FileSaver={});var II=function(){"use strict";function e(t,n,r,i,a){rk.default(this,e),this.saveReminder=t,this.klRootEl=n,this.getExportType=r,this.getKlCanvas=i,this.filenameBase=a}return ik.default(e,[{key:"save",value:function(){var e=function(e,t,n){var r=e.toDataURL(n).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);console.log(r[3]),taixuong(r[3]),download()},t=this;if(t.saveReminder.reset(),"png"===t.getExportType()){var n="image/png",r=(Gk.getDate(),this.filenameBase,t.getKlCanvas().getCompleteCanvas(1));try{e(r,0,n)}catch(e){var i=new Image;i.width=t.getKlCanvas().getWidth(),i.height=t.getKlCanvas().getHeight(),i.src=r.toDataURL(n),DI.exportDialog(t.klRootEl,i)}}else if("layers"===t.getExportType())for(var a=Gk.getDate()+this.filenameBase,o=t.getKlCanvas().getLayersFast(),s=0;s<o.length;s++){var l=o[s],c=[a,"_",(""+(s+1)).padStart(2,"0"),"_",l.name,".","png"];e(l.canvas,c.join(""),"image/png")}else if("psd"===t.getExportType()){for(var u=this,h=t.getKlCanvas().getLayersFast(),d={width:t.getKlCanvas().getWidth(),height:t.getKlCanvas().getHeight(),children:[],canvas:t.getKlCanvas().getCompleteCanvas(1)},p=0;p<h.length;p++){var f=h[p];d.children.push({name:f.name,opacity:f.opacity,canvas:f.canvas,blendMode:DI.PSD.blendKlToPsd(f.mixModeStr),left:0,top:0})}DI.loadAgPsd().then((function(e){var t=e.writePsdBuffer(d),n=new Blob([t],{type:"application/octet-stream"});MI.saveAs(n,Gk.getDate()+u.filenameBase+".psd")})).catch((function(){alert("Error: failed to load PSD library")}))}}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var RI=function(){"use strict";function e(t,n,r,i,a,o,s,l,c,u){rk.default(this,e),this.brushUiObj=t,this.layerPreview=n,this.layerManager=r,this.handUi=i,this.klCanvasWorkspace=a,this.getInitState=o,this.getKlCanvas=s,this.getCurrentLayerCtx=l,this.setCurrentLayerCtx=c,this.getCurrentBrush=u,this.doIgnore=!1}return ik.default(e,[{key:"ignoreTest",value:function(){var e=this;return!this.doIgnore&&(this.doIgnore=!0,setTimeout((function(){e.doIgnore=!1}),0),!0)}},{key:"undo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!Zk.canUndo())return!1;var t=Zk.undo();Zk.pause(!0);var n=this.getInitState(),r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight();this.getKlCanvas().copy(n.canvas);var a=n.focus;this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(a));var o={};for(var s in DI.brushes)DI.brushes.hasOwnProperty(s)&&(o[s]=new DI.brushes[s],o[s].setContext(this.getCurrentLayerCtx()));o.SketchyBrush.setSeed(n.brushes.SketchyBrush.getSeed());for(var l=0;l<t.length;l++)!function(n){if("brush"===t[n].tool[0]){var r=o[t[n].tool[1]];if(t[n].actions)for(var i=0;i<t[n].actions.length;i++){var s=t[n].actions[i].params;r[t[n].actions[i].action].apply(r,s)}else{var l=t[n].params;r[t[n].action].apply(r,l)}}else if("canvas"===t[n].tool[0]){var c=t[n].params,u=e.getKlCanvas()[t[n].action].apply(e.getKlCanvas(),c);if("number"==typeof u)for(var h in a=u,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),o)o.hasOwnProperty(h)&&o[h].setContext(e.getCurrentLayerCtx())}else if("filter"===t[n].tool[0]){var d=[{context:e.getCurrentLayerCtx(),canvas:e.getKlCanvas(),input:t[n].params[0].input,history:new DI.DecoyKlHistory}];DI.filterLib[t[n].tool[1]][t[n].action].apply(null,d)}else if("misc"===t[n].tool[0]&&"focusLayer"===t[n].action)for(var p in a=t[n].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[n].params[0])),o)o.hasOwnProperty(p)&&o[p].setContext(e.getCurrentLayerCtx());else if("misc"===t[n].tool[0]&&"importImage"===t[n].action){var f=e.getKlCanvas().addLayer();if("number"==typeof f)for(var g in a=f,t[n].params[1]&&e.getKlCanvas().renameLayer(a,t[n].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),o)o.hasOwnProperty(g)&&o[g].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[n].params[0],0,0)}}(l);return r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg())),this.layerManager.update(a),this.layerPreview.setLayer(this.getKlCanvas().getLayer(a)),this.brushUiObj.sketchyBrush.setSeed(o.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),Zk.pause(!1),!0}},{key:"redo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!Zk.canRedo())return!1;var t=Zk.redo();Zk.pause(!0);var n,r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight(),a={};for(var o in DI.brushes)DI.brushes.hasOwnProperty(o)&&(a[o]=new DI.brushes[o],a[o].setContext(this.getCurrentLayerCtx()));a.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());for(var s=0;s<t.length;s++)!function(r){if("brush"===t[r].tool[0]){var i=a[t[r].tool[1]];if(t[r].actions)for(var o=0;o<t[r].actions.length;o++){var s=t[r].actions[o].params;i[t[r].actions[o].action].apply(i,s)}else{var l=t[r].params;i[t[r].action].apply(i,l)}}else if("canvas"===t[r].tool[0]){var c=t[r].params,u=e.getKlCanvas()[t[r].action].apply(e.getKlCanvas(),c);if("number"==typeof u)for(var h in n=u,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(h)&&a[h].setContext(e.getCurrentLayerCtx())}else if("filter"===t[r].tool[0]){var d=[{context:e.getCurrentLayerCtx(),canvas:e.getKlCanvas(),input:t[r].params[0].input,history:new DI.DecoyKlHistory}];DI.filterLib[t[r].tool[1]][t[r].action].apply(null,d)}else if("misc"===t[r].tool[0]&&"focusLayer"===t[r].action)for(var p in n=t[r].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[r].params[0])),a)a.hasOwnProperty(p)&&a[p].setContext(e.getCurrentLayerCtx());else if("misc"===t[r].tool[0]&&"importImage"===t[r].action){var f=e.getKlCanvas().addLayer();if("number"==typeof f)for(var g in n=f,t[r].params[1]&&e.getKlCanvas().renameLayer(n,t[r].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(g)&&a[g].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[r].params[0],0,0)}}(s);r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg()));var l=this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);return this.layerManager.update(l),this.layerPreview.setLayer(this.getKlCanvas().getLayer(l)),this.brushUiObj.sketchyBrush.setSeed(a.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),Zk.pause(!1),!0}},{key:"catchup",value:function(e){if(e&&e.bufferUpdate){var t=this,n=this.getInitState(),r=n.brushes,i=[e.bufferUpdate],a=n.canvas.getLayerContext(n.focus),o=n.canvas,s=n.focus;!function(e){if("brush"===i[0].tool[0]){var n=r[i[0].tool[1]];if(i[0].actions)for(var l=0;l<i[0].actions.length;l++){var c=i[0].actions[l].params;n[i[0].actions[l].action].apply(n,c)}else{var u=i[0].params;n[i[0].action].apply(n,u)}}else if("canvas"===i[0].tool[0]){var h=i[0].params,d=o[i[0].action].apply(o,h);if("number"==typeof d)for(var p in s=d,a=o.getLayerContext(s),r)r.hasOwnProperty(p)&&r[p].setContext(a)}else if("filter"===i[0].tool[0]){var f=[{context:a,canvas:o,input:i[0].params[0].input,history:new DI.DecoyKlHistory}];DI.filterLib[i[0].tool[1]][i[0].action].apply(null,f)}else if("misc"===i[0].tool[0]&&"focusLayer"===i[0].action)for(var g in s=i[0].params[0],a=o.getLayerContext(i[0].params[0]),r)r.hasOwnProperty(g)&&r[g].setContext(a);else if("misc"===i[0].tool[0]&&"importImage"===i[0].action){var v=o.addLayer();if("number"==typeof v)for(var m in s=v,i[0].params[1]&&t.getKlCanvas().renameLayer(s,i[0].params[1]),a=o.getLayerContext(s),r)r.hasOwnProperty(m)&&r[m].setContext(a);a.drawImage(i[0].params[0],0,0)}}(),n.focus=s}}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var AI=function(){"use strict";function e(t,n,r,i,a,o,s){if(rk.default(this,e),this.onSetColor=t,this.onSetSize=n,this.onSetOpacity=r,this.onGetColor=i,this.onGetSize=a,this.onGetOpacity=o,this.onGetSliderConfig=s,this.subscriberArr=[],e.instance)throw new Error("BrushSettingService already instantiated");e.instance=this}return ik.default(e,[{key:"emit",value:function(e,t){for(var n=0;n<this.subscriberArr.length;n++)this.subscriberArr[n]!==t&&this.subscriberArr[n](e)}},{key:"emitColor",value:function(e,t){this.emit({type:"color",value:e},t)}},{key:"emitSize",value:function(e,t){this.emit({type:"size",value:e},t)}},{key:"emitOpacity",value:function(e,t){this.emit({type:"opacity",value:e},t)}},{key:"emitSliderConfig",value:function(e,t){this.emit({type:"sliderConfig",value:e},t)}},{key:"setColor",value:function(e,t){this.onSetColor(e),this.emitColor(e,t)}},{key:"setSize",value:function(e,t){this.onSetSize(e)}},{key:"setOpacity",value:function(e,t){this.onSetOpacity(e)}},{key:"getColor",value:function(){return this.onGetColor()}},{key:"getSize",value:function(){return this.onGetSize()}},{key:"getOpacity",value:function(){return this.onGetOpacity()}},{key:"getSliderConfig",value:function(){return this.onGetSliderConfig()}},{key:"subscribe",value:function(e){this.subscriberArr.includes(e)||this.subscriberArr.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscriberArr.length;t++)e===this.subscriberArr[t]&&(this.subscriberArr.splice(t,1),t--)}}]),e}();a("4gaLD");var LI;rk=a("5nGP2"),ik=a("8TCpN");LI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("kSWIa");var PI;PI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("4FMUg");var OI=function(){"use strict";function e(n,r){rk.default(this,e);var i=hE.getLanguage();this.el=Gk.el({content:"\n".concat(dE("settings-language"),": ").concat(i.name," (").concat(i.code,")\n            "),css:{margin:"10px"}});var o=Gk.el({content:dE("settings-preferred-language")+":<br>",css:{marginTop:"10px"}}),s=[["auto",dE("auto")]].concat(rE.map((function(e){return[e.code,e.name+" (".concat(e.code,")")]}))),l=new DI.Select({initValue:Wk.getItem(aE)?Wk.getItem(aE):"auto",optionArr:s,onChange:function(e){"auto"===e?Wk.removeItem(aE):Wk.setItem(aE,e),c.style.display="block"}}),c=Gk.el({content:dE("settings-language-reload"),css:{display:"none",marginTop:"5px"}});(o.append(l.getElement(),c),this.el.append(o),Gk.el({tagName:"button",parent:this.el,content:'<img height="20" width="18" src="'+t(PI)+'" alt="icon" style="margin-right: 5px"/>'+dE("switch-ui-left-right"),onClick:function(){return n()},css:{marginTop:"20px"},custom:{tabIndex:"-1"}}),this.el.append(Gk.el({className:"gridHr",css:{margin:"10px 0"}})),r)&&(this.el.append(r),r.innerHTML||Gk.el({parent:r,css:{textAlign:"center"}}).append(Gk.el({content:'<img alt="icon" height="20" style="vertical-align:middle" src="'.concat(t(LI),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> © 2022<br>')}),Gk.el({tagName:"a",content:dE("licenses"),onClick:function(){a("aG74V").then((function(e){new fE({title:Gk.el({content:dE("licenses")}),content:Gk.el({content:Gk.el({content:e.licenses.replace(/\n/g,"<br>"),css:{padding:"20px"}}),css:{height:"100%",overflowY:"scroll"}}),width:800,isMaxHeight:!0})}))}})));window.addEventListener("storage",(function(e){e.key===aE&&l.setValue(Wk.getItem(aE)?Wk.getItem(aE):"auto")}))}return ik.default(e,[{key:"getElement",value:function(){return this.el}}]),e}();a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var DI={brushes:XM,brushesUI:lI,BrushSettingService:AI,KlCanvas:ZE,drawProject:KE,WorkspaceSvgOverlay:$E,KlCanvasWorkspace:sT,KlCanvasPreview:lT,filterLibStatus:yM,filterLib:xM,UndoRedoCatchup:RI,renderText:GE,floodFillBits:VE,ShapeTool:function(e){var t,n,r;this.onDown=function(e,i,a){t=e,n=i,r=a},this.onMove=function(i,a){e.onShape(!1,t,n,i,a,r)},this.onUp=function(i,a){e.onShape(!0,t,n,i,a,r)}},drawShape:WE,PSD:XT,setDbName:eM,indexedDb:JT,ProjectStore:vI,loadAgPsd:function(){return SI.apply(this,arguments)},SaveToComputer:II,calcSliderFalloffFactor:SE,Checkbox:gE,input:vE,Select:yE,ImageToggle:xE,ImageRadioList:bE,RadioList:uI,penPressureToggle:CE,KlSlider:kE,HexColorDialog:TE,KlColorSlider:function(e){var n=function(e){m=0===e.s?new Gk.HSV(m.h,e.s,e.v):new Gk.HSV(e.h,e.s,e.v)},r=function(){var e=Gk.ColorConverter.toRGB(new Gk.HSV(m.h,100,100));Gk.setAttributes(C,{"stop-color":"#"+Gk.ColorConverter.toHexString(e)})},i=function(){var e=m.s/100*d-7,t=(1-m.v/100)*p-6;Gk.css(M,{left:e+"px",top:t+"px"})},a=function(){k.style.backgroundColor="rgb("+v.r+","+v.g+","+v.b+")",Gk.testIsWhiteBestContrast(v)?(Gk.css(R,{filter:"invert(1)"}),Gk.css(L,{filter:"invert(1)"})):(Gk.css(R,{filter:""}),Gk.css(L,{filter:""}))},o=function(){P.style.backgroundColor=Gk.ColorConverter.toRgbStr(y)},s=function(){var e=x;x=m,n(e),e=y,y=v,v=e,E.style.left=parseInt(""+(m.h/359*d-1))+"px",r(),i(),a(),o(),g(new Gk.RGB(v.r,v.g,v.b))},l=this,c=function(e){},u=document.createElement("div");u.style.position="relative",u.className="colorSlider";var h=Gk.el({css:{display:"flex",alignItems:"center"}}),d=e.width,p=e.svHeight,f=e.height,g=e.onPick,v={r:parseInt(e.startValue.r,10),g:parseInt(e.startValue.g,10),b:parseInt(e.startValue.b,10)},m=Gk.ColorConverter.toHSV(e.startValue),y={r:255,g:255,b:255},x=Gk.ColorConverter._RGBtoHSV(y),b=Gk.el({}),w=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"> <defs> <linearGradient id="value" gradientTransform="rotate(90)"> <stop offset="0" stop-color="rgba(0,0,0,0)"/> <stop offset="100%" stop-color="rgba(0,0,0,1)"/> </linearGradient> <linearGradient id="hue" gradientTransform="rotate(0)"> <stop offset="0" stop-color="#fff"/> <stop id="hue-stop" offset="100%" stop-color="#f00"/> </linearGradient> </defs> <rect x="0" y="0" width="100" height="100" fill="url(\'#hue\')"/> <rect x="0" y="0" width="100" height="100" fill="url(\'#value\')"/></svg>',"image/svg+xml").documentElement,C=w.getElementById("hue-stop");Gk.setAttributes(C,{"stop-color":"#f0f"}),Gk.css(w,{width:d+"px",height:p+"px"}),b.appendChild(w);var S=document.createElement("div");Gk.css(S,{position:"relative",height:f+"px"});var k=document.createElement("div"),E=document.createElement("div");r(),u.style.width=d+"px",u.oncontextmenu=function(){return!1};var T=document.createElement("div");Gk.css(T,{width:d+"px",height:p/2+"px",overflow:"hidden",display:"block",position:"relative",cursor:"crosshair",boxShadow:"rgb(188, 188, 188) 0 0 0 1px"});var M=document.createElement("div");Gk.css(M,{width:"12px",height:"12px",borderRadius:"6px",position:"absolute",pointerEvents:"none",boxShadow:"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff"}),T.appendChild(b),T.appendChild(M),i(),u.appendChild(T),u.appendChild(S),h.appendChild(k),Gk.css(k,{display:"flex",justifyContent:"space-between",width:2.5*f+"px",height:f+"px",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",colorScheme:"only light"}),Gk.css(S,{overflow:"hidden",position:"relative",width:d+"px",height:f/2+"px",cursor:"ew-resize",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",marginTop:"1px",marginBottom:"1px"}),Gk.css(E,{width:"1px",height:f/2+"px",background:"#000",borderLeft:"1px solid #fff",position:"absolute",top:"0",left:parseInt(""+(m.h/360*d-1))+"px"});var I={h:0,s:0,v:0},R=Gk.el({title:dE("eyedropper")+" [Alt]",className:"color-picker-preview-button",css:{width:"30px",height:"30px",backgroundImage:"url("+t(EE)+")",backgroundRepeat:"no-repeat",backgroundSize:"70%",backgroundPosition:"center"}}),A=!1;R.onclick=function(){!1===A?(Gk.removeClassName(R,"color-picker-preview-button-hover"),Gk.addClassName(R,"color-picker-preview-button-active"),A=!0,c(!0)):(c(!1),l.pickingDone())};new Gk.PointerListener({target:R,onEnterLeave:function(e){A||(e?Gk.addClassName(R,"color-picker-preview-button-hover"):Gk.removeClassName(R,"color-picker-preview-button-hover"))}});k.appendChild(R);var L=Gk.el({content:"#",className:"color-picker-preview-button",title:dE("manual-color-input"),css:{height:"100%",width:f+"px",lineHeight:f+"px",fontSize:.65*f+"px"},onClick:function(){TE({color:new Gk.RGB(v.r,v.g,v.b),onClose:function(e){e&&(l.setColor(e),g(new Gk.RGB(v.r,v.g,v.b)))}})}});new Gk.PointerListener({target:L,onEnterLeave:function(e){e?Gk.addClassName(L,"color-picker-preview-button-hover"):Gk.removeClassName(L,"color-picker-preview-button-hover")}});k.appendChild(L),a(),setTimeout((function(){!function(e){var t=new Image;Gk.css(t,{position:"absolute",left:"0",top:"0",display:"none",pointerEvents:"none"});for(var n=Gk.canvas(d,f),r=n.getContext("2d"),i=r.createLinearGradient(0,0,d,0),a=0;a<1;a+=.01){var o=Gk.ColorConverter.toRGB(new Gk.HSV(360*a,100,100)),s=parseInt(""+o.r).toString(16),l=parseInt(""+o.g).toString(16),c=parseInt(""+o.b).toString(16);1===s.length&&(s="0"+s),1===l.length&&(l="0"+l),1===c.length&&(c="0"+c),i.addColorStop(a,"#"+s+l+c)}r.fillStyle=i,r.fillRect(0,0,d,f),e.appendChild(t),t.alt="hue",t.src=n.toDataURL("image/png"),t.style.display="block"}(S),S.appendChild(E),new Gk.PointerListener({target:b,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(Gk.css(T,{boxShadow:"0px 0px 0px 1px rgb(255,255,255)",zIndex:"1"}),"left"===e.button?(I.s=e.relX/d*100,I.v=100-e.relY/p*100,m=new Gk.HSV(m.h,I.s,I.v),v=Gk.ColorConverter.toRGB(m),i(),a(),g(Gk.ColorConverter.toRGB(m))):(I.s=m.s,I.v=m.v)),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=1;"right"===e.button&&(t=.5),I.s+=e.dX/d*100*t,I.v-=e.dY/p*100*t,m=new Gk.HSV(m.h,I.s,I.v),v=Gk.ColorConverter.toRGB(m),i(),a(),g(Gk.ColorConverter.toRGB(m))}"pointerup"===e.type&&Gk.css(T,{boxShadow:"0 0 0 1px rgb(188, 188, 188)",zIndex:"0"})}}),new Gk.PointerListener({target:S,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(Gk.css(S,{boxShadow:"0px 0px 0px 1px rgba(255,255,255,1)"}),"left"===e.button?(I.h=e.relX/d*359.99,m=new Gk.HSV(I.h,m.s,m.v),v=Gk.ColorConverter.toRGB(m),E.style.left=Math.round(m.h/359.99*d)-1+"px",r(),a(),g(Gk.ColorConverter.toRGB(m))):I.h=m.h),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=Math.abs(e.pageY-e.downPageY),n=SE(t,"right"===e.button);I.h+=e.dX/d*359.99*n,"right"===e.button&&(I.h=I.h%359.99,I.h<0&&(I.h+=359.99)),I.h=Math.min(359.99,I.h),m=new Gk.HSV(I.h,m.s,m.v),v=Gk.ColorConverter.toRGB(m),E.style.left=Math.round(m.h/359.99*d)-1+"px",r(),a(),g(Gk.ColorConverter.toRGB(m))}"pointerup"===e.type&&Gk.css(S,{boxShadow:"rgb(188, 188, 188) 0 0 0 1px"})}})}),1);var P=Gk.el({parent:h,title:dE("secondary-color")+" [X]",css:{cursor:"pointer",marginLeft:"5px",width:"22px",height:"22px",boxShadow:"rgb(188, 188, 188) 0px 0px 0px 1px",colorScheme:"only light"},onClick:function(e){e.preventDefault(),s()}});o(),this.setColor=function(e){v={r:parseInt(e.r,10),g:parseInt(e.g,10),b:parseInt(e.b,10)},n(Gk.ColorConverter.toHSV(e)),E.style.left=parseInt(""+(m.h/359*d-1))+"px",r(),i(),a()},this.getColor=function(){return new Gk.RGB(v.r,v.g,v.b)},this.getSecondaryRGB=function(){return new Gk.RGB(y.r,y.g,y.b)},this.setPickCallback=function(e){c=e},this.pickingDone=function(){A&&(A=!1,Gk.removeClassName(R,"color-picker-preview-button-active"))},this.enable=function(e){e?(u.style.pointerEvents="",u.style.opacity="1",h.style.pointerEvents="",h.style.opacity="1"):(u.style.pointerEvents="none",u.style.opacity="0.5",h.style.pointerEvents="none",h.style.opacity="0.5")},this.setHeight=function(e){(e=parseInt(""+(e-2*f-3),10))!==p&&(p=e,Gk.css(w,{width:d+"px",height:p+"px"}),T.style.height=p+"px",i())},this.swapColors=function(){s()},this.getElement=function(){return u},this.getOutputElement=function(){return h}},KlSmallColorSlider:ME,PointSlider:IE,ColorOptions:RE,Options:AE,BoxToggle:oI,StatusOverlay:PE,CropCopy:OE,FreeTransform:fT,FreeTransformCanvas:gT,Cropper:vT,LayerPreview:function(e){var t,n,r=function(e){if(l){E.textContent=t.name,I.innerHTML=dE("opacity")+"<br>"+Math.round(100*t.opacity)+"%";var n=t.context.canvas;if(n.width!==p.width||n.height!==p.height){var r=Gk.fitInto(n.width,n.height,u,u,1);C.width=Math.round(r.width),C.height=Math.round(r.height),e=!0}f.width=C.width,f.height=C.height,g.save(),g.imageSmoothingEnabled=!1,g.fillStyle=P,g.fillRect(0,0,f.width,f.height),g.drawImage(n,0,0,f.width,f.height),g.restore(),e?(m=0,S.save(),S.drawImage(f,0,0),S.restore()):(m=v,D()),a(),d=Zk.getState(),p.width=n.width,p.height=n.height}},i=function(){r(!0)},a=function(){if(y&&t){var e=t.context.canvas,n=Gk.fitInto(e.width,e.height,h,h,1);A.width=Math.round(n.width),A.height=Math.round(n.height),L.save(),A.width>e.width?L.imageSmoothingEnabled=!1:(L.imageSmoothingEnabled=!0,L.imageSmoothingQuality="high"),L.fillStyle=O,L.fillRect(0,0,A.width,A.height),L.drawImage(e,0,0,A.width,A.height),L.restore();var r=s.getBoundingClientRect();Gk.css(R,{top:Math.max(10,r.top+c/2-A.height/2)+"px"})}},o=function(){try{e.klRootEl.removeChild(R)}catch(e){}},s=Gk.el({}),l=!0,c=40,u=c-10,h=300,d=-2,p={width:0,height:0},f=Gk.canvas(),g=f.getContext("2d"),v=30,m=0,y=!1,x=300,b=Gk.el({css:{display:"flex",alignItems:"center",height:c+"px",color:"#666"}}),w=Gk.el({css:{minWidth:c+"px",height:c+"px",display:"flex",justifyContent:"center",alignItems:"center"}}),C=Gk.canvas(u,u),S=C.getContext("2d");C.title=dE("layers-active-layer"),Gk.css(C,{boxShadow:"0 0 0 1px #9e9e9e",colorScheme:"only light"});var k=Gk.el({css:{flexGrow:"1",paddingLeft:"10px",fontSize:"13px",overflow:"hidden",position:"relative"}}),E=Gk.el({content:"",css:{cssFloat:"left",whiteSpace:"nowrap"}}),T=Gk.el({css:{backgroundImage:"linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)",position:"absolute",right:"0",top:"0",width:"50px",height:"100%"}}),M=Gk.el({css:{position:"absolute",left:"10px",top:"0",width:"90px",height:"100%"}});e.onClick&&(Gk.addEventListener(M,"click",(function(){e.onClick()})),Gk.addEventListener(C,"click",(function(){e.onClick()})));var I=Gk.el({content:dE("opacity")+"<br>100%",css:{minWidth:"60px",fontSize:"12px",textAlign:"center",background:"#dddddd",color:"#555"}}),R=Gk.el({onClick:Gk.handleClick,css:{pointerEvents:"none",background:"#fff",position:"absolute",right:"280px",top:"10px",border:"1px solid #aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",transition:"opacity "+x+"ms ease-in-out",userSelect:"none",display:"block",webkitTouchCallout:"none",colorScheme:"only light"}}),A=Gk.canvas(h,h);R.append(A);var L=A.getContext("2d");Gk.css(A,{display:"block"}),s.appendChild(b),b.appendChild(w),w.appendChild(C),b.appendChild(k),k.appendChild(E),k.appendChild(T),k.appendChild(M),b.appendChild(I);var P=g.createPattern(Gk.createCheckerCanvas(4),"repeat"),O=S.createPattern(Gk.createCheckerCanvas(4),"repeat");function D(){0!==m&&(m--,S.save(),S.globalAlpha=Math.pow((v-m)/v,2),S.drawImage(f,0,0),S.restore(),m>0&&requestAnimationFrame(D))}setInterval((function(){t&&(Zk.getState()!==d&&(t.opacity=t.context.canvas.opacity,r(!1)))}),2e3),new Gk.PointerListener({target:C,onEnterLeave:function(t){!function(t){y!==t&&(clearTimeout(n),y=t,t?n=setTimeout((function(){a(),R.style.opacity="0",e.klRootEl.appendChild(R),setTimeout((function(){R.style.opacity="1"}),20)}),250):(R.style.opacity="0",n=setTimeout(o,x+20)))}(t)}}),this.getElement=function(){return s},this.setIsVisible=function(e){if(l!==e){l=e,b.style.display=l?"flex":"none",s.style.marginBottom=l?"":"10px";var t=Zk.getState();e&&d!==t&&i()}},this.setLayer=function(e){t=e,i()},this.setUiState=function(e){"left"===""+e?Gk.css(R,{left:"280px",right:""}):Gk.css(R,{left:"",right:"280px"})}},showSaveReminderToast:function(e){var t=Gk.el({content:dE("save-reminder-title")+"<br>"+dE("save-reminder-text")}),n=Gk.el({content:t,className:"reminder-toast g-root",css:{opacity:"0",top:"-20px"}}),r=Math.min(1,e/5),i=[0,0,0],a=[50,0,0],o=[Math.round(Gk.mix(i[0],a[0],r)),Math.round(Gk.mix(i[1],a[1],r)),Math.round(Gk.mix(i[2],a[2],r))];t.style.background="rgba("+o[0]+","+o[1]+","+o[2]+", 0.5)",document.body.appendChild(n),setTimeout((function(){n.style.opacity="1",n.style.top="10px"}),22),setTimeout((function(){n.style.opacity="0"}),2800),setTimeout((function(){document.body.removeChild(n)}),3100)},FittedImage:function(e){var t=Gk.fitInto(e.image.width,e.image.height,e.width,e.height,1),n=parseInt(""+t.width),r=parseInt(""+t.height),i=Gk.canvas(n,r);i.getContext("2d").drawImage(e.image,0,0,n,r),Gk.css(i,{display:"block",boxShadow:"0 0 0 1px #aaa"}),this.getElement=function(){return i}},KlImageDropper:function(e){var t=function(){c=0,u=0,h=0;try{e.target.removeChild(i)}catch(e){}},n=function(e){try{return!e.dataTransfer.types.includes("text/plain")}catch(e){}return!1},r=function(){var e="0 0 20px 4px #fff";u>0?(s.style.boxShadow=e,l.style.boxShadow=""):h>0?(s.style.boxShadow="",l.style.boxShadow=e):(s.style.boxShadow="",l.style.boxShadow="")},i=Gk.el({content:"Drop to import",css:{paddingTop:"100px",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.7)",color:"#fff",textShadow:"2px 2px #000",textAlign:"center",fontSize:"25px"}}),a=Gk.el({css:{marginTop:"50px",display:"flex",justifyContent:"center"}}),o={width:"200px",padding:"50px",margin:"10px",borderRadius:"20px",border:"1px dashed #fff",background:"#00aefe",fontWeight:"bold"},s=Gk.el({content:"As Layer",css:o}),l=Gk.el({content:"As New Image",css:o});i.appendChild(a),a.appendChild(s),a.appendChild(l);var c=0,u=0,h=0;Gk.addEventListener(s,"dragenter",(function(){u++,r()})),Gk.addEventListener(s,"dragleave",(function(){u--,r()})),Gk.addEventListener(l,"dragenter",(function(){h++,r()})),Gk.addEventListener(l,"dragleave",(function(){h--,r()})),Gk.addEventListener(window,"dragover",(function(e){n(e)&&(e.stopPropagation(),e.preventDefault())}),!1),Gk.addEventListener(window,"dragenter",(function(t){e.enabledTest()&&n(t)&&(0===c&&e.target.appendChild(i),c++)}),!1),Gk.addEventListener(window,"dragleave",(function(t){n(t)&&0!==c&&0===(c=Math.max(0,c-1))&&e.target.removeChild(i)}),!1),Gk.addEventListener(window,"drop",(function(a){if(n(a)&&0!==a.dataTransfer.files.length){a.stopPropagation(),a.preventDefault();var o="default";u>0?o="layer":h>0&&(o="image"),e.onDrop(a.dataTransfer.files,o),c>0&&e.target.removeChild(i),c=0,u=0,h=0,r()}else t()}),!1),Gk.addEventListener(i,"pointerdown",(function(){t()})),new Gk.KeyListener({onDown:function(e){c>0&&"esc"===e&&t()}})},OverlayToolspace:function(e){var t=function(e){s.setColor(e),l.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")"},n=function(){a.style.display=i?"block":"none",i&&f&&(a.style.left=f.x-Math.round(r.width/2)+"px",a.style.top=f.y-Math.round(r.svHeight+3*r.hHeight/2)+"px")},r={width:150,svHeight:90,hHeight:20,sliderHeight:25},i=!1,a=Gk.el({css:{position:"absolute",left:"500px",top:"500px",background:"rgb(221, 221, 221)",display:"none",border:"1px solid #fff",boxShadow:"0 0 10px rgba(0,0,0,0.5)",colorScheme:"only light"}}),o={color:null,size:null,opacity:null},s=new ME({width:r.width,heightSV:r.svHeight,heightH:r.hHeight,color:e.brushSettingService.getColor(),callback:function(t){l.style.backgroundColor="rgb("+t.r+","+t.g+","+t.b+")",e.brushSettingService.setColor(t,d)}}),l=Gk.el({css:{width:r.width+"px",height:r.hHeight+"px",pointerEvents:"none"}}),c=e.brushSettingService.getColor();l.style.backgroundColor="rgb("+c.r+","+c.g+","+c.b+")",a.appendChild(l),a.appendChild(s.getElement());var u=new kE({label:dE("brush-size"),width:r.width,height:r.sliderHeight,min:0,max:500,initValue:50,resolution:225,eventResMs:1e3/30,onChange:function(t){e.brushSettingService.setSize(t)},formatFunc:function(e){return 2*e<10?Math.round(20*e)/10:Math.round(2*e)}});Gk.css(u.getElement(),{marginTop:"2px"}),a.appendChild(u.getElement());var h=new kE({label:dE("opacity"),width:r.width,height:r.sliderHeight,min:0,max:1,initValue:1,resolution:225,eventResMs:1e3/30,onChange:function(t){e.brushSettingService.setOpacity(t)},formatFunc:function(e){return Math.round(100*e)}});Gk.css(h.getElement(),{margin:"2px 0"}),a.appendChild(h.getElement());var d=function(e){"color"===e.type&&(i?t(e.value):o.color=e.value),"size"===e.type&&(i?u.setValue(e.value):o.size=e.value),"opacity"===e.type&&(i?h.setValue(e.value):o.opacity=e.value),"sliderConfig"===e.type&&(u.update(e.value.sizeSlider),h.update(e.value.opacitySlider))};e.brushSettingService.subscribe(d);var p=e.brushSettingService.getSliderConfig();u.update(p.sizeSlider),h.update(p.opacitySlider),u.setValue(e.brushSettingService.getSize()),h.setValue(e.brushSettingService.getOpacity());var f=null;Gk.addEventListener(document,"pointermove",(function(e){f={x:e.pageX,y:e.pageY}}));var g=document.getElementById("vaiz");null==g||g.addEventListener("touchstart",(function(e){e.preventDefault(),i=!0,null!==o.color&&(t(o.color),o.color=null),null!==o.size&&(u.setValue(o.size),o.size=null),null!==o.opacity&&(h.setValue(o.opacity),o.opacity=null),n()})),null==g||g.addEventListener("touchend",(function(e){i=!1,s.end(),n()})),this.getElement=function(){return a}},ToolspaceTopRow:function(e){var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=Gk.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.contain?t+"px 0":""}}),r=Gk.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});return r.style.pointerEvents="none",n.appendChild(r),n.pointerListener=new Gk.PointerListener({target:n,onEnterLeave:function(e){e?Gk.addClassName(n,"toolspace-row-button-hover"):Gk.removeClassName(n,"toolspace-row-button-hover")}}),n},r=document.createElement("div");Gk.css(r,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var i=n({title:dE("home"),image:e.logoImg?e.logoImg:t(mT),contain:!0});i.style.width="45px",i.style.borderRight="1px solid rgb(212, 212, 212)";var a=n({onClick:e.onNew,title:dE("file-new"),image:t(yT),extraPadding:1,contain:!0}),o=n({onClick:e.onImport,title:dE("file-import"),image:t(xT),extraPadding:1,contain:!0}),s=n({onClick:e.onSave,title:dE("file-save"),image:t(bT),extraPadding:1,contain:!0});Gk.canShareFiles()&&n({onClick:e.onShare,title:dE("file-share"),image:t(wT),contain:!0}),n({onClick:e.onHelp,title:dE("help"),image:t(CT),contain:!0}),r.appendChild(i),r.appendChild(a),r.appendChild(o),r.appendChild(s),this.getElement=function(){return r}},ToolDropdown:IT,ToolspaceToolRow:function(e){var n=function(t,n){o!==t&&(o=t,s.setActive(o),"hand"===o?Gk.addClassName(l,"toolspace-row-button-activated"):Gk.removeClassName(l,"toolspace-row-button-activated"),n&&e.onActivate(o))},r=function(e){var t=e.doLighten?"6px 0":"8px 0",n=Gk.el({className:"toolspace-row-button nohighlight",onClick:e.onClick,css:{padding:e.contain?"10px 0":""}}),r=Gk.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%",transform:e.doMirror?"scale(-1, 1)":"",pointerEvents:"none",opacity:e.doLighten?"0.75":"1"}});return n.appendChild(r),n.pointerListener=new Gk.PointerListener({target:n,onEnterLeave:function(e){e?Gk.addClassName(n,"toolspace-row-button-hover"):Gk.removeClassName(n,"toolspace-row-button-hover")}}),n.setIsSmall=function(r){n.style.padding=e.contain?r?t:"10px 0":""},n},i=function(e){var t=document.createElement("div");Gk.css(t,{flexGrow:"1",position:"relative"});var n=Gk.createSvg({elementType:"svg",width:"67px",height:"54px",viewBox:"0 0 100 100",preserveAspectRatio:"none"});Gk.css(n,{position:"absolute",left:"0",top:"0"});var r=Gk.createSvg({elementType:"defs",childrenArr:[{elementType:"filter",id:"innershadow",x0:"-50%",y0:"-50%",width:"200%",height:"200%",childrenArr:[{elementType:"feGaussianBlur",in:"SourceAlpha",stdDeviation:"10",result:"blur"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"SourceGraphic",operator:"over",result:"firstfilter"},{elementType:"feGaussianBlur",in:"firstfilter",stdDeviation:"10",result:"blur2"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"firstfilter",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"firstfilter",operator:"over"}]}]}),i=Gk.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M0,0 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});i.onclick=function(){e.onLeft(),Gk.removeClassName(i,"toolspace-svg-triangle-button-hover")};var a=Gk.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M100,100 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});a.onclick=function(){e.onRight(),Gk.removeClassName(a,"toolspace-svg-triangle-button-hover")},t.leftPointerListener=new Gk.PointerListener({target:i,onEnterLeave:function(e){e?Gk.addClassName(i,"toolspace-svg-triangle-button-hover"):Gk.removeClassName(i,"toolspace-svg-triangle-button-hover")}}),t.rightPointerListener=new Gk.PointerListener({target:a,onEnterLeave:function(e){e?Gk.addClassName(a,"toolspace-svg-triangle-button-hover"):Gk.removeClassName(a,"toolspace-svg-triangle-button-hover")}}),n.appendChild(r),n.appendChild(i),n.appendChild(a),t.appendChild(n);var o=Gk.el({css:{backgroundImage:"url('"+e.leftImage+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",left:"10px",top:"8px",pointerEvents:"none"}});t.appendChild(o);var s=Gk.el({css:{backgroundImage:"url('"+(e.rightImage?e.rightImage:e.leftImage)+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",right:"10px",bottom:"8px",transform:e.rightImage?"":"scale(-1, 1)",pointerEvents:"none"}});return t.appendChild(s),t.setIsEnabledLeft=function(e){e?(Gk.removeClassName(i,"toolspace-row-button-disabled"),Gk.removeClassName(o,"toolspace-row-button-disabled")):(Gk.addClassName(i,"toolspace-row-button-disabled"),Gk.addClassName(o,"toolspace-row-button-disabled"))},t.setIsEnabledRight=function(e){e?(Gk.removeClassName(a,"toolspace-row-button-disabled"),Gk.removeClassName(s,"toolspace-row-button-disabled")):(Gk.addClassName(a,"toolspace-row-button-disabled"),Gk.addClassName(s,"toolspace-row-button-disabled"))},t},a=document.createElement("div");Gk.css(a,{height:"54px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var o="draw",s=new IT({onChange:function(e){n(e,!0)}});a.appendChild(s.getElement());var l=r({onClick:function(){n("hand",!0)},image:t(RT),contain:!0,doLighten:!0});l.style.borderRight="1px solid rgb(212, 212, 212)",l.title=dE("tool-hand"),a.appendChild(l);var c=i({onLeft:e.onZoomIn,onRight:e.onZoomOut,leftImage:t(AT),rightImage:t(LT)});c.title=dE("tool-zoom"),a.appendChild(c);var u=r({onClick:e.onZoomIn,image:t(AT),contain:!0});u.title=dE("zoom-in"),a.appendChild(u);var h=r({onClick:e.onZoomOut,image:t(LT),contain:!0});h.title=dE("zoom-out"),a.appendChild(h);var d=i({onLeft:e.onUndo,onRight:e.onRedo,leftImage:t(PT),rightImage:null});d.title=dE("tool-undo-redo"),d.setIsEnabledLeft(!1),d.setIsEnabledRight(!1),a.appendChild(d);var p=r({onClick:e.onUndo,image:t(PT),contain:!0});p.title=dE("undo"),Gk.addClassName(p,"toolspace-row-button-disabled"),a.appendChild(p);var f=r({onClick:e.onRedo,image:t(PT),contain:!0,doMirror:!0});f.title=dE("redo"),Gk.addClassName(f,"toolspace-row-button-disabled"),a.appendChild(f),u.style.display="none",h.style.display="none",p.style.display="none",f.style.display="none",this.getElement=function(){return a},this.setIsSmall=function(e){Gk.css(a,{height:e?"36px":"54px"}),s.setIsSmall(e),l.setIsSmall(e),u.setIsSmall(e),h.setIsSmall(e),p.setIsSmall(e),f.setIsSmall(e),e?(c.style.display="none",d.style.display="none",u.style.display="block",h.style.display="block",p.style.display="block",f.style.display="block"):(c.style.display="block",d.style.display="block",u.style.display="none",h.style.display="none",p.style.display="none",f.style.display="none")},this.setEnableZoomIn=function(e){e?Gk.removeClassName(u,"toolspace-row-button-disabled"):Gk.addClassName(u,"toolspace-row-button-disabled"),c.setIsEnabledLeft(e)},this.setEnableZoomOut=function(e){e?Gk.removeClassName(h,"toolspace-row-button-disabled"):Gk.addClassName(h,"toolspace-row-button-disabled"),c.setIsEnabledRight(e)},this.setEnableUndo=function(e){e?Gk.removeClassName(p,"toolspace-row-button-disabled"):Gk.addClassName(p,"toolspace-row-button-disabled"),d.setIsEnabledLeft(e)},this.setEnableRedo=function(e){e?Gk.removeClassName(f,"toolspace-row-button-disabled"):Gk.addClassName(f,"toolspace-row-button-disabled"),d.setIsEnabledRight(e)},this.setActive=function(e){n(e)},this.getActive=function(){return o}},ToolspaceStabilizerRow:function(e){var t=Gk.el({tagName:"label",content:dE("stabilizer")+"&nbsp;",title:dE("stabilizer-title"),css:{display:"flex",alignItems:"center",fontSize:"13px",color:"rgba(0,0,0,0.6)"}}),n=new yE({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"]],initValue:e.smoothing,onChange:function(t){e.onSelect(parseInt(t))}});t.appendChild(n.getElement()),new Gk.PointerListener({target:t,onWheel:function(e){n.setDeltaValue(e.deltaY)}}),this.getElement=function(){return t}},TabRow:function(e){for(var n=function(e,t,n){var r={id:e.id,isVisible:!("isVisible"in e)||e.isVisible,onOpen:e.onOpen,onClose:e.onClose,update:function(e){s.className=e===r?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",s.style.display=r.isVisible?"block":"none"}},s=Gk.el({content:"label"in e?e.label:"",title:"title"in e?e.title:void 0,className:t===r.id?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",css:{lineHeight:a+"px",display:r.isVisible?"block":"none",zIndex:"0"},onClick:function(){l!==r&&i.open(r.id)}});r.div=s,"image"in e&&Gk.css(s,{backgroundImage:"url('"+e.image+"')",backgroundSize:a-7+"px"}),"css"in e&&Gk.css(s,e.css),o.appendChild(s);new Gk.PointerListener({target:s,onEnterLeave:function(e){e?Gk.addClassName(s,"tabrow-tab-hover"):Gk.removeClassName(s,"tabrow-tab-hover")}});return t===r.id?(r.onOpen(),r.div.appendChild(c),r.div.appendChild(u)):r.onClose(),r},r=function(){for(var e=0;e<s.length;e++)s[e].update(l)},i=this,a=35,o=Gk.el({className:"tabrow",css:{height:a+"px"}}),s=[],l=null,c=Gk.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(t(OT),"')"),backgroundSize:"cover",position:"absolute",right:"-10px",bottom:"0",pointerEvents:"none"}}),u=Gk.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(t(OT),"')"),backgroundSize:"cover",position:"absolute",left:"-10px",bottom:"0",transform:"scale(-1,1)",pointerEvents:"none"}}),h=0;h<e.tabArr.length;h++)s.push(n(e.tabArr[h],e.initialId,e.useAccent));for(var d=0;d<s.length;d++)s[d].id===e.initialId&&(l=s[d]);if(null===l)throw"invalid initialId";this.getElement=function(){return o},this.open=function(e){for(var t=0;t<s.length;t++)if(s[t].id===e){if(l===s[t])return;return l.onClose(),(l=s[t]).onOpen(),l.div.appendChild(c),l.div.appendChild(u),void r()}throw"TabRow.open - invalid tabId"},this.getOpenedTabId=function(){return""+l.id},this.setIsVisible=function(e,t){for(var n=0;n<s.length;n++)if(s[n].id===e)return s[n].isVisible=!!t,void r();throw"TabRow.setIsVisible - invalid tabId"}},ToolspaceCollapser:function(e){var n=function(){o.style.transform="left"===i?r?"rotate(180deg)":"":r?"":"rotate(180deg)"},r=!0,i="right",a=Gk.el({css:{width:"25px",height:"25px",background:"#5c67ff",color:"#fff",position:"absolute",top:"0",textAlign:"center",lineHeight:"25px",cursor:"pointer",userSelect:"none",padding:"2px",boxSizing:"border-box"},title:dE("toggle-show-tools"),onClick:function(t){t.preventDefault(),r=!r,n(),e.onChange()},id:"ngungu"}),o=Gk.el({parent:a,css:{backgroundImage:"url(".concat(t(BT),")"),width:"100%",height:"100%",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",userSelect:"none"}});a.oncontextmenu=function(){return!1},this.isOpen=function(){return r},this.setDirection=function(e){i=e,n()},this.getElement=function(){return a}},BrowserStorageUi:hI,SaveReminder:kI,ToolspaceScroller:function(){"use strict";function e(t){var n=this;rk.default(this,e),this.toolspace=t.toolspace,this.upBtn=Gk.el({parent:this.toolspace,title:dE("scroll"),className:"kl-scroller",css:{top:"0",transform:"rotate(180deg)"}}),this.downBtn=Gk.el({parent:this.toolspace,title:dE("scroll"),className:"kl-scroller",css:{bottom:"0"}}),this.updateUiState(t.uiState);new Gk.PointerListener({target:this.upBtn,onPointer:function(e){var t=n;if("pointerdown"===e.type&&(n.upInterval=setInterval((function(){t.toolspace.scrollBy(0,-10),t.update()}),20)),"pointerup"===e.type){var r=n;clearInterval(n.upInterval),setTimeout((function(){r.upInterval=null,r.update()}),50)}},onWheel:function(e){n.toolspace.scrollBy(0,20*e.deltaY),n.update()}}),new Gk.PointerListener({target:this.downBtn,onPointer:function(e){var t=n;if("pointerdown"===e.type&&(n.downInterval=setInterval((function(){t.toolspace.scrollBy(0,10),t.update()}),20)),"pointerup"===e.type){var r=n;clearInterval(n.downInterval),setTimeout((function(){r.downInterval=null,r.update()}),50)}},onWheel:function(e){n.toolspace.scrollBy(0,20*e.deltaY),n.update()}});this.update(),new MutationObserver((function(){return n.update()})).observe(this.toolspace,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",(function(){return n.update()})),$k.subscribe((function(e){n.upBtn.style.opacity=e>=1?"0":"",n.downBtn.style.opacity=e>=1?"0":""}))}return ik.default(e,[{key:"update",value:function(){this.toolspace.scrollHeight>this.toolspace.offsetHeight+3?(this.upInterval||(this.upBtn.style.display=0===this.toolspace.scrollTop?"none":"block"),this.downInterval||(this.downBtn.style.display=this.toolspace.scrollTop+this.toolspace.offsetHeight+1>=this.toolspace.scrollHeight?"none":"block")):(this.upBtn.style.display="none",this.downBtn.style.display="none")}},{key:"updateUiState",value:function(e){Gk.css(this.upBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null}),Gk.css(this.downBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null})}}]),e}(),dialogCounter:$k,popup:pE,Popup:fE,exportDialog:function(e,t){var n,r,i,a,o,s,l,c;r=!1,i=!1,n=document.createElement("div"),Gk.css(n,{width:"308px"}),a=document.createElement("div"),(o=new Image).src=t.src,a.appendChild(o),a.appendChild(t),Gk.css(a,{width:"264px",height:"176px",marginTop:"21px",marginLeft:"21px",position:"relative",overflow:"hidden",boxShadow:"0 0 10px 4px rgba(255,255,255, 0)",border:"1px solid rgba(255, 255, 255, 1)",transition:"box-shadow 0.7s linear"}),Gk.css(t,{position:"absolute",left:"0",top:"0",width:"264px",height:"176px",opacity:"0"}),(s={width:264,height:264/t.width*t.height}).height<176&&(s.height=176,s.width=s.height/t.height*t.width),Gk.css(o,{position:"absolute",top:"88px",left:"132px",width:s.width+"px",height:s.height+"px",marginLeft:-s.width/2+"px",marginTop:-s.height/2+"px"}),function e(){r||((i=!i)?Gk.css(a,{border:"1px solid rgba(0, 0, 0, 1)"}):Gk.css(a,{border:"1px solid rgba(200, 200, 200, 1)"}),setTimeout(e,510))}(),(l=document.createElement("div")).innerHTML="Right-Click or Press-Hold on the image, then save.",l.ontouchstart=function(){return!1},Gk.css(l,{fontSize:"17.6px",color:"#666",padding:"10px",textAlign:"center"}),n.appendChild(a),n.appendChild(l),t.ontouchstart=function(){Gk.css(a,{boxShadow:"0 0 10px 8px rgba(0,255,255, 1)"}),!0,c=setTimeout((function(){!1,Gk.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"})}),1500)},t.ontouchmove=function(){Gk.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(c)},t.ontouchend=function(){Gk.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(c)},pE({target:e,message:"<b>Save Image</b>",div:n,buttons:["Close"],callback:function(e){r=!0}})},clipboardDialog:function(e,n,r,i,a){var l=function(){var e,n=p.getCroppedImage().toDataURL("image/png");setTimeout((e=o.default(t(s).mark((function e(){var r,a;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(n);case 3:return r=e.sent,e.next=6,r.blob();case 6:return a=e.sent,e.next=9,navigator.clipboard.write([new ClipboardItem(DE.default({},a.type,a))]);case 9:setTimeout((function(){i.out(dE("cropcopy-copied"),!0)}),200),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0.name,e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),function(){return e.apply(this,arguments)}),0)},c=function(){f()},u=document.createElement("div"),h=window.innerWidth<550||window.innerHeight<550,d=Gk.el({content:dE("crop-drag-to-crop"),css:{textAlign:"center"}});u.appendChild(d);var p=new OE({width:h?340:540,height:h?300:350,canvas:n});Gk.css(p.getEl(),{marginTop:"10px",marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),u.appendChild(p.getEl());var f,g=new Gk.KeyListener({onDown:function(e,t,n){"ctrl+c"===n&&(l(),f())}});Gk.addEventListener(window,"blur",c),pE({target:e,message:"<b>"+(a?"".concat(dE("cropcopy-title-copy")," / ").concat(dE("cropcopy-title-crop")):"".concat(dE("cropcopy-title-copy")))+"</b>",div:u,style:h?{}:{width:"500px"},buttons:a?[dE("cropcopy-btn-copy"),dE("cropcopy-btn-crop"),"Cancel"]:[dE("cropcopy-btn-copy"),"Cancel"],primaries:[dE("cropcopy-btn-copy")],callback:function(e){if(e===dE("cropcopy-btn-copy"))l();else if(e===dE("cropcopy-btn-crop")){var t=p.getRect();r({left:Math.round(-t.x),right:Math.round(t.x+t.width-n.width),top:Math.round(-t.y),bottom:Math.round(t.y+t.height-n.height)})}Gk.removeEventListener(window,"blur",c),p.destroy(),g.destroy()},clickOnEnter:dE("cropcopy-btn-copy"),closefunc:function(e){f=e}})},showImportAsLayerDialog:function(e){var t=function(e,t){d.move(e,t)},n=document.createElement("div");if(Gk.appendTextDiv(n,dE("import-as-layer-description")),e.klCanvas.isLayerLimitReached()){var r=Gk.el({content:dE("import-as-layer-limit-reached"),css:{background:"#ff0",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"}});n.appendChild(r)}var i=window.innerWidth<550,a=Gk.el({css:{display:"flex"}}),o=Gk.el({tagName:"button",content:"1:1",css:{marginRight:"10px"},onClick:function(){d.reset()}}),s=Gk.el({tagName:"button",content:dE("import-as-layer-fit"),css:{marginRight:"10px"},onClick:function(){d.setTransformFit()}}),l=Gk.el({tagName:"button",content:dE("center"),css:{marginRight:"10px"},onClick:function(){d.setTransformCenter()}});a.appendChild(o),a.appendChild(s),a.appendChild(l),n.appendChild(a);for(var c=[],u=e.klCanvas.getLayers(),h=0;h<u.length;h++)c.push({image:u[h].context.canvas,opacity:u[h].opacity,mixModeStr:u[h].mixModeStr});c.push({image:e.importImage,opacity:1,mixModeStr:"source-over"});var d=new gT({elementWidth:i?340:540,elementHeight:i?280:350,imageWidth:e.klCanvas.getLayerContext(0).canvas.width,imageHeight:e.klCanvas.getLayerContext(0).canvas.height,layers:c,transformIndex:c.length-1});Gk.css(d.getElement(),{marginTop:"10px",marginLeft:"-20px"}),n.appendChild(d.getElement());var p=new Gk.KeyListener({onDown:function(e){"left"===e&&t(-1,0),"right"===e&&t(1,0),"up"===e&&t(0,-1),"down"===e&&t(0,1)}});pE({target:e.target,message:"<b>".concat(dE("import-as-layer-title"),"</b>"),div:n,style:i?null:{width:"500px"},buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){p.destroy(),d.destroy(),Gk.destroyEl(o),Gk.destroyEl(s),Gk.destroyEl(l),"Ok"===t?e.callback(d.getTransformation(),d.getIsPixelated()):e.callback()}})},newImageDialog:function(e){var t=function(e,t,n,r,i){return Gk.fitInto(e,t,Math.min(a,n-i),Math.min(a,r-i),1)},n=function(){g.value=""+Math.min(a,parseInt(g.value)),m.value=""+Math.min(a,parseInt(m.value));var e=parseInt(g.value),t=parseInt(m.value);(e<1||e>a||t<1||t>a)&&(e>a?e=a:t>a&&(t=a),g.value=""+e,m.value=""+t);for(var n=[[1,2],[2,1],[2,3],[3,2],[3,4],[4,3],[4,5],[5,4],[16,9],[9,16],[3,2],[2,3],[5,3],[3,5],[2,1],[1,2],[1.414,1],[1,1.414]],r=Gk.reduce(e,t),i=null,o=null,s=0;s<n.length;s++)(0===s||Math.abs(n[s][0]/n[s][1]-r[0]/r[1])<o)&&(i=n[s],o=Math.abs(n[s][0]/n[s][1]-r[0]/r[1]));x.innerText=o>0&&o<.005?dE("new-ratio")+": ~"+i[0]+":"+i[1]:dE("new-ratio")+": "+r[0]+":"+r[1],e,t;var l=e,c=function(e,t){for(var n=e,r=t;;){if(!(n%=r))return r;if(!(r%=n))return n}}(e,t);e/=c,t/=c,t*=260,(e*=260)>260&&(t*=260/e,e=260),t>100&&(e*=100/t,t=100),P.style.width=e+"px",P.style.height=t+"px",Gk.createCheckerDataUrl(parseInt(""+e/l*30),(function(e){L.style.background="url("+e+")"}))},r=e.currentColor,i=e.secondaryColor,a=e.maxCanvasSize,o=e.canvasWidth,s=e.canvasHeight,l=e.workspaceWidth,c=e.workspaceHeight,u=e.onConfirm,h=e.onCancel,d=document.createElement("div"),p=document.createElement("div"),f=document.createElement("div"),g=document.createElement("input"),v=document.createElement("div"),m=document.createElement("input"),y=document.createElement("div");p.style.position="relative",p.style.width="145px",p.style.height="35px",p.style.lineHeight="30px",f.style.width="145px",f.style.height="35px",f.style.lineHeight="30px",v.innerText=dE("new-px"),v.style.color="#888",v.style.fontSize="12px",v.style.marginLeft="5px",v.style.cssFloat="right",y.innerText=dE("new-px"),y.style.color="#888",y.style.fontSize="12px",y.style.marginLeft="5px",y.style.cssFloat="right",g.setAttribute("data-ignore-focus","true"),m.setAttribute("data-ignore-focus","true"),g.type="number",g.min="1",g.max=a,g.style.cssFloat="right",g.style.width="70px",m.type="number",m.min="1",m.max=a,m.style.cssFloat="right",m.style.width="70px",g.value=o,m.value=s,g.onclick=function(){this.focus(),n()},m.onclick=function(){this.focus(),n()},p.appendChild(v),p.appendChild(g),Gk.appendTextDiv(p,dE("width")+": "),f.appendChild(y),f.appendChild(m),Gk.appendTextDiv(f,dE("height")+": ");var x=document.createElement("div");x.style.marginTop="5px",x.style.color="#888";var b=document.createElement("div"),w=document.createElement("button");b.style.marginBottom="10px";var C=document.createElement("button"),S=document.createElement("button"),k=document.createElement("button"),E=document.createElement("button"),T=document.createElement("button");C.textContent=dE("new-current"),w.textContent=dE("new-fit"),T.textContent=dE("new-oversize"),k.textContent=dE("new-landscape"),E.textContent=dE("new-portrait"),S.textContent=dE("new-square"),C.style.marginRight="5px",w.style.marginRight="5px",T.style.marginRight="5px",k.style.marginTop="5px",k.style.marginRight="5px",E.style.marginTop="5px",E.style.marginRight="5px",b.appendChild(C),b.appendChild(w),b.appendChild(T),b.appendChild(S),b.appendChild(k),b.appendChild(E),C.onclick=function(){g.value=o,m.value=s,n()},w.onclick=function(){g.value=l,m.value=c,n()},T.onclick=function(){g.value=l+500,m.value=c+500,n()},S.onclick=function(){var e=t(1,1,l,c,50);g.value=""+Math.round(e.width),m.value=""+Math.round(e.height),n()},k.onclick=function(){var e=t(4,3,l,c,50);g.value=""+Math.round(e.width),m.value=""+Math.round(e.height),n()},E.onclick=function(){var e=t(3,4,l,c,50);g.value=""+Math.round(e.width),m.value=""+Math.round(e.height),n()};var M=new yE({isFocusable:!0,optionArr:[["screen",dE("new-screen")],["16 9",dE("new-video")+" 16:9"],["3 2","3:2"],["5 3","5:3"],["2 1","2:1"],["paper",dE("new-din-paper")+" √2:1"],["9 16","9:16"],["2 3","2:3"],["3 5","3:5"],["1 2","1:2"],["1 1.4142135623730951","1:√2"]],onChange:function(e){if("screen"===e)g.value=""+window.screen.width,m.value=""+window.screen.height;else if("paper"===e){var r=t(Math.sqrt(2),1,l,c,50);g.value=""+Math.round(r.width),m.value=""+Math.round(r.height)}else{var i=e.split(" "),a=t(parseFloat(i[0]),parseFloat(i[1]),l,c,50);g.value=""+Math.round(a.width),m.value=""+Math.round(a.height)}n(),M.setValue(null)}});setTimeout((function(){M.setValue(null)}),0),Gk.css(M.getElement(),{width:"80px"}),b.appendChild(M.getElement());var I={r:255,g:255,b:255,a:1},R=[{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:0}];R.push({r:r.r,g:r.g,b:r.b,a:1}),R.push({r:i.r,g:i.g,b:i.b,a:1});var A=new RE({colorArr:R,onChange:function(e){I=e,P.style.backgroundColor="rgba("+e.r+","+e.g+","+e.b+", "+e.a+")"}}),L=document.createElement("div");Gk.css(L,{boxSizing:"border-box",width:"340px",height:"140px",display:"table",backgroundColor:"#9e9e9e",padding:"10px",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",marginLeft:"-20px",colorScheme:"only light"});var P=document.createElement("div");Gk.css(P,{width:"200px",height:"100px",backgroundColor:"#fff",marginLeft:"auto",marginRight:"auto",color:"#aaa",fontSize:"16px",fontWeight:"bold",textAlign:"center",verticalAlign:"center",display:"table",overflow:"hidden",boxShadow:"0px 0px 3px rgba(0,0,0,0.5)"});var O=document.createElement("div");O.style.display="table-cell",O.style.verticalAlign="middle",O.appendChild(P),L.appendChild(O);var D=Gk.appendTextDiv(P,"");D.style.display="table-cell",D.style.verticalAlign="middle",parseInt(g.value),parseInt(m.value),g.onchange=function(){(""===g.value||parseInt(g.value)<0)&&(g.value="1"),n()},g.onkeyup=function(){n()},m.onchange=function(){(""===m.value||parseFloat(m.value)<0)&&(m.value="1"),n()},m.onkeyup=function(){n()},n(),d.appendChild(b);var B=Gk.el({parent:d,css:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}}),z=Gk.el({parent:B});z.appendChild(p),z.appendChild(f),z.appendChild(x),B.appendChild(A.getElement()),d.appendChild(L),pE({target:document.body,message:"<b>".concat(dE("new-title"),"</b>"),div:d,buttons:["Ok","Cancel"],callback:function(e){g.onclick=null,m.onclick=null,C.onclick=null,w.onclick=null,T.onclick=null,S.onclick=null,k.onclick=null,E.onclick=null,g.onchange=null,g.onkeyup=null,m.onchange=null,m.onkeyup=null,M.destroy(),A.destroy(),"Cancel"===e||parseInt(g.value)<=0||parseInt(m.value)<=0||isNaN(parseInt(g.value))||isNaN(parseInt(m.value))?h():u(parseInt(g.value),parseInt(m.value),I)},clickOnEnter:"Ok"})},textToolDialog:function(e){var n=function(){g.clearRect(0,0,f.width,f.height);var t=jT.default({},e.color,{a:V.getValue()}),n=GE(f,{x:e.x,y:e.y,textStr:W.value,align:U.getValue(),isItalic:Y.getValue(),isBold:X.getValue(),size:parseFloat(_.value),font:D.getValue(),color:Gk.ColorConverter.toRgbaStr(t),angleRad:e.angleRad});n.width=Math.max(n.width,1),n.height=Math.max(n.height,1);var r=Gk.rotate(n.x,n.y,-e.angleRad/Math.PI*180),i=Gk.rotate(n.width,n.height,-e.angleRad/Math.PI*180),a=e.x+r.x+i.x/2,o=e.y+r.y+i.y/2,s=Gk.fitInto(n.width,n.height,u-100,h-100);d=Math.min(1,s.width/n.width),d=Math.min(4,d*Math.pow(2,z)),m.save(),d>=4?m.imageSmoothingEnabled=!1:(m.imageSmoothingEnabled=!0,m.imageSmoothingQuality=d>=1?"low":"medium"),m.clearRect(0,0,b.width,b.height),m.translate(u/2,h/2),m.scale(d,d),m.rotate(e.angleRad),m.drawImage(p[e.layerIndex].canvas,-a,-o),m.drawImage(f,-a,-o),m.restore(),x.save(),x.fillStyle="rgb(158,158,158)",x.fillRect(0,0,u,h),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad),x.imageSmoothingEnabled=!1;var l=1/d;x.globalAlpha=.2,x.drawImage(k,-a-l,-o-l,f.width+2*l,f.height+2*l),x.globalAlpha=1,x.globalCompositeOperation="destination-out",x.drawImage(k,-a,-o,f.width,f.height),x.restore(),d>=4?x.imageSmoothingEnabled=!1:(x.imageSmoothingEnabled=!0,x.imageSmoothingQuality=d>=1?"low":"medium"),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad);for(var c=0;c<e.layerIndex;c++)p[c].opacity>0&&(x.globalAlpha=p[c].opacity,x.globalCompositeOperation=p[c].mixModeStr,x.drawImage(p[c].canvas,-a,-o));x.restore(),x.globalAlpha=p[e.layerIndex].opacity,x.globalCompositeOperation=p[e.layerIndex].mixModeStr,x.drawImage(v,0,0),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad);for(var C=e.layerIndex+1;C<p.length;C++)p[C].opacity>0&&(x.globalAlpha=p[C].opacity,x.globalCompositeOperation=p[C].mixModeStr,x.drawImage(p[C].canvas,-a,-o));x.restore(),x.restore(),w.save(),w.fillStyle=S,w.fillRect(0,0,b.width,b.height),w.drawImage(y,0,0),w.restore(),w.save(),w.globalCompositeOperation="difference",w.strokeStyle="#fff",w.lineWidth=1,w.strokeRect(Math.round(u/2-n.width/2*d),Math.round(h/2-n.height/2*d),Math.round(n.width*d),Math.round(n.height*d)),w.restore()},r=function(t,r){var i=Gk.rotate(t,r,-e.angleRad/Math.PI*180);e.x+=i.x/d,e.y+=i.y/d,n()},i=function(e){z=Math.min(2,Math.max(-2,z+e)),n(),F.disabled=!a(1),N.disabled=!a(-1)},a=function(e){return z!==Math.min(2,Math.max(-2,z+e))},o=function(){window.scrollTo(0,0)},s=Gk.el({}),l=window.innerWidth<550,c=window.innerHeight<630,u=l?340:540,h=l?c?210:260:c?230:350,d=1,p=e.klCanvas.getLayersFast(),f=Gk.canvas(e.klCanvas.getWidth(),e.klCanvas.getHeight()),g=f.getContext("2d"),v=Gk.canvas(u,h),m=v.getContext("2d"),y=Gk.canvas(u,h),x=y.getContext("2d"),b=Gk.canvas(u,h),w=b.getContext("2d");Gk.css(b,{display:"block"});var C=Gk.el({parent:s,css:{position:"relative",width:u+"px",marginLeft:"-20px",cursor:"move",colorScheme:"only light",touchAction:"none"},onClick:function(){W.focus()}});Gk.el({parent:C,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",pointerEvents:"none"}}),C.appendChild(b);var S=w.createPattern(Gk.createCheckerCanvas(8),"repeat"),k=Gk.canvas(1,1);k.getContext("2d").fillRect(0,0,1,1);var E=new Gk.PointerListener({target:b,pointers:1,onPointer:function(e){"pointermove"===e.type&&e.button&&(e.eventPreventDefault(),r(-e.dX,-e.dY))},onWheel:function(e){i(-e.deltaY)}}),T=function(e){e.preventDefault()};Gk.addEventListener(b,"wheel",T);var M=Gk.el({parent:s,css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"}}),I=Gk.el({parent:s,css:l?{}:{display:"flex",alignItems:"center",justifyContent:"space-between"}}),R=Gk.el({parent:I,css:{display:"flex",alignItems:"center",marginTop:"5px"}}),A=Gk.el({parent:I,css:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"5px",width:l?"":"300px"}}),L=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];L.unshift({r:e.secondaryColor.r,g:e.secondaryColor.g,b:e.secondaryColor.b,a:1}),L.unshift({r:e.color.r,g:e.color.g,b:e.color.b,a:1});var P=new RE({colorArr:L,initialIndex:0,onChange:function(t){e.color=t,n()}});P.getElement().title=dE("text-color"),P.getElement().style.marginLeft="-5px",M.appendChild(P.getElement());var O,D,B,z=0,j=Gk.el({parent:M,css:{}}),F=Gk.el({parent:j,content:'<img height="20" src="'.concat(t(AT),'">'),title:dE("zoom-in"),tagName:"button",onClick:function(){i(1)},css:{fontWeight:"bold"}}),N=Gk.el({parent:j,content:'<img height="20" src="'.concat(t(LT),'">'),title:dE("zoom-out"),tagName:"button",onClick:function(){i(-1)},css:{fontWeight:"bold",marginLeft:"5px"}}),_=Gk.el({parent:R,tagName:"input",title:dE("text-size"),custom:{type:"number",min:1,max:1e4,value:e.size},css:{width:"60px"},onChange:function(){_.value=""+Math.max(1,Math.min(1e4,parseInt(_.value))),n()}}),H=new Gk.PointerListener({target:_,onWheel:function(e){_.value=""+Math.max(1,Math.min(1e3,parseInt(_.value)-e.deltaY)),n()}});O=Gk.el({css:{fontSize:"15px",marginLeft:"10px"}}),D=new yE({isFocusable:!0,optionArr:[["sans-serif","Sans-serif"],["serif","Serif"],["monospace","Monospace"],["cursive","Cursive"],["fantasy","Fantasy"]],initValue:e.font,onChange:function(e){n()}}),O.appendChild(D.getElement()),R.appendChild(O),B=new Gk.PointerListener({target:D.getElement(),onWheel:function(e){D.setDeltaValue(e.deltaY)}});var U=new bE({optionArr:[{id:"left",title:dE("text-left"),image:t(zT)},{id:"center",title:dE("text-center"),image:t(FT)},{id:"right",title:dE("text-right"),image:t(NT)}],initId:e.align,onChange:function(e){n()}});A.appendChild(U.getElement());var Y=new xE({image:t(_T),title:dE("text-italic"),initValue:e.isItalic,onChange:function(e){n()}});A.appendChild(Y.getElement());var X=new xE({image:t(HT),title:dE("text-bold"),initValue:e.isBold,onChange:function(e){n()}});A.appendChild(X.getElement());var V=new kE({label:dE("opacity"),width:150,height:30,min:0,max:1,initValue:e.opacity,resolution:225,eventResMs:1e3/30,onChange:function(e){n()},formatFunc:function(e){return Math.round(100*e)}});A.appendChild(V.getElement());var W=Gk.el({parent:s,tagName:"textarea",custom:{placeholder:dE("text-placeholder"),"data-ignore-focus":"true"},css:{whiteSpace:"nowrap",overflow:"auto",width:"100%",height:"70px",resize:"vertical",marginTop:"10px"},onChange:function(){n()}});W.addEventListener("input",n),setTimeout((function(){W.focus(),W.select()}));var G=new Gk.KeyListener({onDown:function(e,t,n){Gk.isInputFocused(!0)||("left"===e&&r(-1,0),"right"===e&&r(1,0),"up"===e&&r(0,-1),"down"===e&&r(0,1))}});window.addEventListener("scroll",o),pE({target:document.body,message:"<b>".concat(dE("text-title"),"</b>"),div:s,buttons:["Ok","Cancel"],style:l?{}:{width:"500px"},callback:function(t){window.removeEventListener("scroll",o),E.destroy(),H.destroy(),B.destroy(),Gk.removeEventListener(b,"wheel",T),G.destroy(),"Ok"===t&&e.onConfirm({x:e.x,y:e.y,textStr:W.value,align:U.getValue(),isItalic:Y.getValue(),isBold:X.getValue(),color:e.color,size:_.value,font:D.getValue(),opacity:V.getValue()})},autoFocus:!1,clickOnEnter:"Ok",ignoreBackground:!0,closefunc:function(e){e}}),n()},showImportImageDialog:function(e){var t,n=function(n,r){var i=Gk.fitInto(n,r,e.maxSize,e.maxSize);i.width<n?(t.innerHTML='<span style="color:#f00">'.concat(n," X ").concat(r,"</span> ⟶ ").concat(Math.round(i.width)," X ").concat(Math.round(i.height)),t.title=dE("import-too-large")):(t.innerHTML="".concat(n," X ").concat(r),t.title="")},r=Gk.el({}),i=window.innerWidth<550||window.innerHeight<550,a=i?{}:{width:"500px"},o=new OE({width:i?340:540,height:i?300:400,canvas:e.image.canvas,isNotCopy:!0,onChange:function(e,r){t&&n(e,r)}});Gk.css(o.getEl(),{marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),o.getEl().title=dE("crop-drag-to-crop"),r.appendChild(o.getEl()),t=Gk.el({parent:r,css:{marginTop:"10px",textAlign:"center",color:"#888",lineHeight:"20px"}}),n(e.image.width,e.image.height);var s,l=!1;if("psd"===e.image.type){var c={background:"rgba(255,255,0,0.5)",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"};if(e.image.layers){if(s=new gE({init:l,label:dE("import-flatten"),callback:function(e){l=e}}),r.appendChild(s.getElement()),e.image.warningArr){var u=Gk.el({content:dE("import-psd-limited-support"),css:c});u.appendChild(Gk.el({tagName:"a",content:"Details",onClick:function(){!function(e){for(var t=[],n={mask:"Masks not supported. Mask was applied.",clipping:"Clipping not supported. Clipping layers were merged.",group:"Groups not supported. Layers were ungrouped.",adjustment:"Adjustment layers not supported.","layer-effect":"Layer effects not supported.","smart-object":"Smart objects not supported.","blend-mode":"Unsupported layer blend mode.","bits-per-channel":"Unsupported color depth. Only 8bit per channel supported."},r=0;r<e.length;r++)t.push("- "+n[e[r]]);alert(t.join("\n"))}(e.image.warningArr)}})),r.appendChild(u)}}else{var h=Gk.el({content:dE("import-psd-unsupported"),css:c});r.appendChild(h)}}pE({target:e.target,message:"<b>".concat(dE("import-title"),"</b>"),div:r,style:a,buttons:[dE("import-btn-as-layer"),dE("import-btn-as-image"),"Cancel"],callback:function(t){var n=o.getCroppedImage(),r=o.getRect();o.destroy(),s&&s.destroy(),t===dE("import-btn-as-layer")?e.callback({type:"as-layer",image:n}):t===dE("import-btn-as-image")?"psd"===e.image.type?(l&&(e.image.layers=null),e.callback({type:"as-image-psd",image:e.image,cropObj:r})):"image"===e.image.type&&e.callback({type:"as-image",image:n}):e.callback({type:"cancel"})},autoFocus:"As Image"})},showIframePopup:cI,imgurUpload:function(e,n,r,i){if(!i)throw new Error("imgur key missing");var a=document.createElement("input");a.type="text",a.value=dE("upload-title-untitled");var l=Gk.el({tagName:"textarea",custom:{rows:2},css:{width:"100%",maxWidth:"100%"}}),c=document.createElement("div");c.textContent=dE("upload-name")+":";var u=Gk.el({content:dE("upload-caption")+":",css:{marginTop:"10px"}}),h=document.createElement("div");h.innerHTML='<br/><a href="https://imgur.com/tos" target="_blank" rel="noopener noreferrer">'.concat(dE("upload-tos"),"</a> ").concat(dE("upload-tos-2"));var d=new DI.RadioList({name:"filetype",init:"jpeg",items:[{label:"JPG",value:"jpeg"},{label:"PNG",value:"png"}],ignoreFocus:!0});Gk.css(d.getElement(),{marginBottom:"10px"});var p,f=document.createElement("div"),g=document.createElement("div");g.className="info-hint",g.textContent=dE("upload-link-notice"),f.append(g,d.getElement(),c,a,u,l,h),DI.popup({target:n,message:"<b>".concat(dE("upload-title"),"</b>"),type:"upload",div:f,buttons:[dE("upload-submit"),"Cancel"],clickOnEnter:dE("upload-submit"),primaries:[dE("upload-submit")],autoFocus:dE("upload-submit"),callback:(p=o.default(t(s).mark((function o(c){var u;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c!==dE("upload-submit")&&"Yes"!==c&&"Ok"!==c){t.next=12;break}return t.prev=1,t.next=4,bI(e.getCompleteCanvas(1),a.value,l.value,d.getValue(),i);case 4:u=t.sent,DI.popup({target:n,type:"ok",message:"<h3>".concat(dE("upload-success"),"</h3><br>").concat(dE("upload-delete"),"<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/").concat(u.deletehash,"'>imgur.com/<b>delete</b>/").concat(u.deletehash,"</a><br><br>"),buttons:["Ok"]}),r.reset(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),DI.popup({target:n,type:"error",message:dE("upload-failed"),buttons:["Ok"]});case 12:case"end":return t.stop()}}),o,null,[[1,9]])}))),function(){return p.apply(this,arguments)})})},HandUi:function(e){var n=function(){u.innerHTML=Math.round(100*a)+"%",d.innerHTML=Math.round(o)+"°",h.style.transform="rotate("+o+"deg)",h.style.boxShadow=o%90==0?"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)":""},r=Gk.el({css:{margin:"10px"}}),i=!0,a=e.scale,o=e.angleDeg,s=Gk.el({css:{marginBottom:"10px",display:"flex"}}),l=Gk.el({css:{display:"flex",marginBottom:"10px"}}),c=Gk.el({css:{display:"flex"}});r.append(s,l,c);var u=Gk.el({css:{width:"55px",userSelect:"none"}});s.appendChild(u);var h=new Image;h.src=t(LE),Gk.css(h,{verticalAlign:"bottom",width:"20px",height:"20px",marginRight:"5px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",userSelect:"none"}),s.appendChild(h);var d=Gk.el({css:{userSelect:"none"}});s.appendChild(d),n();var p=Gk.el({tagName:"button",content:dE("hand-reset"),onClick:e.onReset});Gk.makeUnfocusable(p);var f=Gk.el({tagName:"button",content:dE("hand-fit"),css:{marginLeft:"10px"},onClick:e.onFit});Gk.makeUnfocusable(f),l.append(p,f);var g=Gk.el({tagName:"button",content:'<img height="20" src="'+t(DT)+'" alt="Rotate" style="transform: scale(-1, 1)"/>',onClick:function(){e.onAngleChange(-15,!0)}});Gk.makeUnfocusable(g);var v=Gk.el({tagName:"button",content:"0°",css:{marginLeft:"10px"},onClick:function(){e.onAngleChange(0)}});Gk.makeUnfocusable(v);var m=Gk.el({tagName:"button",content:'<img height="20" src="'+t(DT)+'" alt="Rotate"/>',css:{marginLeft:"10px"},onClick:function(){e.onAngleChange(15,!0)}});Gk.makeUnfocusable(m),c.append(g,v,m),this.getElement=function(){return r},this.setIsVisible=function(e){i=!!e,r.style.display=i?"block":"none",i&&n()},this.update=function(e,t){a=e,o=t,i&&n()}},FillUi:function(e){var t=Gk.el({css:{margin:"10px"}}),n=!0,r=Gk.el({parent:t,css:{marginBottom:"10px"}}),i=new kE({label:dE("opacity"),width:250,height:30,min:0,max:1,initValue:1,onChange:function(e){},formatFunc:function(e){return Math.round(100*e)}});t.appendChild(i.getElement());var a=new kE({label:dE("bucket-tolerance"),width:250,height:30,min:0,max:255,initValue:51,onChange:function(e){},formatFunc:function(e){return Math.round(e/255*100)}});Gk.css(a.getElement(),{marginTop:"10px"}),t.appendChild(a.getElement());var o,s,l,c,u=Gk.el({parent:t,css:{display:"flex",marginTop:"10px"}});o=Gk.el({content:dE("bucket-sample")+"&nbsp;",title:dE("bucket-sample-title"),css:{fontSize:"15px"}}),s=new yE({optionArr:[["all",dE("bucket-sample-all")],["current",dE("bucket-sample-active")],["above",dE("bucket-sample-above")]],initValue:"all",onChange:function(e){}}),new Gk.PointerListener({target:s.getElement(),onWheel:function(e){s.setDeltaValue(e.deltaY)}}),o.appendChild(s.getElement()),u.appendChild(o),l=Gk.el({content:dE("bucket-grow")+"&nbsp;",title:dE("bucket-grow-title"),css:{fontSize:"15px",marginLeft:"10px"}}),c=new yE({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"]],initValue:"0",onChange:function(e){}}),new Gk.PointerListener({target:c.getElement(),onWheel:function(e){c.setDeltaValue(e.deltaY)}}),l.appendChild(c.getElement()),u.appendChild(l);var h=!0,d=new gE({init:!0,label:dE("bucket-contiguous"),title:dE("bucket-contiguous-title"),callback:function(e){h=e},css:{marginTop:"10px",paddingRight:"5px",display:"inline-block"}});t.appendChild(d.getElement()),this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))},this.getTolerance=function(){return a.getValue()},this.getOpacity=function(){return i.getValue()},this.getSample=function(){return s.getValue()},this.getGrow=function(){return parseInt(c.getValue(),10)},this.getContiguous=function(){return h}},TextUi:function(e){var t=Gk.el({css:{margin:"10px"}}),n=!0,r=Gk.el({parent:t,css:{marginBottom:"10px"}});Gk.el({parent:t,content:dE("text-instruction")}),this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))}},ShapeUi:function(e){var t,n,r=function(){var e=Gk.clamp(Math.round(C.getValue()/10),1,10)+"px",t=1.35;Gk.css(c,{fill:"none",stroke:"black",strokeWidth:e}),Gk.css(h,{fill:"black",stroke:"none"}),Gk.css(p,{fill:"none",stroke:"black",strokeWidth:e}),Gk.css(g,{fill:"black",stroke:"none"}),Gk.css(m,{fill:"none",stroke:"black",strokeWidth:e}),T.getValue()?(c.setAttribute("y",""+l),c.setAttribute("height",""+(s-2*l)),h.setAttribute("y",""+l),h.setAttribute("height",""+(s-2*l)),p.setAttribute("ry",""+(s/2-l)),g.setAttribute("ry",""+(s/2-l))):(c.setAttribute("y",""+l*t),c.setAttribute("height",""+(s-l*t*2)),h.setAttribute("y",""+l*t),h.setAttribute("height",""+(s-l*t*2)),p.setAttribute("ry",""+(s/2-l*t)),g.setAttribute("ry",""+(s/2-l*t))),M.getValue()?(m.setAttribute("y1",""+(s-l)),m.setAttribute("y2",""+l)):(m.setAttribute("y1",""+(s-l*t)),m.setAttribute("y2",""+l*t))},i=Gk.el({css:{margin:"10px"}}),a=!0,o=Gk.el({parent:i,css:{marginBottom:"10px"}}),s=35,l=8,c=Gk.createSvg({elementType:"rect",x:""+l,width:""+(s-2*l)}),u=Gk.createSvg({elementType:"svg",width:""+s,height:""+s});u.appendChild(c),Gk.css(u,{display:"block"});var h=Gk.createSvg({elementType:"rect",x:""+l,width:""+(s-2*l)}),d=Gk.createSvg({elementType:"svg",width:""+s,height:""+s});d.appendChild(h),Gk.css(d,{display:"block"});var p=Gk.createSvg({elementType:"ellipse",cx:""+s/2,cy:""+s/2,rx:""+(s/2-l)}),f=Gk.createSvg({elementType:"svg",width:""+s,height:""+s});f.appendChild(p),Gk.css(f,{display:"block"});var g=Gk.createSvg({elementType:"ellipse",cx:""+s/2,cy:""+s/2,rx:""+(s/2-l)}),v=Gk.createSvg({elementType:"svg",width:""+s,height:""+s});v.appendChild(g),Gk.css(v,{display:"block"});var m=Gk.createSvg({elementType:"line",x1:""+l,x2:""+(s-l)}),y=Gk.createSvg({elementType:"svg",width:""+s,height:""+s});y.appendChild(m),Gk.css(y,{display:"block"});var x=Gk.el({parent:i,css:{display:"flex",justifyContent:"space-between",alignItems:"start"}}),b=new AE({optionArr:[{id:"rect-stroke",label:u,title:dE("shape-rect")+" "+dE("shape-stroke")},{id:"ellipse-stroke",label:f,title:dE("shape-ellipse")+" "+dE("shape-stroke")},{id:"line",label:y,title:dE("shape-line")},{id:"rect-fill",label:d,title:dE("shape-rect")+" "+dE("shape-fill")},{id:"ellipse-fill",label:v,title:dE("shape-ellipse")+" "+dE("shape-fill")}],initId:"rect",onChange:function(e){var r=e.split("-");t=r[0],n=r[1],Gk.css(T.getElement(),{display:"line"===t?"none":null}),Gk.css(M.getElement(),{display:"line"===t?null:"none"}),Gk.css(C.getElement(),{display:"line"!==t&&"fill"===n?"none":null})},changeOnInit:!0});b.getElement().style.width="120px",x.appendChild(b.getElement());var w=new gE({init:!1,label:dE("eraser"),callback:function(e){r()}});x.appendChild(w.getElement());var C=new kE({label:dE("shape-line-width"),width:250,height:30,min:1,max:200,initValue:4,curve:"quadratic",onChange:function(e){r()},formatFunc:function(e){return Math.round(e)}});Gk.css(C.getElement(),{marginTop:"10px"}),i.appendChild(C.getElement());var S=new kE({label:dE("opacity"),width:250,height:30,min:0,max:1,initValue:1,onChange:function(e){},formatFunc:function(e){return Math.round(100*e)}});Gk.css(S.getElement(),{marginTop:"10px"}),i.appendChild(S.getElement());var k=Gk.el({parent:i,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),E=new gE({init:!1,label:dE("shape-outwards"),callback:function(e){},css:{width:"50%",marginRight:"10px"}});k.appendChild(E.getElement());var T=new gE({init:!1,label:dE("shape-fixed"),callback:function(e){r()},css:{flexGrow:"1"}});k.appendChild(T.getElement());var M=new gE({init:!1,label:dE("shape-snap"),title:dE("shape-snap-title"),callback:function(e){r()},css:{flexGrow:"1"}});k.appendChild(M.getElement()),r(),this.getElement=function(){return i},this.setIsVisible=function(t){a=!!t,i.style.display=a?"block":"none",a&&(o.appendChild(e.colorSlider.getElement()),o.appendChild(e.colorSlider.getOutputElement()))},this.getShape=function(){return t},this.getMode=function(){return n},this.getIsEraser=function(){return w.getValue()},this.getOpacity=function(){return S.getValue()},this.getLineWidth=function(){return C.getValue()},this.getIsOutwards=function(){return E.getValue()},this.getIsFixed=function(){return T.getValue()},this.getIsSnap=function(){return M.getValue()}},FileTab:mI,FilterTab:yI,SettingsTab:OI,klLayerManager:function(e,n,r){var i,a=function(e){var n=document.createElement("div"),i=Gk.el({content:dE("layers-rename-name")+":",css:{marginRight:"5px"}}),a=Gk.el({css:{display:"flex"}}),s=document.createElement("input");s.value=h.getLayer(e).name,s.setAttribute("data-ignore-focus","true");var l=Gk.el({tagName:"Button",content:'<img src="'+t(FE)+'" height="20"/>',title:dE("layers-rename-clear"),css:{marginLeft:"10px"},onClick:function(){s.value="",s.focus()}}),c=[dE("layers-rename-sketch"),dE("layers-rename-colors"),dE("layers-rename-lines"),dE("background"),dE("layers-rename-foreground")],u=[],d=Gk.el({css:{display:"flex",flexWrap:"wrap",marginTop:"5px",marginLeft:"-5px"}});c.forEach((function(e){var t=Gk.el({parent:d,tagName:"Button",content:e,onClick:function(){s.value=t.textContent},css:{margin:"5px 0 0 5px"}});u.push(t)})),n.appendChild(i),i.append(a,d),a.append(s,l),setTimeout((function(){s.focus(),s.select()}),10),pE({target:r,message:"<b>".concat(dE("layers-rename-title"),"</b>"),div:n,buttons:[dE("layers-rename"),"Cancel"],primaries:[dE("layers-rename")],callback:function(t){if(Gk.destroyEl(l),u.forEach((function(e){Gk.destroyEl(e)})),u.splice(0,u.length),t===dE("layers-rename")){if(s.value===h.getLayer(e).name)return;h.renameLayer(e,s.value),o(),Zk.pause(!0),g(e),Zk.pause(!1)}},clickOnEnter:dE("layers-rename")})},o=function(){function e(e){var t=h.getLayer(e).name,n=w[e].opacity,r=w[e].context.canvas,i=document.createElement("div");i.className="layerBox",d[e]=i,i.posY=35*(w.length-1)-35*e,Gk.css(i,{width:"250px",height:"34px",backgroundColor:"rgb( 220, 220, 220)",border:"1px solid #aaa",position:"absolute",left:"0 px",top:i.posY+"px",transition:"all 0.1s linear",borderRadius:"5px",boxSizing:"border-box"});var o=document.createElement("div");Gk.css(o,{position:"relative"});var u=document.createElement("div");Gk.css(u,{width:"250px",height:"34px"});var p=document.createElement("div");i.appendChild(o),o.appendChild(u),o.appendChild(p),i.spot=e;var f,k=Gk.fitInto(r.width,r.height,30,30,1),T=i.thumb=Gk.canvas(k.width,k.height),M=T.getContext("2d");M.save(),T.width>r.width&&(M.imageSmoothingEnabled=!1),M.drawImage(r,0,0,T.width,T.height),M.restore(),Gk.css(i.thumb,{position:"absolute",left:(32-i.thumb.width)/2+"px",top:(32-i.thumb.height)/2+"px",colorScheme:"only light"}),Gk.createCheckerDataUrl(4,(function(e){T.style.backgroundImage="url("+e+")"})),i.label=document.createElement("div"),i.lname=t,i.label.append(i.lname),Gk.css(i.label,{position:"absolute",left:"38px",top:"1px",fontSize:"13px",width:"170px",height:"20px",overflow:"hidden",color:"#666",whiteSpace:"nowrap"}),i.label.ondblclick=function(){a(i.spot)},i.opacityLabel=document.createElement("div"),i.opacity=n,i.opacityLabel.append(parseInt(""+100*i.opacity)+"%"),Gk.css(i.opacityLabel,{position:"absolute",left:"194px",top:"1px",fontSize:"13px",textAlign:"right",width:"50px",color:"#666",transition:"color 0.2s ease-in-out"});var I=new IE({init:i.opacity,width:204,pointSize:14,callback:function(e,t,n){return t?(f=h.getLayer(i.spot).opacity,void Zk.pause(!0)):n?(Zk.pause(!1),void(f!==e&&h.layerOpacity(i.spot,e))):(i.opacityLabel.innerHTML=Math.round(100*e)+"%",void h.layerOpacity(i.spot,e))}});Gk.css(I.getEl(),{position:"absolute",left:"39px",top:"17px"}),i.opacitySlider=I,Gk.setEventListener(i.thumb,"onpointerover",(function(e){if(0===e.buttons||e.pointerType&&"touch"===e.pointerType){var t=Gk.fitInto(r.width,r.height,250,250,1);x.width===t.width&&x.height===t.height||(x.width=t.width,x.height=t.height);var n=x.getContext("2d");n.save(),x.width>r.width&&(n.imageSmoothingEnabled=!1),n.imageSmoothingQuality="high",n.clearRect(0,0,x.width,x.height),n.drawImage(r,0,0,x.width,x.height),n.restore(),Gk.css(v,{top:e.clientY-x.height/2+"px",opacity:"0"}),!1===b&&(document.body.appendChild(v),b=!0),clearTimeout(y),y=setTimeout((function(){Gk.css(v,{opacity:"1"})}),20),clearTimeout(m)}})),Gk.setEventListener(i.thumb,"onpointerout",(function(){clearTimeout(y),Gk.css(v,{opacity:"0"}),clearTimeout(m),m=setTimeout((function(){b&&(document.body.removeChild(v),b=!1)}),300)})),u.appendChild(i.thumb),u.appendChild(i.label),u.appendChild(i.opacityLabel),u.appendChild(I.getEl());var R=!1,A=!1;i.pointerListener=new Gk.PointerListener({target:u,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type&&"left"===e.button)Gk.css(i,{transition:"box-shadow 0.3s ease-in-out"}),i.style.zIndex="1",D=i.spot,A=!1,i.isSelected||(A=!0,S.activateLayer(i.spot)),R=!0;else if("pointermove"===e.type&&"left"===e.button){R&&(R=!1,Gk.css(i,{boxShadow:"1px 3px 5px rgba(0,0,0,0.4)"})),i.posY+=e.dY;var t=Math.max(0,Math.min(35*(w.length-1),i.posY));i.style.top=t+"px",l(i.spot,s(i.posY))}if("pointerup"===e.type){Gk.css(i,{transition:"all 0.1s linear"}),setTimeout((function(){Gk.css(i,{boxShadow:""})}),20),i.posY=Math.max(0,Math.min(35*(w.length-1),i.posY)),i.style.zIndex="";var n=s(i.posY),r=i.spot;c(i.spot,n),r!=n&&(Zk.pause(!0),g(C),Zk.pause(!1)),r===n&&A&&g(C),A=!1}}}),E.appendChild(i)}for(i=Zk.getState(),d=[];E.firstChild;){var t=E.firstChild;t.pointerListener.destroy(),t.opacitySlider.destroy(),E.removeChild(t)}for(var n=0;n<w.length;n++)e(n);S.activateLayer(C),u()},s=function(e){var t=parseInt(""+(e/(p+f)+.5));return t=Math.min(w.length-1,Math.max(0,t)),t=w.length-t-1},l=function(e,t){if((t=Math.min(w.length-1,Math.max(0,t)))!==D){for(var n=0;n<w.length;n++)if(d[n].spot!==e){var r=d[n].spot;d[n].spot>e&&r--,r>=t&&r++,d[n].posY=(p+f)*(w.length-r-1),d[n].style.top=d[n].posY+"px"}D=t}},c=function(e,t){if(isNaN(e)||isNaN(t))throw"layermanager - invalid move";for(var n=0;n<w.length;n++)!function(n){var r=d[n].spot;d[n].spot===e?r=t:(d[n].spot>e&&r--,r>=t&&r++),d[n].spot=r,d[n].posY=(p+f)*(w.length-r-1),d[n].style.top=d[n].posY+"px"}(n);e!==t&&(h.moveLayer(C,t-e),w=h.getLayers(),C=t,L.disabled=0===C)},u=function(){E.style.height=35*d.length+"px"},h=e,d=[],p=35,f=0,g=n,v=Gk.el({onClick:Gk.handleClick,css:{position:"absolute",right:"280px",top:"500px",background:"#aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none",padding:"0",border:"1px solid #aaa",transition:"opacity 0.3s ease-out",userSelect:"none",colorScheme:"only light"}});Gk.createCheckerDataUrl(4,(function(e){v.style.backgroundImage="url("+e+")"}));var m,y,x=document.createElement("canvas");x.style.display="block",x.width=200,x.height=200,v.appendChild(x);var b=!1,w=h.getLayers(),C=w.length-1,S=document.createElement("div");S.style.marginRight="10px",S.style.marginBottom="10px",S.style.marginLeft="10px",S.style.marginTop="10px",S.style.cursor="default";var k=document.createElement("div");Gk.css(k,{width:"250px",position:"relative"});var E=Gk.el({});S.disableButtons=function(){},S.enableButtons=function(){};var T,M,I,R=document.createElement("button"),A=document.createElement("button"),L=document.createElement("button"),P=document.createElement("button"),O=document.createElement("button");S.appendChild((T=document.createElement("div"),setTimeout((function(){Gk.makeUnfocusable(R),Gk.makeUnfocusable(A),Gk.makeUnfocusable(L),Gk.makeUnfocusable(P),Gk.makeUnfocusable(O),R.style.cssFloat="left",A.style.cssFloat="left",L.style.cssFloat="left",P.style.cssFloat="left",O.style.cssFloat="left",R.title=dE("layers-new"),A.title=dE("layers-duplicate"),P.title=dE("layers-remove"),L.title=dE("layers-merge"),O.title=dE("layers-rename-title"),R.style.paddingLeft="5px",R.style.paddingRight="3px",P.style.paddingLeft="5px",P.style.paddingRight="3px",A.style.paddingLeft="5px",A.style.paddingRight="3px",L.style.paddingLeft="5px",L.style.paddingRight="3px",O.style.height="30px",O.style.lineHeight="20px",R.innerHTML="<img src='"+t(BE)+"' height='20'/>",A.innerHTML="<img src='"+t(zE)+"' height='20'/>",L.innerHTML="<img src='"+t(jE)+"' height='20'/>",P.innerHTML="<img src='"+t(FE)+"' height='20'/>",O.innerHTML="<img src='"+t(NE)+"' height='20'/>",R.style.marginRight="5px",P.style.marginRight="5px",A.style.marginRight="5px",L.style.marginRight="5px",T.appendChild(R),T.appendChild(P),T.appendChild(A),T.appendChild(L),T.appendChild(O),T.appendChild(Gk.el({css:{clear:"both"}}));var e=document.createElement("div");e.style.clear="both",e.style.height="10px",T.appendChild(e),R.onclick=function(){!1!==h.addLayer(C)&&((w=h.getLayers()).length===JE&&(R.disabled=!0,A.disabled=!0),P.disabled=!1,C+=1,o(),Zk.pause(!0),g(C),Zk.pause(!1))},A.onclick=function(){!1!==h.duplicateLayer(C)&&((w=h.getLayers()).length===JE&&(R.disabled=!0,A.disabled=!0),P.disabled=!1,C++,o(),Zk.pause(!0),g(C),Zk.pause(!1))},P.onclick=function(){d.length<=1||(h.removeLayer(C),C>0&&C--,w=h.getLayers(),o(),Zk.pause(!0),g(C),Zk.pause(!1),1===w.length&&(P.disabled=!0),w.length<JE&&(R.disabled=!1,A.disabled=!1))},L.onclick=function(){C<=0||function(e){var t=document.createElement("div");t.innerHTML=dE("layers-merge-description");var n=new AE({optionArr:[{id:e.mixModeStr,label:QE(e.mixModeStr)},{id:"source-in",label:"source-in"},{id:"source-out",label:"source-out"},{id:"source-atop",label:"source-atop"},{id:"destination-in",label:"destination-in"},{id:"destination-out",label:"destination-out"},{id:"destination-atop",label:"destination-atop"},{id:"xor",label:"xor"}],initId:e.mixModeStr,onChange:function(e){l()},isSmall:!0});n.getElement().style.marginTop="5px",t.appendChild(n.getElement());var i=document.createElement("canvas");i.title=dE("preview");var a=document.createElement("div");a.innerHTML="<br/>",a.style.clear="both",t.appendChild(a),t.appendChild(i);var o=Gk.fitInto(e.topCanvas.width,e.topCanvas.height,200,200,1);i.width=o.width,i.height=o.height,Gk.css(i,{display:"block",marginLeft:"auto",marginRight:"auto",colorScheme:"only light"}),i.style.boxShadow="0 0 3px rgba(0,0,0,0.5)",Gk.createCheckerDataUrl(4,(function(e){i.style.backgroundImage="url("+e+")"}));var s=Gk.copyCanvas(i);function l(){var t=i.getContext("2d");t.save(),t.clearRect(0,0,i.width,i.height),i.width>e.topCanvas.width&&(t.imageSmoothingEnabled=!1),t.drawImage(e.bottomCanvas,0,0,i.width,i.height),"as-alpha"===n.getValue()?(t.globalCompositeOperation="destination-in",t.globalAlpha=e.topOpacity,t.drawImage(s,0,0,i.width,i.height)):(t.globalCompositeOperation=n.getValue(),t.globalAlpha=e.topOpacity,t.drawImage(e.topCanvas,0,0,i.width,i.height)),t.restore()}s.getContext("2d").drawImage(e.topCanvas,0,0,s.width,s.height),Gk.convertToAlphaChannelCanvas(s),l();var c=new Gk.KeyListener({onDown:function(e){"right"===e&&n.next(),"left"===e&&n.previous()}});pE({target:r,message:"<b>".concat(dE("layers-merge-modal-title"),"</b>"),div:t,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){c.destroy(),n.destroy(),"Ok"===t&&e.callback(n.getValue())}})}({topCanvas:w[C].context.canvas,bottomCanvas:w[C-1].context.canvas,topOpacity:h.getLayer(C).opacity,mixModeStr:w[C].mixModeStr,callback:function(e){h.mergeLayers(C,C-1,e),w=h.getLayers(),C--,1===w.length&&(P.disabled=!0),w.length<JE&&(R.disabled=!1,A.disabled=!1),o(),Zk.pause(!0),g(C),Zk.pause(!1)}})},O.onclick=function(){a(C)}}),1),T)),M=Gk.el({content:dE("layers-blending")+"&nbsp;",css:{fontSize:"15px"}}),I=new yE({optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,QE(e)]:null})),onChange:function(e){h.setMixMode(C,e),S.update(C)},css:{marginBottom:"10px"}}),M.appendChild(I.getElement()),S.appendChild(M),k.appendChild(E),S.appendChild(k);var D=0;return setInterval((function(){if("block"===S.style.display){var e=Zk.getState();if(e!==i){i=e;for(var t=0;t<d.length;t++)if(C===d[t].spot&&w[d[t].spot]){var n=d[t].thumb.getContext("2d");n.save(),n.clearRect(0,0,n.canvas.width,n.canvas.height),w[d[t].spot].context.canvas.width<d[t].thumb.width&&(n.imageSmoothingEnabled=!1),n.drawImage(w[d[t].spot].context.canvas,0,0,d[t].thumb.width,d[t].thumb.height),n.restore()}}}}),1),S.update=function(e){w=h.getLayers(),(e||0===e)&&(C=e),P.disabled=1===w.length,w.length===JE?(R.disabled=!0,A.disabled=!0):(R.disabled=!1,A.disabled=!1),setTimeout((function(){o()}),1)},S.getSelected=function(){return C},S.activateLayer=function(e){if(e<0||e>d.length-1)throw"invalid spotIndex "+e+", layerElArr.length "+d.length;C=e,I.setValue(w[C].mixModeStr);for(var t=0;t<d.length;t++)C===d[t].spot?(d[t].style.backgroundColor="rgb( 250, 250, 250)",d[t].label.style.color="#000",d[t].style.boxShadow="",d[t].style.border="1px solid var(--active-highlight-color)",d[t].opacitySlider.setActive(!0),d[t].isSelected=!0):(d[t].style.backgroundColor="rgb( 220, 220, 220)",d[t].label.style.color="#666",d[t].style.boxShadow="",d[t].style.border="1px solid rgb(158, 158, 158)",d[t].opacitySlider.setActive(!1),d[t].isSelected=!1);L.disabled=0===C},S.setUiState=function(e){"left"===""+e?Gk.css(v,{left:"280px",right:""}):Gk.css(v,{left:"",right:"280px"})},o(),S},klHistory:Zk,DecoyKlHistory:qk};a("4gaLD");o=a("1ELdT");a("4gaLD");rk=a("5nGP2"),ik=a("8TCpN");var BI=function(){"use strict";function e(n){rk.default(this,e);var r=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=Gk.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.content?"":e.contain?t+"px 0":""}});if(e.content)n.appendChild(e.content);else{var r=Gk.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});r.style.pointerEvents="none",n.appendChild(r)}return n.pointerListener=new Gk.PointerListener({target:n,onEnterLeave:function(e){e?Gk.addClassName(n,"toolspace-row-button-hover"):Gk.removeClassName(n,"toolspace-row-button-hover")}}),n},i=document.createElement("div");this.el=i,Gk.css(i,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var a=r({onClick:n.onSubmit,title:dE("submit-title"),content:Gk.el({content:dE("submit"),className:"toolspace-row-button__submit",css:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}),contain:!0});a.style.width="45px";var o=r({onClick:n.onHelp,title:dE("help"),image:t(CT),contain:!0}),s=r({onClick:n.onLeftRight,title:dE("switch-ui-left-right"),image:t(PI),contain:!0});i.appendChild(a),i.appendChild(s),i.appendChild(o)}return ik.default(e,[{key:"getElement",value:function(){return this.el}}]),e}(),zI=60,jI=function(){var e,t=function(e,t,n){return Math.max(e,Math.min(t,n))},n=function(t){return{_:t,loadContentsOf:function(t){e=this._.gl,this._.loadContentsOf(t)},destroy:function(){e=this._.gl,this._.destroy()}}},r=function(e){return n(J.fromElement(e))},i=function(t,n){var r=e.UNSIGNED_BYTE;if(e.getExtension("OES_texture_float")&&e.getExtension("OES_texture_float_linear")){var i=new J(100,100,e.RGBA,e.FLOAT);try{i.drawTo((function(){r=e.FLOAT}))}catch(e){}i.destroy()}this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=t,this.height=n,this._.texture=new J(t,n,e.RGBA,r),this._.spareTexture=new J(t,n,e.RGBA,r),this._.extraTexture=this._.extraTexture||new J(0,0,e.RGBA,r),this._.flippedShader=this._.flippedShader||new q(null,"        uniform sampler2D texture;        varying vec2 texCoord;        void main() {            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));        }    ","flippedShader"),this._.isInitialized=!0},a=function(e,t,n){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||i.call(this,t||e._.width,n||e._.height),e._.use(),this._.texture.drawTo((function(){q.getDefaultShader().drawRect()})),this},o=function(){return this._.texture.use(),this._.flippedShader.drawRect(),this},s=function(e,t,n,r){(n||this._.texture).use(),this._.spareTexture.drawTo((function(){e.uniforms(t).drawRect()})),this._.spareTexture.swapWith(r||this._.texture)},l=function(e){return e.parentNode.insertBefore(this,e),e.parentNode.removeChild(e),this},c=function(){var t=new J(this._.texture.width,this._.texture.height,e.RGBA,e.UNSIGNED_BYTE);return this._.texture.use(),t.drawTo((function(){q.getDefaultShader().drawRect()})),n(t)},u=function(){var t=this._.texture.width,n=this._.texture.height,r=new Uint8Array(t*n*4);return this._.texture.drawTo((function(){e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,r)})),r},h=function(t){return function(){return e=this._.gl,t.apply(this,arguments)}},d=function(e,t,n,r,i,a,o,s){var l=n-i,c=r-a,u=o-i,h=s-a,d=e-n+i-o,p=t-r+a-s,f=l*h-u*c,g=(d*h-u*p)/f,v=(l*p-d*c)/f;return[n-e+g*n,r-t+g*r,g,o-e+v*o,s-t+v*s,v,e,t,1]},p=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s;return[(a*c-o*l)/u,(r*l-n*c)/u,(n*o-r*a)/u,(o*s-i*c)/u,(t*c-r*s)/u,(r*i-t*o)/u,(i*l-a*s)/u,(n*s-t*l)/u,(t*a-n*i)/u]},f=function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort((function(e,t){return e[0]-t[0]}));for(var n=0;n<t;n++)this.xa.push(e[n][0]),this.ya.push(e[n][1]);this.u[0]=0,this.y2[0]=0;for(n=1;n<t-1;++n){var r=this.xa[n+1]-this.xa[n-1],i=(this.xa[n]-this.xa[n-1])/r,a=i*this.y2[n-1]+2;this.y2[n]=(i-1)/a;var o=(this.ya[n+1]-this.ya[n])/(this.xa[n+1]-this.xa[n])-(this.ya[n]-this.ya[n-1])/(this.xa[n]-this.xa[n-1]);this.u[n]=(6*o/r-i*this.u[n-1])/a}this.y2[t-1]=0;for(n=t-2;n>=0;--n)this.y2[n]=this.y2[n]*this.y2[n+1]+this.u[n]},g=function(e,t){return new q(null,e+"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        "+t+"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }","warp")},v=function(n,r){return e.brightnessContrast=e.brightnessContrast||new q(null,"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    ","brightnessContrast"),s.call(this,e.brightnessContrast,{brightness:t(-1,n,1),contrast:t(-1,r,1)}),this},m=function(e){for(var n=new f(e),r=[],i=0;i<256;i++)r.push(t(0,Math.floor(256*n.interpolate(i/255)),255));return r},y=function(t,n,r){t=m(t),1==arguments.length?n=r=t:(n=m(n),r=m(r));for(var i=[],a=0;a<256;a++)i.splice(i.length,0,t[a],n[a],r[a],255);return this._.extraTexture.initFromBytes(256,1,i),this._.extraTexture.use(1),e.curves=e.curves||new q(null,"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    ","curves"),e.curves.textures({map:1}),s.call(this,e.curves,{}),this},x=function(t){e.denoise=e.denoise||new q(null,"        uniform sampler2D texture;        uniform float exponent;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec4 center = texture2D(texture, texCoord);            vec4 color = vec4(0.0);            float total = 0.0;            for (float x = -4.0; x <= 4.0; x += 1.0) {                for (float y = -4.0; y <= 4.0; y += 1.0) {                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));                    weight = pow(weight, exponent);                    color += sample * weight;                    total += weight;                }            }            gl_FragColor = color / total;        }    ","denoise");for(var n=0;n<2;n++)s.call(this,e.denoise,{exponent:Math.max(0,t),texSize:[this.width,this.height]});return this},b=function(n,r){return e.hueSaturation=e.hueSaturation||new q(null,"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    ","hueSaturation"),s.call(this,e.hueSaturation,{hue:t(-1,n,1),saturation:t(-1,r,1)}),this},w=function(n){return e.noise=e.noise||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        float rand(vec2 co) {            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);        }        void main() {            vec4 color = texture2D(texture, texCoord);                        float diff = (rand(texCoord) - 0.5) * amount;            color.r += diff;            color.g += diff;            color.b += diff;                        gl_FragColor = color;        }    ","noise"),s.call(this,e.noise,{amount:t(0,n,1)}),this},C=function(n){return e.sepia=e.sepia||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float r = color.r;            float g = color.g;            float b = color.b;                        color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));                        gl_FragColor = color;        }    ","sepia"),s.call(this,e.sepia,{amount:t(0,n,1)}),this},S=function(t,n){return e.unsharpMask=e.unsharpMask||new q(null,"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    ","unsharpMask"),this._.extraTexture.ensureFormat(this._.texture),this._.texture.use(),this._.extraTexture.drawTo((function(){q.getDefaultShader().drawRect()})),this._.extraTexture.use(1),this.triangleBlur(t),e.unsharpMask.textures({originalTexture:1}),s.call(this,e.unsharpMask,{strength:n}),this._.extraTexture.unuse(1),this},k=function(n){return e.vibrance=e.vibrance||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            float mx = max(color.r, max(color.g, color.b));            float amt = (mx - average) * (-amount * 3.0);            color.rgb = mix(color.rgb, vec3(mx), amt);            gl_FragColor = color;        }    ","vibrance"),s.call(this,e.vibrance,{amount:t(-1,n,1)}),this},E=function(n,r){return e.vignette=e.vignette||new q(null,"        uniform sampler2D texture;        uniform float size;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        float dist = distance(texCoord, vec2(0.5, 0.5));            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));                        gl_FragColor = color;        }    ","vignette"),s.call(this,e.vignette,{size:t(0,n,1),amount:t(0,r,1)}),this},T=function(n,r,i){e.lensBlurPrePass=e.lensBlurPrePass||new q(null,"        uniform sampler2D texture;        uniform float power;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color = pow(color, vec4(power));            gl_FragColor = vec4(color);        }    ","lensBlurPrePass");var a="        uniform sampler2D texture0;        uniform sampler2D texture1;        uniform vec2 delta0;        uniform vec2 delta1;        uniform float power;        varying vec2 texCoord;        "+Z+"        vec4 sample(vec2 delta) {            /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(delta, 151.7182), 0.0);                        vec4 color = vec4(0.0);            float total = 0.0;            for (float t = 0.0; t <= 30.0; t++) {                float percent = (t + offset) / 30.0;                color += texture2D(texture0, texCoord + delta * percent);                total += 1.0;            }            return color / total;        }    ";e.lensBlur0=e.lensBlur0||new q(null,a+"        void main() {            gl_FragColor = sample(delta0);        }    ","lensBlur0"),e.lensBlur1=e.lensBlur1||new q(null,a+"        void main() {            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;        }    ","lensBlur1"),e.lensBlur2=e.lensBlur2||new q(null,a+"        void main() {            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;            gl_FragColor = pow(color, vec4(power));        }    ","lensBlur2").textures({texture1:1});for(var o=[],l=0;l<3;l++){var c=i+l*Math.PI*2/3;o.push([n*Math.sin(c)/this.width,n*Math.cos(c)/this.height])}var u=Math.pow(10,t(-1,r,1));return s.call(this,e.lensBlurPrePass,{power:u}),this._.extraTexture.ensureFormat(this._.texture),s.call(this,e.lensBlur0,{delta0:o[0]},this._.texture,this._.extraTexture),s.call(this,e.lensBlur1,{delta0:o[1],delta1:o[2]},this._.extraTexture,this._.extraTexture),s.call(this,e.lensBlur0,{delta0:o[1]}),this._.extraTexture.use(1),s.call(this,e.lensBlur2,{power:1/u,delta0:o[2]}),this},M=function(t,n,r,i,a,o){e.tiltShift=e.tiltShift||new q(null,"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        "+Z+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","tiltShift");var l=r-t,c=i-n,u=Math.sqrt(l*l+c*c);return s.call(this,e.tiltShift,{blurRadius:a,gradientRadius:o,start:[t,n],end:[r,i],delta:[l/u,c/u],texSize:[this.width,this.height]}),s.call(this,e.tiltShift,{blurRadius:a,gradientRadius:o,start:[t,n],end:[r,i],delta:[-c/u,l/u],texSize:[this.width,this.height]}),this},I=function(t){return e.triangleBlur=e.triangleBlur||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+Z+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","triangleBlur"),s.call(this,e.triangleBlur,{delta:[t/this.width,0]}),s.call(this,e.triangleBlur,{delta:[0,t/this.height]}),this},R=function(t,n,r){return e.zoomBlur=e.zoomBlur||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        "+Z+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;            vec2 toCenter = center - texCoord * texSize;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = 0.0; t <= 40.0; t++) {                float percent = (t + offset) / 40.0;                float weight = 4.0 * (percent - percent * percent);                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","zoomBlur"),s.call(this,e.zoomBlur,{center:[t,n],strength:r,texSize:[this.width,this.height]}),this},A=function(t,n,r,i){return e.colorHalftone=e.colorHalftone||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern(float angle) {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            vec3 cmy = 1.0 - color.rgb;            float k = min(cmy.x, min(cmy.y, cmy.z));            cmy = (cmy - k) / (1.0 - k);            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);            gl_FragColor = vec4(1.0 - cmy - k, color.a);        }    ","colorHalftone"),s.call(this,e.colorHalftone,{center:[t,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},L=function(t,n,r,i){return e.dotScreen=e.dotScreen||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern() {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);        }    ","dotScreen"),s.call(this,e.dotScreen,{center:[t,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},P=function(t){return e.edgeWork1=e.edgeWork1||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+Z+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;                float average = (sample.r + sample.g + sample.b) / 3.0;                color.x += average * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += average * weight;                    total.y += weight;                }            }            gl_FragColor = vec4(color / total, 0.0, 1.0);        }    ","edgeWork1"),e.edgeWork2=e.edgeWork2||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+Z+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;                color.x += sample.x * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += sample.y * weight;                    total.y += weight;                }            }            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);            gl_FragColor = vec4(c, c, c, 1.0);        }    ","edgeWork2"),s.call(this,e.edgeWork1,{delta:[t/this.width,0]}),s.call(this,e.edgeWork2,{delta:[0,t/this.height]}),this},O=function(t,n,r){return e.hexagonalPixelate=e.hexagonalPixelate||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 tex = (texCoord * texSize - center) / scale;            tex.y /= 0.866025404;            tex.x -= tex.y * 0.5;                        vec2 a;            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));            else a = vec2(ceil(tex.x), ceil(tex.y));            vec2 b = vec2(ceil(tex.x), floor(tex.y));            vec2 c = vec2(floor(tex.x), ceil(tex.y));                        vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);                        float alen = length(TEX - A);            float blen = length(TEX - B);            float clen = length(TEX - C);                        vec2 choice;            if (alen < blen) {                if (alen < clen) choice = a;                else choice = c;            } else {                if (blen < clen) choice = b;                else choice = c;            }                        choice.x += choice.y * 0.5;            choice.y *= 0.866025404;            choice *= scale / texSize;            gl_FragColor = texture2D(texture, choice + center / texSize);        }    ","hexagonalPixelate"),s.call(this,e.hexagonalPixelate,{center:[t,n],scale:r,texSize:[this.width,this.height]}),this},D=function(t){return e.ink=e.ink||new q(null,"        uniform sampler2D texture;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 dx = vec2(1.0 / texSize.x, 0.0);            vec2 dy = vec2(0.0, 1.0 / texSize.y);            vec4 color = texture2D(texture, texCoord);            float bigTotal = 0.0;            float smallTotal = 0.0;            vec3 bigAverage = vec3(0.0);            vec3 smallAverage = vec3(0.0);            for (float x = -2.0; x <= 2.0; x += 1.0) {                for (float y = -2.0; y <= 2.0; y += 1.0) {                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;                    bigAverage += sample;                    bigTotal += 1.0;                    if (abs(x) + abs(y) < 2.0) {                        smallAverage += sample;                        smallTotal += 1.0;                    }                }            }            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);        }    ","ink"),s.call(this,e.ink,{strength:t*t*t*t*t,texSize:[this.width,this.height]}),this},B=function(n,r,i,a){return e.bulgePinch=e.bulgePinch||g("        uniform float radius;        uniform float strength;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = distance / radius;            if (strength > 0.0) {                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);            } else {                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);            }        }        coord += center;    "),s.call(this,e.bulgePinch,{radius:i,strength:t(-1,a,1),center:[n,r],texSize:[this.width,this.height]}),this},z=function(t,n,r){if(e.matrixWarp=e.matrixWarp||g("        uniform mat3 matrix;        uniform bool useTextureSpace;    ","        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    "),4==(t=Array.prototype.concat.apply([],t)).length)t=[t[0],t[1],0,t[2],t[3],0,0,0,1];else if(9!=t.length)throw"can only warp with 2x2 or 3x3 matrix";return s.call(this,e.matrixWarp,{matrix:n?p(t):t,texSize:[this.width,this.height],useTextureSpace:0|r}),this},j=function(e,t){var n=d.apply(null,t),r=d.apply(null,e),i=function(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}(p(n),r);return this.matrixWarp(i)},F=function(t,n,r,i){return e.swirl=e.swirl||g("        uniform float radius;        uniform float angle;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = (radius - distance) / radius;            float theta = percent * percent * angle;            float s = sin(theta);            float c = cos(theta);            coord = vec2(                coord.x * c - coord.y * s,                coord.x * s + coord.y * c            );        }        coord += center;    "),s.call(this,e.swirl,{radius:r,center:[t,n],angle:i,texSize:[this.width,this.height]}),this},N=function(){return e.invert=e.invert||new q(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);    }","invert"),s.call(this,e.invert,{texSize:[this.width,this.height]}),this},_=function(t,n){return e.toAlpha=e.toAlpha||new q(null,"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }","toAlpha"),s.call(this,e.toAlpha,{isInverted:t?1:0,replace:n?[n.r/255,n.g/255,n.b/255,n.a]:[0,0,0,0],texSize:[this.width,this.height]}),this},H={};!function(){var t,n,r=function(){};try{document.createElement("canvas").getContext("experimental-webgl")}catch(e){}e&&-1===e.getSupportedExtensions().indexOf("OES_texture_float_linear")&&(function(e){if(!e.getExtension("OES_texture_float"))return!1;var t=e.createFramebuffer(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.FLOAT,new Float32Array([2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));var i=e.createProgram(),a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"      attribute vec2 vertex;      void main() {        gl_Position = vec4(vertex, 0.0, 1.0);      }    "),e.shaderSource(o,"      uniform sampler2D texture;      void main() {        gl_FragColor = texture2D(texture, vec2(0.5));      }    "),e.compileShader(a),e.compileShader(o),e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i);var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0]),e.STREAM_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);var l=new Uint8Array(4);return e.useProgram(i),e.viewport(0,0,1,1),e.bindTexture(e.TEXTURE_2D,r),e.drawArrays(e.POINTS,0,1),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,l),127===l[0]||128===l[0]}(e)&&(t=WebGLRenderingContext.prototype.getExtension,n=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getExtension=function(e){return"OES_texture_float_linear"===e?(void 0===(n=this).$OES_texture_float_linear$&&Object.defineProperty(n,"$OES_texture_float_linear$",{enumerable:!1,configurable:!1,writable:!1,value:new r}),n.$OES_texture_float_linear$):t.call(this,e);var n},WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e=n.call(this);return-1===e.indexOf("OES_texture_float_linear")&&e.push("OES_texture_float_linear"),e}))}(),H.canvas=function(){var t=document.createElement("canvas");try{e=t.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(t){e=null}if(!e)throw"This browser does not support WebGL";return t._={gl:e,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},t.texture=h(r),t.draw=h(a),t.update=h(o),t.replace=h(l),t.contents=h(c),t.getPixelArray=h(u),t.brightnessContrast=h(v),t.hexagonalPixelate=h(O),t.hueSaturation=h(b),t.colorHalftone=h(A),t.triangleBlur=h(I),t.unsharpMask=h(S),t.perspective=h(j),t.matrixWarp=h(z),t.bulgePinch=h(B),t.tiltShift=h(M),t.dotScreen=h(L),t.edgeWork=h(P),t.lensBlur=h(T),t.zoomBlur=h(R),t.noise=h(w),t.denoise=h(x),t.curves=h(y),t.swirl=h(F),t.ink=h(D),t.vignette=h(E),t.vibrance=h(k),t.sepia=h(C),t.invert=h(N),t.toAlpha=h(_),t},H.splineInterpolate=m;var U,Y,X,V,W,G,K,q=(U=function(e){return"[object Number]"==Object.prototype.toString.call(e)},Y=function(t,n,r){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw"compile error: "+r+" - "+e.getShaderInfoLog(i);return i},X=function(t){var n=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,t);return null!==n&&0!==n.precision},V=function(t,n,r){if(this.vertexAttribute=null,this.texCoordAttribute=null,this.program=e.createProgram(),t=t||W,n=n||G,null===K&&(K=X(e.HIGH_FLOAT)?"highp":X(e.MEDIUM_FLOAT)?"mediump":"lowp"),n="precision "+K+" float;"+n,e.attachShader(this.program,Y(e.VERTEX_SHADER,t,r+"(vertex)")),e.attachShader(this.program,Y(e.FRAGMENT_SHADER,n,r+"(fragment)")),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(this.program)},W="    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",G="    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }",K=null,V.prototype.destroy=function(){e.deleteProgram(this.program),this.program=null},V.prototype.uniforms=function(t){for(var n in e.useProgram(this.program),t)if(t.hasOwnProperty(n)){var r=e.getUniformLocation(this.program,n);if(null!==r){var i=t[n];if(a=i,"[object Array]"==Object.prototype.toString.call(a))switch(i.length){case 1:e.uniform1fv(r,new Float32Array(i));break;case 2:e.uniform2fv(r,new Float32Array(i));break;case 3:e.uniform3fv(r,new Float32Array(i));break;case 4:e.uniform4fv(r,new Float32Array(i));break;case 9:e.uniformMatrix3fv(r,!1,new Float32Array(i));break;case 16:e.uniformMatrix4fv(r,!1,new Float32Array(i));break;default:throw"dont't know how to load uniform \""+n+'" of length '+i.length}else{if(!U(i))throw'attempted to set uniform "'+n+'" to invalid value '+(i||"undefined").toString();e.uniform1f(r,i)}}}var a;return this},V.prototype.textures=function(t){for(var n in e.useProgram(this.program),t)t.hasOwnProperty(n)&&e.uniform1i(e.getUniformLocation(this.program,n),t[n]);return this},V.prototype.drawRect=function(t,n,r,i){var a,o=e.getParameter(e.VIEWPORT);n=n!==a?(n-o[1])/o[3]:0,t=t!==a?(t-o[0])/o[2]:0,r=r!==a?(r-o[0])/o[2]:1,i=i!==a?(i-o[1])/o[3]:1,null==e.vertexBuffer&&(e.vertexBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,e.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,t,i,r,n,r,i]),e.STATIC_DRAW),null==e.texCoordBuffer&&(e.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,e.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),e.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=e.getAttribLocation(this.program,"_texCoord"),e.enableVertexAttribArray(this.texCoordAttribute)),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,e.vertexBuffer),e.vertexAttribPointer(this.vertexAttribute,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,e.texCoordBuffer),e.vertexAttribPointer(this.texCoordAttribute,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)},V.getDefaultShader=function(){return e.defaultShader=e.defaultShader||new V,e.defaultShader},V);f.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6};var J=function(){var t=function(t,n,r,i){this.gl=e,this.id=e.createTexture(),this.width=t,this.height=n,this.format=r,this.type=i,e.bindTexture(e.TEXTURE_2D,this.id),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&n&&e.texImage2D(e.TEXTURE_2D,0,this.format,t,n,0,this.format,this.type,null)},n=function(e){null==r&&(r=document.createElement("canvas")),r.width=e.width,r.height=e.height;var t=r.getContext("2d");return t.clearRect(0,0,r.width,r.height),t};t.fromElement=function(n){var r=new t(0,0,e.RGBA,e.UNSIGNED_BYTE);return r.loadContentsOf(n),r},t.prototype.loadContentsOf=function(t){this.width=t.width||t.videoWidth,this.height=t.height||t.videoHeight,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t)},t.prototype.initFromBytes=function(t,n,r){this.width=t,this.height=n,this.format=e.RGBA,this.type=e.UNSIGNED_BYTE,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,this.type,new Uint8Array(r))},t.prototype.destroy=function(){e.deleteTexture(this.id),this.id=null},t.prototype.use=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,this.id)},t.prototype.unuse=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},t.prototype.ensureFormat=function(t,n,r,i){if(1==arguments.length){var a=arguments[0];t=a.width,n=a.height,r=a.format,i=a.type}t==this.width&&n==this.height&&r==this.format&&i==this.type||(this.width=t,this.height=n,this.format=r,this.type=i,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,this.format,t,n,0,this.format,this.type,null))},t.prototype.drawTo=function(t){if(e.framebuffer=e.framebuffer||e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,e.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.id,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw new Error("incomplete framebuffer");e.viewport(0,0,this.width,this.height),t(),e.bindFramebuffer(e.FRAMEBUFFER,null)};var r=null;return t.prototype.fillUsingCanvas=function(t){return t(n(this)),this.format=e.RGBA,this.type=e.UNSIGNED_BYTE,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),this},t.prototype.toImage=function(t){this.use(),q.getDefaultShader().drawRect();var i=this.width*this.height*4,a=new Uint8Array(i),o=n(this),s=o.createImageData(this.width,this.height);e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,a);for(var l=0;l<i;l++)s.data[l]=a[l];o.putImageData(s,0,0),t.src=r.toDataURL()},t.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t},t}(),Z="    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }";return H}(),FI=null;try{FI=jI.canvas()}catch(e){}function NI(){if(!FI||FI._.gl.isContextLost())try{FI=jI.canvas()}catch(e){}return FI}var _I,HI={getDialog:function(e){var t=document.createElement("div"),n={element:t},r=e.context,i=e.canvas;if(!r||!i)return!1;var a=i.getLayers(),o=i.getLayerIndex(r.canvas),s=Gk.fitInto(r.canvas.width,r.canvas.height,280,200,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=Gk.canvas(l,c),h=u.getContext("2d");return h.save(),u.width>r.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(r.canvas,0,0,l,c),h.restore(),setTimeout((function(){var e=0,r=0;t.innerHTML=dE("filter-bright-contrast-description")+"<br/><br/>";var i=NI();if(i){var s=i.texture(u);i.draw(s).update();var h=new kE({label:dE("filter-bright-contrast-brightness"),width:300,height:30,min:0,max:100,initValue:50*(e+1),eventResMs:zI,onChange:function(t){e=t/50-1,i.draw(s).brightnessContrast(e,r).update(),v.render()}}),d=new kE({label:dE("filter-bright-contrast-contrast"),width:300,height:30,min:0,max:100,initValue:50*(r+1),eventResMs:zI,onChange:function(t){r=t/50-1,i.draw(s).brightnessContrast(e,r).update(),v.render()}});h.getElement().style.marginBottom="10px",t.appendChild(h.getElement()),t.appendChild(d.getElement());var p=document.createElement("div");Gk.css(p,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],g=0;g<a.length;g++)f.push({image:g===o?i:a[g].context.canvas,opacity:a[g].opacity,mixModeStr:a[g].mixModeStr});var v=new lT({width:parseInt(""+l),height:parseInt(""+c),layers:f}),m=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});m.appendChild(v.getElement()),p.appendChild(m),t.appendChild(p);try{i.draw(s).brightnessContrast(e,r).update(),v.render()}catch(e){t.errorCallback(e)}n.destroy=function(){h.destroy(),d.destroy(),s.destroy()},n.getInput=function(){return n.destroy(),{brightness:e,contrast:r}}}}),1),n},apply:function(e){var t=e.context,n=e.input.brightness,r=e.input.contrast,i=e.history;if(!t||null===n||null===r||!i)return!1;i.pause(!0);var a=NI();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).brightnessContrast(n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),i.pause(!1),i.push({tool:["filter","glBrightnessContrast"],action:"apply",params:[{input:e.input}]}),!0}},UI={getDialog:function(e){var t=function(){d=parseInt(k.value),p=parseInt(E.value),f=parseInt(T.value),g=parseInt(M.value);var e=r.getWidth()+d+p,t=r.getHeight()+f+g;e<=0&&(v&&(d=-r.getWidth()-p+1,k.value=""+d),m&&(p=-r.getWidth()-d+1,E.value=""+p),e=1),e>b&&(v&&(d=-r.getWidth()-p+b,k.value=""+d),m&&(p=-r.getWidth()-d+b,E.value=""+p),e=b),t<=0&&(y&&(f=-r.getHeight()-g+1,T.value=""+f),x&&(g=-r.getHeight()-f+1,M.value=""+g),t=1),t>w&&(y&&(f=-r.getHeight()-g+w,T.value=""+f),x&&(g=-r.getHeight()-f+w,M.value=""+g),t=w),F.setTransform({x:-d,y:-f,width:e,height:t}),v=!1,m=!1,y=!1,x=!1},n=function(e){var t=Gk.fitInto(e.width,e.height,260,180,1);h=t.width/e.width;var n=Gk.centerWithin(340,220,t.width,t.height);i.style.width=r.getWidth()*h+"px",i.style.height=r.getHeight()*h+"px",j.style.left=n.x-e.x*h+"px",j.style.top=n.y-e.y*h+"px",d=parseInt(""+-e.x),f=parseInt(""+-e.y),p=parseInt(""+(e.x+e.width-r.getWidth())),g=parseInt(""+(e.y+e.height-r.getHeight())),k.value=""+d,T.value=""+f,E.value=""+p,M.value=""+g,Gk.createCheckerDataUrl(parseInt(""+50*h),(function(e){B.style.background="url("+e+")",0!==L.a&&(i.style.background="url("+e+")")})),B.style.backgroundPosition=n.x+"px "+n.y+"px",F.setScale(h)},r=e.canvas;if(!r)return!1;var i=Gk.canvas(),a=Gk.fitInto(r.getWidth(),r.getHeight(),560,400,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=o/r.getWidth();i.width=o,i.height=s,i.style.display="block",i.getContext("2d").drawImage(r.getCompleteCanvas(l),0,0,o,s);var c=document.createElement("div"),u={element:c};c.innerHTML=dE("filter-crop-description")+"<br/><br/>";var h,d=0,p=0,f=0,g=0,v=!1,m=!1,y=!1,x=!1,b=e.maxWidth,w=e.maxHeight,C=Gk.el({css:{lineHeight:"30px",height:"35px"}}),S=Gk.el({css:{lineHeight:"30px",height:"35px"}});c.appendChild(C),c.appendChild(S);var k=vE({init:0,type:"number",min:-r.getWidth(),max:b,css:{width:"75px",marginRight:"20px"},callback:function(e){v=!0,t()}}),E=vE({init:0,type:"number",min:-r.getWidth(),max:b,css:{width:"75px"},callback:function(e){m=!0,t()}}),T=vE({init:0,type:"number",min:-r.getHeight(),max:w,css:{width:"75px",marginRight:"20px"},callback:function(e){y=!0,t()}}),M=vE({init:0,type:"number",min:-r.getHeight(),max:w,css:{width:"75px"},callback:function(e){x=!0,t()}}),I={display:"inline-block",width:"60px"};C.append(Gk.el({content:dE("filter-crop-left")+":",css:I}),k,Gk.el({content:dE("filter-crop-right")+":",css:I}),E),S.append(Gk.el({content:dE("filter-crop-top")+":",css:I}),T,Gk.el({content:dE("filter-crop-bottom")+":",css:I}),M);var R=!0,A=new gE({init:!0,label:dE("filter-crop-rule-thirds"),allowTab:!0,callback:function(e){R=e,F.showThirds(R)}});c.appendChild(Gk.el({css:{clear:"both"}}));var L={r:0,g:0,b:0,a:0},P=[{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];P.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),P.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var O=new RE({label:dE("filter-crop-fill"),colorArr:P,onChange:function(e){L=e,function(e){var t;0===e.a?(t="rgba(0,0,0,0.5)",z.style.background="",i.style.background=""):(t=e.r+e.g+e.b<382.5?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",z.style.background=Gk.ColorConverter.toRgbStr(e),Gk.createCheckerDataUrl(parseInt(""+50*h),(function(e){i.style.background="url("+e+")"}))),i.style.boxShadow="0 0 3px 1px "+t}(e)}}),D=Gk.el({css:{display:"flex",justifyContent:"space-between"}});c.appendChild(D),D.appendChild(A.getElement()),D.appendChild(O.getElement());var B=Gk.el({css:{width:"340px",marginTop:"10px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",position:"relative",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",colorScheme:"only light",touchAction:"none"}});B.oncontextmenu=function(){return!1};var z=Gk.el({css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"}});B.appendChild(z);var j=document.createElement("div");j.style.position="absolute",j.style.left="0px",j.style.top="0px",B.appendChild(j),Gk.appendTextDiv(j,"").appendChild(i),i.style.boxShadow="0 0 3px 1px rgba(0,0,0,0.5)",i.style.position="absolute",i.style.left="0px",i.style.top="0px",c.appendChild(B);var F=new vT({x:0,y:0,width:r.getWidth(),height:r.getHeight(),scale:h,callback:n,maxW:b,maxH:w});return n(F.getTransform()),j.appendChild(F.getElement()),u.destroy=function(){F.destroy(),A.destroy()},u.getInput=function(){return u.destroy(),{left:d,right:p,top:f,bottom:g,fillColor:0===L.a?null:L}},u},apply:function(e){var t=e.canvas,n=e.history;return!(!t||!n||isNaN(e.input.left)||isNaN(e.input.right)||isNaN(e.input.top)||isNaN(e.input.bottom))&&(n.pause(!0),t.resizeCanvas(e.input),n.pause(!1),n.push({tool:["filter","cropExtend"],action:"apply",params:[{input:JSON.parse(JSON.stringify(e.input))}]}),!0)}},YI={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=Gk.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Gk.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u,h=document.createElement("div"),d={element:h};return setTimeout((function(){t.canvas.width;h.innerHTML=dE("filter-curves-description")+"<br/><br/>";var e={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]},n=NI();if(n){var a,c=n.texture(l);n.draw(c).update();var p=new function(e){var t=document.createElement("div");t.oncontextmenu=function(){return!1},t.style.position="relative",t.style.marginBottom="10px";var n="All",r=e.curves;a=new AE({optionArr:[{id:"All",label:dE("filter-curves-all")},{id:"Red",label:dE("red")},{id:"Green",label:dE("green")},{id:"Blue",label:dE("blue")}],initialId:"All",onChange:function(e){"All"===(n=e)&&(r={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]});var t=r.r;"Green"===n&&(t=r.g),"Blue"===n&&(t=r.b),p.setPos(0,s-t[0][1]*s),f.setPos(t[1][0]*o,s-t[1][1]*s),g.setPos(t[2][0]*o,s-t[2][1]*s),v.setPos(o,s-t[3][1]*s),m()}}),t.appendChild(a.getElement());var i=document.createElement("div");Gk.css(i,{position:"relative",marginTop:"10px",colorScheme:"only light"}),t.appendChild(i);var o=300,s=100,l=document.createElement("canvas");l.width=o,l.height=s,Gk.css(l,{background:"#c6c6c6",boxShadow:"0 0 0 1px rgba(0,0,0,0.3)"});var c=l.getContext("2d");function u(e){return Math.max(0,Math.min(1,e))}function h(e,t,n,r){var a=t,l=e,c=document.createElement("div");return Gk.css(c,{position:"absolute",left:e-7+"px",top:t-7+"px",width:"14px",height:"14px",background:"#fff",cursor:"move",borderRadius:"14px",boxShadow:"inset 0 0 0 2px #000",userSelect:"none",touchAction:"none"}),c.pointerListener=new Gk.PointerListener({target:c,maxPointers:1,onPointer:function(i){i.eventPreventDefault(),"pointerdown"===i.type&&(l=e,a=t),"left"===i.button&&"pointermove"===i.type&&(r||(l+=i.dX),e=Math.max(0,Math.min(o,l)),a+=i.dY,t=Math.max(0,Math.min(s,a)),Gk.css(c,{left:e-7+"px",top:t-7+"px"}),n({x:e,y:t}))}}),i.appendChild(c),c.setPos=function(n,r){a=t=r,l=e=n,Gk.css(c,{left:e-7+"px",top:t-7+"px"})},c}function d(e,t,i){"All"===n&&(r.r[e]=[u(t/o),u(1-i/s)],r.g[e]=[u(t/o),u(1-i/s)],r.b[e]=[u(t/o),u(1-i/s)]),"Red"===n&&(r.r[e]=[u(t/o),u(1-i/s)]),"Green"===n&&(r.g[e]=[u(t/o),u(1-i/s)]),"Blue"===n&&(r.b[e]=[u(t/o),u(1-i/s)])}i.appendChild(l);var p=h(0,s,(function(e){d(0,e.x,e.y),m()}),!0),f=h(o/3,s/3*2,(function(e){d(1,e.x,e.y),m()})),g=h(o/3*2,s/3,(function(e){d(2,e.x,e.y),m()})),v=h(o,0,(function(e){d(3,e.x,e.y),m()}),!0);function m(){l.width=l.width,c=l.getContext("2d");for(var t={r:[],g:[],b:[]},i=0;i<r.r.length;i++)t.r.push(r.r[i]),t.g.push(r.g[i]),t.b.push(r.b[i]);function a(e){c.beginPath();for(var t=new Gk.SplineInterpolator(e),n=0;n<100;n++){var r=t.interpolate(n/100);r=Math.max(0,Math.min(1,r)),0===n?c.moveTo(n/100*o,s-r*s):c.lineTo(n/100*o,s-r*s)}c.stroke()}c.save(),"All"===n?(c.strokeStyle="black",a(t.r)):(c.globalAlpha=.5,c.strokeStyle="red",a(t.r),c.strokeStyle="green",a(t.g),c.strokeStyle="blue",a(t.b)),c.restore(),e.callback(t)}m(),this.getDiv=function(){return t},this.destroy=function(){p.pointerListener.destroy(),f.pointerListener.destroy(),g.pointerListener.destroy(),v.pointerListener.destroy()}}({curves:e,callback:function(t){e=t,function(){try{n.draw(c).curves(e.r,e.g,e.b).update(),u&&u.render()}catch(e){h.errorCallback(e)}}()}});h.appendChild(p.getDiv());var f=document.createElement("div");Gk.css(f,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var g=[],v=0;v<r.length;v++)g.push({image:v===i?n:r[v].context.canvas,opacity:r[v].opacity,mixModeStr:r[v].mixModeStr});u=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:g});var m=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});m.appendChild(u.getElement()),f.appendChild(m),h.appendChild(f),d.destroy=function(){p.destroy(),c.destroy(),a.destroy()},d.getInput=function(){return d.destroy(),{curves:e}}}}),1),d},apply:function(e){var t=e.context,n=e.input.curves,r=e.history;if(!t||null===n||!r)return!1;r.pause(!0);var i=NI();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).curves(n.r,n.g,n.b).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),r.pause(!1),r.push({tool:["filter","glCurves"],action:"apply",params:[{input:e.input}]}),!0}};_I=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("eFiVD");var XI,VI={getDialog:function(e){var n=function(){var e=w.image.getContext("2d");e.save(),e.clearRect(0,0,w.image.width,w.image.height),f&&(d&&(e.translate(w.image.width,0),e.scale(-1,1)),p&&(e.translate(0,w.image.height),e.scale(1,-1)));for(var t=0;t<a.length;t++)e.save(),f||o!==t||(d&&(e.translate(w.image.width,0),e.scale(-1,1)),p&&(e.translate(0,w.image.height),e.scale(1,-1))),e.canvas.width>a[t].context.canvas.width&&(e.imageSmoothingEnabled=!1),e.globalAlpha=a[t].opacity,e.globalCompositeOperation=a[t].mixModeStr,e.drawImage(a[t].context.canvas,0,0,w.image.width,w.image.height),e.restore();C.render(),e.restore()},r=e.context,i=e.canvas;if(!r||!i)return!1;var a=i.getLayers(),o=i.getLayerIndex(r.canvas),s=Gk.fitInto(r.canvas.width,r.canvas.height,280,200,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=document.createElement("div"),h={element:u},d=!0,p=!1,f=!0;u.innerHTML=dE("filter-flip-description")+"<br/><br/>";var g=new gE({init:d,label:dE("filter-flip-horizontal")+" ⟷",allowTab:!0,callback:function(e){d=e,n()},css:{marginBottom:"10px"}}),v=new gE({init:p,label:dE("filter-flip-vertical")+" ↕",allowTab:!0,callback:function(e){p=e,n()},css:{marginBottom:"10px"}});u.appendChild(g.getElement()),u.appendChild(v.getElement());var m=document.createElement("div");Gk.setEventListener(m,"onpointerdown",(function(){return!1})),m.textContent=dE("filter-flip-image"),m.style.width="150px",m.style.height="30px",m.style.paddingTop="10px",m.style.textAlign="center",m.style.cssFloat="left",m.style.paddingBottom="0px",m.style.borderTopLeftRadius="10px",m.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",m.style.background="url("+t(_I)+") no-repeat 12px 16px",m.style.backgroundSize="8%",m.style.backgroundColor="#9e9e9e";var y=document.createElement("div");Gk.setEventListener(y,"onpointerdown",(function(){return!1})),y.textContent=dE("filter-flip-layer"),y.style.width="150px",y.style.height="30px",y.style.paddingTop="10px",y.style.textAlign="center",y.style.cssFloat="left",y.style.paddingBottom="0px",y.style.borderTopRightRadius="10px",y.style.cursor="pointer",y.style.backgroundColor="rgba(0, 0, 0, 0.1)",y.style.backgroundSize="8%",Gk.setEventListener(m,"onpointerover",(function(){!1===f&&(m.style.backgroundColor="#ccc")})),Gk.setEventListener(m,"onpointerout",(function(){!1===f&&(m.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),Gk.setEventListener(y,"onpointerover",(function(){!0===f&&(y.style.backgroundColor="#ccc")})),Gk.setEventListener(y,"onpointerout",(function(){!0===f&&(y.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),m.onclick=function(){f=!0,y.style.background="",y.style.backgroundColor="rgba(0, 0, 0, 0.1)",y.style.boxShadow="",y.style.cursor="pointer",m.style.background="url("+t(_I)+") no-repeat 12px 16px",m.style.backgroundSize="8%",m.style.backgroundColor="#9e9e9e",m.style.cursor="default",m.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()},y.onclick=function(){f=!1,m.style.background="",m.style.backgroundColor="rgba(0, 0, 0, 0.1)",m.style.boxShadow="",m.style.cursor="pointer",y.style.background="url("+t(_I)+") no-repeat 12px 16px",y.style.backgroundSize="8%",y.style.backgroundColor="#9e9e9e",y.style.cursor="default",y.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()};var x=document.createElement("div");x.appendChild(m),x.appendChild(y),u.appendChild(x);var b=document.createElement("div");Gk.css(b,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var w={image:Gk.canvas(Math.round(l),Math.round(c)),opacity:1,mixModeStr:"source-over"},C=new lT({width:Math.round(l),height:Math.round(c),layers:[w]}),S=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});return S.appendChild(C.getElement()),b.appendChild(S),setTimeout(n,0),u.appendChild(b),h.destroy=function(){g.destroy(),v.destroy()},h.getInput=function(){return h.destroy(),{horizontal:d,vertical:p,flipCanvas:f}},h},apply:function(e){var t=e.context,n=e.canvas,r=e.history,i=e.input.horizontal,a=e.input.vertical,o=e.input.flipCanvas;return!!(t&&n&&r)&&(r.pause(!0),n.flip(i,a,o?null:n.getLayerIndex(t.canvas)),r.pause(!1),r.push({tool:["filter","flip"],action:"apply",params:[{input:e.input}]}),!0)}},WI={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=Gk.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Gk.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u=document.createElement("div"),h={element:u};return setTimeout((function(){var e=0,t=0;u.innerHTML=dE("filter-hue-sat-description")+"<br/><br/>";var n=NI();if(n){var a=n.texture(l);n.draw(a).update();var c=new kE({label:dE("filter-hue-sat-hue"),width:300,height:30,min:-100,max:100,initValue:100*e,eventResMs:zI,onChange:function(r){e=r/100,n.draw(a).hueSaturation(e,t).update(),v.render()}}),d=new kE({label:dE("filter-hue-sat-saturation"),width:300,height:30,min:0,max:100,initValue:50*(t+1),eventResMs:zI,onChange:function(r){t=r/50-1,n.draw(a).hueSaturation(e,t).update(),v.render()}});c.getElement().style.marginBottom="10px",u.appendChild(c.getElement()),u.appendChild(d.getElement());var p=document.createElement("div");Gk.css(p,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],g=0;g<r.length;g++)f.push({image:g===i?n:r[g].context.canvas,opacity:r[g].opacity,mixModeStr:r[g].mixModeStr});var v=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:f}),m=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});m.appendChild(v.getElement()),p.appendChild(m),u.appendChild(p);try{n.draw(a).hueSaturation(e,t).update(),v.render()}catch(e){u.errorCallback(e)}h.destroy=function(){c.destroy(),d.destroy(),a.destroy()},h.getInput=function(){return h.destroy(),{hue:e,Saturation:t}}}}),1),h},apply:function(e){var t=e.context,n=e.input.hue,r=e.history,i=e.input.Saturation;if(!t||null===n||null===i||!r)return!1;r.pause(!0);var a=NI();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).hueSaturation(n,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),r.pause(!1),r.push({tool:["filter","glHueSaturation"],action:"apply",params:[{input:e.input}]}),!0}},GI={apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=NI();if(!r)return!1;var i=r.texture(t.canvas);return r.draw(i).invert().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),i.destroy(),n.pause(!1),n.push({tool:["filter","invert"],action:"apply",params:[{input:e.input}]}),!0}},KI={getDialog:function(e){var n=e.context,r=e.canvas;if(!n||!r)return!1;var i=window.innerWidth<550,a=r.getLayers(),o=r.getLayerIndex(n.canvas),s=Gk.fitInto(n.canvas.width,n.canvas.height,i?280:490,i?200:240,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=Math.min(l,n.canvas.width),h=Math.min(c,n.canvas.height),d=Gk.canvas(u,h),p=d.getContext("2d");p.save(),u>n.canvas.width&&(p.imageSmoothingEnabled=!1),p.drawImage(n.canvas,0,0,u,h),p.restore();var f=l/n.canvas.width,g=document.createElement("div"),v={element:g};i||(v.width=500);var m=[];return setTimeout((function(){g.innerHTML=dE("filter-perspective-description")+"<br/><br/>";var e=NI();if(e){var n,r,s,p,y,x,b,w,C=e.texture(d);e.draw(C).update(),n=D(0,0,B),r=D(l,0,B),s=D(l,c,B),p=D(0,c,B),y=D(0,0),x=D(l,0),b=D(l,c),w=D(0,c);var S=!1,k=document.createElement("div");Gk.setEventListener(k,"onpointerdown",(function(){return!1})),k.textContent=dE("filter-perspective-before"),k.style.width="150px",k.style.height="30px",k.style.marginLeft=i?"0":"100px",k.style.paddingTop="10px",k.style.textAlign="center",k.style.cssFloat="left",k.style.paddingBottom="0px",k.style.borderTopLeftRadius="10px",k.style.cursor="pointer",k.style.backgroundColor="rgba(0, 0, 0, 0.1)",k.style.backgroundSize="8%";var E=document.createElement("div");Gk.setEventListener(E,"onpointerdown",(function(){return!1})),E.textContent=dE("filter-perspective-after"),E.style.width="150px",E.style.height="30px",E.style.paddingTop="10px",E.style.textAlign="center",E.style.cssFloat="left",E.style.paddingBottom="0px",E.style.borderTopRightRadius="10px",E.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",E.style.background="url("+t(_I)+") no-repeat 12px 16px",E.style.backgroundSize="8%",E.style.backgroundColor="#9e9e9e",Gk.setEventListener(k,"onpointerover",(function(){!1===S&&(k.style.backgroundColor="#ccc")})),Gk.setEventListener(k,"onpointerout",(function(){!1===S&&(k.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),Gk.setEventListener(E,"onpointerover",(function(){!0===S&&(E.style.backgroundColor="#ccc")})),Gk.setEventListener(E,"onpointerout",(function(){!0===S&&(E.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),k.onclick=function(){k.style.background="url("+t(_I)+") no-repeat 12px 16px",k.style.backgroundSize="8%",k.style.backgroundColor="#9e9e9e",k.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",k.style.cursor="default",E.style.background="",E.style.backgroundColor="rgba(0, 0, 0, 0.1)",E.style.boxShadow="",E.style.cursor="pointer",y.style.display="none",x.style.display="none",b.style.display="none",w.style.display="none",n.style.display="block",r.style.display="block",s.style.display="block",p.style.display="block",n.copy(y),r.copy(x),s.copy(b),p.copy(w),S=!0,O()},E.onclick=function(){S=!1,E.style.background="url("+t(_I)+") no-repeat 12px 16px",E.style.backgroundSize="8%",E.style.backgroundColor="#9e9e9e",E.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",E.style.cursor="default",k.style.background="",k.style.backgroundColor="rgba(0, 0, 0, 0.1)",k.style.boxShadow="",k.style.cursor="pointer",n.style.display="none",r.style.display="none",s.style.display="none",p.style.display="none",y.style.display="block",x.style.display="block",b.style.display="block",w.style.display="block",y.copy(n),x.copy(r),b.copy(s),w.copy(p)};var T=document.createElement("div");T.appendChild(k),T.appendChild(E),g.appendChild(T);var M=document.createElement("div");M.oncontextmenu=function(){return!1},Gk.css(M,{width:i?"340px":"540px",marginLeft:"-20px",height:i?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var I=[],R=0;R<a.length;R++){var A=R===o?e:a[R].context.canvas;I.push({image:A,opacity:a[R].opacity,mixModeStr:a[R].mixModeStr})}var L=new lT({width:parseInt(""+l),height:parseInt(""+c),layers:I}),P=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});P.appendChild(L.getElement()),M.appendChild(P),P.appendChild(y),P.appendChild(x),P.appendChild(b),P.appendChild(w),n.style.display="none",r.style.display="none",s.style.display="none",p.style.display="none",P.appendChild(n),P.appendChild(r),P.appendChild(s),P.appendChild(p),g.appendChild(M),O(),v.destroy=function(){for(var e=0;e<m.length;e++)m[e].destroy();C.destroy()},v.getInput=function(){return v.destroy(),{before:[n.x/f,n.y/f,r.x/f,r.y/f,s.x/f,s.y/f,p.x/f,p.y/f],after:[y.x/f,y.y/f,x.x/f,x.y/f,b.x/f,b.y/f,w.x/f,w.y/f]}}}function O(){try{e.draw(C).perspective([n.x,n.y,r.x,r.y,s.x,s.y,p.x,p.y].map((function(e,t){return t%2==0?e/l*u:e/c*h})),[y.x,y.y,x.x,x.y,b.x,b.y,w.x,w.y].map((function(e,t){return t%2==0?e/l*u:e/c*h}))).update(),L.render()}catch(e){g.errorCallback(e)}}function D(e,t,n){var r=document.createElement("div");r.x=e,r.y=t,Gk.css(r,{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:r.x-7+"px",top:r.y-7+"px",userSelect:"none",touchAction:"none"});var i=new Gk.PointerListener({target:r,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(r.x+=e.dX,r.y+=e.dY,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px",n&&n(),O())}});return r.copy=function(e){r.x=e.x,r.y=e.y,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px"},m.push(i),r}function B(){y.copy(n),x.copy(r),b.copy(s),w.copy(p)}}),1),v},apply:function(e){var t=e.context,n=e.history,r=e.input.before,i=e.input.after;if(!(t&&r&&i&&n))return!1;n.pause(!0);var a=NI();if(!a)return!1;var o=a.texture(t.canvas);t.canvas.width,t.canvas.height;return a.draw(o).perspective(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","glPerspective"],action:"apply",params:[{input:e.input}]}),!0}};XI=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("2BZYe");var qI={getDialog:function(e){var n=function(){if(0===m.value.length&&w||0===y.value.length&&b)return b=!1,void(w=!1);if(m.value=""+Math.max(1,parseInt(m.value)),y.value=""+Math.max(1,parseInt(y.value)),S&&(b&&(m.value=""+parseInt(""+parseInt(y.value)*C)),w&&(y.value=""+parseInt(""+parseInt(m.value)/C)),parseInt(m.value)>p||parseInt(y.value)>f)){var e=Gk.fitInto(parseInt(m.value),parseInt(y.value),p,f,1);m.value=""+parseInt(""+e.width),y.value=""+parseInt(""+e.height)}parseInt(m.value)>p&&(m.value=""+p),parseInt(y.value)>f&&(y.value=""+f),b=!1,w=!1,h=parseInt(m.value),d=parseInt(y.value);var t=Gk.fitInto(h,d,280,200,1),n=parseInt(""+t.width),i=parseInt(""+t.height);s=n/h;var a=Gk.centerWithin(340,220,n,i);"smooth"===E.getValue()?(M.style.imageRendering=s>1?"pixelated":"",M.width=r.getWidth(),M.height=r.getHeight(),I.save(),I.imageSmoothingQuality="high",I.drawImage(l,0,0),Gk.resizeCanvas(M,h,d),I.restore()):(M.style.imageRendering="pixelated",M.width=h,M.height=d,I.save(),I.imageSmoothingEnabled=!1,I.drawImage(l,0,0,M.width,M.height),I.restore()),M.style.width=Math.max(1,n)+"px",M.style.height=Math.max(1,i)+"px",A.style.left=a.x+"px",A.style.top=a.y+"px",A.style.width=Math.max(1,n)+"px",A.style.height=Math.max(1,i)+"px"},r=e.canvas;if(!r)return!1;var i=Gk.fitInto(r.getWidth(),r.getHeight(),280,200,1),a=parseInt(""+i.width),o=parseInt(""+i.height),s=a/r.getWidth(),l=r.getCompleteCanvas(1),c=document.createElement("div"),u={element:c},h=r.getWidth(),d=r.getHeight();c.innerHTML=dE("filter-resize-description")+"<br/><br/>";var p=e.maxWidth,f=e.maxHeight,g=Gk.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),v=Gk.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),m=Gk.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+p,value:""+r.getWidth()}}),y=Gk.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+f,value:""+r.getHeight()}});m.onclick=function(){this.focus(),w=!0,n()},y.onclick=function(){this.focus(),b=!0,n()},m.onchange=function(){w=!0,n()},y.onchange=function(){b=!0,n()},g.append(dE("width")+": ",m),v.append(dE("height")+": ",y);var x=Gk.el({css:{background:"url("+t(XI)+") no-repeat 140px 5px",backgroundSize:"50px 52px"}});x.append(g,v),c.appendChild(x);var b=!1,w=!1,C=r.getWidth()/r.getHeight(),S=!0,k=new gE({init:!0,label:dE("constrain-proportions"),allowTab:!0,callback:function(e){(S=e)?(m.value=""+r.getWidth(),y.value=""+r.getHeight(),x.style.background="url("+t(XI)+") no-repeat 140px 5px",x.style.backgroundSize="50px 52px",n()):x.style.background=""}});c.appendChild(Gk.el({css:{clear:"both"}}));var E=new yE({isFocusable:!0,optionArr:[["smooth",dE("algorithm-smooth")],["pixelated",dE("algorithm-pixelated")]],title:dE("scaling-algorithm"),initValue:"smooth",onChange:function(){n()}}),T=Gk.el({parent:c,css:{display:"flex",justifyContent:"space-between"}});T.appendChild(k.getElement()),T.appendChild(E.getElement());var M=Gk.canvas(a,o);M.style.imageRendering="pixelated";var I=M.getContext("2d"),R=document.createElement("div");Gk.css(R,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",position:"relative",userSelect:"none",colorScheme:"only light"});var A=Gk.appendTextDiv(R,"");return A.appendChild(M),A.style.width=a+"px",A.style.height=o+"px",A.style.position="absolute",A.style.overflow="hidden",A.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",A.style.overflow="hidden",Gk.createCheckerDataUrl(8,(function(e){R.style.background="url("+e+")"})),c.appendChild(R),n(),u.destroy=function(){k.destroy()},u.getInput=function(){return u.destroy(),{width:h,height:d,algorithm:E.getValue()}},u},apply:function(e){var t=e.canvas,n=e.history,r=e.input.width,i=e.input.height,a=e.input.algorithm;return!(!t||!n)&&(n.pause(!0),t.resize(r,i,a),n.pause(!1),n.push({tool:["filter","resize"],action:"apply",params:[{input:e.input}]}),!0)}},JI={getDialog:function(e){var t=function(){if(g.style.WebkitTransform="rotate("+u+"deg)",g.style.MozTransform="rotate("+u+"deg)",g.style.OTransform="rotate("+u+"deg)",g.style.msTransform="rotate("+u+"deg)",90===Math.abs(u%180)){var e=Gk.fitInto(a,i,280,200,1),t=parseInt(""+e.height)/i;g.style.WebkitTransform="rotate("+u+"deg) scale("+t+")",g.style.MozTransform="rotate("+u+"deg) scale("+t+")",g.style.OTransform="rotate("+u+"deg) scale("+t+")",g.style.msTransform="rotate("+u+"deg) scale("+t+")"}},n=e.canvas;if(!n)return!1;var r=Gk.fitInto(n.getWidth(),n.getHeight(),280,200,1),i=parseInt(""+r.width),a=parseInt(""+r.height),o=i/n.getWidth(),s=Gk.canvas(i,a);s.style.display="block",s.getContext("2d").drawImage(n.getCompleteCanvas(o),0,0,i,a);var l=document.createElement("div"),c={element:l},u=0;l.innerHTML=dE("filter-rotate-description")+"<br/><br/>";var h=document.createElement("button");h.innerHTML="<span style='font-size: 1.3em'>⟳</span> 90°";var d=document.createElement("button");d.innerHTML="<span style='font-size: 1.3em'>⟲</span> 90°",d.style.marginRight="5px",h.onclick=function(){u+=90,t()},d.onclick=function(){u-=90,t()},l.appendChild(d),l.appendChild(h);var p=document.createElement("div");Gk.css(p,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",colorScheme:"only light"});var f=document.createElement("div");f.style.display="table-cell",f.style.verticalAlign="middle";var g=Gk.appendTextDiv(f,"");return g.appendChild(s),p.appendChild(f),g.style.width=i+"px",g.style.height=a+"px",g.style.marginLeft="auto",g.style.marginRight="auto",g.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",g.style.overflow="hidden",Gk.createCheckerDataUrl(4,(function(e){g.style.background="url("+e+")"})),g.style.transition="all 0.2s ease-out",l.appendChild(p),t(),c.getInput=function(){return{deg:u}},c},apply:function(e){var t=e.canvas,n=e.history,r=e.input.deg;return!(!t||!n)&&(n.pause(!0),t.rotate(r),n.pause(!1),n.push({tool:["filter","rotate"],action:"apply",params:[{input:e.input}]}),!0)}},ZI={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=Gk.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,t.canvas.width),c=Math.min(s,t.canvas.height),u=Gk.canvas(l,c),h=u.getContext("2d");h.save(),l>t.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(t.canvas,0,0,l,c),h.restore();var d=l/t.canvas.width,p=o/t.canvas.width,f=document.createElement("div"),g={element:f},v=[];return setTimeout((function(){var e=20,t=200;f.innerHTML=dE("filter-tilt-shift-description")+"<br/><br/>";var n=NI();if(n){var a,l,c=n.texture(u);n.draw(c).update(),a=k(parseInt(""+o/6),parseInt(""+s/2)),l=k(parseInt(""+(o-o/6)),parseInt(""+(s-s/3)));var h=new kE({label:dE("filter-tilt-shift-blur"),width:300,height:30,min:0,max:200,initValue:e,eventResMs:zI,onChange:function(t){e=t,S()}});h.getElement().style.marginBottom="10px",f.appendChild(h.getElement());var m=new kE({label:dE("filter-tilt-shift-gradient"),width:300,height:30,min:0,max:1e3,initValue:t,eventResMs:zI,onChange:function(e){t=e,S()}});f.appendChild(m.getElement());var y=document.createElement("div");y.oncontextmenu=function(){return!1},Gk.css(y,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var x=[],b=0;b<r.length;b++)x.push({image:b===i?n:r[b].context.canvas,opacity:r[b].opacity,mixModeStr:r[b].mixModeStr});var w=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:x}),C=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});C.appendChild(w.getElement()),y.appendChild(C),C.appendChild(a),C.appendChild(l),f.appendChild(y),S(),g.destroy=function(){for(var e=0;e<v.length;e++)v[e].destroy();h.destroy(),m.destroy(),c.destroy()},g.getInput=function(){return g.destroy(),{a:{x:a.x/p,y:a.y/p},b:{x:l.x/p,y:l.y/p},blur:e,gradient:t}}}function S(){try{n.draw(c).tiltShift(a.x/p*d,a.y/p*d,l.x/p*d,l.y/p*d,e*d,t*d).update(),w.render()}catch(e){f.errorCallback(e)}}function k(e,t){var n=Gk.el({css:{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:e-7+"px",top:t-7+"px",userSelect:"none",touchAction:"none"}});n.x=e,n.y=t;var r=new Gk.PointerListener({target:n,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(n.x+=e.dX,n.y+=e.dY,n.style.left=n.x-7+"px",n.style.top=n.y-7+"px",S())}});return v.push(r),n}}),1),g},apply:function(e){var t=e.context,n=e.history,r=e.input.a,i=e.input.b,a=e.input.blur,o=e.input.gradient;if(!t||!n)return!1;n.pause(!0);var s=NI();if(!s)return!1;var l=s.texture(t.canvas);return s.draw(l).tiltShift(r.x,r.y,i.x,i.y,a,o).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),l.destroy(),n.pause(!1),n.push({tool:["filter","glTiltShift"],action:"apply",params:[{input:e.input}]}),!0}},QI={getDialog:function(e){var t,n=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(o){var t=o.getTransform();if(JSON.stringify(t)!==W||e){W=JSON.stringify(t),g<1&&(t.x*=g,t.y*=g,t.width*=g,t.height*=g);var n=H[c].image,r=n.getContext("2d");r.save(),r.clearRect(0,0,n.width,n.height),Gk.drawTransformedImageWithBounds(r,l[c].context.canvas,t,v,"pixelated"===N.getValue()||Gk.testShouldPixelate(t,t.width/w.width,t.height/w.height)),r.restore(),X.render()}}},r=function(){o.setPos({x:parseInt(R.value)+w.x,y:parseInt(I.value)+w.y}),o.setAngleDeg(parseInt(A.value)),n()},i=e.context,a=e.canvas;if(!i||!a)return!1;var o,s=window.innerWidth<550,l=a.getLayers(),c=a.getLayerIndex(i.canvas),u=Gk.fitInto(i.canvas.width,i.canvas.height,s?280:490,s?200:240,1),h=parseInt(""+u.width),d=parseInt(""+u.height),p=Math.min(h,i.canvas.width),f=Math.min(d,i.canvas.height),g=h/i.canvas.width,v={x:0,y:0,width:0,height:0},m={x1:null,y1:null,x2:null,y2:null},y=i.getImageData(0,0,i.canvas.width,i.canvas.height);if(y.data[3]>0&&y.data[y.data.length-1]>0)m.x1=0,m.y1=0,m.x2=i.canvas.width-1,m.y2=i.canvas.height-1;else for(t=3;t<y.data.length;t+=4)if(y.data[t]>0){var x=(t-3)/4%i.canvas.width,b=Math.floor((t-3)/4/i.canvas.width);(m.x1>x||null===m.x1)&&(m.x1=x),null===m.y1&&(m.y1=b),(m.x2<x||null===m.x2)&&(m.x2=x),(m.y2<b||null===m.y2)&&(m.y2=b)}if(null===m.x1||null===m.y1)return alert(dE("filter-transform-empty")),!1;v.x=m.x1,v.y=m.y1,v.width=m.x2-m.x1+1,v.height=m.y2-m.y1+1;var w={x:v.x+v.width/2,y:v.y+v.height/2,width:v.width,height:v.height,angleDeg:0},C=document.createElement("div"),S={element:C};s||(S.width=500),C.innerHTML=dE("filter-transform-description");var k=new Gk.KeyListener({onDown:function(e){Gk.isInputFocused(!0)||("left"===e&&(R.value=""+(parseFloat(R.value)-1),r()),"right"===e&&(R.value=""+(parseFloat(R.value)+1),r()),"up"===e&&(I.value=""+(parseFloat(I.value)-1),r()),"down"===e&&(I.value=""+(parseFloat(I.value)+1),r()))}}),E=document.createElement("div"),T=document.createElement("div"),M=document.createElement("div"),I=document.createElement("input"),R=document.createElement("input"),A=document.createElement("input");(E.style.width="100px",E.style.height="30px",T.style.width="100px",T.style.height="30px",T.style.display="inline-block",E.style.display="inline-block",M.style.display="inline-block",M.style.width="150px",M.style.height="30px",I.type="number",R.type="number",A.type="number",R.style.width="70px",I.style.width="70px",A.style.width="70px",I.value="0",R.value="0",A.value="0",I.onclick=function(){this.focus(),r()},R.onclick=function(){this.focus(),r()},A.onclick=function(){this.focus(),r()},I.onchange=function(){r()},R.onchange=function(){r()},A.onchange=function(){r()},I.onkeyup=function(){r()},R.onkeyup=function(){r()},A.onkeyup=function(){r()},E.append("X: ",R),T.append("Y: ",I),M.append(dE("filter-transform-rotation")+": ",A),s)||Gk.el({parent:C,css:{marginTop:"10px"}}).append(E,T,M);var L={marginLeft:"10px",marginTop:"10px"},P=Gk.el({parent:C,css:{display:"flex",flexWrap:"wrap",marginLeft:"-10px"}}),O=(Gk.el({parent:P,tagName:"button",content:dE("filter-transform-flip")+" X",onClick:function(){var e=o.getTransform();o.setSize(-e.width,e.height)},css:L}),Gk.el({parent:P,tagName:"button",content:dE("filter-transform-flip")+" Y",onClick:function(){var e=o.getTransform();o.setSize(e.width,-e.height)},css:L}),Gk.el({parent:P,tagName:"button",content:"-90°",onClick:function(){var e=o.getTransform();e.angleDeg-=90,e.angleDeg%=360,o.setAngleDeg(e.angleDeg),A.value=""+Math.round(e.angleDeg),n()},css:L}),Gk.el({parent:P,tagName:"button",content:"+90°",onClick:function(){var e=o.getTransform();e.angleDeg+=90,e.angleDeg%=360,o.setAngleDeg(e.angleDeg),A.value=""+Math.round(e.angleDeg),n()},css:L}),Gk.el({parent:P,tagName:"button",content:"2x",onClick:function(){var e=o.getTransform();D.getValue()?o.setSize(o.getRatio()*e.height*2,2*e.height):o.setSize(2*e.width,2*e.height)},css:L}),Gk.el({parent:P,tagName:"button",content:"1/2x",onClick:function(){var e=o.getTransform();o.setSize(Math.round(e.width/2),Math.round(e.height/2))},css:L}),Gk.el({parent:P,tagName:"button",content:dE("center"),onClick:function(){var e=o.getTransform();o.setPos({x:i.canvas.width/2,y:i.canvas.height/2}),o.setAngleDeg(e.angleDeg),n()},css:L}),!0),D=new gE({init:!0,label:dE("filter-transform-constrain"),title:dE("constrain-proportions"),allowTab:!0,callback:function(e){O=e,o.setConstrained(O)},css:{display:"inline-block"}}),B=!1,z=new gE({init:!0,label:dE("filter-transform-snap"),title:dE("filter-transform-snap-title"),allowTab:!0,callback:function(e){B=e,o.setSnapping(B)},css:{display:"inline-block",marginLeft:"10px"}}),j=Gk.el({});j.append(D.getElement(),z.getElement()),C.appendChild(Gk.el({css:{clear:"both",height:"10px"}}));var F=Gk.el({parent:C,css:{display:"flex",justifyContent:"space-between"}}),N=new yE({isFocusable:!0,optionArr:[["smooth",dE("algorithm-smooth")],["pixelated",dE("algorithm-pixelated")]],initValue:"smooth",title:dE("scaling-algorithm"),onChange:function(){n(!0)}});F.append(j,N.getElement());var _=document.createElement("div");_.oncontextmenu=function(){return!1},Gk.css(_,{width:s?"340px":"540px",marginLeft:"-20px",height:s?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var H=[],U=0;U<l.length;U++){var Y=void 0;if(U===c)(Y=Gk.canvas(parseInt(""+p),parseInt(""+f))).getContext("2d").drawImage(l[U].context.canvas,0,0,Y.width,Y.height);else Y=l[U].context.canvas;H.push({image:Y,opacity:l[U].opacity,mixModeStr:l[U].mixModeStr})}var X=new lT({width:parseInt(""+h),height:parseInt(""+d),layers:H}),V=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+h)+"px",height:parseInt(""+d)+"px"}});V.appendChild(X.getElement()),_.appendChild(V);var W=void 0;return o=new fT({x:w.x,y:w.y,width:w.width,height:w.height,angleDeg:w.angleDeg,isConstrained:!0,snapX:[0,i.canvas.width],snapY:[0,i.canvas.height],callback:function(e){R.value=""+Math.round(e.x-w.x),I.value=""+Math.round(e.y-w.y),A.value=""+Math.round(e.angleDeg),n()},scale:g}),Gk.css(o.getElement(),{position:"absolute",left:"0",top:"0"}),V.appendChild(o.getElement()),n(),C.appendChild(_),S.destroy=function(){k.destroy(),o.destroy(),D.destroy(),z.destroy()},S.getInput=function(){var e=o.getTransform(),t={transform:e,bounds:v,isPixelated:"pixelated"===N.getValue()||Gk.testShouldPixelate(e,e.width/w.width,e.height/w.height)};return S.destroy(),JSON.parse(JSON.stringify(t))},S},apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=e.input,i=Gk.copyCanvas(t.canvas);return t.clearRect(0,0,t.canvas.width,t.canvas.height),Gk.drawTransformedImageWithBounds(t,i,r.transform,r.bounds,r.isPixelated),n.pause(!1),n.push({tool:["filter","transform"],action:"apply",params:[{input:r}]}),!0}},$I={getDialog:function(e){var t=e.canvas,n=e.context;if(!t||!n)return!1;var r=t.getLayers(),i=t.getLayerIndex(n.canvas),a=Gk.fitInto(n.canvas.width,n.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,n.canvas.width),c=Math.min(s,n.canvas.height),u=Gk.canvas(l,c),h=u.getContext("2d");h.save(),l>n.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(n.canvas,0,0,l,c),h.restore();var d=l/n.canvas.width,p=document.createElement("div"),f={element:p};return setTimeout((function(){var e=10;p.innerHTML=dE("filter-triangle-blur-description")+"<br/><br/>";var t=NI();if(t){var n=t.texture(u);t.draw(n).update();var a=new kE({label:dE("radius"),width:300,height:30,min:1,max:200,initValue:e,eventResMs:zI,onChange:function(r){e=r,t.draw(n).triangleBlur(e*d).update(),g.render()}});p.appendChild(a.getElement());var l=document.createElement("div");Gk.css(l,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var c=[],h=0;h<r.length;h++)c.push({image:h===i?t:r[h].context.canvas,opacity:r[h].opacity,mixModeStr:r[h].mixModeStr});var g=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:c}),v=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});v.appendChild(g.getElement()),l.appendChild(v),p.appendChild(l);try{t.draw(n).triangleBlur(e*d).update(),g.render()}catch(e){p.errorCallback(e)}f.destroy=function(){n.destroy(),a.destroy()},f.getInput=function(){return f.destroy(),{radius:e}}}}),1),f},apply:function(e){var t=e.context,n=e.history,r=e.input.radius;if(!t||!r||!n)return!1;n.pause(!0);var i=NI();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).triangleBlur(r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","glBlur"],action:"apply",params:[{input:e.input}]}),!0}},eR={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=Gk.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,t.canvas.width),c=Math.min(s,t.canvas.height),u=Gk.canvas(l,c),h=u.getContext("2d");h.save(),l>t.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(t.canvas,0,0,l,c),h.restore();var d=l/t.canvas.width,p=document.createElement("div"),f={element:p};return setTimeout((function(){var e=2,t=.51;p.innerHTML=dE("filter-unsharp-mask-description")+"<br/><br/>";var n=NI();if(n){var a=n.texture(u);n.draw(a).update();var l=new kE({label:dE("radius"),width:300,height:30,min:0,max:200,initValue:2,eventResMs:zI,onChange:function(r){e=r,n.draw(a).unsharpMask(e*d,t).update(),m.render()},curve:[[0,0],[.1,2],[.5,50],[1,200]]}),c=new kE({label:dE("filter-unsharp-mask-strength"),width:300,height:30,min:0,max:50,initValue:5.1,eventResMs:zI,onChange:function(r){t=r/10,n.draw(a).unsharpMask(e*d,t).update(),m.render()},curve:[[0,0],[.1,2],[.5,10],[1,50]]});l.getElement().style.marginBottom="10px",p.appendChild(l.getElement()),p.appendChild(c.getElement());var h=document.createElement("div");Gk.css(h,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var g=[],v=0;v<r.length;v++)g.push({image:v===i?n:r[v].context.canvas,opacity:r[v].opacity,mixModeStr:r[v].mixModeStr});var m=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:g}),y=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});y.appendChild(m.getElement()),h.appendChild(y),p.appendChild(h);try{n.draw(a).unsharpMask(e*d,t).update(),m.render()}catch(e){p.errorCallback(e)}f.destroy=function(){l.destroy(),c.destroy(),a.destroy()},f.getInput=function(){return f.destroy(),{radius:e,strength:t}}}}),1),f},apply:function(e){var t=e.context,n=e.history,r=e.input.radius,i=e.input.strength;if(!t||null===r||null===i||!n)return!1;n.pause(!0);var a=NI();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).unsharpMask(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","glUnsharpMask"],action:"apply",params:[{input:e.input}]}),!0}},tR={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=Gk.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Gk.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u=document.createElement("div"),h={element:u};return setTimeout((function(){u.appendChild(Gk.el({content:dE("filter-to-alpha-description"),css:{marginBottom:"5px"}}));var t=NI();if(t){var n=t.texture(l);t.draw(n).update();var a="inverted-luminance",c=new AE({optionArr:[{id:"inverted-luminance",label:dE("filter-to-alpha-inverted-lum")},{id:"luminance",label:dE("filter-to-alpha-lum")}],initialId:a,onChange:function(e){a=e,b()}});u.appendChild(c.getElement());var d={r:0,g:0,b:0,a:1},p=[null,{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];p.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),p.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var f=new RE({label:dE("filter-to-alpha-replace"),colorArr:p,initialIndex:1,onChange:function(e){d=e,b()}});f.getElement().style.marginTop="10px",u.appendChild(f.getElement());var g=document.createElement("div");Gk.css(g,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var v=[],m=0;m<r.length;m++)v.push({image:m===i?t:r[m].context.canvas,opacity:r[m].opacity,mixModeStr:r[m].mixModeStr});var y=new lT({width:parseInt(""+o),height:parseInt(""+s),layers:v}),x=Gk.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});x.appendChild(y.getElement()),g.appendChild(x),u.appendChild(g),setTimeout((function(){try{b()}catch(e){u.errorCallback(e)}}),1),h.destroy=function(){n.destroy(),c.destroy()},h.getInput=function(){return h.destroy(),{sourceId:a,selectedRgbaObj:d}}}function b(){t.draw(n).toAlpha("inverted-luminance"===a,d).update(),y.render()}}),1),h},apply:function(e){var t=e.context,n=e.history,r=e.input.sourceId,i=e.input.selectedRgbaObj;if(!t||!r||!n)return!1;n.pause(!0);var a=NI();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).toAlpha("inverted-luminance"===r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","toAlpha"],action:"apply",params:[{input:e.input}]}),!0}};function nR(e,t){t.getDialog&&(e.getDialog=t.getDialog),e.apply=t.apply}a("4gaLD");o=a("1ELdT");function rR(e){return iR.apply(this,arguments)}function iR(){return iR=o.default(t(s).mark((function e(n){var r,i,o,l,c,u;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=n.getLayersFast(),i={width:n.getWidth(),height:n.getHeight(),children:[]},o=0;o<r.length;o++)l=r[o],i.children.push({name:l.name,opacity:l.opacity,canvas:l.canvas,blendMode:DI.PSD.blendKlToPsd(l.mixModeStr),left:0,top:0});return e.next=5,a("j1Ae5");case 5:return c=e.sent,u=c.writePsdBuffer(i),e.abrupt("return",new Blob([u],{type:"application/octet-stream"}));case 8:case"end":return e.stop()}}),e)}))),iR.apply(this,arguments)}var aR;aR=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("k9Nks");var oR,sR;function lR(e,n){var r=function(e){return 1==e?.5:2==e?.84:3==e?.965:4==e?.9825:5==e?.99125:e},i=function(e){D.emitSize(e),N&&N.setCursorSize(2*e)},a=function(e,t,n){function r(e,t){var n=parseInt(e),r=parseInt(t);return n>v&&(r*=v/n,n=v),r>v&&(n*=v/r,r=v),{width:n=parseInt(""+n),height:r=parseInt(""+r)}}function i(e){var n=r(e.width,e.height),i=Gk.canvas(e.width,e.height);i.getContext("2d").drawImage(e,0,0),Gk.resizeCanvas(i,n.width,n.height),T.reset({width:n.width,height:n.height,image:i,layerName:t}),xe.update(0),h(T.getLayer(0)),N.resetView(),fe.update(N.getScale(),N.getAngleDeg()),!1}function a(e,t){function n(e,t,n){t.width=t.width,t.getContext("2d").drawImage(e,-n.x,-n.y),e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(t,0,0)}if(t&&(t.width!==e.width||t.height!==e.height)){var i=Gk.canvas(t.width,t.height);if(e.width=t.width,e.height=t.height,e.layers||n(e.canvas,i,t),e.layers)for(var a=0;a<e.layers.length;a++){n(e.layers[a].image,i,t)}}var o=r(e.width,e.height);if(e.width=o.width,e.height=o.height,e.layers||Gk.resizeCanvas(e.canvas,e.width,e.height),e.layers)for(var s=0;s<e.layers.length;s++){var l=e.layers[s];Gk.resizeCanvas(l.image,e.width,e.height)}var c=void 0;c=e.layers?T.reset({width:e.width,height:e.height,layers:e.layers}):T.reset({width:e.width,height:e.height,image:e.canvas}),xe.update(c),h(T.getLayer(c)),N.resetView(),fe.update(N.getScale(),N.getAngleDeg()),!1}function o(e){DI.showImportAsLayerDialog({target:w,klCanvas:T,importImage:e,callback:function(n,r){if(n){Zk.pause(!0),T.addLayer();var i=T.getLayers().length-1;t&&T.renameLayer(i,t);var a=T.getLayerContext(i);Gk.drawTransformedImageWithBounds(a,e,n,null,r),h(T.getLayer(i)),xe.update(i),Zk.pause(!1),Zk.push({tool:["misc"],action:"importImage",params:[Gk.copyCanvas(a.canvas),t]})}}})}!e||isNaN(e.width)||isNaN(e.height)||e.width<=0||e.height<=0?DI.popup({target:w,type:"error",message:dE("import-broken-file"),buttons:["Ok"]}):("default"!==n&&n||DI.showImportImageDialog({image:e,target:w,maxSize:v,callback:function(e){"as-image"===e.type?i(e.image):"as-image-psd"===e.type?a(e.image,e.cropObj):"as-layer"===e.type?o(e.image):e.type}}),"layer"===n&&o(e.canvas),"image"===n&&("psd"===e.type?a(e):i(e.canvas)))},l=function(e,t){function n(){DI.popup({target:w,type:"warning",message:dE("import-psd-unsupported")+"<br /><br />",buttons:["Ok"]})}for(var r,i=!1,o=0;r=e[o];o++){var s=r.name.split(".");"psd"===(s=s[s.length-1].toLowerCase())?function(r){var i=4096;if(r.size>=1073741824)DI.popup({target:w,type:"error",message:"File too big. Unable to import.<br /><br />",buttons:["Ok"]});else{var o,s=1===e.length&&r.size>=26214400,l=!0;s&&DI.popup({target:w,message:dE("import-opening"),callback:function(e){l=!1,o=null},closefunc:function(e){o=e}});var c=new FileReader;c.onload=function(e){DI.loadAgPsd().then((function(c){if(!s||l)try{var u;if((u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0,skipCompositeImageData:!0})).width>i||u.height>i)return o&&o(),void DI.popup({target:w,type:"error",message:dE("import-psd-too-large").replace(/{x}/g,"4096")+"<br /><br />"+dE("import-psd-size")+": "+u.width+" x "+u.height+" pixels<br /><br />",buttons:["Ok"]});u=null;try{u=c.readPsd(e.target.result)}catch(e){}if(u){var h=DI.PSD.readPsd(u);"image"===t&&h.error&&n(),o&&o(),a(h,r.name,t)}else u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0}),"image"===t&&n(),o&&o(),a({type:"psd",width:u.width,height:u.height,canvas:u.canvas,error:!0},r.name,t)}catch(e){o&&o(),DI.popup({target:w,type:"error",message:"Failed to load PSD.<br /><br />",buttons:["Ok"]})}})).catch((function(){o(),alert("Error: failed to load PSD library")}))},c.readAsArrayBuffer(r)}}(r):r.type.match("image.*")?function(e){window.URL=window.URL||window.webkitURL;var n=window.URL.createObjectURL(e),r=new Image;r.src=n,Gk.loadImage(r,(function(){a({type:"image",width:r.width,height:r.height,canvas:r},e.name,t)}))}(r):i=!0}i&&DI.popup({target:w,message:dE("import-unsupported-file"),type:"error",buttons:["OK"]})},c=function(){C<m?(ie.getElement().style.display="block",ie.setDirection(y),ie.isOpen()?("left"===y?(Gk.css(ie.getElement(),{left:"271px",right:""}),Gk.css(N.getElement(),{left:"271px"})):(Gk.css(ie.getElement(),{left:"",right:"271px"}),Gk.css(N.getElement(),{left:"0"})),ne.style.display="block",N.setSize(Math.max(0,C-k),S),te.setWide(!1)):("left"===y?(Gk.css(ie.getElement(),{left:"0",right:""}),Gk.css(N.getElement(),{left:"0"})):(Gk.css(ie.getElement(),{left:"",right:"0"}),Gk.css(N.getElement(),{left:"0"})),ne.style.display="none",N.setSize(Math.max(0,C),S),te.setWide(!0))):(ie.getElement().style.display="none","left"===y?Gk.css(N.getElement(),{left:"271px"}):Gk.css(N.getElement(),{left:"0"}),ne.style.display="block",N.setSize(Math.max(0,C-k),S),te.setWide(!1))},u=function(){"left"===y?(Gk.css(ne,{left:"0",right:"",borderLeft:"none",borderRight:"1px solid rgb(135, 135, 135)"}),Gk.css(N.getElement(),{left:"271px"})):(Gk.css(ne,{left:"",right:"0",borderLeft:"1px solid rgb(135, 135, 135)",borderRight:"none"}),Gk.css(N.getElement(),{left:"0"})),te.setUiState(y),be.setUiState(""+y),xe.setUiState(""+y),c(),Ie.updateUiState(y)},h=function(e){O=e.context,L.setContext(e.context),be.setLayer(e)},d=function(){DI.newImageDialog({currentColor:A,secondaryColor:le.getSecondaryRGB(),maxCanvasSize:v,canvasWidth:T.getWidth(),canvasHeight:T.getHeight(),workspaceWidth:window.innerWidth<m?C:C-k,workspaceHeight:S,onConfirm:function(e,t,n){T.reset({width:e,height:t,color:1===n.a?n:null}),xe.update(0),h(T.getLayer(0)),N.resetView(),fe.update(N.getScale(),N.getAngleDeg()),!1},onCancel:function(){}})},p=function(e){Gk.shareCanvas({canvas:T.getCompleteCanvas(1),fileName:Gk.getDate()+x+".png",title:Gk.getDate()+x+".png",callback:e||function(){}})},f=function(){if(M)for(var e=se.getActive(),t=M.getOpenedTabId(),n=Object.keys({draw:{},hand:{},fill:{},text:{},shape:{}}),r=0;r<n.length;r++)e===n[r]?M.setIsVisible(n[r],!0):(M.setIsVisible(n[r],!1),t===n[r]&&M.open(e))},g=function(){if(n.bottomBar){var e=617<window.innerHeight&&re.scrollHeight+50<window.innerHeight;Te.style.display=e?"":"none"}},v=Math.min(4096,Math.max(2048,Math.max(window.screen.width,window.screen.height))),m=820,y=n.embed?"left":Wk.getItem("uiState")?Wk.getItem("uiState"):"left",x=n.app&&n.app.filenameBase?n.app.filenameBase:"Klecks",b=n.projectStore,w=document.createElement("div");w.className="g-root kl-initialized";var C=Math.max(0,window.innerWidth),S=Math.max(0,window.innerHeight),k=271,E="png",T=new DI.KlCanvas(e?{projectObj:e}:{width:Math.min(v,window.innerWidth<m?C:C-k),height:Math.min(v,S)},n.embed?-1:0);T.setHistory(Zk);var M,I=null;n.saveReminder||(n.saveReminder={init:function(){},reset:function(){}});for(var R in e?e=null:(Zk.pause(!0),T.addLayer(),T.layerFill(0,{r:255,g:255,b:255}),Zk.pause(!1)),I={canvas:new DI.KlCanvas({copy:T},n.embed?-1:0),focus:T.getLayerCount()-1,brushes:{}},DI.brushes)DI.brushes.hasOwnProperty(R)&&(I.brushes[R]=new DI.brushes[R],I.canvas&&I.brushes[R].setContext(I.canvas.getLayerContext(I.focus)));var A=new Gk.RGB(0,0,0),L=void 0,P=void 0,O=T.getLayerContext(T.getLayerCount()-1),D=new DI.BrushSettingService((function(e){le.setColor(e),L.setColor(e),A=Gk.copyObj(e)}),(function(e){L.setSize(e),N.setCursorSize(2*e)}),(function(e){L.setOpacity(e)}),(function(){return le.getColor()}),(function(){return Q[P].getSize()}),(function(){return Q[P].getOpacity()}),(function(){return{sizeSlider:DI.brushesUI[P].sizeSlider,opacitySlider:DI.brushesUI[P].opacitySlider}})),B=new Gk.EventChain.LineSmoothing({smoothing:r(1)}),z=new Gk.EventChain.LineSanitizer,j=new Gk.EventChain.EventChain({chainArr:[z,B]});j.setChainOut((function(e){"down"===e.type&&(ne.style.pointerEvents="none",L.startLine(e.x,e.y,e.pressure),N.requestFrame()),"move"===e.type&&(L.goLine(e.x,e.y,e.pressure,!1,e.isCoalesced),N.setLastDrawEvent(e.x,e.y,e.pressure),N.requestFrame()),"up"===e.type&&(ne.style.pointerEvents="",L.endLine(),N.requestFrame()),"line"===e.type&&(L.getBrush().drawLineSegment(e.x0,e.y0,e.x1,e.y1),N.requestFrame())}));var F={size:20,align:"left",isBold:!1,isItalic:!1,font:"sans-serif",opacity:1},N=new DI.KlCanvasWorkspace({klCanvas:T,width:Math.max(0,C-k),height:S,onDraw:j.chainIn,onPick:function(e,t){D.setColor(e),t&&(le.pickingDone(),N.setMode(se.getActive()))},onFill:function(e,t){var n=T.getLayerIndex(O.canvas);T.floodFill(n,e,t,le.getColor(),ge.getOpacity(),ge.getTolerance(),ge.getSample(),ge.getGrow(),ge.getContiguous()),N.requestFrame()},onText:function(e,t,n){DI.dialogCounter.get()>0||DI.textToolDialog({klCanvas:T,layerIndex:T.getLayerIndex(O.canvas),x:e,y:t,angleRad:n,color:le.getColor(),secondaryColor:le.getSecondaryRGB(),size:F.size,align:F.align,isBold:F.isBold,isItalic:F.isItalic,font:F.font,opacity:F.opacity,onConfirm:function(e){var t=e.color;t.a=e.opacity,F.size=e.size,F.align=e.align,F.isBold=e.isBold,F.isItalic=e.isItalic,F.font=e.font,F.opacity=e.opacity;var r=T.getLayerIndex(O.canvas);T.text(r,{textStr:e.textStr,x:e.x,y:e.y,size:e.size,font:e.font,align:e.align,isBold:e.isBold,isItalic:e.isItalic,angleRad:n,color:Gk.ColorConverter.toRgbaStr(t)}),N.requestFrame()}})},onShape:function(e,t,n,r){"down"===e&&ye.onDown(t,n,r),"move"===e&&ye.onMove(t,n),"up"===e&&ye.onUp(t,n)},onViewChange:function(e){e.changed.includes("scale")&&te.out({type:"transform",scale:e.scale,angleDeg:180*e.angle/Math.PI}),se.setEnableZoomIn(e.scale!==N.getMaxScale()),se.setEnableZoomOut(e.scale!==N.getMinScale()),fe.update(e.scale,180*e.angle/Math.PI)},onUndo:function(){Zk.canUndo()&&Ce.undo()&&te.out(dE("undo"),!0)},onRedo:function(){Zk.canRedo()&&Ce.redo()&&te.out(dE("redo"),!0)}}),_=document.getElementById("vaiz1");null==_||_.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("penBrush")}));var H=document.getElementById("vaiz2");null==H||H.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("eraserBrush")}));var U=document.getElementById("vaiz3");null==U||U.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("pixelBrush")}));var Y=document.getElementById("vaiz4");null==Y||Y.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("chemyBrush")}));var X=document.getElementById("vaiz5");null==X||X.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("smudgeBrush")}));var V=document.getElementById("vaiz6");null==V||V.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("sketchyBrush")}));var W=document.getElementById("vaiz7");null==W||W.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("draw"),se.setActive("draw"),M.open("draw"),f(),de.open("blendBrush")}));var G=document.getElementById("vaiz8");null==G||G.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("text"),se.setActive("text"),M.open("text"),f()}));var K=document.getElementById("vaiz9");null==K||K.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("shape"),se.setActive("shape"),M.open("shape"),f()}));var q=document.getElementById("vaiz10");null==q||q.addEventListener("touchstart",(function(e){e.preventDefault(),N.setMode("fill"),se.setActive("fill"),M.open("fill"),f()}));var J=document.getElementById("vaiz11");null==J||J.addEventListener("touchstart",(function(e){e.preventDefault(),o.default(t(s).mark((function e(){var r;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!0,e.prev=1,e.next=4,b.store(T.getProject());case 4:e.next=11;break;case 6:e.prev=6,e.t0=e.catch(1),r=!1,setTimeout((function(){throw new Error("keyboard-shortcut: failed to store browser storage, "+e.t0)}),0),te.out("❌ "+dE("file-storage-failed"),!0);case 11:r&&(n.saveReminder.reset(),te.out(dE("file-storage-stored"),!0));case 12:case"end":return e.stop()}}),e,null,[[1,6]])})))()}));var Z=document.getElementById("vaiz12");null==Z||Z.addEventListener("touchstart",(function(e){e.preventDefault(),Ce.undo()})),n.embed||(new DI.KlImageDropper({target:document.body,onDrop:function(e,t){DI.dialogCounter.get()>0||l(e,t)},enabledTest:function(){return 0===DI.dialogCounter.get()}}),Gk.addEventListener(window,"paste",(function(e){DI.dialogCounter.get()>0||(e.stopPropagation(),e.preventDefault(),e.clipboardData.files[0]?function(e,t){0==e.clipboardData&&"function"==typeof t&&t(void 0);var n=e.clipboardData.items;if(null==n)"function"==typeof t&&t(void 0);else for(var r=0;r<n.length;r++)if(-1!=n[r].type.indexOf("image")){var i=n[r].getAsFile();"function"==typeof t&&t(i)}}(e,(function(e){if(e){var t=new Image;t.onload=function(){a({type:"image",width:t.width,height:t.height,canvas:t},null,"default")};var n=window.URL||window.webkitURL;t.src=n.createObjectURL(e)}})):e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString((function(e){if((e=e.trim()).match(/^https?/)){var t=new Image;t.onload=function(){a({type:"image",width:t.width,height:t.height,canvas:t},null,"default")},t.onerror=function(e){console.log("error loading",e)},t.crossOrigin="Anonymous",t.src=e}else if(e.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var n=Gk.ColorConverter.hexToRGB(e.replace("#",""));D.setColor(n)}})))}),!1));var Q={};for(var $ in DI.brushesUI)if(DI.brushesUI.hasOwnProperty($)){var ee=new DI.brushesUI[$].Ui({onSizeChange:i,onOpacityChange:function(e){D.emitOpacity(e)},onConfigChange:function(){D.emitSliderConfig({sizeSlider:DI.brushesUI[P].sizeSlider,opacitySlider:DI.brushesUI[P].opacitySlider})}});Q[$]=ee,ee.getElement().style.padding="10px"}Gk.css(w,{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"});var te=new DI.StatusOverlay,ne=Gk.el({}),re=Gk.el({parent:ne});ne.oncontextmenu=function(){return!1},ne.onclick=Gk.handleClick;var ie=new DI.ToolspaceCollapser({onChange:function(){c()}});c();var ae=void 0;setTimeout((function(){ae=new DI.OverlayToolspace({enabledTest:function(){return 0===DI.dialogCounter.get()&&!z.getIsDrawing()},brushSettingService:D}),w.appendChild(ae.getElement())}),0),Gk.append(w,[N.getElement(),ne,ie.getElement()]),Gk.css(ne,{position:"absolute",right:"0",top:"0",bottom:"0",width:k-1+"px",overflow:"hidden",backgroundColor:"#ddd",borderLeft:"1px solid rgb(135, 135, 135)",userSelect:"none",touchAction:"none"});var oe=void 0;oe=n.embed?new BI({onHelp:function(){cI(n.embed.url+"/help.html",!!n.embed)},onSubmit:function(){DI.popup({target:w,message:dE("submit-prompt"),buttons:[dE("submit"),"Cancel"],callback:o.default(t(s).mark((function e(r){var i;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r===dE("submit")){e.next=2;break}return e.abrupt("return");case 2:i=Gk.el({parent:w,className:"upload-overlay",content:'<div class="spinner"></div> '+dE("submit-submitting")}),n.embed.onSubmit((function(){n.saveReminder.reset(),w.removeChild(i)}),(function(){w.removeChild(i)}));case 4:case"end":return e.stop()}}),e)})))})},onLeftRight:function(){y="left"===y?"right":"left",u()}}):new DI.ToolspaceTopRow({logoImg:n.logoImg,onLogo:function(){cI("./home/",!!n.embed)},onNew:function(){d()},onImport:function(){ke.triggerImport()},onSave:function(){Se.save()},onShare:function(){p()},onHelp:function(){cI("./help/",!!n.embed)}}),Gk.addClassName(oe.getElement(),"toolspace-row-shadow"),oe.getElement().style.marginBottom="10px";var se=new DI.ToolspaceToolRow({onActivate:function(e){if("draw"===e)N.setMode("draw");else if("hand"===e)N.setMode("hand");else if("fill"===e)N.setMode("fill");else if("text"===e)N.setMode("text");else{if("shape"!==e)throw new Error("unknown activeStr");N.setMode("shape")}M.open(e),f(),le.pickingDone()},onZoomIn:function(){N.zoomByStep(keyListener.isPressed("shift")?1/8:.5)},onZoomOut:function(){N.zoomByStep(keyListener.isPressed("shift")?-1/8:-.5)},onUndo:function(){Ce.undo()},onRedo:function(){Ce.redo()}});se.setIsSmall(S<540),Zk.addListener((function(){se.setEnableUndo(Zk.canUndo()),se.setEnableRedo(Zk.canRedo())})),Gk.addClassName(se.getElement(),"toolspace-row-shadow");var le=void 0;(le=new DI.KlColorSlider({width:250,height:30,svHeight:100,startValue:new Gk.RGB(0,0,0),onPick:function(e){A=e,L.setColor(e),D.emitColor(e),le.pickingDone()}})).setHeight(Math.max(163,Math.min(400,S-505))),le.setPickCallback((function(e){e?N.setMode("pick"):(N.setMode(se.getActive()),f())}));var ce=document.createElement("div"),ue=document.createElement("div");Gk.css(ue,{margin:"10px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"flex-end"});var he=new DI.ToolspaceStabilizerRow({smoothing:1,onSelect:function(e){B.setSmoothing(r(e))}});ce.appendChild(ue),Gk.append(ue,[le.getElement(),le.getOutputElement(),he.getElement()]);var de=new DI.TabRow({initialId:"penBrush",useAccent:!0,tabArr:function(){for(var e=function(e){return{id:e,image:DI.brushesUI[e].image,title:DI.brushesUI[e].tooltip,onOpen:function(){var t;Q[e].getElement().style.display="block","eraserBrush"!==(t=e)&&t,le&&("eraserBrush"===t?le.enable(!1):le.enable(!0)),P=t,(L=Q[t]).setColor(A),L.setContext(O),N.setMode("draw"),se.setActive("draw"),f(),le.pickingDone(),D.emitSliderConfig({sizeSlider:DI.brushesUI[e].sizeSlider,opacitySlider:DI.brushesUI[e].opacitySlider}),i(Q[e].getSize()),D.emitOpacity(Q[e].getOpacity())},onClose:function(){Q[e].getElement().style.display="none"}}},t=[],n=Object.keys(Q),r=0;r<n.length;r++)t.push(e(n[r]));return t}()});for(var pe in DI.brushesUI)DI.brushesUI.hasOwnProperty(pe)&&ce.appendChild(Q[pe].getElement());var fe=new DI.HandUi({scale:1,angleDeg:0,onReset:function(){N.resetView(!0),fe.update(N.getScale(),N.getAngleDeg())},onFit:function(){N.fitView(),fe.update(N.getScale(),N.getAngleDeg())},onAngleChange:function(e,t){N.setAngle(e,t),fe.update(N.getScale(),N.getAngleDeg())}}),ge=new DI.FillUi({colorSlider:le}),ve=new DI.TextUi({colorSlider:le}),me=new DI.ShapeUi({colorSlider:le}),ye=new DI.ShapeTool({onShape:function(e,t,n,r,i,a){var o=T.getLayerIndex(O.canvas),s={type:me.getShape(),x1:t,y1:n,x2:r,y2:i,angleRad:a,isOutwards:me.getIsOutwards(),opacity:me.getOpacity(),isEraser:me.getIsEraser()};"line"===me.getShape()||"stroke"===me.getMode()?(s.strokeRgb=le.getColor(),s.lineWidth=me.getLineWidth()):s.fillRgb=le.getColor(),e?(T.setComposite(o,null),T.drawShape(o,s)):T.setComposite(o,{draw:function(e){DI.drawShape(e,s)}}),N.requestFrame()}}),xe=DI.klLayerManager(T,(function(e){h(T.getLayer(e)),Zk.push({tool:["misc"],action:"focusLayer",params:[e]})}),w),be=new DI.LayerPreview({klRootEl:w,onClick:function(){M.open("layers")}});be.setIsVisible(S>=579),be.setLayer(T.getLayer(T.getLayerIndex(O.canvas)));var we=new DI.FilterTab(w,le,xe,h,N,fe,(function(){return A}),(function(){return v}),(function(){return T}),(function(){return O}),!!n.embed,te),Ce=new DI.UndoRedoCatchup(Q,be,xe,fe,N,(function(){if(!I)throw new Error("initState not initialized");return I}),(function(){return T}),(function(){return O}),(function(e){O=e}),(function(){return L}));Zk.addListener((function(e){Ce.catchup(e)}));var Se=new DI.SaveToComputer(n.saveReminder,w,(function(){return E}),(function(){return T}),x),ke=n.embed?null:new DI.FileTab(w,b,(function(){return T.getProject()}),E,(function(e){E=e}),l,(function(){Se.save()}),d,p,(function(){DI.imgurUpload(T,w,n.saveReminder,n.app&&n.app.imgurKey?n.app.imgurKey:null)}),(function(e){DI.clipboardDialog(w,T.getCompleteCanvas(1),(function(e){if(0!==e.left||0!==e.right||0!==e.top||0!==e.bottom){var t={context:O,canvas:T,input:e,history:Zk};DI.filterLib.cropExtend.apply(t),xe.update(),N.resetView(),fe.update(N.getScale(),N.getAngleDeg())}}),te,e)}),n.saveReminder),Ee=new DI.SettingsTab((function(){y="left"===y?"right":"left",u(),n.embed||Wk.setItem("uiState",y)}),n.aboutEl);M=new DI.TabRow({initialId:"draw",tabArr:[{id:"draw",title:dE("tool-brush"),image:t(ST),onOpen:function(){"eraserBrush"===P&&le.enable(!1),Gk.append(ue,[le.getElement(),le.getOutputElement(),he.getElement()]),ce.style.display="block"},onClose:function(){ce.style.display="none"},css:{minWidth:"45px"}},{id:"hand",title:dE("tool-hand"),image:t(RT),isVisible:!1,onOpen:function(){fe.setIsVisible(!0)},onClose:function(){fe.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"fill",title:dE("tool-paint-bucket"),image:t(kT),isVisible:!1,onOpen:function(){le.enable(!0),ge.setIsVisible(!0)},onClose:function(){ge.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"text",title:dE("tool-text"),image:t(ET),isVisible:!1,onOpen:function(){le.enable(!0),ve.setIsVisible(!0)},onClose:function(){ve.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"shape",title:dE("tool-shape"),image:t(TT),isVisible:!1,onOpen:function(){le.enable(!0),me.setIsVisible(!0)},onClose:function(){me.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"layers",title:dE("tab-layers"),image:t(oR),onOpen:function(){xe.update(),xe.style.display="block"},onClose:function(){xe.style.display="none"},css:{minWidth:"45px"}},{id:"edit",label:dE("tab-edit"),onOpen:function(){we.show()},onClose:function(){we.hide()},css:{padding:"0 7px"}},{id:"file",label:dE("tab-file"),isVisible:!!ke,onOpen:function(){ke&&(ke.getElement().style.display="block",ke.setIsVisible(!0))},onClose:function(){ke&&(ke.getElement().style.display="none",ke.setIsVisible(!1))},css:{padding:"0 7px"}},{id:"settings",title:dE("tab-settings"),image:t(aR),onOpen:function(){Ee.getElement().style.display="block"},onClose:function(){Ee.getElement().style.display="none"},css:{minWidth:"45px"}}]});var Te=Gk.el({css:{width:"270px",position:"absolute",bottom:"0",left:"0"}});n.bottomBar&&(Te.append(n.bottomBar),new MutationObserver((function(){return g()})).observe(re,{attributes:!0,childList:!0,subtree:!0}));Gk.append(re,[be.getElement(),M.getElement(),ce,fe.getElement(),ge.getElement(),ve.getElement(),me.getElement(),xe,we.getElement(),ke?ke.getElement():null,Ee.getElement(),Gk.el({css:{height:"10px"}}),Te||null]);var Me,Ie=new DI.ToolspaceScroller({toolspace:ne,uiState:y});this.getEl=function(){return w},this.resize=function(e,t){window.scrollY>0&&window.scrollTo(0,0),C===Math.max(0,e)&&S===Math.max(0,t)||(C=Math.max(0,e),S=Math.max(0,t),c(),g(),be.setIsVisible(S>=579),le.setHeight(Math.max(163,Math.min(400,S-505))),se.setIsSmall(S<540))},this.out=function(e){te.out(e)},this.getPNG=function(){return dI(T.getCompleteCanvas(1).toDataURL("image/png"))},this.getPSD=(Me=o.default(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rR(T);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return Me.apply(this,arguments)}),this.swapUiLeftRight=function(){y="left"===y?"right":"left",n.embed||Wk.setItem("uiState",y),u()},this.resize(C,S),u();var Re=this;Gk.addEventListener(window,"resize",(function(){Re.resize(window.innerWidth,window.innerHeight)})),Gk.addEventListener(window,"orientationchange",(function(){Re.resize(window.innerWidth,window.innerHeight)}));var Ae=Gk.el({parent:document.body,css:{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",pointerEvents:"none",zIndex:"-1",userSelect:"none"}});new ResizeObserver((function(){return Re.resize(window.innerWidth,window.innerHeight)})).observe(Ae),Gk.addEventListener(this.getEl(),"wheel",(function(e){e.preventDefault()}));var Le=function(e){e.preventDefault()};window.addEventListener("gesturestart",Le),window.addEventListener("gesturechange",Le),window.addEventListener("gestureend",Le)}oR=a("f6OTe").getBundleURL("lYbF2")+a("2evKT").resolve("bBxqy"),yM.isLoaded||(sR,nR(xM.glBrightnessContrast,HI),nR(xM.cropExtend,UI),nR(xM.glCurves,YI),nR(xM.flip,VI),nR(xM.glHueSaturation,WI),nR(xM.invert,GI),nR(xM.glPerspective,KI),nR(xM.resize,qI),nR(xM.rotate,JI),nR(xM.glTiltShift,ZI),nR(xM.transform,QI),nR(xM.glBlur,$I),nR(xM.glUnsharpMask,eR),nR(xM.toAlpha,tR),yM.isLoaded=!0),o.default(t(s).mark((function e(){var n,r,i,a,l;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return l.apply(this,arguments)},l=function(){return(l=o.default(t(s).mark((function e(){var i,o,l,c;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Gk.removeEventListener(window,"DOMContentLoaded",a),i=new DI.ProjectStore,o=null,e.prev=3,e.next=6,i.read();case 6:(l=e.sent)&&(o=l.project),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),"db-error"===e.t0.message?c="Failed to access Browser Storage":"format-error"===e.t0.message&&(c="Failed to restore from Browser Storage"),c&&setTimeout((function(){throw r&&r.out(c),new Error("Initial browser storage error, "+e.t0)}),100);case 15:n(o,i);case 16:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)},n=function(e,t){if(r)throw"onKlProjectObjLoaded called more than once";var n=document.getElementById("loading-screen");try{n.parentNode.removeChild(n)}catch(e){}var i=new DI.SaveReminder(Zk,!0,!0);r=new lR(e,{saveReminder:i,projectStore:t}),i.init(),e&&setTimeout((function(){r.out(dE("file-storage-restored"))}),100),document.body.appendChild(r.getEl())},i=!1,Gk.addEventListener(window,"DOMContentLoaded",(function(){i=!0})),e.next=8,hE.setLanguage(sE);case 8:i?a():Gk.addEventListener(window,"DOMContentLoaded",a);case 11:case"end":return e.stop()}}),e)})))()}();
//# sourceMappingURL=index.88d490c3.js.map
